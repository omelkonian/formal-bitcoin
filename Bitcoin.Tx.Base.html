<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Bitcoin.Tx.Base</title><link rel="stylesheet" href="css/Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- Transactions.</a>
<a id="91" class="Comment">------------------------------------------------------------------------</a>
<a id="164" class="Keyword">module</a> <a id="171" href="Bitcoin.Tx.Base.html" class="Module">Bitcoin.Tx.Base</a> <a id="187" class="Keyword">where</a>

<a id="194" class="Keyword">open</a> <a id="199" class="Keyword">import</a> <a id="206" href="Prelude.Init.html" class="Module">Prelude.Init</a>
<a id="219" class="Keyword">open</a> <a id="224" class="Keyword">import</a> <a id="231" href="Prelude.Lists.html" class="Module">Prelude.Lists</a>
<a id="245" class="Keyword">open</a> <a id="250" class="Keyword">import</a> <a id="257" href="Prelude.DecEq.html" class="Module">Prelude.DecEq</a>

<a id="272" class="Keyword">open</a> <a id="277" class="Keyword">import</a> <a id="284" href="Bitcoin.BasicTypes.html" class="Module">Bitcoin.BasicTypes</a>
<a id="303" class="Keyword">open</a> <a id="308" class="Keyword">import</a> <a id="315" href="Bitcoin.Script.Base.html" class="Module">Bitcoin.Script.Base</a>

<a id="336" class="Keyword">record</a> <a id="TxInput"></a><a id="343" href="Bitcoin.Tx.Base.html#343" class="Record">TxInput</a> <a id="351" class="Symbol">:</a> <a id="353" class="PrimitiveType">Set</a> <a id="357" class="Keyword">where</a>
  <a id="365" class="Keyword">constructor</a> <a id="_at_"></a><a id="377" href="Bitcoin.Tx.Base.html#377" class="InductiveConstructor Operator">_at_</a>
  <a id="384" class="Keyword">field</a>
    <a id="TxInput.txId"></a><a id="394" href="Bitcoin.Tx.Base.html#394" class="Field">txId</a>  <a id="400" class="Symbol">:</a> <a id="402" href="Bitcoin.BasicTypes.html#266" class="Function">HashId</a>  <a id="410" class="Comment">-- referenced previous transaction</a>
    <a id="TxInput.index"></a><a id="449" href="Bitcoin.Tx.Base.html#449" class="Field">index</a> <a id="455" class="Symbol">:</a> <a id="457" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>       <a id="465" class="Comment">-- index in the referenced transaction&#39;s outputs</a>
<a id="514" class="Keyword">open</a> <a id="519" href="Bitcoin.Tx.Base.html#343" class="Module">TxInput</a> <a id="527" class="Keyword">public</a>
<a id="534" class="Keyword">unquoteDecl</a> <a id="DecEqᵢ"></a><a id="546" href="Bitcoin.Tx.Base.html#546" class="Function">DecEqᵢ</a> <a id="553" class="Symbol">=</a> <a id="555" href="Prelude.Generics.html#5231" class="Function">DERIVE</a> <a id="562" href="Prelude.DecEq.html#550" class="Record">DecEq</a> <a id="568" href="Data.List.Base.html#4458" class="Function Operator">[</a> <a id="570" class="Keyword">quote</a> <a id="576" href="Bitcoin.Tx.Base.html#343" class="Record">TxInput</a> <a id="584" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="586" href="Bitcoin.Tx.Base.html#546" class="Function">DecEqᵢ</a> <a id="593" href="Data.List.Base.html#4458" class="Function Operator">]</a>

<a id="596" class="Keyword">record</a> <a id="TxOutput"></a><a id="603" href="Bitcoin.Tx.Base.html#603" class="Record">TxOutput</a> <a id="612" class="Symbol">(</a><a id="613" href="Bitcoin.Tx.Base.html#613" class="Bound">ctx</a> <a id="617" class="Symbol">:</a> <a id="619" href="Bitcoin.Script.Base.html#323" class="Datatype">ScriptContext</a><a id="632" class="Symbol">)</a> <a id="634" class="Symbol">:</a> <a id="636" class="PrimitiveType">Set</a> <a id="640" class="Keyword">where</a>
  <a id="648" class="Keyword">field</a>
    <a id="TxOutput.value"></a><a id="658" href="Bitcoin.Tx.Base.html#658" class="Field">value</a>     <a id="668" class="Symbol">:</a> <a id="670" href="Bitcoin.BasicTypes.html#222" class="Function">Value</a>
    <a id="TxOutput.validator"></a><a id="680" href="Bitcoin.Tx.Base.html#680" class="Field">validator</a> <a id="690" class="Symbol">:</a> <a id="692" href="Bitcoin.Script.Base.html#2100" class="Datatype">BitcoinScript</a> <a id="706" href="Bitcoin.Tx.Base.html#613" class="Bound">ctx</a>
<a id="710" class="Keyword">open</a> <a id="715" href="Bitcoin.Tx.Base.html#603" class="Module">TxOutput</a> <a id="724" class="Keyword">public</a>
<a id="731" class="Keyword">unquoteDecl</a> <a id="DecEqₒ"></a><a id="743" href="Bitcoin.Tx.Base.html#743" class="Function">DecEqₒ</a> <a id="750" class="Symbol">=</a> <a id="752" href="Prelude.Generics.html#5231" class="Function">DERIVE</a> <a id="759" href="Prelude.DecEq.html#550" class="Record">DecEq</a> <a id="765" href="Data.List.Base.html#4458" class="Function Operator">[</a> <a id="767" class="Keyword">quote</a> <a id="773" href="Bitcoin.Tx.Base.html#603" class="Record">TxOutput</a> <a id="782" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="784" href="Bitcoin.Tx.Base.html#743" class="Function">DecEqₒ</a> <a id="791" href="Data.List.Base.html#4458" class="Function Operator">]</a>
<a id="∃TxOutput"></a><a id="793" href="Bitcoin.Tx.Base.html#793" class="Function">∃TxOutput</a> <a id="803" class="Symbol">=</a> <a id="805" href="Data.Product.html#1788" class="Function">∃[</a> <a id="808" href="Bitcoin.Tx.Base.html#808" class="Bound">ctx</a> <a id="812" href="Data.Product.html#1788" class="Function">]</a> <a id="814" href="Bitcoin.Tx.Base.html#603" class="Record">TxOutput</a> <a id="823" href="Bitcoin.Tx.Base.html#808" class="Bound">ctx</a>

<a id="Witness"></a><a id="828" href="Bitcoin.Tx.Base.html#828" class="Function">Witness</a> <a id="836" class="Symbol">:</a> <a id="838" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a> <a id="840" class="Symbol">→</a> <a id="842" class="PrimitiveType">Set</a>
<a id="846" href="Bitcoin.Tx.Base.html#828" class="Function">Witness</a> <a id="854" href="Bitcoin.Tx.Base.html#854" class="Bound">n</a> <a id="856" class="Symbol">=</a> <a id="858" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="862" href="Agda.Builtin.Int.html#246" class="Datatype">ℤ</a> <a id="864" href="Bitcoin.Tx.Base.html#854" class="Bound">n</a>

<a id="∃Witness"></a><a id="867" href="Bitcoin.Tx.Base.html#867" class="Function">∃Witness</a> <a id="876" class="Symbol">=</a> <a id="878" href="Data.Product.html#1788" class="Function">∃[</a> <a id="881" href="Bitcoin.Tx.Base.html#881" class="Bound">n</a> <a id="883" href="Data.Product.html#1788" class="Function">]</a> <a id="885" href="Bitcoin.Tx.Base.html#828" class="Function">Witness</a> <a id="893" href="Bitcoin.Tx.Base.html#881" class="Bound">n</a>

<a id="896" class="Keyword">record</a> <a id="Tx"></a><a id="903" href="Bitcoin.Tx.Base.html#903" class="Record">Tx</a> <a id="906" class="Symbol">(</a><a id="907" href="Bitcoin.Tx.Base.html#907" class="Bound">i</a> <a id="909" href="Bitcoin.Tx.Base.html#909" class="Bound">o</a> <a id="911" class="Symbol">:</a> <a id="913" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a><a id="914" class="Symbol">)</a> <a id="916" class="Symbol">:</a> <a id="918" class="PrimitiveType">Set</a> <a id="922" class="Keyword">where</a>
  <a id="930" class="Keyword">field</a>
    <a id="Tx.inputs"></a><a id="940" href="Bitcoin.Tx.Base.html#940" class="Field">inputs</a>  <a id="948" class="Symbol">:</a> <a id="950" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="954" href="Bitcoin.Tx.Base.html#343" class="Record">TxInput</a>  <a id="963" href="Bitcoin.Tx.Base.html#907" class="Bound">i</a>   <a id="967" class="Comment">-- inputs</a>
    <a id="Tx.wit"></a><a id="981" href="Bitcoin.Tx.Base.html#981" class="Field">wit</a>     <a id="989" class="Symbol">:</a> <a id="991" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="995" href="Bitcoin.Tx.Base.html#867" class="Function">∃Witness</a> <a id="1004" href="Bitcoin.Tx.Base.html#907" class="Bound">i</a>   <a id="1008" class="Comment">-- segragated witnesses</a>
    <a id="Tx.relLock"></a><a id="1036" href="Bitcoin.Tx.Base.html#1036" class="Field">relLock</a> <a id="1044" class="Symbol">:</a> <a id="1046" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="1050" href="Bitcoin.BasicTypes.html#245" class="Function">Time</a>     <a id="1059" href="Bitcoin.Tx.Base.html#907" class="Bound">i</a>   <a id="1063" class="Comment">-- relative timelocks</a>

    <a id="Tx.outputs"></a><a id="1090" href="Bitcoin.Tx.Base.html#1090" class="Field">outputs</a> <a id="1098" class="Symbol">:</a> <a id="1100" href="Data.Vec.Base.html#959" class="Datatype">Vec</a> <a id="1104" href="Bitcoin.Tx.Base.html#793" class="Function">∃TxOutput</a> <a id="1114" href="Bitcoin.Tx.Base.html#909" class="Bound">o</a>  <a id="1117" class="Comment">-- outputs</a>
    <a id="Tx.absLock"></a><a id="1132" href="Bitcoin.Tx.Base.html#1132" class="Field">absLock</a> <a id="1140" class="Symbol">:</a> <a id="1142" href="Bitcoin.BasicTypes.html#245" class="Function">Time</a>             <a id="1159" class="Comment">-- absolute timelock</a>
<a id="1180" class="Keyword">open</a> <a id="1185" href="Bitcoin.Tx.Base.html#903" class="Module">Tx</a> <a id="1188" class="Keyword">public</a>

<a id="1196" class="Keyword">unquoteDecl</a> <a id="DecEqₜₓ"></a><a id="1208" href="Bitcoin.Tx.Base.html#1208" class="Function">DecEqₜₓ</a> <a id="1216" class="Symbol">=</a> <a id="1218" href="Prelude.Generics.html#5231" class="Function">DERIVE</a> <a id="1225" href="Prelude.DecEq.html#550" class="Record">DecEq</a> <a id="1231" href="Data.List.Base.html#4458" class="Function Operator">[</a> <a id="1233" class="Keyword">quote</a> <a id="1239" href="Bitcoin.Tx.Base.html#903" class="Record">Tx</a> <a id="1242" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1244" href="Bitcoin.Tx.Base.html#1208" class="Function">DecEqₜₓ</a> <a id="1252" href="Data.List.Base.html#4458" class="Function Operator">]</a>

<a id="∃Tx"></a><a id="1255" href="Bitcoin.Tx.Base.html#1255" class="Function">∃Tx</a> <a id="1259" class="Symbol">=</a> <a id="1261" href="Data.Product.html#1788" class="Function">∃[</a> <a id="1264" href="Bitcoin.Tx.Base.html#1264" class="Bound">i</a> <a id="1266" href="Data.Product.html#1788" class="Function">]</a> <a id="1268" href="Data.Product.html#1788" class="Function">∃[</a> <a id="1271" href="Bitcoin.Tx.Base.html#1271" class="Bound">o</a> <a id="1273" href="Data.Product.html#1788" class="Function">]</a> <a id="1275" href="Bitcoin.Tx.Base.html#903" class="Record">Tx</a> <a id="1278" href="Bitcoin.Tx.Base.html#1264" class="Bound">i</a> <a id="1280" href="Bitcoin.Tx.Base.html#1271" class="Bound">o</a>

<a id="1283" class="Keyword">variable</a>
  <a id="1294" href="Bitcoin.Tx.Base.html#1294" class="Generalizable">i</a> <a id="1296" href="Bitcoin.Tx.Base.html#1296" class="Generalizable">i′</a> <a id="1299" href="Bitcoin.Tx.Base.html#1299" class="Generalizable">o</a> <a id="1301" href="Bitcoin.Tx.Base.html#1301" class="Generalizable">o′</a> <a id="1304" class="Symbol">:</a> <a id="1306" href="Agda.Builtin.Nat.html#192" class="Datatype">ℕ</a>
  <a id="1310" class="Comment">-- T T′ : ∃Tx</a>

<a id="_‼ⁱ_"></a><a id="1325" href="Bitcoin.Tx.Base.html#1325" class="Function Operator">_‼ⁱ_</a> <a id="1330" class="Symbol">:</a> <a id="1332" href="Bitcoin.Tx.Base.html#903" class="Record">Tx</a> <a id="1335" href="Bitcoin.Tx.Base.html#1294" class="Generalizable">i</a> <a id="1337" href="Bitcoin.Tx.Base.html#1299" class="Generalizable">o</a> <a id="1339" class="Symbol">→</a> <a id="1341" href="Data.Fin.Base.html#1066" class="Datatype">Fin</a> <a id="1345" href="Bitcoin.Tx.Base.html#1294" class="Generalizable">i</a> <a id="1347" class="Symbol">→</a> <a id="1349" href="Bitcoin.Tx.Base.html#343" class="Record">TxInput</a>
<a id="1357" href="Bitcoin.Tx.Base.html#1357" class="Bound">tx</a> <a id="1360" href="Bitcoin.Tx.Base.html#1325" class="Function Operator">‼ⁱ</a> <a id="1363" href="Bitcoin.Tx.Base.html#1363" class="Bound">i</a> <a id="1365" class="Symbol">=</a> <a id="1367" href="Data.Vec.Base.html#1566" class="Function">V.lookup</a> <a id="1376" class="Symbol">(</a><a id="1377" href="Bitcoin.Tx.Base.html#940" class="Field">inputs</a> <a id="1384" href="Bitcoin.Tx.Base.html#1357" class="Bound">tx</a><a id="1386" class="Symbol">)</a> <a id="1388" href="Bitcoin.Tx.Base.html#1363" class="Bound">i</a>

<a id="_‼ʷ_"></a><a id="1391" href="Bitcoin.Tx.Base.html#1391" class="Function Operator">_‼ʷ_</a> <a id="1396" class="Symbol">:</a> <a id="1398" href="Bitcoin.Tx.Base.html#903" class="Record">Tx</a> <a id="1401" href="Bitcoin.Tx.Base.html#1294" class="Generalizable">i</a> <a id="1403" href="Bitcoin.Tx.Base.html#1299" class="Generalizable">o</a> <a id="1405" class="Symbol">→</a> <a id="1407" href="Data.Fin.Base.html#1066" class="Datatype">Fin</a> <a id="1411" href="Bitcoin.Tx.Base.html#1294" class="Generalizable">i</a> <a id="1413" class="Symbol">→</a> <a id="1415" href="Bitcoin.Tx.Base.html#867" class="Function">∃Witness</a>
<a id="1424" href="Bitcoin.Tx.Base.html#1424" class="Bound">tx</a> <a id="1427" href="Bitcoin.Tx.Base.html#1391" class="Function Operator">‼ʷ</a> <a id="1430" href="Bitcoin.Tx.Base.html#1430" class="Bound">i</a> <a id="1432" class="Symbol">=</a> <a id="1434" href="Data.Vec.Base.html#1566" class="Function">V.lookup</a> <a id="1443" class="Symbol">(</a><a id="1444" href="Bitcoin.Tx.Base.html#981" class="Field">wit</a> <a id="1448" href="Bitcoin.Tx.Base.html#1424" class="Bound">tx</a><a id="1450" class="Symbol">)</a> <a id="1452" href="Bitcoin.Tx.Base.html#1430" class="Bound">i</a>

<a id="_‼ʳ_"></a><a id="1455" href="Bitcoin.Tx.Base.html#1455" class="Function Operator">_‼ʳ_</a> <a id="1460" class="Symbol">:</a> <a id="1462" href="Bitcoin.Tx.Base.html#903" class="Record">Tx</a> <a id="1465" href="Bitcoin.Tx.Base.html#1294" class="Generalizable">i</a> <a id="1467" href="Bitcoin.Tx.Base.html#1299" class="Generalizable">o</a> <a id="1469" class="Symbol">→</a> <a id="1471" href="Data.Fin.Base.html#1066" class="Datatype">Fin</a> <a id="1475" href="Bitcoin.Tx.Base.html#1294" class="Generalizable">i</a> <a id="1477" class="Symbol">→</a> <a id="1479" href="Bitcoin.BasicTypes.html#245" class="Function">Time</a>
<a id="1484" href="Bitcoin.Tx.Base.html#1484" class="Bound">tx</a> <a id="1487" href="Bitcoin.Tx.Base.html#1455" class="Function Operator">‼ʳ</a> <a id="1490" href="Bitcoin.Tx.Base.html#1490" class="Bound">i</a> <a id="1492" class="Symbol">=</a> <a id="1494" href="Data.Vec.Base.html#1566" class="Function">V.lookup</a> <a id="1503" class="Symbol">(</a><a id="1504" href="Bitcoin.Tx.Base.html#1036" class="Field">relLock</a> <a id="1512" href="Bitcoin.Tx.Base.html#1484" class="Bound">tx</a><a id="1514" class="Symbol">)</a> <a id="1516" href="Bitcoin.Tx.Base.html#1490" class="Bound">i</a>

<a id="_‼ᵒ_"></a><a id="1519" href="Bitcoin.Tx.Base.html#1519" class="Function Operator">_‼ᵒ_</a> <a id="1524" class="Symbol">:</a> <a id="1526" href="Bitcoin.Tx.Base.html#903" class="Record">Tx</a> <a id="1529" href="Bitcoin.Tx.Base.html#1294" class="Generalizable">i</a> <a id="1531" href="Bitcoin.Tx.Base.html#1299" class="Generalizable">o</a> <a id="1533" class="Symbol">→</a> <a id="1535" href="Data.Fin.Base.html#1066" class="Datatype">Fin</a> <a id="1539" href="Bitcoin.Tx.Base.html#1299" class="Generalizable">o</a> <a id="1541" class="Symbol">→</a> <a id="1543" href="Bitcoin.Tx.Base.html#793" class="Function">∃TxOutput</a>
<a id="1553" href="Bitcoin.Tx.Base.html#1553" class="Bound">tx</a> <a id="1556" href="Bitcoin.Tx.Base.html#1519" class="Function Operator">‼ᵒ</a> <a id="1559" href="Bitcoin.Tx.Base.html#1559" class="Bound">i</a> <a id="1561" class="Symbol">=</a> <a id="1563" href="Data.Vec.Base.html#1566" class="Function">V.lookup</a> <a id="1572" class="Symbol">(</a><a id="1573" href="Bitcoin.Tx.Base.html#1090" class="Field">outputs</a> <a id="1581" href="Bitcoin.Tx.Base.html#1553" class="Bound">tx</a><a id="1583" class="Symbol">)</a> <a id="1585" href="Bitcoin.Tx.Base.html#1559" class="Bound">i</a>

<a id="1588" class="Comment">-- Coinbase transactions start at time t=0.</a>
<a id="Coinbase"></a><a id="1632" href="Bitcoin.Tx.Base.html#1632" class="Function">Coinbase</a> <a id="1641" class="Symbol">:</a> <a id="1643" href="Bitcoin.Tx.Base.html#903" class="Record">Tx</a> <a id="1646" class="Number">0</a> <a id="1648" href="Bitcoin.Tx.Base.html#1299" class="Generalizable">o</a> <a id="1650" class="Symbol">→</a> <a id="1652" class="PrimitiveType">Set</a>
<a id="1656" href="Bitcoin.Tx.Base.html#1632" class="Function">Coinbase</a> <a id="1665" href="Bitcoin.Tx.Base.html#1665" class="Bound">tx</a> <a id="1668" class="Symbol">=</a> <a id="1670" href="Bitcoin.Tx.Base.html#1132" class="Field">absLock</a> <a id="1678" href="Bitcoin.Tx.Base.html#1665" class="Bound">tx</a> <a id="1681" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="1683" class="Number">0</a>

<a id="1686" class="Comment">-- Timed transactions.</a>
<a id="1709" class="Keyword">record</a> <a id="TimedTx"></a><a id="1716" href="Bitcoin.Tx.Base.html#1716" class="Record">TimedTx</a> <a id="1724" class="Symbol">:</a> <a id="1726" class="PrimitiveType">Set</a> <a id="1730" class="Keyword">where</a>
  <a id="1738" class="Keyword">constructor</a> <a id="_at_"></a><a id="1750" href="Bitcoin.Tx.Base.html#1750" class="InductiveConstructor Operator">_at_</a>
  <a id="1757" class="Keyword">field</a>
    <a id="TimedTx.transaction"></a><a id="1767" href="Bitcoin.Tx.Base.html#1767" class="Field">transaction</a> <a id="1779" class="Symbol">:</a> <a id="1781" href="Bitcoin.Tx.Base.html#1255" class="Function">∃Tx</a>
    <a id="TimedTx.time"></a><a id="1789" href="Bitcoin.Tx.Base.html#1789" class="Field">time</a>        <a id="1801" class="Symbol">:</a> <a id="1803" href="Bitcoin.BasicTypes.html#245" class="Function">Time</a>
<a id="1808" class="Keyword">open</a> <a id="1813" href="Bitcoin.Tx.Base.html#1716" class="Module">TimedTx</a> <a id="1821" class="Keyword">public</a>

<a id="1829" class="Keyword">unquoteDecl</a> <a id="DecEqₜₜₓ"></a><a id="1841" href="Bitcoin.Tx.Base.html#1841" class="Function">DecEqₜₜₓ</a> <a id="1850" class="Symbol">=</a> <a id="1852" href="Prelude.Generics.html#5231" class="Function">DERIVE</a> <a id="1859" href="Prelude.DecEq.html#550" class="Record">DecEq</a> <a id="1865" href="Data.List.Base.html#4458" class="Function Operator">[</a> <a id="1867" class="Keyword">quote</a> <a id="1873" href="Bitcoin.Tx.Base.html#1716" class="Record">TimedTx</a> <a id="1881" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1883" href="Bitcoin.Tx.Base.html#1841" class="Function">DecEqₜₜₓ</a> <a id="1892" href="Data.List.Base.html#4458" class="Function Operator">]</a>
</pre></body></html>