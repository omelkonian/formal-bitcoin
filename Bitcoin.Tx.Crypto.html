<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Bitcoin.Tx.Crypto</title><link rel="stylesheet" href="css/Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- Hashing/signing transactions.</a>
<a id="107" class="Comment">------------------------------------------------------------------------</a>
<a id="180" class="Keyword">module</a> <a id="187" href="Bitcoin.Tx.Crypto.html" class="Module">Bitcoin.Tx.Crypto</a> <a id="205" class="Keyword">where</a>

<a id="212" class="Keyword">open</a> <a id="217" class="Keyword">import</a> <a id="224" href="Data.Vec.html" class="Module">Data.Vec</a> <a id="233" class="Keyword">using</a> <a id="239" class="Symbol">(</a><a id="240" href="Data.Vec.Base.html#2386" class="Function Operator">_[_]≔_</a><a id="246" class="Symbol">)</a>

<a id="249" class="Keyword">open</a> <a id="254" class="Keyword">import</a> <a id="261" href="Prelude.Init.html" class="Module">Prelude.Init</a>
<a id="274" class="Keyword">open</a> <a id="279" class="Keyword">import</a> <a id="286" href="Prelude.Functor.html" class="Module">Prelude.Functor</a>
<a id="302" class="Keyword">open</a> <a id="307" class="Keyword">import</a> <a id="314" href="Prelude.ToN.html" class="Module">Prelude.ToN</a>

<a id="327" class="Keyword">open</a> <a id="332" class="Keyword">import</a> <a id="339" href="Bitcoin.BasicTypes.html" class="Module">Bitcoin.BasicTypes</a>
<a id="358" class="Keyword">open</a> <a id="363" class="Keyword">import</a> <a id="370" href="Bitcoin.Crypto.html" class="Module">Bitcoin.Crypto</a>
<a id="385" class="Keyword">open</a> <a id="390" class="Keyword">import</a> <a id="397" href="Bitcoin.Tx.Base.html" class="Module">Bitcoin.Tx.Base</a>
<a id="413" class="Keyword">open</a> <a id="418" class="Keyword">import</a> <a id="425" href="Bitcoin.Script.Base.html" class="Module">Bitcoin.Script.Base</a>

<a id="446" class="Comment">-- Remove witnesses (i.e. adhere to SegregatedWitness feature of Bitcoin)</a>
<a id="wit⊥"></a><a id="520" href="Bitcoin.Tx.Crypto.html#520" class="Function">wit⊥</a> <a id="525" class="Symbol">:</a> <a id="527" class="Symbol">∀</a> <a id="529" class="Symbol">{</a><a id="530" href="Bitcoin.Tx.Crypto.html#530" class="Bound">n</a><a id="531" class="Symbol">}</a> <a id="533" class="Symbol">→</a> <a id="535" href="Data.Vec.Base.html#998" class="Datatype">Vec</a> <a id="539" href="Bitcoin.Tx.Base.html#867" class="Function">∃Witness</a> <a id="548" href="Bitcoin.Tx.Crypto.html#530" class="Bound">n</a>
<a id="550" href="Bitcoin.Tx.Crypto.html#520" class="Function">wit⊥</a> <a id="555" class="Symbol">=</a> <a id="557" href="Data.Vec.Base.html#5784" class="Function">V.replicate</a> <a id="569" class="Symbol">(_</a> <a id="572" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="574" href="Data.Vec.Base.html#1034" class="InductiveConstructor">[]</a><a id="576" class="Symbol">)</a>

<a id="wit→⊥"></a><a id="579" href="Bitcoin.Tx.Crypto.html#579" class="Function">wit→⊥</a> <a id="585" class="Symbol">:</a> <a id="587" href="Bitcoin.Tx.Base.html#903" class="Record">Tx</a> <a id="590" href="Bitcoin.Tx.Base.html#1914" class="Generalizable">i</a> <a id="592" href="Bitcoin.Tx.Base.html#1919" class="Generalizable">o</a> <a id="594" class="Symbol">→</a> <a id="596" href="Bitcoin.Tx.Base.html#903" class="Record">Tx</a> <a id="599" href="Bitcoin.Tx.Base.html#1914" class="Generalizable">i</a> <a id="601" href="Bitcoin.Tx.Base.html#1919" class="Generalizable">o</a>
<a id="603" href="Bitcoin.Tx.Crypto.html#579" class="Function">wit→⊥</a> <a id="609" href="Bitcoin.Tx.Crypto.html#609" class="Bound">tx</a> <a id="612" class="Symbol">=</a> <a id="614" class="Keyword">record</a> <a id="621" href="Bitcoin.Tx.Crypto.html#609" class="Bound">tx</a> <a id="624" class="Symbol">{</a> <a id="626" href="Bitcoin.Tx.Base.html#981" class="Field">wit</a> <a id="630" class="Symbol">=</a> <a id="632" href="Bitcoin.Tx.Crypto.html#520" class="Function">wit⊥</a> <a id="637" class="Symbol">}</a>

<a id="640" class="Comment">-- Sign a transaction</a>
<a id="μ"></a><a id="662" href="Bitcoin.Tx.Crypto.html#662" class="Function">μ</a> <a id="664" class="Symbol">:</a> <a id="666" href="Bitcoin.Tx.Base.html#903" class="Record">Tx</a> <a id="669" href="Bitcoin.Tx.Base.html#1914" class="Generalizable">i</a> <a id="671" href="Bitcoin.Tx.Base.html#1919" class="Generalizable">o</a> <a id="673" class="Symbol">→</a> <a id="675" href="Data.Fin.Base.html#1126" class="Datatype">Fin</a> <a id="679" href="Bitcoin.Tx.Base.html#1914" class="Generalizable">i</a> <a id="681" class="Symbol">→</a> <a id="683" href="Bitcoin.Tx.Base.html#903" class="Record">Tx</a> <a id="686" href="Bitcoin.Tx.Base.html#1914" class="Generalizable">i</a> <a id="688" href="Bitcoin.Tx.Base.html#1919" class="Generalizable">o</a>
<a id="690" href="Bitcoin.Tx.Crypto.html#662" class="Function">μ</a> <a id="692" class="Symbol">{</a><a id="693" class="Argument">i</a> <a id="695" class="Symbol">=</a> <a id="697" href="Agda.Builtin.Nat.html#223" class="InductiveConstructor">suc</a> <a id="701" class="Symbol">_}</a> <a id="704" href="Bitcoin.Tx.Crypto.html#704" class="Bound">tx</a> <a id="707" href="Bitcoin.Tx.Crypto.html#707" class="Bound">i′</a> <a id="710" class="Symbol">=</a> <a id="712" class="Keyword">record</a> <a id="719" href="Bitcoin.Tx.Crypto.html#704" class="Bound">tx</a> <a id="722" class="Symbol">{</a> <a id="724" href="Bitcoin.Tx.Base.html#981" class="Field">wit</a> <a id="728" class="Symbol">=</a> <a id="730" href="Bitcoin.Tx.Crypto.html#520" class="Function">wit⊥</a> <a id="735" href="Data.Vec.Base.html#2386" class="Function Operator">[</a> <a id="737" href="Data.Fin.Patterns.html#390" class="InductiveConstructor">0F</a> <a id="740" href="Data.Vec.Base.html#2386" class="Function Operator">]≔</a> <a id="743" class="Symbol">(_</a> <a id="746" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="748" href="Data.Vec.Base.html#5750" class="Function Operator">V.[</a> <a id="752" href="Agda.Builtin.Int.html#264" class="InductiveConstructor Operator">+</a> <a id="754" class="Symbol">(</a><a id="755" href="Prelude.ToN.html#102" class="Field">toℕ</a> <a id="759" href="Bitcoin.Tx.Crypto.html#707" class="Bound">i′</a><a id="761" class="Symbol">)</a> <a id="763" href="Data.Vec.Base.html#5750" class="Function Operator">]</a><a id="764" class="Symbol">)</a> <a id="766" class="Symbol">}</a>

<a id="sig"></a><a id="769" href="Bitcoin.Tx.Crypto.html#769" class="Function">sig</a> <a id="773" class="Symbol">:</a> <a id="775" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="780" href="Bitcoin.Crypto.html#345" class="Record">KeyPair</a> <a id="788" class="Symbol">→</a> <a id="790" href="Bitcoin.Tx.Base.html#903" class="Record">Tx</a> <a id="793" href="Bitcoin.Tx.Base.html#1914" class="Generalizable">i</a> <a id="795" href="Bitcoin.Tx.Base.html#1919" class="Generalizable">o</a> <a id="797" class="Symbol">→</a> <a id="799" href="Data.Fin.Base.html#1126" class="Datatype">Fin</a> <a id="803" href="Bitcoin.Tx.Base.html#1914" class="Generalizable">i</a> <a id="805" class="Symbol">→</a> <a id="807" href="Bitcoin.Tx.Base.html#903" class="Record">Tx</a> <a id="810" href="Bitcoin.Tx.Base.html#1914" class="Generalizable">i</a> <a id="812" href="Bitcoin.Tx.Base.html#1919" class="Generalizable">o</a>
<a id="814" href="Bitcoin.Tx.Crypto.html#769" class="Function">sig</a> <a id="818" href="Bitcoin.Tx.Crypto.html#818" class="Bound">ks</a> <a id="821" href="Bitcoin.Tx.Crypto.html#821" class="Bound">tx</a> <a id="824" href="Bitcoin.Tx.Crypto.html#824" class="Bound">i</a> <a id="826" class="Symbol">=</a> <a id="828" class="Keyword">record</a> <a id="835" href="Bitcoin.Tx.Crypto.html#821" class="Bound">tx</a> <a id="838" class="Symbol">{</a> <a id="840" href="Bitcoin.Tx.Base.html#981" class="Field">wit</a> <a id="844" class="Symbol">=</a> <a id="846" href="Bitcoin.Tx.Base.html#981" class="Field">wit</a> <a id="850" href="Bitcoin.Tx.Crypto.html#821" class="Bound">tx</a> <a id="853" href="Data.Vec.Base.html#2386" class="Function Operator">[</a> <a id="855" href="Bitcoin.Tx.Crypto.html#824" class="Bound">i</a> <a id="857" href="Data.Vec.Base.html#2386" class="Function Operator">]≔</a> <a id="860" class="Symbol">(_</a> <a id="863" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="865" href="Data.Vec.Base.html#7540" class="Function">V.fromList</a> <a id="876" class="Symbol">(</a><a id="877" href="Function.Base.html#1554" class="Function">flip</a> <a id="882" href="Bitcoin.Crypto.html#654" class="Postulate">SIG</a> <a id="886" class="Symbol">(</a><a id="887" href="Bitcoin.Tx.Crypto.html#662" class="Function">μ</a> <a id="889" href="Bitcoin.Tx.Crypto.html#821" class="Bound">tx</a> <a id="892" href="Bitcoin.Tx.Crypto.html#824" class="Bound">i</a><a id="893" class="Symbol">)</a> <a id="895" href="Prelude.Functor.html#299" class="Field Operator">&lt;$&gt;</a> <a id="899" href="Bitcoin.Tx.Crypto.html#818" class="Bound">ks</a><a id="901" class="Symbol">))</a> <a id="904" class="Symbol">}</a>

<a id="sig⋆"></a><a id="907" href="Bitcoin.Tx.Crypto.html#907" class="Function">sig⋆</a> <a id="912" class="Symbol">:</a> <a id="914" href="Data.Vec.Base.html#998" class="Datatype">Vec</a> <a id="918" class="Symbol">(</a><a id="919" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="924" href="Bitcoin.Crypto.html#345" class="Record">KeyPair</a><a id="931" class="Symbol">)</a> <a id="933" href="Bitcoin.Tx.Base.html#1914" class="Generalizable">i</a> <a id="935" class="Symbol">→</a> <a id="937" href="Bitcoin.Tx.Base.html#903" class="Record">Tx</a> <a id="940" href="Bitcoin.Tx.Base.html#1914" class="Generalizable">i</a> <a id="942" href="Bitcoin.Tx.Base.html#1919" class="Generalizable">o</a> <a id="944" class="Symbol">→</a> <a id="946" href="Bitcoin.Tx.Base.html#903" class="Record">Tx</a> <a id="949" href="Bitcoin.Tx.Base.html#1914" class="Generalizable">i</a> <a id="951" href="Bitcoin.Tx.Base.html#1919" class="Generalizable">o</a>
<a id="953" href="Bitcoin.Tx.Crypto.html#907" class="Function">sig⋆</a> <a id="958" href="Bitcoin.Tx.Crypto.html#958" class="Bound">kss</a> <a id="962" href="Bitcoin.Tx.Crypto.html#962" class="Bound">tx</a> <a id="965" class="Symbol">=</a> <a id="967" class="Keyword">record</a> <a id="974" href="Bitcoin.Tx.Crypto.html#962" class="Bound">tx</a> <a id="977" class="Symbol">{</a> <a id="979" href="Bitcoin.Tx.Base.html#981" class="Field">wit</a> <a id="983" class="Symbol">=</a> <a id="985" class="Symbol">(λ</a> <a id="988" href="Bitcoin.Tx.Crypto.html#988" class="Bound">i</a> <a id="990" class="Symbol">→</a> <a id="992" class="Symbol">_</a> <a id="994" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="996" class="Symbol">(</a><a id="997" href="Data.Vec.Base.html#7540" class="Function">V.fromList</a> <a id="1008" class="Symbol">(</a><a id="1009" href="Function.Base.html#1554" class="Function">flip</a> <a id="1014" href="Bitcoin.Crypto.html#654" class="Postulate">SIG</a> <a id="1018" class="Symbol">(</a><a id="1019" href="Bitcoin.Tx.Crypto.html#662" class="Function">μ</a> <a id="1021" href="Bitcoin.Tx.Crypto.html#962" class="Bound">tx</a> <a id="1024" href="Bitcoin.Tx.Crypto.html#988" class="Bound">i</a><a id="1025" class="Symbol">)</a> <a id="1027" href="Prelude.Functor.html#299" class="Field Operator">&lt;$&gt;</a> <a id="1031" href="Data.Vec.Base.html#1605" class="Function">V.lookup</a> <a id="1040" href="Bitcoin.Tx.Crypto.html#958" class="Bound">kss</a> <a id="1044" href="Bitcoin.Tx.Crypto.html#988" class="Bound">i</a><a id="1045" class="Symbol">)))</a> <a id="1049" href="Prelude.Functor.html#299" class="Field Operator">&lt;$&gt;</a> <a id="1053" href="Data.Vec.Base.html#6011" class="Function">V.allFin</a> <a id="1062" class="Symbol">_</a> <a id="1064" class="Symbol">}</a>

<a id="1067" class="Comment">-- m-of-n multi-signature scheme</a>
<a id="ver"></a><a id="1100" href="Bitcoin.Tx.Crypto.html#1100" class="Function">ver</a> <a id="1104" class="Symbol">:</a> <a id="1106" href="Bitcoin.Crypto.html#345" class="Record">KeyPair</a> <a id="1114" class="Symbol">→</a> <a id="1116" href="Agda.Builtin.Int.html#246" class="Datatype">ℤ</a> <a id="1118" class="Symbol">→</a> <a id="1120" href="Bitcoin.Tx.Base.html#903" class="Record">Tx</a> <a id="1123" href="Bitcoin.Tx.Base.html#1914" class="Generalizable">i</a> <a id="1125" href="Bitcoin.Tx.Base.html#1919" class="Generalizable">o</a> <a id="1127" class="Symbol">→</a> <a id="1129" href="Data.Fin.Base.html#1126" class="Datatype">Fin</a> <a id="1133" href="Bitcoin.Tx.Base.html#1914" class="Generalizable">i</a> <a id="1135" class="Symbol">→</a> <a id="1137" href="Agda.Builtin.Bool.html#163" class="Datatype">Bool</a>
<a id="1142" href="Bitcoin.Tx.Crypto.html#1100" class="Function">ver</a> <a id="1146" href="Bitcoin.Tx.Crypto.html#1146" class="Bound">k</a> <a id="1148" href="Bitcoin.Tx.Crypto.html#1148" class="Bound">σ</a> <a id="1150" href="Bitcoin.Tx.Crypto.html#1150" class="Bound">tx</a> <a id="1153" href="Bitcoin.Tx.Crypto.html#1153" class="Bound">i</a> <a id="1155" class="Symbol">=</a> <a id="1157" href="Bitcoin.Crypto.html#678" class="Postulate">VER</a> <a id="1161" href="Bitcoin.Tx.Crypto.html#1146" class="Bound">k</a> <a id="1163" href="Bitcoin.Tx.Crypto.html#1148" class="Bound">σ</a> <a id="1165" class="Symbol">(</a><a id="1166" href="Bitcoin.Tx.Crypto.html#662" class="Function">μ</a> <a id="1168" href="Bitcoin.Tx.Crypto.html#1150" class="Bound">tx</a> <a id="1171" href="Bitcoin.Tx.Crypto.html#1153" class="Bound">i</a><a id="1172" class="Symbol">)</a>

<a id="ver⋆"></a><a id="1175" href="Bitcoin.Tx.Crypto.html#1175" class="Function">ver⋆</a> <a id="1180" class="Symbol">:</a> <a id="1182" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="1187" href="Bitcoin.Crypto.html#345" class="Record">KeyPair</a> <a id="1195" class="Symbol">→</a> <a id="1197" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="1202" href="Agda.Builtin.Int.html#246" class="Datatype">ℤ</a> <a id="1204" class="Symbol">→</a> <a id="1206" href="Bitcoin.Tx.Base.html#903" class="Record">Tx</a> <a id="1209" href="Bitcoin.Tx.Base.html#1914" class="Generalizable">i</a> <a id="1211" href="Bitcoin.Tx.Base.html#1919" class="Generalizable">o</a> <a id="1213" class="Symbol">→</a> <a id="1215" href="Data.Fin.Base.html#1126" class="Datatype">Fin</a> <a id="1219" href="Bitcoin.Tx.Base.html#1914" class="Generalizable">i</a> <a id="1221" class="Symbol">→</a> <a id="1223" href="Agda.Builtin.Bool.html#163" class="Datatype">Bool</a>
<a id="1228" href="Bitcoin.Tx.Crypto.html#1175" class="Function">ver⋆</a> <a id="1233" class="Symbol">_</a>         <a id="1243" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>      <a id="1251" class="Symbol">_</a> <a id="1253" class="Symbol">_</a> <a id="1255" class="Symbol">=</a> <a id="1257" href="Agda.Builtin.Bool.html#188" class="InductiveConstructor">true</a>
<a id="1262" href="Bitcoin.Tx.Crypto.html#1175" class="CatchallClause Function">ver⋆</a><a id="1266" class="CatchallClause"> </a><a id="1267" href="Agda.Builtin.List.html#185" class="CatchallClause InductiveConstructor">[]</a><a id="1269" class="CatchallClause">        </a><a id="1277" class="CatchallClause Symbol">_</a><a id="1278" class="CatchallClause">       </a><a id="1285" class="CatchallClause Symbol">_</a><a id="1286" class="CatchallClause"> </a><a id="1287" class="CatchallClause Symbol">_</a> <a id="1289" class="Symbol">=</a> <a id="1291" href="Agda.Builtin.Bool.html#182" class="InductiveConstructor">false</a>
<a id="1297" href="Bitcoin.Tx.Crypto.html#1175" class="Function">ver⋆</a> <a id="1302" class="Symbol">(</a><a id="1303" href="Bitcoin.Tx.Crypto.html#1303" class="Bound">k</a> <a id="1305" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="1307" href="Bitcoin.Tx.Crypto.html#1307" class="Bound">ks</a><a id="1309" class="Symbol">)</a> <a id="1311" class="Symbol">(</a><a id="1312" href="Bitcoin.Tx.Crypto.html#1312" class="Bound">σ</a> <a id="1314" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="1316" href="Bitcoin.Tx.Crypto.html#1316" class="Bound">σs</a><a id="1318" class="Symbol">)</a> <a id="1320" href="Bitcoin.Tx.Crypto.html#1320" class="Bound">T</a> <a id="1322" href="Bitcoin.Tx.Crypto.html#1322" class="Bound">i</a> <a id="1324" class="Symbol">=</a> <a id="1326" href="Data.Bool.Base.html#1283" class="Function Operator">if</a> <a id="1329" href="Bitcoin.Tx.Crypto.html#1100" class="Function">ver</a> <a id="1333" href="Bitcoin.Tx.Crypto.html#1303" class="Bound">k</a> <a id="1335" href="Bitcoin.Tx.Crypto.html#1312" class="Bound">σ</a> <a id="1337" href="Bitcoin.Tx.Crypto.html#1320" class="Bound">T</a> <a id="1339" href="Bitcoin.Tx.Crypto.html#1322" class="Bound">i</a> <a id="1341" href="Data.Bool.Base.html#1283" class="Function Operator">then</a> <a id="1346" href="Bitcoin.Tx.Crypto.html#1175" class="Function">ver⋆</a> <a id="1351" href="Bitcoin.Tx.Crypto.html#1307" class="Bound">ks</a> <a id="1354" href="Bitcoin.Tx.Crypto.html#1316" class="Bound">σs</a> <a id="1357" href="Bitcoin.Tx.Crypto.html#1320" class="Bound">T</a> <a id="1359" href="Bitcoin.Tx.Crypto.html#1322" class="Bound">i</a> <a id="1361" href="Data.Bool.Base.html#1283" class="Function Operator">else</a> <a id="1366" href="Bitcoin.Tx.Crypto.html#1175" class="Function">ver⋆</a> <a id="1371" class="Symbol">(</a><a id="1372" href="Bitcoin.Tx.Crypto.html#1303" class="Bound">k</a> <a id="1374" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="1376" href="Bitcoin.Tx.Crypto.html#1307" class="Bound">ks</a><a id="1378" class="Symbol">)</a> <a id="1380" href="Bitcoin.Tx.Crypto.html#1316" class="Bound">σs</a> <a id="1383" href="Bitcoin.Tx.Crypto.html#1320" class="Bound">T</a> <a id="1385" href="Bitcoin.Tx.Crypto.html#1322" class="Bound">i</a>

<a id="1388" class="Comment">-- Hash a transaction (i.e. get its identifier)</a>
<a id="1436" class="Keyword">instance</a>
  <a id="Hashable-TxInput"></a><a id="1447" href="Bitcoin.Tx.Crypto.html#1447" class="Function">Hashable-TxInput</a> <a id="1464" class="Symbol">:</a> <a id="1466" href="Bitcoin.Crypto.html#775" class="Record">Hashable</a> <a id="1475" href="Bitcoin.Tx.Base.html#343" class="Record">TxInput</a>
  <a id="1485" href="Bitcoin.Tx.Crypto.html#1447" class="Function">Hashable-TxInput</a> <a id="1502" class="Symbol">.</a><a id="1503" href="Bitcoin.Crypto.html#826" class="Field Operator">_♯</a> <a id="1506" class="Symbol">(</a><a id="1507" href="Bitcoin.Tx.Crypto.html#1507" class="Bound">tx♯</a> <a id="1511" href="Bitcoin.Tx.Base.html#377" class="InductiveConstructor Operator">at</a> <a id="1514" href="Bitcoin.Tx.Crypto.html#1514" class="Bound">i</a><a id="1515" class="Symbol">)</a> <a id="1517" class="Symbol">=</a> <a id="1519" class="Symbol">(</a><a id="1520" href="Bitcoin.Tx.Crypto.html#1507" class="Bound">tx♯</a> <a id="1524" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1526" href="Bitcoin.Tx.Crypto.html#1514" class="Bound">i</a><a id="1527" class="Symbol">)</a> <a id="1529" href="Bitcoin.Crypto.html#826" class="Field Operator">♯</a>

  <a id="Hashable-ScriptCtx"></a><a id="1534" href="Bitcoin.Tx.Crypto.html#1534" class="Function">Hashable-ScriptCtx</a> <a id="1553" class="Symbol">:</a> <a id="1555" href="Bitcoin.Crypto.html#775" class="Record">Hashable</a> <a id="1564" href="Bitcoin.Script.Base.html#347" class="Datatype">ScriptContext</a>
  <a id="1580" href="Bitcoin.Tx.Crypto.html#1534" class="Function">Hashable-ScriptCtx</a> <a id="1599" class="Symbol">.</a><a id="1600" href="Bitcoin.Crypto.html#826" class="Field Operator">_♯</a> <a id="1603" class="Symbol">(</a><a id="1604" href="Bitcoin.Script.Base.html#375" class="InductiveConstructor">Ctx</a> <a id="1608" href="Bitcoin.Tx.Crypto.html#1608" class="Bound">n</a><a id="1609" class="Symbol">)</a> <a id="1611" class="Symbol">=</a> <a id="1613" href="Bitcoin.Tx.Crypto.html#1608" class="Bound">n</a> <a id="1615" href="Bitcoin.Crypto.html#826" class="Field Operator">♯</a>

  <a id="Hashable-ScriptTy"></a><a id="1620" href="Bitcoin.Tx.Crypto.html#1620" class="Function">Hashable-ScriptTy</a> <a id="1638" class="Symbol">:</a> <a id="1640" href="Bitcoin.Crypto.html#775" class="Record">Hashable</a> <a id="1649" href="Bitcoin.Script.Base.html#523" class="Datatype">ScriptType</a>
  <a id="1662" href="Bitcoin.Tx.Crypto.html#1620" class="Function">Hashable-ScriptTy</a> <a id="1680" class="Symbol">.</a><a id="1681" href="Bitcoin.Crypto.html#826" class="Field Operator">_♯</a> <a id="1684" class="Symbol">=</a> <a id="1686" href="Function.Base.html#4121" class="Function Operator">case_of</a> <a id="1694" class="Symbol">λ{</a> <a id="1697" href="Bitcoin.Script.Base.html#548" class="InductiveConstructor">`Bool</a> <a id="1703" class="Symbol">→</a> <a id="1705" href="Agda.Builtin.Int.html#264" class="InductiveConstructor Operator">+</a> <a id="1707" class="Number">0</a><a id="1708" class="Symbol">;</a> <a id="1710" href="Bitcoin.Script.Base.html#554" class="InductiveConstructor">`ℤ</a> <a id="1713" class="Symbol">→</a> <a id="1715" href="Agda.Builtin.Int.html#264" class="InductiveConstructor Operator">+</a> <a id="1717" class="Number">1</a> <a id="1719" class="Symbol">}</a>

<a id="1722" class="Comment">-- [BUG] need to define script♯ separately, otherwise non-terminating..</a>
<a id="script♯"></a><a id="1794" href="Bitcoin.Tx.Crypto.html#1794" class="Function">script♯</a> <a id="1802" class="Symbol">:</a> <a id="1804" href="Bitcoin.Crypto.html#509" class="Function">HashFunction</a> <a id="1817" class="Symbol">(</a><a id="1818" href="Bitcoin.Script.Base.html#701" class="Datatype">Script</a> <a id="1825" href="Bitcoin.Script.Base.html#648" class="Generalizable">ctx</a> <a id="1829" href="Bitcoin.Script.Base.html#675" class="Generalizable">ty</a><a id="1831" class="Symbol">)</a>
<a id="1833" href="Bitcoin.Tx.Crypto.html#1794" class="Function">script♯</a> <a id="1841" class="Symbol">=</a> <a id="1843" href="Function.Base.html#4121" class="Function Operator">case_of</a> <a id="1851" class="Symbol">λ</a> <a id="1853" class="Keyword">where</a>
    <a id="1863" class="Symbol">(</a><a id="1864" href="Bitcoin.Script.Base.html#846" class="InductiveConstructor">var</a> <a id="1868" href="Bitcoin.Tx.Crypto.html#1868" class="Bound">n</a><a id="1869" class="Symbol">)</a>  <a id="1872" class="Symbol">→</a> <a id="1874" href="Bitcoin.Tx.Crypto.html#1868" class="Bound">n</a> <a id="1876" href="Bitcoin.Crypto.html#826" class="Field Operator">♯</a>
    <a id="1882" class="Symbol">(</a><a id="1883" href="Bitcoin.Script.Base.html#917" class="InductiveConstructor">`</a> <a id="1885" href="Bitcoin.Tx.Crypto.html#1885" class="Bound">z</a><a id="1886" class="Symbol">)</a>    <a id="1891" class="Symbol">→</a> <a id="1893" href="Bitcoin.Tx.Crypto.html#1885" class="Bound">z</a>
    <a id="1899" class="Symbol">(</a><a id="1900" href="Bitcoin.Tx.Crypto.html#1900" class="Bound">x</a> <a id="1902" href="Bitcoin.Script.Base.html#944" class="InductiveConstructor Operator">`+</a> <a id="1905" href="Bitcoin.Tx.Crypto.html#1905" class="Bound">y</a><a id="1906" class="Symbol">)</a> <a id="1908" class="Symbol">→</a> <a id="1910" class="Symbol">(</a><a id="1911" href="Bitcoin.Tx.Crypto.html#1794" class="Function">script♯</a> <a id="1919" href="Bitcoin.Tx.Crypto.html#1900" class="Bound">x</a> <a id="1921" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1923" href="Bitcoin.Tx.Crypto.html#1794" class="Function">script♯</a> <a id="1931" href="Bitcoin.Tx.Crypto.html#1905" class="Bound">y</a><a id="1932" class="Symbol">)</a> <a id="1934" href="Bitcoin.Crypto.html#826" class="Field Operator">♯</a>
    <a id="1940" class="Symbol">(</a><a id="1941" href="Bitcoin.Tx.Crypto.html#1941" class="Bound">x</a> <a id="1943" href="Bitcoin.Script.Base.html#999" class="InductiveConstructor Operator">`-</a> <a id="1946" href="Bitcoin.Tx.Crypto.html#1946" class="Bound">y</a><a id="1947" class="Symbol">)</a> <a id="1949" class="Symbol">→</a> <a id="1951" class="Symbol">(</a><a id="1952" href="Bitcoin.Tx.Crypto.html#1794" class="Function">script♯</a> <a id="1960" href="Bitcoin.Tx.Crypto.html#1941" class="Bound">x</a> <a id="1962" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1964" href="Bitcoin.Tx.Crypto.html#1794" class="Function">script♯</a> <a id="1972" href="Bitcoin.Tx.Crypto.html#1946" class="Bound">y</a><a id="1973" class="Symbol">)</a> <a id="1975" href="Bitcoin.Crypto.html#826" class="Field Operator">♯</a>
    <a id="1981" class="Symbol">(</a><a id="1982" href="Bitcoin.Tx.Crypto.html#1982" class="Bound">x</a> <a id="1984" href="Bitcoin.Script.Base.html#1054" class="InductiveConstructor Operator">`=</a> <a id="1987" href="Bitcoin.Tx.Crypto.html#1987" class="Bound">y</a><a id="1988" class="Symbol">)</a> <a id="1990" class="Symbol">→</a> <a id="1992" class="Symbol">(</a><a id="1993" href="Bitcoin.Tx.Crypto.html#1794" class="Function">script♯</a> <a id="2001" href="Bitcoin.Tx.Crypto.html#1982" class="Bound">x</a> <a id="2003" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2005" href="Bitcoin.Tx.Crypto.html#1794" class="Function">script♯</a> <a id="2013" href="Bitcoin.Tx.Crypto.html#1987" class="Bound">y</a><a id="2014" class="Symbol">)</a> <a id="2016" href="Bitcoin.Crypto.html#826" class="Field Operator">♯</a>
    <a id="2022" class="Symbol">(</a><a id="2023" href="Bitcoin.Tx.Crypto.html#2023" class="Bound">x</a> <a id="2025" href="Bitcoin.Script.Base.html#1112" class="InductiveConstructor Operator">`&lt;</a> <a id="2028" href="Bitcoin.Tx.Crypto.html#2028" class="Bound">y</a><a id="2029" class="Symbol">)</a> <a id="2031" class="Symbol">→</a> <a id="2033" class="Symbol">(</a><a id="2034" href="Bitcoin.Tx.Crypto.html#1794" class="Function">script♯</a> <a id="2042" href="Bitcoin.Tx.Crypto.html#2023" class="Bound">x</a> <a id="2044" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2046" href="Bitcoin.Tx.Crypto.html#1794" class="Function">script♯</a> <a id="2054" href="Bitcoin.Tx.Crypto.html#2028" class="Bound">y</a><a id="2055" class="Symbol">)</a> <a id="2057" href="Bitcoin.Crypto.html#826" class="Field Operator">♯</a>
    <a id="2063" class="Symbol">(</a><a id="2064" href="Bitcoin.Script.Base.html#1198" class="InductiveConstructor Operator">`if</a> <a id="2068" href="Bitcoin.Tx.Crypto.html#2068" class="Bound">b</a> <a id="2070" href="Bitcoin.Script.Base.html#1198" class="InductiveConstructor Operator">then</a> <a id="2075" href="Bitcoin.Tx.Crypto.html#2075" class="Bound">x</a> <a id="2077" href="Bitcoin.Script.Base.html#1198" class="InductiveConstructor Operator">else</a> <a id="2082" href="Bitcoin.Tx.Crypto.html#2082" class="Bound">y</a><a id="2083" class="Symbol">)</a> <a id="2085" class="Symbol">→</a> <a id="2087" class="Symbol">(</a><a id="2088" href="Bitcoin.Tx.Crypto.html#1794" class="Function">script♯</a> <a id="2096" href="Bitcoin.Tx.Crypto.html#2068" class="Bound">b</a> <a id="2098" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2100" href="Bitcoin.Tx.Crypto.html#1794" class="Function">script♯</a> <a id="2108" href="Bitcoin.Tx.Crypto.html#2075" class="Bound">x</a> <a id="2110" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2112" href="Bitcoin.Tx.Crypto.html#1794" class="Function">script♯</a> <a id="2120" href="Bitcoin.Tx.Crypto.html#2082" class="Bound">y</a><a id="2121" class="Symbol">)</a> <a id="2123" href="Bitcoin.Crypto.html#826" class="Field Operator">♯</a>
    <a id="2129" class="Symbol">(</a><a id="2130" href="Bitcoin.Script.Base.html#1293" class="InductiveConstructor Operator">∣</a> <a id="2132" href="Bitcoin.Tx.Crypto.html#2132" class="Bound">x</a> <a id="2134" href="Bitcoin.Script.Base.html#1293" class="InductiveConstructor Operator">∣</a><a id="2135" class="Symbol">)</a>  <a id="2138" class="Symbol">→</a> <a id="2140" href="Bitcoin.Tx.Crypto.html#1794" class="Function">script♯</a> <a id="2148" href="Bitcoin.Tx.Crypto.html#2132" class="Bound">x</a> <a id="2150" href="Bitcoin.Crypto.html#826" class="Field Operator">♯</a>
    <a id="2156" class="Symbol">(</a><a id="2157" href="Bitcoin.Script.Base.html#1345" class="InductiveConstructor">hash</a> <a id="2162" href="Bitcoin.Tx.Crypto.html#2162" class="Bound">x</a><a id="2163" class="Symbol">)</a> <a id="2165" class="Symbol">→</a> <a id="2167" href="Bitcoin.Tx.Crypto.html#1794" class="Function">script♯</a> <a id="2175" href="Bitcoin.Tx.Crypto.html#2162" class="Bound">x</a> <a id="2177" href="Bitcoin.Crypto.html#826" class="Field Operator">♯</a>
    <a id="2183" class="Symbol">(</a><a id="2184" href="Bitcoin.Script.Base.html#1413" class="InductiveConstructor">versig</a> <a id="2191" href="Bitcoin.Tx.Crypto.html#2191" class="Bound">ks</a> <a id="2194" href="Bitcoin.Tx.Crypto.html#2194" class="Bound">fs</a><a id="2196" class="Symbol">)</a> <a id="2198" class="Symbol">→</a> <a id="2200" class="Symbol">(</a><a id="2201" href="Bitcoin.Tx.Crypto.html#2191" class="Bound">ks</a> <a id="2204" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2206" href="Bitcoin.Tx.Crypto.html#2194" class="Bound">fs</a><a id="2208" class="Symbol">)</a> <a id="2210" href="Bitcoin.Crypto.html#826" class="Field Operator">♯</a>
    <a id="2216" class="Symbol">(</a><a id="2217" href="Bitcoin.Script.Base.html#1502" class="InductiveConstructor Operator">absAfter</a> <a id="2226" href="Bitcoin.Tx.Crypto.html#2226" class="Bound">t</a> <a id="2228" href="Bitcoin.Script.Base.html#1502" class="InductiveConstructor Operator">⇒</a> <a id="2230" href="Bitcoin.Tx.Crypto.html#2230" class="Bound">x</a><a id="2231" class="Symbol">)</a> <a id="2233" class="Symbol">→</a> <a id="2235" class="Symbol">(</a><a id="2236" href="Bitcoin.Tx.Crypto.html#2226" class="Bound">t</a> <a id="2238" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2240" href="Bitcoin.Tx.Crypto.html#1794" class="Function">script♯</a> <a id="2248" href="Bitcoin.Tx.Crypto.html#2230" class="Bound">x</a><a id="2249" class="Symbol">)</a> <a id="2251" href="Bitcoin.Crypto.html#826" class="Field Operator">♯</a>
    <a id="2257" class="Symbol">(</a><a id="2258" href="Bitcoin.Script.Base.html#1555" class="InductiveConstructor Operator">relAfter</a> <a id="2267" href="Bitcoin.Tx.Crypto.html#2267" class="Bound">t</a> <a id="2269" href="Bitcoin.Script.Base.html#1555" class="InductiveConstructor Operator">⇒</a> <a id="2271" href="Bitcoin.Tx.Crypto.html#2271" class="Bound">x</a><a id="2272" class="Symbol">)</a> <a id="2274" class="Symbol">→</a> <a id="2276" class="Symbol">(</a><a id="2277" href="Bitcoin.Tx.Crypto.html#2267" class="Bound">t</a> <a id="2279" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2281" href="Bitcoin.Tx.Crypto.html#1794" class="Function">script♯</a> <a id="2289" href="Bitcoin.Tx.Crypto.html#2271" class="Bound">x</a><a id="2290" class="Symbol">)</a> <a id="2292" href="Bitcoin.Crypto.html#826" class="Field Operator">♯</a>

<a id="2295" class="Keyword">instance</a>
  <a id="Hashable-Script"></a><a id="2306" href="Bitcoin.Tx.Crypto.html#2306" class="Function">Hashable-Script</a> <a id="2322" class="Symbol">:</a> <a id="2324" href="Bitcoin.Crypto.html#775" class="Record">Hashable</a> <a id="2333" class="Symbol">(</a><a id="2334" href="Bitcoin.Script.Base.html#701" class="Datatype">Script</a> <a id="2341" href="Bitcoin.Script.Base.html#648" class="Generalizable">ctx</a> <a id="2345" href="Bitcoin.Script.Base.html#675" class="Generalizable">ty</a><a id="2347" class="Symbol">)</a>
  <a id="2351" href="Bitcoin.Tx.Crypto.html#2306" class="Function">Hashable-Script</a> <a id="2367" class="Symbol">.</a><a id="2368" href="Bitcoin.Crypto.html#826" class="Field Operator">_♯</a> <a id="2371" class="Symbol">=</a> <a id="2373" href="Bitcoin.Tx.Crypto.html#1794" class="Function">script♯</a>

  <a id="Hashable-BScript"></a><a id="2384" href="Bitcoin.Tx.Crypto.html#2384" class="Function">Hashable-BScript</a> <a id="2401" class="Symbol">:</a> <a id="2403" href="Bitcoin.Crypto.html#775" class="Record">Hashable</a> <a id="2412" class="Symbol">(</a><a id="2413" href="Bitcoin.Script.Base.html#2124" class="Datatype">BitcoinScript</a> <a id="2427" href="Bitcoin.Script.Base.html#648" class="Generalizable">ctx</a><a id="2430" class="Symbol">)</a>
  <a id="2434" href="Bitcoin.Tx.Crypto.html#2384" class="Function">Hashable-BScript</a> <a id="2451" class="Symbol">.</a><a id="2452" href="Bitcoin.Crypto.html#826" class="Field Operator">_♯</a> <a id="2455" class="Symbol">(</a><a id="2456" href="Bitcoin.Script.Base.html#2174" class="InductiveConstructor Operator">ƛ</a> <a id="2458" href="Bitcoin.Tx.Crypto.html#2458" class="Bound">s</a><a id="2459" class="Symbol">)</a> <a id="2461" class="Symbol">=</a> <a id="2463" href="Bitcoin.Tx.Crypto.html#2458" class="Bound">s</a> <a id="2465" href="Bitcoin.Crypto.html#826" class="Field Operator">♯</a>

  <a id="Hashable-TxOutput"></a><a id="2470" href="Bitcoin.Tx.Crypto.html#2470" class="Function">Hashable-TxOutput</a> <a id="2488" class="Symbol">:</a> <a id="2490" href="Bitcoin.Crypto.html#775" class="Record">Hashable</a> <a id="2499" class="Symbol">(</a><a id="2500" href="Bitcoin.Tx.Base.html#603" class="Record">TxOutput</a> <a id="2509" href="Bitcoin.Script.Base.html#648" class="Generalizable">ctx</a><a id="2512" class="Symbol">)</a>
  <a id="2516" href="Bitcoin.Tx.Crypto.html#2470" class="Function">Hashable-TxOutput</a> <a id="2534" class="Symbol">.</a><a id="2535" href="Bitcoin.Crypto.html#826" class="Field Operator">_♯</a> <a id="2538" href="Bitcoin.Tx.Crypto.html#2538" class="Bound">o</a> <a id="2540" class="Symbol">=</a> <a id="2542" class="Symbol">(</a><a id="2543" href="Bitcoin.Tx.Base.html#658" class="Field">value</a> <a id="2549" href="Bitcoin.Tx.Crypto.html#2538" class="Bound">o</a> <a id="2551" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2553" href="Bitcoin.Tx.Base.html#680" class="Field">validator</a> <a id="2563" href="Bitcoin.Tx.Crypto.html#2538" class="Bound">o</a><a id="2564" class="Symbol">)</a> <a id="2566" href="Bitcoin.Crypto.html#826" class="Field Operator">♯</a>

  <a id="Hashable-Tx"></a><a id="2571" href="Bitcoin.Tx.Crypto.html#2571" class="Function">Hashable-Tx</a> <a id="2583" class="Symbol">:</a> <a id="2585" href="Bitcoin.Crypto.html#775" class="Record">Hashable</a> <a id="2594" class="Symbol">(</a><a id="2595" href="Bitcoin.Tx.Base.html#903" class="Record">Tx</a> <a id="2598" href="Bitcoin.Tx.Base.html#1914" class="Generalizable">i</a> <a id="2600" href="Bitcoin.Tx.Base.html#1919" class="Generalizable">o</a><a id="2601" class="Symbol">)</a>
  <a id="2605" href="Bitcoin.Tx.Crypto.html#2571" class="Function">Hashable-Tx</a> <a id="2617" class="Symbol">.</a><a id="2618" href="Bitcoin.Crypto.html#826" class="Field Operator">_♯</a> <a id="2621" href="Bitcoin.Tx.Crypto.html#2621" class="Bound">tx</a> <a id="2624" class="Symbol">=</a> <a id="2626" class="Symbol">(</a><a id="2627" href="Bitcoin.Tx.Base.html#940" class="Field">inputs</a> <a id="2634" href="Bitcoin.Tx.Crypto.html#2621" class="Bound">tx</a> <a id="2637" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2639" href="Bitcoin.Tx.Base.html#981" class="Field">wit</a> <a id="2643" href="Bitcoin.Tx.Crypto.html#2621" class="Bound">tx</a> <a id="2646" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2648" href="Bitcoin.Tx.Base.html#1036" class="Field">relLock</a> <a id="2656" href="Bitcoin.Tx.Crypto.html#2621" class="Bound">tx</a> <a id="2659" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2661" href="Bitcoin.Tx.Base.html#1090" class="Field">outputs</a> <a id="2669" href="Bitcoin.Tx.Crypto.html#2621" class="Bound">tx</a> <a id="2672" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2674" href="Bitcoin.Tx.Base.html#1132" class="Field">absLock</a> <a id="2682" href="Bitcoin.Tx.Crypto.html#2621" class="Bound">tx</a><a id="2684" class="Symbol">)</a> <a id="2686" href="Bitcoin.Crypto.html#826" class="Field Operator">♯</a>

<a id="hashTxⁱ"></a><a id="2689" href="Bitcoin.Tx.Crypto.html#2689" class="Function">hashTxⁱ</a> <a id="2697" class="Symbol">:</a> <a id="2699" href="Bitcoin.Tx.Base.html#1793" class="Record">TxInput′</a> <a id="2708" class="Symbol">→</a> <a id="2710" href="Bitcoin.Tx.Base.html#343" class="Record">TxInput</a>
<a id="2718" href="Bitcoin.Tx.Crypto.html#2689" class="Function">hashTxⁱ</a> <a id="2726" class="Symbol">(</a><a id="2727" href="Bitcoin.Tx.Crypto.html#2727" class="Bound">tx</a> <a id="2730" href="Bitcoin.Tx.Base.html#1828" class="InductiveConstructor Operator">at</a> <a id="2733" href="Bitcoin.Tx.Crypto.html#2733" class="Bound">i</a><a id="2734" class="Symbol">)</a> <a id="2736" class="Symbol">=</a> <a id="2738" class="Symbol">(</a><a id="2739" href="Bitcoin.Tx.Crypto.html#2727" class="Bound">tx</a> <a id="2742" href="Bitcoin.Crypto.html#826" class="Field Operator">♯</a><a id="2743" class="Symbol">)</a> <a id="2745" href="Bitcoin.Tx.Base.html#377" class="InductiveConstructor Operator">at</a> <a id="2748" class="Symbol">(</a><a id="2749" href="Prelude.ToN.html#102" class="Field">toℕ</a> <a id="2753" href="Bitcoin.Tx.Crypto.html#2733" class="Bound">i</a><a id="2754" class="Symbol">)</a>
</pre></body></html>