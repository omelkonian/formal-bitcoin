<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Bitcoin.Consistency</title><link rel="stylesheet" href="css/Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- Blockchain and consistency.</a>
<a id="105" class="Comment">------------------------------------------------------------------------</a>
<a id="178" class="Keyword">module</a> <a id="185" href="Bitcoin.Consistency.html" class="Module">Bitcoin.Consistency</a> <a id="205" class="Keyword">where</a>

<a id="212" class="Keyword">open</a> <a id="217" class="Keyword">import</a> <a id="224" href="Data.Fin.html" class="Module">Data.Fin</a>  <a id="234" class="Keyword">using</a> <a id="240" class="Symbol">(</a><a id="241" href="Data.Fin.Base.html#1913" class="Function">fromℕ&lt;</a><a id="247" class="Symbol">)</a>

<a id="250" class="Keyword">open</a> <a id="255" class="Keyword">import</a> <a id="262" href="Prelude.Init.html" class="Module">Prelude.Init</a>
<a id="275" class="Keyword">open</a> <a id="280" class="Keyword">import</a> <a id="287" href="Prelude.Lists.html" class="Module">Prelude.Lists</a>
<a id="301" class="Keyword">open</a> <a id="306" class="Keyword">import</a> <a id="313" href="Prelude.DecEq.html" class="Module">Prelude.DecEq</a>
<a id="327" class="Keyword">open</a> <a id="332" class="Keyword">import</a> <a id="339" href="Prelude.Sets.html" class="Module">Prelude.Sets</a>

<a id="353" class="Keyword">open</a> <a id="358" class="Keyword">import</a> <a id="365" href="Bitcoin.BasicTypes.html" class="Module">Bitcoin.BasicTypes</a>
<a id="384" class="Keyword">open</a> <a id="389" class="Keyword">import</a> <a id="396" href="Bitcoin.Script.Base.html" class="Module">Bitcoin.Script.Base</a>
<a id="416" class="Keyword">open</a> <a id="421" class="Keyword">import</a> <a id="428" href="Bitcoin.Tx.Base.html" class="Module">Bitcoin.Tx.Base</a>
<a id="444" class="Keyword">open</a> <a id="449" class="Keyword">import</a> <a id="456" href="Bitcoin.Tx.Crypto.html" class="Module">Bitcoin.Tx.Crypto</a>
<a id="474" class="Keyword">open</a> <a id="479" class="Keyword">import</a> <a id="486" href="Bitcoin.Tx.Semantics.html" class="Module">Bitcoin.Tx.Semantics</a>

<a id="508" class="Comment">-- Blockchain</a>
<a id="Blockchain"></a><a id="522" href="Bitcoin.Consistency.html#522" class="Function">Blockchain</a> <a id="533" class="Symbol">:</a> <a id="535" class="PrimitiveType">Set</a>
<a id="539" href="Bitcoin.Consistency.html#522" class="Function">Blockchain</a> <a id="550" class="Symbol">=</a> <a id="552" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="557" href="Bitcoin.Tx.Base.html#1716" class="Record">TimedTx</a> <a id="565" class="Comment">-- in reverse chronological order, in contrast to the paper</a>

<a id="626" class="Keyword">variable</a> <a id="635" href="Bitcoin.Consistency.html#635" class="Generalizable">txs</a> <a id="639" href="Bitcoin.Consistency.html#639" class="Generalizable">txs′</a> <a id="644" class="Symbol">:</a> <a id="646" href="Bitcoin.Consistency.html#522" class="Function">Blockchain</a>

<a id="txSet"></a><a id="658" href="Bitcoin.Consistency.html#658" class="Function">txSet</a> <a id="664" class="Symbol">:</a> <a id="666" href="Bitcoin.Consistency.html#522" class="Function">Blockchain</a> <a id="677" class="Symbol">→</a> <a id="679" href="Prelude.Sets.Interface.html#385" class="Function">Set⟨</a> <a id="684" href="Bitcoin.Tx.Base.html#1716" class="Record">TimedTx</a> <a id="692" href="Prelude.Sets.Interface.html#385" class="Function">⟩</a>
<a id="694" href="Bitcoin.Consistency.html#658" class="Function">txSet</a> <a id="700" class="Symbol">=</a> <a id="702" href="Prelude.Sets.Interface.html#3951" class="Function">fromList</a>

<a id="match"></a><a id="712" href="Bitcoin.Consistency.html#712" class="Function">match</a> <a id="718" class="Symbol">:</a> <a id="720" href="Bitcoin.Consistency.html#522" class="Function">Blockchain</a> <a id="731" class="Symbol">→</a> <a id="733" href="Bitcoin.BasicTypes.html#266" class="Function">HashId</a> <a id="740" class="Symbol">→</a> <a id="742" href="Prelude.Sets.Interface.html#385" class="Function">Set⟨</a> <a id="747" href="Bitcoin.Tx.Base.html#1716" class="Record">TimedTx</a> <a id="755" href="Prelude.Sets.Interface.html#385" class="Function">⟩</a>
<a id="757" href="Bitcoin.Consistency.html#712" class="Function">match</a> <a id="763" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>                <a id="781" class="Symbol">_</a>   <a id="785" class="Symbol">=</a> <a id="787" href="Prelude.Sets.Interface.html#403" class="Function">∅</a>
<a id="789" href="Bitcoin.Consistency.html#712" class="Function">match</a> <a id="795" class="Symbol">((</a><a id="797" href="Bitcoin.Consistency.html#797" class="Bound">tx</a> <a id="800" href="Bitcoin.Tx.Base.html#1750" class="InductiveConstructor Operator">at</a> <a id="803" href="Bitcoin.Consistency.html#803" class="Bound">t</a><a id="804" class="Symbol">)</a> <a id="806" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="808" href="Bitcoin.Consistency.html#808" class="Bound">txs</a><a id="811" class="Symbol">)</a> <a id="813" href="Bitcoin.Consistency.html#813" class="Bound">tx′</a> <a id="817" class="Keyword">with</a> <a id="822" href="Bitcoin.Tx.Crypto.html#720" class="Function">hashTx</a> <a id="829" href="Bitcoin.Consistency.html#797" class="Bound">tx</a> <a id="832" href="Prelude.DecEq.html#601" class="Field Operator">≟</a> <a id="834" href="Bitcoin.Consistency.html#813" class="Bound">tx′</a>
<a id="838" class="Symbol">...</a> <a id="842" class="Symbol">|</a> <a id="844" href="Relation.Nullary.html#1682" class="InductiveConstructor">no</a> <a id="847" class="Symbol">_</a>  <a id="850" class="Symbol">=</a> <a id="852" href="Bitcoin.Consistency.html#712" class="Function">match</a> <a id="858" class="Bound">txs</a> <a id="862" class="Bound">tx′</a>
<a id="866" class="Symbol">...</a> <a id="870" class="Symbol">|</a> <a id="872" href="Relation.Nullary.html#1645" class="InductiveConstructor">yes</a> <a id="876" class="Symbol">_</a> <a id="878" class="Symbol">=</a> <a id="880" href="Prelude.Sets.Interface.html#416" class="Function">singleton</a> <a id="890" class="Symbol">(</a><a id="891" class="Bound">tx</a> <a id="894" href="Bitcoin.Tx.Base.html#1750" class="InductiveConstructor Operator">at</a> <a id="897" class="Bound">t</a><a id="898" class="Symbol">)</a>
            <a id="912" href="Prelude.Sets.Interface.html#473" class="Function Operator">∪</a> <a id="914" href="Bitcoin.Consistency.html#712" class="Function">match</a> <a id="920" class="Bound">txs</a> <a id="924" class="Bound">tx′</a>

<a id="929" class="Comment">-- UTXO: Unspent transaction outputs.</a>
<a id="UTXOₜₓ"></a><a id="967" href="Bitcoin.Consistency.html#967" class="Function">UTXOₜₓ</a> <a id="974" class="Symbol">:</a> <a id="976" href="Bitcoin.Tx.Base.html#1255" class="Function">∃Tx</a> <a id="980" class="Symbol">→</a> <a id="982" href="Prelude.Sets.Interface.html#385" class="Function">Set⟨</a> <a id="987" href="Bitcoin.Tx.Base.html#343" class="Record">TxInput</a> <a id="995" href="Prelude.Sets.Interface.html#385" class="Function">⟩</a>
<a id="997" href="Bitcoin.Consistency.html#967" class="Function">UTXOₜₓ</a> <a id="1004" href="Bitcoin.Consistency.html#1004" class="Bound">∃tx</a><a id="1007" class="Symbol">@(_</a> <a id="1011" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1013" href="Bitcoin.Consistency.html#1013" class="Bound">o</a> <a id="1015" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1017" href="Bitcoin.Consistency.html#1017" class="Bound">tx</a><a id="1019" class="Symbol">)</a> <a id="1021" class="Symbol">=</a> <a id="1023" href="Prelude.Sets.Interface.html#3951" class="Function">fromList</a> <a id="1032" class="Symbol">(</a><a id="1033" href="Data.List.Base.html#1497" class="Function">map</a> <a id="1037" class="Symbol">(λ</a> <a id="1040" href="Bitcoin.Consistency.html#1040" class="Bound">i</a> <a id="1042" class="Symbol">→</a> <a id="1044" href="Bitcoin.Tx.Crypto.html#720" class="Function">hashTx</a> <a id="1051" href="Bitcoin.Consistency.html#1004" class="Bound">∃tx</a> <a id="1055" href="Bitcoin.Tx.Base.html#377" class="InductiveConstructor Operator">at</a> <a id="1058" href="Bitcoin.Consistency.html#1040" class="Bound">i</a><a id="1059" class="Symbol">)</a> <a id="1061" class="Symbol">(</a><a id="1062" href="Data.List.Base.html#5664" class="Function">upTo</a> <a id="1067" href="Bitcoin.Consistency.html#1013" class="Bound">o</a><a id="1068" class="Symbol">))</a>

<a id="STXOₜₓ"></a><a id="1072" href="Bitcoin.Consistency.html#1072" class="Function">STXOₜₓ</a> <a id="1079" class="Symbol">:</a> <a id="1081" href="Bitcoin.Tx.Base.html#1255" class="Function">∃Tx</a> <a id="1085" class="Symbol">→</a> <a id="1087" href="Prelude.Sets.Interface.html#385" class="Function">Set⟨</a> <a id="1092" href="Bitcoin.Tx.Base.html#343" class="Record">TxInput</a> <a id="1100" href="Prelude.Sets.Interface.html#385" class="Function">⟩</a>
<a id="1102" href="Bitcoin.Consistency.html#1072" class="Function">STXOₜₓ</a> <a id="1109" class="Symbol">(_</a> <a id="1112" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1114" class="Symbol">_</a> <a id="1116" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1118" href="Bitcoin.Consistency.html#1118" class="Bound">tx</a><a id="1120" class="Symbol">)</a> <a id="1122" class="Symbol">=</a> <a id="1124" href="Prelude.Sets.Interface.html#3951" class="Function">fromList</a> <a id="1133" class="Symbol">(</a><a id="1134" href="Data.Vec.Base.html#7399" class="Function">V.toList</a> <a id="1143" class="Symbol">(</a><a id="1144" href="Bitcoin.Tx.Base.html#940" class="Field">inputs</a> <a id="1151" href="Bitcoin.Consistency.html#1118" class="Bound">tx</a><a id="1153" class="Symbol">))</a>

<a id="UTXO"></a><a id="1157" href="Bitcoin.Consistency.html#1157" class="Function">UTXO</a> <a id="1162" class="Symbol">:</a> <a id="1164" href="Bitcoin.Consistency.html#522" class="Function">Blockchain</a> <a id="1175" class="Symbol">→</a> <a id="1177" href="Prelude.Sets.Interface.html#385" class="Function">Set⟨</a> <a id="1182" href="Bitcoin.Tx.Base.html#343" class="Record">TxInput</a> <a id="1190" href="Prelude.Sets.Interface.html#385" class="Function">⟩</a>
<a id="1192" href="Bitcoin.Consistency.html#1157" class="Function">UTXO</a> <a id="1197" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>              <a id="1213" class="Symbol">=</a> <a id="1215" href="Prelude.Sets.Interface.html#403" class="Function">∅</a>
<a id="1217" href="Bitcoin.Consistency.html#1157" class="Function">UTXO</a> <a id="1222" class="Symbol">(</a><a id="1223" href="Bitcoin.Consistency.html#1223" class="Bound">tx</a> <a id="1226" href="Bitcoin.Tx.Base.html#1750" class="InductiveConstructor Operator">at</a> <a id="1229" class="Symbol">_</a> <a id="1231" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="1233" href="Bitcoin.Consistency.html#1233" class="Bound">txs</a><a id="1236" class="Symbol">)</a> <a id="1238" class="Symbol">=</a> <a id="1240" href="Bitcoin.Consistency.html#1157" class="Function">UTXO</a> <a id="1245" href="Bitcoin.Consistency.html#1233" class="Bound">txs</a> <a id="1249" href="Prelude.Sets.Interface.html#469" class="Function Operator">─</a> <a id="1251" href="Bitcoin.Consistency.html#1072" class="Function">STXOₜₓ</a> <a id="1258" href="Bitcoin.Consistency.html#1223" class="Bound">tx</a>
                     <a id="1282" href="Prelude.Sets.Interface.html#473" class="Function Operator">∪</a> <a id="1284" href="Bitcoin.Consistency.html#967" class="Function">UTXOₜₓ</a> <a id="1291" href="Bitcoin.Consistency.html#1223" class="Bound">tx</a>

<a id="1295" class="Comment">-- Consistent update.</a>
<a id="latestTime"></a><a id="1317" href="Bitcoin.Consistency.html#1317" class="Function">latestTime</a> <a id="1328" class="Symbol">:</a> <a id="1330" href="Bitcoin.Consistency.html#522" class="Function">Blockchain</a> <a id="1341" class="Symbol">→</a> <a id="1343" href="Bitcoin.BasicTypes.html#245" class="Function">Time</a>
<a id="1348" href="Bitcoin.Consistency.html#1317" class="Function">latestTime</a> <a id="1359" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>             <a id="1374" class="Symbol">=</a> <a id="1376" class="Number">0</a>
<a id="1378" href="Bitcoin.Consistency.html#1317" class="Function">latestTime</a> <a id="1389" class="Symbol">((_</a> <a id="1393" href="Bitcoin.Tx.Base.html#1750" class="InductiveConstructor Operator">at</a> <a id="1396" href="Bitcoin.Consistency.html#1396" class="Bound">t</a><a id="1397" class="Symbol">)</a> <a id="1399" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="1401" class="Symbol">_)</a> <a id="1404" class="Symbol">=</a> <a id="1406" href="Bitcoin.Consistency.html#1396" class="Bound">t</a>

<a id="1409" class="Keyword">record</a> <a id="_▷_,_"></a><a id="1416" href="Bitcoin.Consistency.html#1416" class="Record Operator">_▷_,_</a> <a id="1422" class="Symbol">(</a><a id="1423" href="Bitcoin.Consistency.html#1423" class="Bound">txs</a> <a id="1427" class="Symbol">:</a> <a id="1429" href="Bitcoin.Consistency.html#522" class="Function">Blockchain</a><a id="1439" class="Symbol">)</a> <a id="1441" class="Symbol">(</a><a id="1442" href="Bitcoin.Consistency.html#1442" class="Bound">tx</a> <a id="1445" class="Symbol">:</a> <a id="1447" href="Bitcoin.Tx.Base.html#903" class="Record">Tx</a> <a id="1450" href="Bitcoin.Tx.Base.html#1294" class="Generalizable">i</a> <a id="1452" href="Bitcoin.Tx.Base.html#1299" class="Generalizable">o</a><a id="1453" class="Symbol">)</a> <a id="1455" class="Symbol">(</a><a id="1456" href="Bitcoin.Consistency.html#1456" class="Bound">t</a> <a id="1458" class="Symbol">:</a> <a id="1460" href="Bitcoin.BasicTypes.html#245" class="Function">Time</a><a id="1464" class="Symbol">)</a> <a id="1466" class="Symbol">:</a> <a id="1468" class="PrimitiveType">Set</a> <a id="1472" class="Keyword">where</a>
  <a id="1480" class="Keyword">field</a>
    <a id="1490" class="Comment">-- well-formedness conditions</a>

    <a id="_▷_,_.inputsUnique"></a><a id="1525" href="Bitcoin.Consistency.html#1525" class="Field">inputsUnique</a> <a id="1538" class="Symbol">:</a>
      <a id="1546" href="Data.List.Relation.Unary.Unique.Setoid.html#869" class="Datatype">Unique</a> <a id="1553" class="Symbol">(</a><a id="1554" href="Data.Vec.Base.html#7399" class="Function">V.toList</a> <a id="1563" class="Symbol">(</a><a id="1564" href="Bitcoin.Tx.Base.html#940" class="Field">inputs</a> <a id="1571" href="Bitcoin.Consistency.html#1442" class="Bound">tx</a><a id="1573" class="Symbol">))</a>

    <a id="_▷_,_.singleMatch"></a><a id="1581" href="Bitcoin.Consistency.html#1581" class="Field">singleMatch</a> <a id="1593" class="Symbol">:</a> <a id="1595" class="Symbol">∀</a> <a id="1597" class="Symbol">(</a><a id="1598" href="Bitcoin.Consistency.html#1598" class="Bound">i</a> <a id="1600" class="Symbol">:</a> <a id="1602" href="Data.Fin.Base.html#1066" class="Datatype">Fin</a> <a id="1606" href="Bitcoin.Consistency.html#1450" class="Bound">i</a><a id="1607" class="Symbol">)</a> <a id="1609" class="Symbol">→</a>
      <a id="1617" class="Keyword">let</a>
        <a id="1629" class="Symbol">(</a><a id="1630" href="Bitcoin.Consistency.html#1630" class="Bound">tx♯</a> <a id="1634" href="Bitcoin.Tx.Base.html#377" class="InductiveConstructor Operator">at</a> <a id="1637" class="Symbol">_)</a> <a id="1640" class="Symbol">=</a> <a id="1642" href="Bitcoin.Consistency.html#1442" class="Bound">tx</a> <a id="1645" href="Bitcoin.Tx.Base.html#1325" class="Function Operator">‼ⁱ</a> <a id="1648" href="Bitcoin.Consistency.html#1598" class="Bound">i</a>
      <a id="1656" class="Keyword">in</a>
        <a id="1667" href="Data.Product.html#1788" class="Function">∃[</a> <a id="1670" href="Bitcoin.Consistency.html#1670" class="Bound">tx</a> <a id="1673" href="Data.Product.html#1788" class="Function">]</a> <a id="1675" class="Symbol">(</a><a id="1676" href="Bitcoin.Consistency.html#712" class="Function">match</a> <a id="1682" href="Bitcoin.Consistency.html#1423" class="Bound">txs</a> <a id="1686" href="Bitcoin.Consistency.html#1630" class="Bound">tx♯</a> <a id="1690" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="1692" href="Prelude.Sets.Interface.html#416" class="Function">singleton</a> <a id="1702" href="Bitcoin.Consistency.html#1670" class="Bound">tx</a><a id="1704" class="Symbol">)</a>

    <a id="_▷_,_.noOutOfBounds"></a><a id="1711" href="Bitcoin.Consistency.html#1711" class="Field">noOutOfBounds</a> <a id="1725" class="Symbol">:</a> <a id="1727" class="Symbol">∀</a> <a id="1729" class="Symbol">(</a><a id="1730" href="Bitcoin.Consistency.html#1730" class="Bound">i</a> <a id="1732" class="Symbol">:</a> <a id="1734" href="Data.Fin.Base.html#1066" class="Datatype">Fin</a> <a id="1738" href="Bitcoin.Consistency.html#1450" class="Bound">i</a><a id="1739" class="Symbol">)</a> <a id="1741" class="Symbol">→</a>
      <a id="1749" class="Keyword">let</a>
        <a id="1761" class="Symbol">(</a><a id="1762" href="Bitcoin.Consistency.html#1762" class="Bound">Tᵢ♯</a> <a id="1766" href="Bitcoin.Tx.Base.html#377" class="InductiveConstructor Operator">at</a> <a id="1769" href="Bitcoin.Consistency.html#1769" class="Bound">oᵢ</a><a id="1771" class="Symbol">)</a>              <a id="1786" class="Symbol">=</a> <a id="1788" href="Bitcoin.Consistency.html#1442" class="Bound">tx</a> <a id="1791" href="Bitcoin.Tx.Base.html#1325" class="Function Operator">‼ⁱ</a> <a id="1794" href="Bitcoin.Consistency.html#1730" class="Bound">i</a>
        <a id="1804" class="Symbol">(((_</a> <a id="1809" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1811" href="Bitcoin.Consistency.html#1811" class="Bound">o</a> <a id="1813" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1815" class="Symbol">_)</a> <a id="1818" href="Bitcoin.Tx.Base.html#1750" class="InductiveConstructor Operator">at</a> <a id="1821" class="Symbol">_)</a> <a id="1824" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1826" class="Symbol">_)</a> <a id="1829" class="Symbol">=</a> <a id="1831" href="Bitcoin.Consistency.html#1581" class="Field">singleMatch</a> <a id="1843" href="Bitcoin.Consistency.html#1730" class="Bound">i</a>
      <a id="1851" class="Keyword">in</a>
        <a id="1862" href="Bitcoin.Consistency.html#1769" class="Bound">oᵢ</a> <a id="1865" href="Data.Nat.Base.html#1047" class="Function Operator">&lt;</a> <a id="1867" href="Bitcoin.Consistency.html#1811" class="Bound">o</a>

    <a id="1874" class="Comment">-------------------------------------------------------</a>

    <a id="1935" class="Comment">-- (1)</a>
    <a id="_▷_,_.inputs∈UTXO"></a><a id="1946" href="Bitcoin.Consistency.html#1946" class="Field">inputs∈UTXO</a> <a id="1958" class="Symbol">:</a> <a id="1960" class="Symbol">∀</a> <a id="1962" class="Symbol">(</a><a id="1963" href="Bitcoin.Consistency.html#1963" class="Bound">i</a> <a id="1965" class="Symbol">:</a> <a id="1967" href="Data.Fin.Base.html#1066" class="Datatype">Fin</a> <a id="1971" href="Bitcoin.Consistency.html#1450" class="Bound">i</a><a id="1972" class="Symbol">)</a> <a id="1974" class="Symbol">→</a>
      <a id="1982" class="Keyword">let</a>
        <a id="1994" class="Symbol">(</a><a id="1995" href="Bitcoin.Consistency.html#1995" class="Bound">Tᵢ♯</a> <a id="1999" href="Bitcoin.Tx.Base.html#377" class="InductiveConstructor Operator">at</a> <a id="2002" href="Bitcoin.Consistency.html#2002" class="Bound">oᵢ</a><a id="2004" class="Symbol">)</a> <a id="2006" class="Symbol">=</a> <a id="2008" href="Bitcoin.Consistency.html#1442" class="Bound">tx</a> <a id="2011" href="Bitcoin.Tx.Base.html#1325" class="Function Operator">‼ⁱ</a> <a id="2014" href="Bitcoin.Consistency.html#1963" class="Bound">i</a>
      <a id="2022" class="Keyword">in</a>
        <a id="2033" href="Bitcoin.Consistency.html#1995" class="Bound">Tᵢ♯</a> <a id="2037" href="Bitcoin.Tx.Base.html#377" class="InductiveConstructor Operator">at</a> <a id="2040" href="Bitcoin.Consistency.html#2002" class="Bound">oᵢ</a> <a id="2043" href="Prelude.Sets.Interface.html#442" class="Function Operator">∈ˢ</a> <a id="2046" href="Bitcoin.Consistency.html#1157" class="Function">UTXO</a> <a id="2051" href="Bitcoin.Consistency.html#1423" class="Bound">txs</a>

    <a id="2060" class="Comment">-- (2)</a>
    <a id="_▷_,_.inputsRedeemable"></a><a id="2071" href="Bitcoin.Consistency.html#2071" class="Field">inputsRedeemable</a> <a id="2088" class="Symbol">:</a> <a id="2090" class="Symbol">∀</a> <a id="2092" class="Symbol">(</a><a id="2093" href="Bitcoin.Consistency.html#2093" class="Bound">i</a> <a id="2095" class="Symbol">:</a> <a id="2097" href="Data.Fin.Base.html#1066" class="Datatype">Fin</a> <a id="2101" href="Bitcoin.Consistency.html#1450" class="Bound">i</a><a id="2102" class="Symbol">)</a> <a id="2104" class="Symbol">→</a>
      <a id="2112" class="Keyword">let</a>
        <a id="2124" class="Symbol">(_</a> <a id="2127" href="Bitcoin.Tx.Base.html#377" class="InductiveConstructor Operator">at</a> <a id="2130" href="Bitcoin.Consistency.html#2130" class="Bound">oᵢ</a><a id="2132" class="Symbol">)</a> <a id="2134" class="Symbol">=</a> <a id="2136" href="Bitcoin.Consistency.html#1442" class="Bound">tx</a> <a id="2139" href="Bitcoin.Tx.Base.html#1325" class="Function Operator">‼ⁱ</a> <a id="2142" href="Bitcoin.Consistency.html#2093" class="Bound">i</a>
        <a id="2152" class="Symbol">(((_</a> <a id="2157" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2159" href="Bitcoin.Consistency.html#2159" class="Bound">o</a> <a id="2161" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2163" href="Bitcoin.Consistency.html#2163" class="Bound">Tᵢ</a><a id="2165" class="Symbol">)</a> <a id="2167" href="Bitcoin.Tx.Base.html#1750" class="InductiveConstructor Operator">at</a> <a id="2170" href="Bitcoin.Consistency.html#2170" class="Bound">tᵢ</a><a id="2172" class="Symbol">)</a> <a id="2174" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2176" class="Symbol">_)</a> <a id="2179" class="Symbol">=</a> <a id="2181" href="Bitcoin.Consistency.html#1581" class="Field">singleMatch</a> <a id="2193" href="Bitcoin.Consistency.html#2093" class="Bound">i</a>
        <a id="2203" href="Bitcoin.Consistency.html#2203" class="Bound">oᵢ</a> <a id="2206" class="Symbol">=</a> <a id="2208" href="Data.Fin.Base.html#1913" class="Function">fromℕ&lt;</a> <a id="2215" class="Symbol">{</a><a id="2216" class="Argument">m</a> <a id="2218" class="Symbol">=</a> <a id="2220" href="Bitcoin.Consistency.html#2130" class="Bound">oᵢ</a><a id="2222" class="Symbol">}</a> <a id="2224" class="Symbol">{</a><a id="2225" class="Argument">n</a> <a id="2227" class="Symbol">=</a> <a id="2229" href="Bitcoin.Consistency.html#2159" class="Bound">o</a><a id="2230" class="Symbol">}</a> <a id="2232" class="Symbol">(</a><a id="2233" href="Bitcoin.Consistency.html#1711" class="Field">noOutOfBounds</a> <a id="2247" href="Bitcoin.Consistency.html#2093" class="Bound">i</a><a id="2248" class="Symbol">)</a>
        <a id="2258" href="Bitcoin.Consistency.html#2258" class="Bound">vᵢ</a> <a id="2261" class="Symbol">=</a> <a id="2263" href="Bitcoin.Tx.Base.html#658" class="Field">value</a> <a id="2269" class="Symbol">(</a><a id="2270" href="Agda.Builtin.Sigma.html#264" class="Field">proj₂</a> <a id="2276" class="Symbol">(</a><a id="2277" href="Bitcoin.Consistency.html#2163" class="Bound">Tᵢ</a> <a id="2280" href="Bitcoin.Tx.Base.html#1519" class="Function Operator">‼ᵒ</a> <a id="2283" href="Bitcoin.Consistency.html#2203" class="Bound">oᵢ</a><a id="2285" class="Symbol">))</a>
      <a id="2294" class="Keyword">in</a>
        <a id="2305" href="Bitcoin.Consistency.html#2163" class="Bound">Tᵢ</a> <a id="2308" href="Bitcoin.Tx.Semantics.html#515" class="Record Operator">,</a> <a id="2310" href="Bitcoin.Consistency.html#2203" class="Bound">oᵢ</a> <a id="2313" href="Bitcoin.Tx.Semantics.html#515" class="Record Operator">,</a> <a id="2315" href="Bitcoin.Consistency.html#2170" class="Bound">tᵢ</a> <a id="2318" href="Bitcoin.Tx.Semantics.html#515" class="Record Operator">↝[</a> <a id="2321" href="Bitcoin.Consistency.html#2258" class="Bound">vᵢ</a> <a id="2324" href="Bitcoin.Tx.Semantics.html#515" class="Record Operator">]</a> <a id="2326" href="Bitcoin.Consistency.html#1442" class="Bound">tx</a> <a id="2329" href="Bitcoin.Tx.Semantics.html#515" class="Record Operator">,</a> <a id="2331" href="Bitcoin.Consistency.html#2093" class="Bound">i</a> <a id="2333" href="Bitcoin.Tx.Semantics.html#515" class="Record Operator">,</a> <a id="2335" href="Bitcoin.Consistency.html#1456" class="Bound">t</a>

    <a id="2342" class="Comment">-- (3)</a>
    <a id="_▷_,_.valuesPreserved"></a><a id="2353" href="Bitcoin.Consistency.html#2353" class="Field">valuesPreserved</a> <a id="2369" class="Symbol">:</a>
      <a id="2377" class="Keyword">let</a>
        <a id="2389" href="Bitcoin.Consistency.html#2389" class="Bound">ins</a>  <a id="2394" class="Symbol">=</a> <a id="2396" href="Data.Vec.Base.html#5849" class="Function">V.tabulate</a> <a id="2407" class="Symbol">λ</a> <a id="2409" href="Bitcoin.Consistency.html#2409" class="Bound">i</a> <a id="2411" class="Symbol">→</a> <a id="2413" class="Keyword">let</a> <a id="2417" class="Symbol">(_</a> <a id="2420" href="Bitcoin.Tx.Base.html#377" class="InductiveConstructor Operator">at</a> <a id="2423" href="Bitcoin.Consistency.html#2423" class="Bound">oᵢ</a><a id="2425" class="Symbol">)</a> <a id="2427" class="Symbol">=</a> <a id="2429" href="Bitcoin.Consistency.html#1442" class="Bound">tx</a> <a id="2432" href="Bitcoin.Tx.Base.html#1325" class="Function Operator">‼ⁱ</a> <a id="2435" href="Bitcoin.Consistency.html#2409" class="Bound">i</a>
                                    <a id="2473" class="Symbol">(((_</a> <a id="2478" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2480" href="Bitcoin.Consistency.html#2480" class="Bound">o</a> <a id="2482" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2484" href="Bitcoin.Consistency.html#2484" class="Bound">Tᵢ</a><a id="2486" class="Symbol">)</a> <a id="2488" href="Bitcoin.Tx.Base.html#1750" class="InductiveConstructor Operator">at</a> <a id="2491" href="Bitcoin.Consistency.html#2491" class="Bound">tᵢ</a><a id="2493" class="Symbol">)</a> <a id="2495" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2497" class="Symbol">_)</a> <a id="2500" class="Symbol">=</a> <a id="2502" href="Bitcoin.Consistency.html#1581" class="Field">singleMatch</a> <a id="2514" href="Bitcoin.Consistency.html#2409" class="Bound">i</a>
                                    <a id="2552" href="Bitcoin.Consistency.html#2552" class="Bound">oᵢ</a> <a id="2555" class="Symbol">=</a> <a id="2557" href="Data.Fin.Base.html#1913" class="Function">fromℕ&lt;</a> <a id="2564" class="Symbol">{</a><a id="2565" class="Argument">m</a> <a id="2567" class="Symbol">=</a> <a id="2569" href="Bitcoin.Consistency.html#2423" class="Bound">oᵢ</a><a id="2571" class="Symbol">}</a> <a id="2573" class="Symbol">{</a><a id="2574" class="Argument">n</a> <a id="2576" class="Symbol">=</a> <a id="2578" href="Bitcoin.Consistency.html#2480" class="Bound">o</a><a id="2579" class="Symbol">}</a> <a id="2581" class="Symbol">(</a><a id="2582" href="Bitcoin.Consistency.html#1711" class="Field">noOutOfBounds</a> <a id="2596" href="Bitcoin.Consistency.html#2409" class="Bound">i</a><a id="2597" class="Symbol">)</a>
                                <a id="2631" class="Keyword">in</a> <a id="2634" href="Bitcoin.Tx.Base.html#658" class="Field">value</a> <a id="2640" class="Symbol">(</a><a id="2641" href="Agda.Builtin.Sigma.html#264" class="Field">proj₂</a> <a id="2647" class="Symbol">(</a><a id="2648" href="Bitcoin.Consistency.html#2484" class="Bound">Tᵢ</a> <a id="2651" href="Bitcoin.Tx.Base.html#1519" class="Function Operator">‼ᵒ</a> <a id="2654" href="Bitcoin.Consistency.html#2552" class="Bound">oᵢ</a><a id="2656" class="Symbol">))</a>
        <a id="2667" href="Bitcoin.Consistency.html#2667" class="Bound">outs</a> <a id="2672" class="Symbol">=</a> <a id="2674" href="Data.Vec.Base.html#2541" class="Function">V.map</a> <a id="2680" class="Symbol">(</a><a id="2681" href="Bitcoin.Tx.Base.html#658" class="Field">value</a> <a id="2687" href="Function.Base.html#992" class="Function Operator">∘</a> <a id="2689" href="Agda.Builtin.Sigma.html#264" class="Field">proj₂</a><a id="2694" class="Symbol">)</a> <a id="2696" class="Symbol">(</a><a id="2697" href="Bitcoin.Tx.Base.html#1090" class="Field">outputs</a> <a id="2705" href="Bitcoin.Consistency.html#1442" class="Bound">tx</a><a id="2707" class="Symbol">)</a>
      <a id="2715" class="Keyword">in</a>
        <a id="2726" href="Data.Vec.Base.html#5375" class="Function">V.sum</a> <a id="2732" href="Bitcoin.Consistency.html#2389" class="Bound">ins</a> <a id="2736" href="Data.Nat.Base.html#1081" class="Function Operator">≥</a> <a id="2738" href="Data.Vec.Base.html#5375" class="Function">V.sum</a> <a id="2744" href="Bitcoin.Consistency.html#2667" class="Bound">outs</a>

    <a id="2754" class="Comment">-- (4)</a>
    <a id="_▷_,_.laterTime"></a><a id="2765" href="Bitcoin.Consistency.html#2765" class="Field">laterTime</a> <a id="2775" class="Symbol">:</a>
      <a id="2783" href="Bitcoin.Consistency.html#1456" class="Bound">t</a> <a id="2785" href="Data.Nat.Base.html#1081" class="Function Operator">≥</a> <a id="2787" href="Bitcoin.Consistency.html#1317" class="Function">latestTime</a> <a id="2798" href="Bitcoin.Consistency.html#1423" class="Bound">txs</a>

<a id="2803" class="Comment">-- Consistency.</a>
<a id="2819" class="Keyword">data</a> <a id="ConsistentBlockchain"></a><a id="2824" href="Bitcoin.Consistency.html#2824" class="Datatype">ConsistentBlockchain</a> <a id="2845" class="Symbol">:</a> <a id="2847" href="Bitcoin.Consistency.html#522" class="Function">Blockchain</a> <a id="2858" class="Symbol">→</a> <a id="2860" class="PrimitiveType">Set</a> <a id="2864" class="Keyword">where</a>
  <a id="ConsistentBlockchain.∙_∶-_"></a><a id="2872" href="Bitcoin.Consistency.html#2872" class="InductiveConstructor Operator">∙_∶-_</a>  <a id="2879" class="Symbol">:</a> <a id="2881" class="Symbol">(</a><a id="2882" href="Bitcoin.Consistency.html#2882" class="Bound">tx</a> <a id="2885" class="Symbol">:</a> <a id="2887" href="Bitcoin.Tx.Base.html#903" class="Record">Tx</a> <a id="2890" class="Number">0</a> <a id="2892" href="Bitcoin.Tx.Base.html#1299" class="Generalizable">o</a><a id="2893" class="Symbol">)</a>
         <a id="2904" class="Symbol">→</a> <a id="2906" href="Bitcoin.Tx.Base.html#1632" class="Function">Coinbase</a> <a id="2915" href="Bitcoin.Consistency.html#2882" class="Bound">tx</a>
         <a id="2927" class="Symbol">→</a> <a id="2929" href="Bitcoin.Consistency.html#2824" class="Datatype">ConsistentBlockchain</a> <a id="2950" href="Data.List.Base.html#4458" class="Function Operator">[</a> <a id="2952" class="Symbol">(_</a> <a id="2955" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2957" class="Symbol">_</a> <a id="2959" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2961" href="Bitcoin.Consistency.html#2882" class="Bound">tx</a><a id="2963" class="Symbol">)</a> <a id="2965" href="Bitcoin.Tx.Base.html#1750" class="InductiveConstructor Operator">at</a> <a id="2968" class="Number">0</a> <a id="2970" href="Data.List.Base.html#4458" class="Function Operator">]</a>

  <a id="ConsistentBlockchain._⊕_∶-_"></a><a id="2975" href="Bitcoin.Consistency.html#2975" class="InductiveConstructor Operator">_⊕_∶-_</a> <a id="2982" class="Symbol">:</a> <a id="2984" href="Bitcoin.Consistency.html#2824" class="Datatype">ConsistentBlockchain</a> <a id="3005" href="Bitcoin.Consistency.html#635" class="Generalizable">txs</a>
         <a id="3018" class="Symbol">→</a> <a id="3020" class="Symbol">(</a><a id="3021" href="Bitcoin.Consistency.html#3021" class="Bound">tx</a> <a id="3024" class="Symbol">:</a> <a id="3026" href="Bitcoin.Tx.Base.html#903" class="Record">Tx</a> <a id="3029" href="Bitcoin.Tx.Base.html#1294" class="Generalizable">i</a> <a id="3031" href="Bitcoin.Tx.Base.html#1299" class="Generalizable">o</a><a id="3032" class="Symbol">)</a>
         <a id="3043" class="Symbol">→</a> <a id="3045" href="Bitcoin.Consistency.html#635" class="Generalizable">txs</a> <a id="3049" href="Bitcoin.Consistency.html#1416" class="Record Operator">▷</a> <a id="3051" href="Bitcoin.Consistency.html#3021" class="Bound">tx</a> <a id="3054" href="Bitcoin.Consistency.html#1416" class="Record Operator">,</a> <a id="3056" href="Bitcoin.BasicTypes.html#313" class="Generalizable">t</a>
         <a id="3067" class="Symbol">→</a> <a id="3069" href="Bitcoin.Consistency.html#2824" class="Datatype">ConsistentBlockchain</a> <a id="3090" class="Symbol">(((_</a> <a id="3095" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3097" class="Symbol">_</a> <a id="3099" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3101" href="Bitcoin.Consistency.html#3021" class="Bound">tx</a><a id="3103" class="Symbol">)</a> <a id="3105" href="Bitcoin.Tx.Base.html#1750" class="InductiveConstructor Operator">at</a> <a id="3108" href="Bitcoin.BasicTypes.html#313" class="Generalizable">t</a><a id="3109" class="Symbol">)</a> <a id="3111" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3113" href="Bitcoin.Consistency.html#635" class="Generalizable">txs</a><a id="3116" class="Symbol">)</a>
</pre></body></html>