<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Bitcoin.Consistency</title><link rel="stylesheet" href="css/Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- Blockchain and consistency.</a>
<a id="105" class="Comment">------------------------------------------------------------------------</a>
<a id="178" class="Keyword">module</a> <a id="185" href="Bitcoin.Consistency.html" class="Module">Bitcoin.Consistency</a> <a id="205" class="Keyword">where</a>

<a id="212" class="Keyword">open</a> <a id="217" class="Keyword">import</a> <a id="224" href="Prelude.Init.html" class="Module">Prelude.Init</a>
<a id="237" class="Keyword">open</a> <a id="242" class="Keyword">import</a> <a id="249" href="Prelude.General.html" class="Module">Prelude.General</a>
<a id="265" class="Keyword">open</a> <a id="270" class="Keyword">import</a> <a id="277" href="Prelude.Lists.html" class="Module">Prelude.Lists</a>
<a id="291" class="Keyword">open</a> <a id="296" class="Keyword">import</a> <a id="303" href="Prelude.DecEq.html" class="Module">Prelude.DecEq</a>
<a id="317" class="Keyword">open</a> <a id="322" class="Keyword">import</a> <a id="329" href="Prelude.Sets.html" class="Module">Prelude.Sets</a>
<a id="342" class="Keyword">open</a> <a id="347" class="Keyword">import</a> <a id="354" href="Prelude.Functor.html" class="Module">Prelude.Functor</a>
<a id="370" class="Keyword">open</a> <a id="375" class="Keyword">import</a> <a id="382" href="Prelude.ToN.html" class="Module">Prelude.ToN</a>
<a id="394" class="Keyword">open</a> <a id="399" class="Keyword">import</a> <a id="406" href="Prelude.Ord.html" class="Module">Prelude.Ord</a>
<a id="418" class="Keyword">open</a> <a id="423" class="Keyword">import</a> <a id="430" href="Prelude.InferenceRules.html" class="Module">Prelude.InferenceRules</a>

<a id="454" class="Keyword">open</a> <a id="459" class="Keyword">import</a> <a id="466" href="Bitcoin.Crypto.html" class="Module">Bitcoin.Crypto</a>
<a id="481" class="Keyword">open</a> <a id="486" class="Keyword">import</a> <a id="493" href="Bitcoin.BasicTypes.html" class="Module">Bitcoin.BasicTypes</a>
<a id="512" class="Keyword">open</a> <a id="517" class="Keyword">import</a> <a id="524" href="Bitcoin.Script.Base.html" class="Module">Bitcoin.Script.Base</a>
<a id="544" class="Keyword">open</a> <a id="549" class="Keyword">import</a> <a id="556" href="Bitcoin.Tx.Base.html" class="Module">Bitcoin.Tx.Base</a>
<a id="572" class="Keyword">open</a> <a id="577" class="Keyword">import</a> <a id="584" href="Bitcoin.Tx.Crypto.html" class="Module">Bitcoin.Tx.Crypto</a>
<a id="602" class="Keyword">open</a> <a id="607" class="Keyword">import</a> <a id="614" href="Bitcoin.Tx.Semantics.html" class="Module">Bitcoin.Tx.Semantics</a>

<a id="636" class="Comment">-- Blockchain</a>
<a id="Blockchain"></a><a id="650" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a> <a id="661" class="Symbol">:</a> <a id="663" href="Agda.Primitive.html#326" class="Primitive">Set</a>
<a id="667" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a> <a id="678" class="Symbol">=</a> <a id="680" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="685" href="Bitcoin.Tx.Base.html#2342" class="Record">TimedTx</a> <a id="693" class="Comment">-- in reverse chronological order, in contrast to the paper</a>

<a id="754" class="Keyword">variable</a> <a id="763" href="Bitcoin.Consistency.html#763" class="Generalizable">txs</a> <a id="767" href="Bitcoin.Consistency.html#767" class="Generalizable">txs′</a> <a id="772" class="Symbol">:</a> <a id="774" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a>

<a id="txSet"></a><a id="786" href="Bitcoin.Consistency.html#786" class="Function">txSet</a> <a id="792" class="Symbol">:</a> <a id="794" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a> <a id="805" class="Symbol">→</a> <a id="807" href="Prelude.Sets.Interface.html#416" class="Function">Set⟨</a> <a id="812" href="Bitcoin.Tx.Base.html#2342" class="Record">TimedTx</a> <a id="820" href="Prelude.Sets.Interface.html#416" class="Function">⟩</a>
<a id="822" href="Bitcoin.Consistency.html#786" class="Function">txSet</a> <a id="828" class="Symbol">=</a> <a id="830" href="Prelude.Sets.Interface.html#3982" class="Function">fromList</a>

<a id="match"></a><a id="840" href="Bitcoin.Consistency.html#840" class="Function">match</a> <a id="846" class="Symbol">:</a> <a id="848" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a> <a id="859" class="Symbol">→</a> <a id="861" href="Bitcoin.BasicTypes.html#266" class="Function">HashId</a> <a id="868" class="Symbol">→</a> <a id="870" href="Prelude.Sets.Interface.html#416" class="Function">Set⟨</a> <a id="875" href="Bitcoin.Tx.Base.html#2342" class="Record">TimedTx</a> <a id="883" href="Prelude.Sets.Interface.html#416" class="Function">⟩</a>
<a id="885" href="Bitcoin.Consistency.html#840" class="Function">match</a> <a id="891" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>                <a id="909" class="Symbol">_</a>   <a id="913" class="Symbol">=</a> <a id="915" href="Prelude.Sets.Interface.html#434" class="Function">∅</a>
<a id="917" href="Bitcoin.Consistency.html#840" class="Function">match</a> <a id="923" class="Symbol">((</a><a id="925" href="Bitcoin.Consistency.html#925" class="Bound">tx</a> <a id="928" href="Bitcoin.Tx.Base.html#2376" class="InductiveConstructor Operator">at</a> <a id="931" href="Bitcoin.Consistency.html#931" class="Bound">t</a><a id="932" class="Symbol">)</a> <a id="934" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="936" href="Bitcoin.Consistency.html#936" class="Bound">txs</a><a id="939" class="Symbol">)</a> <a id="941" href="Bitcoin.Consistency.html#941" class="Bound">tx♯</a> <a id="945" class="Keyword">with</a> <a id="950" href="Bitcoin.Consistency.html#925" class="Bound">tx</a> <a id="953" href="Bitcoin.Crypto.html#826" class="Field Operator">♯</a> <a id="955" href="Prelude.DecEq.Core.html#141" class="Field Operator">≟</a> <a id="957" href="Bitcoin.Consistency.html#941" class="Bound">tx♯</a>
<a id="961" class="Symbol">...</a> <a id="965" class="Symbol">|</a> <a id="967" href="Relation.Nullary.html#1685" class="InductiveConstructor">no</a> <a id="970" class="Symbol">_</a>  <a id="973" class="Symbol">=</a> <a id="975" href="Bitcoin.Consistency.html#840" class="Function">match</a> <a id="981" class="Bound">txs</a> <a id="985" class="Bound">tx♯</a>
<a id="989" class="Symbol">...</a> <a id="993" class="Symbol">|</a> <a id="995" href="Relation.Nullary.html#1648" class="InductiveConstructor">yes</a> <a id="999" class="Symbol">_</a> <a id="1001" class="Symbol">=</a> <a id="1003" href="Prelude.Sets.Interface.html#447" class="Function">singleton</a> <a id="1013" class="Symbol">(</a><a id="1014" class="Bound">tx</a> <a id="1017" href="Bitcoin.Tx.Base.html#2376" class="InductiveConstructor Operator">at</a> <a id="1020" class="Bound">t</a><a id="1021" class="Symbol">)</a>
            <a id="1035" href="Prelude.Sets.Interface.html#504" class="Function Operator">∪</a> <a id="1037" href="Bitcoin.Consistency.html#840" class="Function">match</a> <a id="1043" class="Bound">txs</a> <a id="1047" class="Bound">tx♯</a>

<a id="1052" class="Comment">-- UTXO: Unspent transaction outputs.</a>
<a id="1090" class="Comment">-- (0) EUTXO-like set-theoretic definition, based on txInputs instead of outputs for convenience</a>
<a id="UTXOₜₓ"></a><a id="1187" href="Bitcoin.Consistency.html#1187" class="Function">UTXOₜₓ</a> <a id="1194" class="Symbol">:</a> <a id="1196" href="Bitcoin.Tx.Base.html#1255" class="Function">∃Tx</a> <a id="1200" class="Symbol">→</a> <a id="1202" href="Prelude.Sets.Interface.html#416" class="Function">Set⟨</a> <a id="1207" href="Bitcoin.Tx.Base.html#343" class="Record">TxInput</a> <a id="1215" href="Prelude.Sets.Interface.html#416" class="Function">⟩</a>
<a id="1217" href="Bitcoin.Consistency.html#1187" class="Function">UTXOₜₓ</a> <a id="1224" href="Bitcoin.Consistency.html#1224" class="Bound">∃tx</a><a id="1227" class="Symbol">@(_</a> <a id="1231" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1233" href="Bitcoin.Consistency.html#1233" class="Bound">o</a> <a id="1235" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1237" href="Bitcoin.Consistency.html#1237" class="Bound">tx</a><a id="1239" class="Symbol">)</a> <a id="1241" class="Symbol">=</a> <a id="1243" href="Prelude.Sets.Interface.html#3982" class="Function">fromList</a> <a id="1252" href="Function.Base.html#1919" class="Function Operator">$</a> <a id="1254" href="Data.List.Base.html#1544" class="Function">map</a> <a id="1258" class="Symbol">(λ</a> <a id="1261" href="Bitcoin.Consistency.html#1261" class="Bound">i</a> <a id="1263" class="Symbol">→</a> <a id="1265" class="Symbol">(</a><a id="1266" href="Bitcoin.Consistency.html#1224" class="Bound">∃tx</a> <a id="1270" href="Bitcoin.Crypto.html#826" class="Field Operator">♯</a><a id="1271" class="Symbol">)</a> <a id="1273" href="Bitcoin.Tx.Base.html#377" class="InductiveConstructor Operator">at</a> <a id="1276" href="Bitcoin.Consistency.html#1261" class="Bound">i</a><a id="1277" class="Symbol">)</a> <a id="1279" class="Symbol">(</a><a id="1280" href="Data.List.Base.html#6234" class="Function">upTo</a> <a id="1285" href="Bitcoin.Consistency.html#1233" class="Bound">o</a><a id="1286" class="Symbol">)</a>

<a id="STXOₜₓ"></a><a id="1289" href="Bitcoin.Consistency.html#1289" class="Function">STXOₜₓ</a> <a id="1296" class="Symbol">:</a> <a id="1298" href="Bitcoin.Tx.Base.html#1255" class="Function">∃Tx</a> <a id="1302" class="Symbol">→</a> <a id="1304" href="Prelude.Sets.Interface.html#416" class="Function">Set⟨</a> <a id="1309" href="Bitcoin.Tx.Base.html#343" class="Record">TxInput</a> <a id="1317" href="Prelude.Sets.Interface.html#416" class="Function">⟩</a>
<a id="1319" href="Bitcoin.Consistency.html#1289" class="Function">STXOₜₓ</a> <a id="1326" class="Symbol">(_</a> <a id="1329" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1331" class="Symbol">_</a> <a id="1333" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1335" href="Bitcoin.Consistency.html#1335" class="Bound">tx</a><a id="1337" class="Symbol">)</a> <a id="1339" class="Symbol">=</a> <a id="1341" href="Prelude.Sets.Interface.html#3982" class="Function">fromList</a> <a id="1350" class="Symbol">(</a><a id="1351" href="Data.Vec.Base.html#7438" class="Function">V.toList</a> <a id="1360" href="Function.Base.html#1919" class="Function Operator">$</a> <a id="1362" href="Bitcoin.Tx.Base.html#940" class="Field">inputs</a> <a id="1369" href="Bitcoin.Consistency.html#1335" class="Bound">tx</a><a id="1371" class="Symbol">)</a>

<a id="UTXO"></a><a id="1374" href="Bitcoin.Consistency.html#1374" class="Function">UTXO</a> <a id="1379" class="Symbol">:</a> <a id="1381" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a> <a id="1392" class="Symbol">→</a> <a id="1394" href="Prelude.Sets.Interface.html#416" class="Function">Set⟨</a> <a id="1399" href="Bitcoin.Tx.Base.html#343" class="Record">TxInput</a> <a id="1407" href="Prelude.Sets.Interface.html#416" class="Function">⟩</a>
<a id="1409" href="Bitcoin.Consistency.html#1374" class="Function">UTXO</a> <a id="1414" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>              <a id="1430" class="Symbol">=</a> <a id="1432" href="Prelude.Sets.Interface.html#434" class="Function">∅</a>
<a id="1434" href="Bitcoin.Consistency.html#1374" class="Function">UTXO</a> <a id="1439" class="Symbol">(</a><a id="1440" href="Bitcoin.Consistency.html#1440" class="Bound">tx</a> <a id="1443" href="Bitcoin.Tx.Base.html#2376" class="InductiveConstructor Operator">at</a> <a id="1446" class="Symbol">_</a> <a id="1448" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="1450" href="Bitcoin.Consistency.html#1450" class="Bound">txs</a><a id="1453" class="Symbol">)</a> <a id="1455" class="Symbol">=</a> <a id="1457" href="Bitcoin.Consistency.html#1374" class="Function">UTXO</a> <a id="1462" href="Bitcoin.Consistency.html#1450" class="Bound">txs</a> <a id="1466" href="Prelude.Sets.Interface.html#500" class="Function Operator">─</a> <a id="1468" href="Bitcoin.Consistency.html#1289" class="Function">STXOₜₓ</a> <a id="1475" href="Bitcoin.Consistency.html#1440" class="Bound">tx</a>
                     <a id="1499" href="Prelude.Sets.Interface.html#504" class="Function Operator">∪</a> <a id="1501" href="Bitcoin.Consistency.html#1187" class="Function">UTXOₜₓ</a> <a id="1508" href="Bitcoin.Consistency.html#1440" class="Bound">tx</a>

<a id="1512" class="Comment">-- Consistent update.</a>
<a id="latestTime"></a><a id="1534" href="Bitcoin.Consistency.html#1534" class="Function">latestTime</a> <a id="1545" class="Symbol">:</a> <a id="1547" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a> <a id="1558" class="Symbol">→</a> <a id="1560" href="Bitcoin.BasicTypes.html#245" class="Function">Time</a>
<a id="1565" href="Bitcoin.Consistency.html#1534" class="Function">latestTime</a> <a id="1576" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>             <a id="1591" class="Symbol">=</a> <a id="1593" class="Number">0</a>
<a id="1595" href="Bitcoin.Consistency.html#1534" class="Function">latestTime</a> <a id="1606" class="Symbol">((_</a> <a id="1610" href="Bitcoin.Tx.Base.html#2376" class="InductiveConstructor Operator">at</a> <a id="1613" href="Bitcoin.Consistency.html#1613" class="Bound">t</a><a id="1614" class="Symbol">)</a> <a id="1616" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="1618" class="Symbol">_)</a> <a id="1621" class="Symbol">=</a> <a id="1623" href="Bitcoin.Consistency.html#1613" class="Bound">t</a>

<a id="1626" class="Keyword">record</a> <a id="_▷_,_"></a><a id="1633" href="Bitcoin.Consistency.html#1633" class="Record Operator">_▷_,_</a> <a id="1639" class="Symbol">(</a><a id="1640" href="Bitcoin.Consistency.html#1640" class="Bound">txs</a> <a id="1644" class="Symbol">:</a> <a id="1646" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a><a id="1656" class="Symbol">)</a> <a id="1658" class="Symbol">(</a><a id="1659" href="Bitcoin.Consistency.html#1659" class="Bound">tx</a> <a id="1662" class="Symbol">:</a> <a id="1664" href="Bitcoin.Tx.Base.html#903" class="Record">Tx</a> <a id="1667" href="Bitcoin.Tx.Base.html#1914" class="Generalizable">i</a> <a id="1669" href="Bitcoin.Tx.Base.html#1919" class="Generalizable">o</a><a id="1670" class="Symbol">)</a> <a id="1672" class="Symbol">(</a><a id="1673" href="Bitcoin.Consistency.html#1673" class="Bound">t</a> <a id="1675" class="Symbol">:</a> <a id="1677" href="Bitcoin.BasicTypes.html#245" class="Function">Time</a><a id="1681" class="Symbol">)</a> <a id="1683" class="Symbol">:</a> <a id="1685" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="1689" class="Keyword">where</a>
  <a id="1697" class="Keyword">field</a>
    <a id="1707" class="Comment">-- well-formedness conditions</a>

    <a id="_▷_,_.inputsUnique"></a><a id="1742" href="Bitcoin.Consistency.html#1742" class="Field">inputsUnique</a> <a id="1755" class="Symbol">:</a>
      <a id="1763" href="Data.List.Relation.Unary.Unique.Setoid.html#719" class="Datatype">Unique</a> <a id="1770" class="Symbol">(</a><a id="1771" href="Data.Vec.Base.html#7438" class="Function">V.toList</a> <a id="1780" class="Symbol">(</a><a id="1781" href="Bitcoin.Tx.Base.html#940" class="Field">inputs</a> <a id="1788" href="Bitcoin.Consistency.html#1659" class="Bound">tx</a><a id="1790" class="Symbol">))</a>

    <a id="_▷_,_.singleMatch"></a><a id="1798" href="Bitcoin.Consistency.html#1798" class="Field">singleMatch</a> <a id="1810" class="Symbol">:</a> <a id="1812" class="Symbol">∀</a> <a id="1814" class="Symbol">(</a><a id="1815" href="Bitcoin.Consistency.html#1815" class="Bound">i</a> <a id="1817" class="Symbol">:</a> <a id="1819" href="Data.Fin.Base.html#1126" class="Datatype">Fin</a> <a id="1823" href="Bitcoin.Consistency.html#1667" class="Bound">i</a><a id="1824" class="Symbol">)</a> <a id="1826" class="Symbol">→</a>
      <a id="1834" class="Keyword">let</a>
        <a id="1846" class="Symbol">(</a><a id="1847" href="Bitcoin.Consistency.html#1847" class="Bound">tx♯</a> <a id="1851" href="Bitcoin.Tx.Base.html#377" class="InductiveConstructor Operator">at</a> <a id="1854" class="Symbol">_)</a> <a id="1857" class="Symbol">=</a> <a id="1859" href="Bitcoin.Consistency.html#1659" class="Bound">tx</a> <a id="1862" href="Bitcoin.Tx.Base.html#1945" class="Function Operator">‼ⁱ</a> <a id="1865" href="Bitcoin.Consistency.html#1815" class="Bound">i</a>
      <a id="1873" class="Keyword">in</a>
        <a id="1884" href="Data.Product.html#1806" class="Function">∃[</a> <a id="1887" href="Bitcoin.Consistency.html#1887" class="Bound">tx</a> <a id="1890" href="Data.Product.html#1806" class="Function">]</a> <a id="1892" class="Symbol">(</a><a id="1893" href="Bitcoin.Consistency.html#840" class="Function">match</a> <a id="1899" href="Bitcoin.Consistency.html#1640" class="Bound">txs</a> <a id="1903" href="Bitcoin.Consistency.html#1847" class="Bound">tx♯</a> <a id="1907" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="1909" href="Prelude.Sets.Interface.html#447" class="Function">singleton</a> <a id="1919" href="Bitcoin.Consistency.html#1887" class="Bound">tx</a><a id="1921" class="Symbol">)</a>

    <a id="_▷_,_.noOutOfBounds"></a><a id="1928" href="Bitcoin.Consistency.html#1928" class="Field">noOutOfBounds</a> <a id="1942" class="Symbol">:</a> <a id="1944" class="Symbol">∀</a> <a id="1946" class="Symbol">(</a><a id="1947" href="Bitcoin.Consistency.html#1947" class="Bound">i</a> <a id="1949" class="Symbol">:</a> <a id="1951" href="Data.Fin.Base.html#1126" class="Datatype">Fin</a> <a id="1955" href="Bitcoin.Consistency.html#1667" class="Bound">i</a><a id="1956" class="Symbol">)</a> <a id="1958" class="Symbol">→</a>
      <a id="1966" class="Keyword">let</a>
        <a id="1978" class="Symbol">(</a><a id="1979" href="Bitcoin.Consistency.html#1979" class="Bound">Tᵢ♯</a> <a id="1983" href="Bitcoin.Tx.Base.html#377" class="InductiveConstructor Operator">at</a> <a id="1986" href="Bitcoin.Consistency.html#1986" class="Bound">oᵢ</a><a id="1988" class="Symbol">)</a>              <a id="2003" class="Symbol">=</a> <a id="2005" href="Bitcoin.Consistency.html#1659" class="Bound">tx</a> <a id="2008" href="Bitcoin.Tx.Base.html#1945" class="Function Operator">‼ⁱ</a> <a id="2011" href="Bitcoin.Consistency.html#1947" class="Bound">i</a>
        <a id="2021" class="Symbol">(((_</a> <a id="2026" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2028" href="Bitcoin.Consistency.html#2028" class="Bound">o</a> <a id="2030" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2032" class="Symbol">_)</a> <a id="2035" href="Bitcoin.Tx.Base.html#2376" class="InductiveConstructor Operator">at</a> <a id="2038" class="Symbol">_)</a> <a id="2041" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2043" class="Symbol">_)</a> <a id="2046" class="Symbol">=</a> <a id="2048" href="Bitcoin.Consistency.html#1798" class="Field">singleMatch</a> <a id="2060" href="Bitcoin.Consistency.html#1947" class="Bound">i</a>
      <a id="2068" class="Keyword">in</a>
        <a id="2079" href="Bitcoin.Consistency.html#1986" class="Bound">oᵢ</a> <a id="2082" href="Prelude.Ord.html#218" class="Field Operator">&lt;</a> <a id="2084" href="Bitcoin.Consistency.html#2028" class="Bound">o</a>

    <a id="2091" class="Comment">-------------------------------------------------------</a>

    <a id="2152" class="Comment">-- (1)</a>
    <a id="_▷_,_.inputs∈UTXO"></a><a id="2163" href="Bitcoin.Consistency.html#2163" class="Field">inputs∈UTXO</a> <a id="2175" class="Symbol">:</a> <a id="2177" class="Symbol">∀</a> <a id="2179" class="Symbol">(</a><a id="2180" href="Bitcoin.Consistency.html#2180" class="Bound">i</a> <a id="2182" class="Symbol">:</a> <a id="2184" href="Data.Fin.Base.html#1126" class="Datatype">Fin</a> <a id="2188" href="Bitcoin.Consistency.html#1667" class="Bound">i</a><a id="2189" class="Symbol">)</a> <a id="2191" class="Symbol">→</a>
      <a id="2199" href="Bitcoin.Consistency.html#1659" class="Bound">tx</a> <a id="2202" href="Bitcoin.Tx.Base.html#1945" class="Function Operator">‼ⁱ</a> <a id="2205" href="Bitcoin.Consistency.html#2180" class="Bound">i</a> <a id="2207" href="Prelude.Sets.Interface.html#473" class="Function Operator">∈ˢ</a> <a id="2210" href="Bitcoin.Consistency.html#1374" class="Function">UTXO</a> <a id="2215" href="Bitcoin.Consistency.html#1640" class="Bound">txs</a>

    <a id="2224" class="Comment">-- (2)</a>
    <a id="_▷_,_.inputsRedeemable"></a><a id="2235" href="Bitcoin.Consistency.html#2235" class="Field">inputsRedeemable</a> <a id="2252" class="Symbol">:</a> <a id="2254" class="Symbol">∀</a> <a id="2256" class="Symbol">(</a><a id="2257" href="Bitcoin.Consistency.html#2257" class="Bound">i</a> <a id="2259" class="Symbol">:</a> <a id="2261" href="Data.Fin.Base.html#1126" class="Datatype">Fin</a> <a id="2265" href="Bitcoin.Consistency.html#1667" class="Bound">i</a><a id="2266" class="Symbol">)</a> <a id="2268" class="Symbol">→</a>
      <a id="2276" class="Keyword">let</a>
        <a id="2288" class="Symbol">(_</a> <a id="2291" href="Bitcoin.Tx.Base.html#377" class="InductiveConstructor Operator">at</a> <a id="2294" href="Bitcoin.Consistency.html#2294" class="Bound">oᵢ</a><a id="2296" class="Symbol">)</a> <a id="2298" class="Symbol">=</a> <a id="2300" href="Bitcoin.Consistency.html#1659" class="Bound">tx</a> <a id="2303" href="Bitcoin.Tx.Base.html#1945" class="Function Operator">‼ⁱ</a> <a id="2306" href="Bitcoin.Consistency.html#2257" class="Bound">i</a>
        <a id="2316" class="Symbol">(((_</a> <a id="2321" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2323" href="Bitcoin.Consistency.html#2323" class="Bound">o</a> <a id="2325" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2327" href="Bitcoin.Consistency.html#2327" class="Bound">Tᵢ</a><a id="2329" class="Symbol">)</a> <a id="2331" href="Bitcoin.Tx.Base.html#2376" class="InductiveConstructor Operator">at</a> <a id="2334" href="Bitcoin.Consistency.html#2334" class="Bound">tᵢ</a><a id="2336" class="Symbol">)</a> <a id="2338" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2340" class="Symbol">_)</a> <a id="2343" class="Symbol">=</a> <a id="2345" href="Bitcoin.Consistency.html#1798" class="Field">singleMatch</a> <a id="2357" href="Bitcoin.Consistency.html#2257" class="Bound">i</a>
        <a id="2367" href="Bitcoin.Consistency.html#2367" class="Bound">oᵢ</a> <a id="2370" class="Symbol">=</a> <a id="2372" href="Data.Fin.Base.html#1973" class="Function">F.fromℕ&lt;</a> <a id="2381" class="Symbol">{</a><a id="2382" class="Argument">m</a> <a id="2384" class="Symbol">=</a> <a id="2386" href="Bitcoin.Consistency.html#2294" class="Bound">oᵢ</a><a id="2388" class="Symbol">}</a> <a id="2390" class="Symbol">{</a><a id="2391" class="Argument">n</a> <a id="2393" class="Symbol">=</a> <a id="2395" href="Bitcoin.Consistency.html#2323" class="Bound">o</a><a id="2396" class="Symbol">}</a> <a id="2398" class="Symbol">(</a><a id="2399" href="Bitcoin.Consistency.html#1928" class="Field">noOutOfBounds</a> <a id="2413" href="Bitcoin.Consistency.html#2257" class="Bound">i</a><a id="2414" class="Symbol">)</a>
        <a id="2424" href="Bitcoin.Consistency.html#2424" class="Bound">vᵢ</a> <a id="2427" class="Symbol">=</a> <a id="2429" href="Bitcoin.Tx.Base.html#658" class="Field">value</a> <a id="2435" class="Symbol">(</a><a id="2436" href="Agda.Builtin.Sigma.html#264" class="Field">proj₂</a> <a id="2442" class="Symbol">(</a><a id="2443" href="Bitcoin.Consistency.html#2327" class="Bound">Tᵢ</a> <a id="2446" href="Bitcoin.Tx.Base.html#2139" class="Function Operator">‼ᵒ</a> <a id="2449" href="Bitcoin.Consistency.html#2367" class="Bound">oᵢ</a><a id="2451" class="Symbol">))</a>
      <a id="2460" class="Keyword">in</a>
        <a id="2471" href="Bitcoin.Consistency.html#2327" class="Bound">Tᵢ</a> <a id="2474" href="Bitcoin.Tx.Semantics.html#600" class="Record Operator">,</a> <a id="2476" href="Bitcoin.Consistency.html#2367" class="Bound">oᵢ</a> <a id="2479" href="Bitcoin.Tx.Semantics.html#600" class="Record Operator">,</a> <a id="2481" href="Bitcoin.Consistency.html#2334" class="Bound">tᵢ</a> <a id="2484" href="Bitcoin.Tx.Semantics.html#600" class="Record Operator">↝[</a> <a id="2487" href="Bitcoin.Consistency.html#2424" class="Bound">vᵢ</a> <a id="2490" href="Bitcoin.Tx.Semantics.html#600" class="Record Operator">]</a> <a id="2492" href="Bitcoin.Consistency.html#1659" class="Bound">tx</a> <a id="2495" href="Bitcoin.Tx.Semantics.html#600" class="Record Operator">,</a> <a id="2497" href="Bitcoin.Consistency.html#2257" class="Bound">i</a> <a id="2499" href="Bitcoin.Tx.Semantics.html#600" class="Record Operator">,</a> <a id="2501" href="Bitcoin.Consistency.html#1673" class="Bound">t</a>

    <a id="2508" class="Comment">-- (3)</a>
    <a id="_▷_,_.valuesPreserved"></a><a id="2519" href="Bitcoin.Consistency.html#2519" class="Field">valuesPreserved</a> <a id="2535" class="Symbol">:</a>
      <a id="2543" class="Keyword">let</a>
        <a id="2555" href="Bitcoin.Consistency.html#2555" class="Bound">ins</a>  <a id="2560" class="Symbol">=</a> <a id="2562" href="Data.Vec.Base.html#5888" class="Function">V.tabulate</a> <a id="2573" class="Symbol">λ</a> <a id="2575" href="Bitcoin.Consistency.html#2575" class="Bound">i</a> <a id="2577" class="Symbol">→</a> <a id="2579" class="Keyword">let</a> <a id="2583" class="Symbol">(_</a> <a id="2586" href="Bitcoin.Tx.Base.html#377" class="InductiveConstructor Operator">at</a> <a id="2589" href="Bitcoin.Consistency.html#2589" class="Bound">oᵢ</a><a id="2591" class="Symbol">)</a> <a id="2593" class="Symbol">=</a> <a id="2595" href="Bitcoin.Consistency.html#1659" class="Bound">tx</a> <a id="2598" href="Bitcoin.Tx.Base.html#1945" class="Function Operator">‼ⁱ</a> <a id="2601" href="Bitcoin.Consistency.html#2575" class="Bound">i</a>
                                    <a id="2639" class="Symbol">(((_</a> <a id="2644" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2646" href="Bitcoin.Consistency.html#2646" class="Bound">o</a> <a id="2648" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2650" href="Bitcoin.Consistency.html#2650" class="Bound">Tᵢ</a><a id="2652" class="Symbol">)</a> <a id="2654" href="Bitcoin.Tx.Base.html#2376" class="InductiveConstructor Operator">at</a> <a id="2657" href="Bitcoin.Consistency.html#2657" class="Bound">tᵢ</a><a id="2659" class="Symbol">)</a> <a id="2661" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2663" class="Symbol">_)</a> <a id="2666" class="Symbol">=</a> <a id="2668" href="Bitcoin.Consistency.html#1798" class="Field">singleMatch</a> <a id="2680" href="Bitcoin.Consistency.html#2575" class="Bound">i</a>
                                    <a id="2718" href="Bitcoin.Consistency.html#2718" class="Bound">oᵢ</a> <a id="2721" class="Symbol">=</a> <a id="2723" href="Data.Fin.Base.html#1973" class="Function">F.fromℕ&lt;</a> <a id="2732" class="Symbol">{</a><a id="2733" class="Argument">m</a> <a id="2735" class="Symbol">=</a> <a id="2737" href="Bitcoin.Consistency.html#2589" class="Bound">oᵢ</a><a id="2739" class="Symbol">}</a> <a id="2741" class="Symbol">{</a><a id="2742" class="Argument">n</a> <a id="2744" class="Symbol">=</a> <a id="2746" href="Bitcoin.Consistency.html#2646" class="Bound">o</a><a id="2747" class="Symbol">}</a> <a id="2749" class="Symbol">(</a><a id="2750" href="Bitcoin.Consistency.html#1928" class="Field">noOutOfBounds</a> <a id="2764" href="Bitcoin.Consistency.html#2575" class="Bound">i</a><a id="2765" class="Symbol">)</a>
                                <a id="2799" class="Keyword">in</a> <a id="2802" href="Bitcoin.Tx.Base.html#658" class="Field">value</a> <a id="2808" class="Symbol">(</a><a id="2809" href="Agda.Builtin.Sigma.html#264" class="Field">proj₂</a> <a id="2815" class="Symbol">(</a><a id="2816" href="Bitcoin.Consistency.html#2650" class="Bound">Tᵢ</a> <a id="2819" href="Bitcoin.Tx.Base.html#2139" class="Function Operator">‼ᵒ</a> <a id="2822" href="Bitcoin.Consistency.html#2718" class="Bound">oᵢ</a><a id="2824" class="Symbol">))</a>
        <a id="2835" href="Bitcoin.Consistency.html#2835" class="Bound">outs</a> <a id="2840" class="Symbol">=</a> <a id="2842" href="Data.Vec.Base.html#2580" class="Function">V.map</a> <a id="2848" class="Symbol">(</a><a id="2849" href="Bitcoin.Tx.Base.html#658" class="Field">value</a> <a id="2855" href="Function.Base.html#1031" class="Function Operator">∘</a> <a id="2857" href="Agda.Builtin.Sigma.html#264" class="Field">proj₂</a><a id="2862" class="Symbol">)</a> <a id="2864" class="Symbol">(</a><a id="2865" href="Bitcoin.Tx.Base.html#1090" class="Field">outputs</a> <a id="2873" href="Bitcoin.Consistency.html#1659" class="Bound">tx</a><a id="2875" class="Symbol">)</a>
      <a id="2883" class="Keyword">in</a>
        <a id="2894" href="Data.Vec.Base.html#5414" class="Function">V.sum</a> <a id="2900" href="Bitcoin.Consistency.html#2555" class="Bound">ins</a> <a id="2904" href="Prelude.Ord.html#269" class="Function Operator">≥</a> <a id="2906" href="Data.Vec.Base.html#5414" class="Function">V.sum</a> <a id="2912" href="Bitcoin.Consistency.html#2835" class="Bound">outs</a>

    <a id="2922" class="Comment">-- (4)</a>
    <a id="_▷_,_.laterTime"></a><a id="2933" href="Bitcoin.Consistency.html#2933" class="Field">laterTime</a> <a id="2943" class="Symbol">:</a>
      <a id="2951" href="Bitcoin.Consistency.html#1673" class="Bound">t</a> <a id="2953" href="Prelude.Ord.html#269" class="Function Operator">≥</a> <a id="2955" href="Bitcoin.Consistency.html#1534" class="Function">latestTime</a> <a id="2966" href="Bitcoin.Consistency.html#1640" class="Bound">txs</a>

<a id="2971" class="Comment">-- Consistency.</a>
<a id="2987" class="Keyword">data</a> <a id="ConsistentBlockchain"></a><a id="2992" href="Bitcoin.Consistency.html#2992" class="Datatype">ConsistentBlockchain</a> <a id="3013" class="Symbol">:</a> <a id="3015" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a> <a id="3026" class="Symbol">→</a> <a id="3028" href="Agda.Primitive.html#326" class="Primitive">Set</a> <a id="3032" class="Keyword">where</a>
  <a id="3040" class="Comment">-- ∎_∶-_  : (tx : Tx 0 o)</a>
  <a id="3068" class="Comment">--        → Coinbase tx</a>
  <a id="3094" class="Comment">--        → ConsistentBlockchain [ (_ , _ , tx) at 0 ]</a>
  <a id="ConsistentBlockchain.∎"></a><a id="3151" href="Bitcoin.Consistency.html#3151" class="InductiveConstructor">∎</a>  <a id="3154" class="Symbol">:</a> <a id="3156" href="Bitcoin.Consistency.html#2992" class="Datatype">ConsistentBlockchain</a> <a id="3177" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>

  <a id="ConsistentBlockchain._⊕_∶-_"></a><a id="3183" href="Bitcoin.Consistency.html#3183" class="InductiveConstructor Operator">_⊕_∶-_</a> <a id="3190" class="Symbol">:</a> <a id="3192" href="Bitcoin.Consistency.html#2992" class="Datatype">ConsistentBlockchain</a> <a id="3213" href="Bitcoin.Consistency.html#763" class="Generalizable">txs</a>
         <a id="3226" class="Symbol">→</a> <a id="3228" class="Symbol">(</a><a id="3229" href="Bitcoin.Consistency.html#3229" class="Bound">tx</a> <a id="3232" class="Symbol">:</a> <a id="3234" href="Bitcoin.Tx.Base.html#903" class="Record">Tx</a> <a id="3237" href="Bitcoin.Tx.Base.html#1914" class="Generalizable">i</a> <a id="3239" href="Bitcoin.Tx.Base.html#1919" class="Generalizable">o</a><a id="3240" class="Symbol">)</a>
         <a id="3251" class="Symbol">→</a> <a id="3253" href="Bitcoin.Consistency.html#763" class="Generalizable">txs</a> <a id="3257" href="Bitcoin.Consistency.html#1633" class="Record Operator">▷</a> <a id="3259" href="Bitcoin.Consistency.html#3229" class="Bound">tx</a> <a id="3262" href="Bitcoin.Consistency.html#1633" class="Record Operator">,</a> <a id="3264" href="Bitcoin.BasicTypes.html#313" class="Generalizable">t</a>
         <a id="3275" class="Symbol">→</a> <a id="3277" href="Bitcoin.Consistency.html#2992" class="Datatype">ConsistentBlockchain</a> <a id="3298" class="Symbol">(((_</a> <a id="3303" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3305" class="Symbol">_</a> <a id="3307" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3309" href="Bitcoin.Consistency.html#3229" class="Bound">tx</a><a id="3311" class="Symbol">)</a> <a id="3313" href="Bitcoin.Tx.Base.html#2376" class="InductiveConstructor Operator">at</a> <a id="3316" href="Bitcoin.BasicTypes.html#313" class="Generalizable">t</a><a id="3317" class="Symbol">)</a> <a id="3319" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3321" href="Bitcoin.Consistency.html#763" class="Generalizable">txs</a><a id="3324" class="Symbol">)</a>

<a id="3327" class="Comment">-- (1) Non-constructive/indirect formulation of the UTXO set, via describing when an output is unspent.</a>
<a id="Unspent"></a><a id="3431" href="Bitcoin.Consistency.html#3431" class="Function">Unspent</a> <a id="3439" class="Symbol">:</a> <a id="3441" class="Symbol">(</a><a id="3442" href="Bitcoin.Consistency.html#3442" class="Bound">b</a> <a id="3444" class="Symbol">:</a> <a id="3446" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a><a id="3456" class="Symbol">)</a> <a id="3458" class="Symbol">→</a> <a id="3460" class="Symbol">(</a><a id="3461" href="Bitcoin.Consistency.html#3461" class="Bound">i</a> <a id="3463" class="Symbol">:</a> <a id="3465" href="Prelude.Lists.html#1166" class="Function">Index</a> <a id="3471" href="Bitcoin.Consistency.html#3442" class="Bound">b</a><a id="3472" class="Symbol">)</a> <a id="3474" class="Symbol">→</a> <a id="3476" class="Keyword">let</a> <a id="3480" class="Symbol">(_</a> <a id="3483" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3485" href="Bitcoin.Consistency.html#3485" class="Bound">o</a> <a id="3487" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3489" href="Bitcoin.Consistency.html#3489" class="Bound">Tᵢ</a><a id="3491" class="Symbol">)</a> <a id="3493" class="InductiveConstructor Operator">at</a> <a id="3496" href="Bitcoin.Consistency.html#3496" class="Bound">tᵢ</a> <a id="3499" class="Symbol">=</a> <a id="3501" href="Bitcoin.Consistency.html#3442" class="Bound">b</a> <a id="3503" href="Prelude.Lists.html#1272" class="Function Operator">‼</a> <a id="3505" href="Bitcoin.Consistency.html#3461" class="Bound">i</a> <a id="3507" class="Keyword">in</a>
        <a id="3518" class="Symbol">∀</a> <a id="3520" class="Symbol">(</a><a id="3521" href="Bitcoin.Consistency.html#3521" class="Bound">j</a> <a id="3523" class="Symbol">:</a> <a id="3525" href="Data.Fin.Base.html#1126" class="Datatype">Fin</a> <a id="3529" href="Bitcoin.Consistency.html#3485" class="Bound">o</a><a id="3530" class="Symbol">)</a> <a id="3532" class="Symbol">→</a> <a id="3534" href="Agda.Primitive.html#326" class="Primitive">Set</a>
<a id="3538" href="Bitcoin.Consistency.html#3431" class="Function">Unspent</a> <a id="3546" href="Bitcoin.Consistency.html#3546" class="Bound">b</a> <a id="3548" href="Bitcoin.Consistency.html#3548" class="Bound">i</a> <a id="3550" href="Bitcoin.Consistency.html#3550" class="Bound">j</a> <a id="3552" class="Symbol">=</a>
  <a id="3556" class="Keyword">let</a> <a id="3560" class="Symbol">(_</a> <a id="3563" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3565" href="Bitcoin.Consistency.html#3565" class="Bound">o</a> <a id="3567" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3569" href="Bitcoin.Consistency.html#3569" class="Bound">Tᵢ</a><a id="3571" class="Symbol">)</a> <a id="3573" href="Bitcoin.Tx.Base.html#2376" class="InductiveConstructor Operator">at</a> <a id="3576" href="Bitcoin.Consistency.html#3576" class="Bound">tᵢ</a> <a id="3579" class="Symbol">=</a> <a id="3581" href="Bitcoin.Consistency.html#3546" class="Bound">b</a> <a id="3583" href="Prelude.Lists.html#1272" class="Function Operator">‼</a> <a id="3585" href="Bitcoin.Consistency.html#3548" class="Bound">i</a> <a id="3587" class="Keyword">in</a>
  <a id="3592" class="Symbol">∀</a> <a id="3594" class="Symbol">(</a><a id="3595" href="Bitcoin.Consistency.html#3595" class="Bound">i′</a> <a id="3598" class="Symbol">:</a> <a id="3600" href="Prelude.Lists.html#1166" class="Function">Index</a> <a id="3606" href="Bitcoin.Consistency.html#3546" class="Bound">b</a><a id="3607" class="Symbol">)</a> <a id="3609" class="Symbol">(</a><a id="3610" href="Bitcoin.Consistency.html#3610" class="Bound">leq</a> <a id="3614" class="Symbol">:</a> <a id="3616" href="Bitcoin.Consistency.html#3595" class="Bound">i′</a> <a id="3619" href="Data.Fin.Base.html#7184" class="Function Operator">F.≤</a> <a id="3623" href="Bitcoin.Consistency.html#3548" class="Bound">i</a><a id="3624" class="Symbol">)</a>  <a id="3627" class="Symbol">→</a> <a id="3629" class="Keyword">let</a> <a id="3633" class="Symbol">(</a><a id="3634" href="Bitcoin.Consistency.html#3634" class="Bound">i′</a> <a id="3637" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3639" class="Symbol">_</a> <a id="3641" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3643" href="Bitcoin.Consistency.html#3643" class="Bound">Tᵢ′</a><a id="3646" class="Symbol">)</a> <a id="3648" href="Bitcoin.Tx.Base.html#2376" class="InductiveConstructor Operator">at</a> <a id="3651" href="Bitcoin.Consistency.html#3651" class="Bound">tᵢ′</a> <a id="3655" class="Symbol">=</a> <a id="3657" href="Bitcoin.Consistency.html#3546" class="Bound">b</a> <a id="3659" href="Prelude.Lists.html#1272" class="Function Operator">‼</a> <a id="3661" href="Bitcoin.Consistency.html#3595" class="Bound">i′</a> <a id="3664" class="Keyword">in</a>
  <a id="3669" class="Symbol">∀</a> <a id="3671" class="Symbol">(</a><a id="3672" href="Bitcoin.Consistency.html#3672" class="Bound">j′</a> <a id="3675" class="Symbol">:</a> <a id="3677" href="Data.Fin.Base.html#1126" class="Datatype">Fin</a> <a id="3681" href="Bitcoin.Consistency.html#3634" class="Bound">i′</a><a id="3683" class="Symbol">)</a> <a id="3685" class="Symbol">→</a>
    <a id="3691" href="Bitcoin.Consistency.html#3569" class="Bound">Tᵢ</a> <a id="3694" href="Bitcoin.Tx.Semantics.html#1239" class="Function Operator">,</a> <a id="3696" href="Bitcoin.Consistency.html#3550" class="Bound">j</a> <a id="3698" href="Bitcoin.Tx.Semantics.html#1239" class="Function Operator">,</a> <a id="3700" href="Bitcoin.Consistency.html#3576" class="Bound">tᵢ</a> <a id="3703" href="Bitcoin.Tx.Semantics.html#1239" class="Function Operator">↛</a> <a id="3705" href="Bitcoin.Consistency.html#3643" class="Bound">Tᵢ′</a> <a id="3709" href="Bitcoin.Tx.Semantics.html#1239" class="Function Operator">,</a> <a id="3711" href="Bitcoin.Consistency.html#3672" class="Bound">j′</a> <a id="3714" href="Bitcoin.Tx.Semantics.html#1239" class="Function Operator">,</a> <a id="3716" href="Bitcoin.Consistency.html#3651" class="Bound">tᵢ′</a>

<a id="Unspent-∷"></a><a id="3721" href="Bitcoin.Consistency.html#3721" class="Function">Unspent-∷</a> <a id="3731" class="Symbol">:</a> <a id="3733" class="Symbol">∀</a> <a id="3735" class="Symbol">{</a><a id="3736" href="Bitcoin.Consistency.html#3736" class="Bound">tx</a> <a id="3739" href="Bitcoin.Consistency.html#3739" class="Bound">t</a><a id="3740" class="Symbol">}</a> <a id="3742" class="Symbol">{</a><a id="3743" href="Bitcoin.Consistency.html#3743" class="Bound">b</a> <a id="3745" class="Symbol">:</a> <a id="3747" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a><a id="3757" class="Symbol">}</a> <a id="3759" class="Symbol">{</a><a id="3760" href="Bitcoin.Consistency.html#3760" class="Bound">i</a> <a id="3762" class="Symbol">:</a> <a id="3764" href="Prelude.Lists.html#1166" class="Function">Index</a> <a id="3770" href="Bitcoin.Consistency.html#3743" class="Bound">b</a><a id="3771" class="Symbol">}</a> <a id="3773" class="Symbol">→</a> <a id="3775" class="Keyword">let</a> <a id="3779" class="Symbol">(_</a> <a id="3782" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3784" href="Bitcoin.Consistency.html#3784" class="Bound">o</a> <a id="3786" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3788" href="Bitcoin.Consistency.html#3788" class="Bound">Tᵢ</a><a id="3790" class="Symbol">)</a> <a id="3792" class="InductiveConstructor Operator">at</a> <a id="3795" href="Bitcoin.Consistency.html#3795" class="Bound">tᵢ</a> <a id="3798" class="Symbol">=</a> <a id="3800" href="Bitcoin.Consistency.html#3743" class="Bound">b</a> <a id="3802" href="Prelude.Lists.html#1272" class="Function Operator">‼</a> <a id="3804" href="Bitcoin.Consistency.html#3760" class="Bound">i</a> <a id="3806" class="Keyword">in</a> <a id="3809" class="Symbol">∀</a> <a id="3811" class="Symbol">{</a><a id="3812" href="Bitcoin.Consistency.html#3812" class="Bound">j</a> <a id="3814" class="Symbol">:</a> <a id="3816" href="Data.Fin.Base.html#1126" class="Datatype">Fin</a> <a id="3820" href="Bitcoin.Consistency.html#3784" class="Bound">o</a><a id="3821" class="Symbol">}</a> <a id="3823" class="Symbol">→</a>
  <a id="3827" href="Prelude.InferenceRules.html#56066" class="Function Operator">∙</a> <a id="3829" href="Bitcoin.Consistency.html#3431" class="Function">Unspent</a> <a id="3837" href="Bitcoin.Consistency.html#3743" class="Bound">b</a> <a id="3839" href="Bitcoin.Consistency.html#3760" class="Bound">i</a> <a id="3841" href="Bitcoin.Consistency.html#3812" class="Bound">j</a>
  <a id="3845" href="Prelude.InferenceRules.html#56000" class="Function Operator">∙</a> <a id="3847" class="Symbol">(((</a><a id="3850" href="Bitcoin.Consistency.html#3788" class="Bound">Tᵢ</a> <a id="3853" href="Bitcoin.Tx.Semantics.html#511" class="Function Operator">atᵒ</a> <a id="3857" href="Bitcoin.Consistency.html#3812" class="Bound">j</a><a id="3858" class="Symbol">)</a> <a id="3860" href="Data.Vec.Membership.Setoid.html#887" class="Function Operator">V.Mem.∉</a> <a id="3868" href="Bitcoin.Tx.Base.html#1330" class="Function">∃inputs</a> <a id="3876" href="Bitcoin.Consistency.html#3736" class="Bound">tx</a><a id="3878" class="Symbol">)</a>
    <a id="3884" href="Prelude.InferenceRules.html#12443" class="Function Operator">─────────────────────────────────────────────────────────</a>
    <a id="3946" href="Bitcoin.Consistency.html#3431" class="Function">Unspent</a> <a id="3954" class="Symbol">((</a><a id="3956" href="Bitcoin.Consistency.html#3736" class="Bound">tx</a> <a id="3959" class="InductiveConstructor Operator">at</a> <a id="3962" href="Bitcoin.Consistency.html#3739" class="Bound">t</a><a id="3963" class="Symbol">)</a> <a id="3965" class="InductiveConstructor Operator">∷</a> <a id="3967" href="Bitcoin.Consistency.html#3743" class="Bound">b</a><a id="3968" class="Symbol">)</a> <a id="3970" class="Symbol">(</a><a id="3971" href="Data.Fin.Base.html#1179" class="InductiveConstructor">fsuc</a> <a id="3976" href="Bitcoin.Consistency.html#3760" class="Bound">i</a><a id="3977" class="Symbol">)</a> <a id="3979" href="Bitcoin.Consistency.html#3812" class="Bound">j</a><a id="3980" class="Symbol">)</a>
<a id="3982" href="Bitcoin.Consistency.html#3721" class="Function">Unspent-∷</a> <a id="3992" class="Symbol">{</a><a id="3993" class="Argument">tx</a> <a id="3996" class="Symbol">=</a> <a id="3998" href="Bitcoin.Consistency.html#3998" class="Bound">tx</a><a id="4000" class="Symbol">}</a> <a id="4002" href="Bitcoin.Consistency.html#4002" class="Bound">unsp</a> <a id="4007" href="Bitcoin.Consistency.html#4007" class="Bound">in∉</a> <a id="4011" href="Data.Fin.Patterns.html#390" class="InductiveConstructor">0F</a> <a id="4014" href="Bitcoin.Consistency.html#4014" class="Bound">0≤</a> <a id="4017" href="Bitcoin.Consistency.html#4017" class="Bound">j′</a> <a id="4020" class="Symbol">(</a><a id="4021" href="Bitcoin.Consistency.html#4021" class="Bound">v</a> <a id="4023" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4025" class="Keyword">record</a> <a id="4032" class="Symbol">{</a><a id="4033" href="Bitcoin.Tx.Semantics.html#938" class="Field">input~output</a> <a id="4046" class="Symbol">=</a> <a id="4048" href="Bitcoin.Consistency.html#4048" class="Bound">io</a><a id="4050" class="Symbol">})</a>
  <a id="4055" class="Symbol">=</a> <a id="4057" href="Bitcoin.Consistency.html#4007" class="Bound">in∉</a> <a id="4061" class="Symbol">(</a><a id="4062" href="Relation.Binary.PropositionalEquality.Core.html#1780" class="Function">subst</a> <a id="4068" class="Symbol">(</a><a id="4069" href="Data.Vec.Membership.Setoid.html#829" class="Function Operator">V.Mem._∈</a> <a id="4078" href="Bitcoin.Tx.Base.html#1330" class="Function">∃inputs</a> <a id="4086" href="Bitcoin.Consistency.html#3998" class="Bound">tx</a><a id="4088" class="Symbol">)</a> <a id="4090" href="Bitcoin.Consistency.html#4048" class="Bound">io</a> <a id="4093" class="Symbol">(</a><a id="4094" href="Data.Vec.Membership.Propositional.Properties.html#1198" class="Function">V.Mem.∈-lookup</a> <a id="4109" href="Bitcoin.Consistency.html#4017" class="Bound">j′</a> <a id="4112" class="Symbol">_))</a>
<a id="4116" href="Bitcoin.Consistency.html#3721" class="Function">Unspent-∷</a> <a id="4126" href="Bitcoin.Consistency.html#4126" class="Bound">unsp</a> <a id="4131" class="Symbol">_</a> <a id="4133" class="Symbol">(</a><a id="4134" href="Data.Fin.Base.html#1179" class="InductiveConstructor">fsuc</a> <a id="4139" href="Bitcoin.Consistency.html#4139" class="Bound">i′</a><a id="4141" class="Symbol">)</a> <a id="4143" class="Symbol">(</a><a id="4144" href="Data.Nat.Base.html#1600" class="InductiveConstructor">s≤s</a> <a id="4148" href="Bitcoin.Consistency.html#4148" class="Bound">leq</a><a id="4151" class="Symbol">)</a> <a id="4153" href="Bitcoin.Consistency.html#4153" class="Bound">j′</a> <a id="4156" href="Bitcoin.Consistency.html#4156" class="Bound">p</a>
  <a id="4160" class="Symbol">=</a> <a id="4162" href="Bitcoin.Consistency.html#4126" class="Bound">unsp</a> <a id="4167" href="Bitcoin.Consistency.html#4139" class="Bound">i′</a> <a id="4170" href="Bitcoin.Consistency.html#4148" class="Bound">leq</a> <a id="4174" href="Bitcoin.Consistency.html#4153" class="Bound">j′</a> <a id="4177" href="Bitcoin.Consistency.html#4156" class="Bound">p</a>

<a id="4180" class="Comment">--</a>

<a id="∃Unspent"></a><a id="4184" href="Bitcoin.Consistency.html#4184" class="Function">∃Unspent</a> <a id="4193" class="Symbol">:</a> <a id="4195" class="Symbol">(</a><a id="4196" href="Bitcoin.Consistency.html#4196" class="Bound">b</a> <a id="4198" class="Symbol">:</a> <a id="4200" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a><a id="4210" class="Symbol">)</a> <a id="4212" class="Symbol">→</a> <a id="4214" href="Bitcoin.Tx.Base.html#793" class="Function">∃TxOutput</a> <a id="4224" class="Symbol">→</a> <a id="4226" href="Agda.Primitive.html#326" class="Primitive">Set</a>
<a id="4230" href="Bitcoin.Consistency.html#4184" class="Function">∃Unspent</a> <a id="4239" href="Bitcoin.Consistency.html#4239" class="Bound">b</a> <a id="4241" href="Bitcoin.Consistency.html#4241" class="Bound">txo</a> <a id="4245" class="Symbol">=</a>
  <a id="4249" href="Agda.Builtin.Sigma.html#166" class="Record">Σ</a> <a id="4251" class="Symbol">(</a><a id="4252" href="Prelude.Lists.html#1166" class="Function">Index</a> <a id="4258" href="Bitcoin.Consistency.html#4239" class="Bound">b</a><a id="4259" class="Symbol">)</a> <a id="4261" class="Symbol">λ</a> <a id="4263" href="Bitcoin.Consistency.html#4263" class="Bound">i</a> <a id="4265" class="Symbol">→</a>
    <a id="4271" class="Keyword">let</a> <a id="4275" class="Symbol">(_</a> <a id="4278" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4280" href="Bitcoin.Consistency.html#4280" class="Bound">o</a> <a id="4282" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4284" href="Bitcoin.Consistency.html#4284" class="Bound">Tᵢ</a><a id="4286" class="Symbol">)</a> <a id="4288" href="Bitcoin.Tx.Base.html#2376" class="InductiveConstructor Operator">at</a> <a id="4291" class="Symbol">_</a> <a id="4293" class="Symbol">=</a> <a id="4295" href="Bitcoin.Consistency.html#4239" class="Bound">b</a> <a id="4297" href="Prelude.Lists.html#1272" class="Function Operator">‼</a> <a id="4299" href="Bitcoin.Consistency.html#4263" class="Bound">i</a> <a id="4301" class="Keyword">in</a>
    <a id="4308" href="Agda.Builtin.Sigma.html#166" class="Record">Σ</a> <a id="4310" class="Symbol">(</a><a id="4311" href="Data.Fin.Base.html#1126" class="Datatype">Fin</a> <a id="4315" href="Bitcoin.Consistency.html#4280" class="Bound">o</a><a id="4316" class="Symbol">)</a> <a id="4318" class="Symbol">λ</a> <a id="4320" href="Bitcoin.Consistency.html#4320" class="Bound">j</a> <a id="4322" class="Symbol">→</a>
      <a id="4330" href="Bitcoin.Consistency.html#3431" class="Function">Unspent</a> <a id="4338" href="Bitcoin.Consistency.html#4239" class="Bound">b</a> <a id="4340" href="Bitcoin.Consistency.html#4263" class="Bound">i</a> <a id="4342" href="Bitcoin.Consistency.html#4320" class="Bound">j</a> <a id="4344" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="4346" class="Symbol">(</a><a id="4347" href="Bitcoin.Consistency.html#4284" class="Bound">Tᵢ</a> <a id="4350" href="Bitcoin.Tx.Base.html#2139" class="Function Operator">‼ᵒ</a> <a id="4353" href="Bitcoin.Consistency.html#4320" class="Bound">j</a> <a id="4355" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="4357" href="Bitcoin.Consistency.html#4241" class="Bound">txo</a><a id="4360" class="Symbol">)</a>

<a id="↝-irreflexive"></a><a id="4363" href="Bitcoin.Consistency.html#4363" class="Function">↝-irreflexive</a> <a id="4377" class="Symbol">:</a> <a id="4379" class="Symbol">∀</a> <a id="4381" class="Symbol">{</a><a id="4382" href="Bitcoin.Consistency.html#4382" class="Bound">T</a> <a id="4384" class="Symbol">:</a> <a id="4386" href="Bitcoin.Tx.Base.html#903" class="Record">Tx</a> <a id="4389" href="Bitcoin.Tx.Base.html#1914" class="Generalizable">i</a> <a id="4391" href="Bitcoin.Tx.Base.html#1919" class="Generalizable">o</a><a id="4392" class="Symbol">}</a> <a id="4394" class="Symbol">{</a><a id="4395" href="Bitcoin.Consistency.html#4395" class="Bound">oᵢ</a> <a id="4398" class="Symbol">:</a> <a id="4400" href="Data.Fin.Base.html#1126" class="Datatype">Fin</a> <a id="4404" href="Bitcoin.Tx.Base.html#1919" class="Generalizable">o</a><a id="4405" class="Symbol">}</a> <a id="4407" class="Symbol">{</a><a id="4408" href="Bitcoin.Consistency.html#4408" class="Bound">iᵢ</a> <a id="4411" class="Symbol">:</a> <a id="4413" href="Data.Fin.Base.html#1126" class="Datatype">Fin</a> <a id="4417" href="Bitcoin.Tx.Base.html#1914" class="Generalizable">i</a><a id="4418" class="Symbol">}</a> <a id="4420" class="Symbol">{</a><a id="4421" href="Bitcoin.Consistency.html#4421" class="Bound">t₀</a> <a id="4424" href="Bitcoin.Consistency.html#4424" class="Bound">t</a> <a id="4426" href="Bitcoin.Consistency.html#4426" class="Bound">v</a> <a id="4428" href="Bitcoin.Consistency.html#4428" class="Bound">t′</a><a id="4430" class="Symbol">}</a>
  <a id="4434" class="Symbol">→</a> <a id="4436" href="Bitcoin.Consistency.html#2992" class="Datatype">ConsistentBlockchain</a> <a id="4457" href="Data.List.Base.html#5025" class="Function Operator">[</a> <a id="4459" class="Symbol">(</a><a id="4460" href="Data.Product.html#2247" class="Function Operator">-,</a> <a id="4463" href="Data.Product.html#2247" class="Function Operator">-,</a> <a id="4466" href="Bitcoin.Consistency.html#4382" class="Bound">T</a><a id="4467" class="Symbol">)</a> <a id="4469" class="InductiveConstructor Operator">at</a> <a id="4472" href="Bitcoin.Consistency.html#4421" class="Bound">t₀</a> <a id="4475" href="Data.List.Base.html#5025" class="Function Operator">]</a>
  <a id="4479" class="Symbol">→</a> <a id="4481" href="Relation.Nullary.html#656" class="Function Operator">¬</a> <a id="4483" class="Symbol">(</a><a id="4484" href="Bitcoin.Consistency.html#4382" class="Bound">T</a> <a id="4486" href="Bitcoin.Tx.Semantics.html#600" class="Record Operator">,</a> <a id="4488" href="Bitcoin.Consistency.html#4395" class="Bound">oᵢ</a> <a id="4491" href="Bitcoin.Tx.Semantics.html#600" class="Record Operator">,</a> <a id="4493" href="Bitcoin.Consistency.html#4424" class="Bound">t</a> <a id="4495" href="Bitcoin.Tx.Semantics.html#600" class="Record Operator">↝[</a> <a id="4498" href="Bitcoin.Consistency.html#4426" class="Bound">v</a> <a id="4500" href="Bitcoin.Tx.Semantics.html#600" class="Record Operator">]</a> <a id="4502" href="Bitcoin.Consistency.html#4382" class="Bound">T</a> <a id="4504" href="Bitcoin.Tx.Semantics.html#600" class="Record Operator">,</a> <a id="4506" href="Bitcoin.Consistency.html#4408" class="Bound">iᵢ</a> <a id="4509" href="Bitcoin.Tx.Semantics.html#600" class="Record Operator">,</a> <a id="4511" href="Bitcoin.Consistency.html#4428" class="Bound">t′</a><a id="4513" class="Symbol">)</a>
<a id="4515" href="Bitcoin.Consistency.html#4363" class="Function">↝-irreflexive</a> <a id="4529" class="Symbol">{</a><a id="4530" class="Argument">T</a> <a id="4532" class="Symbol">=</a> <a id="4534" href="Bitcoin.Consistency.html#4534" class="Bound">T</a><a id="4535" class="Symbol">}</a> <a id="4537" class="Symbol">{</a><a id="4538" class="Argument">iᵢ</a> <a id="4541" class="Symbol">=</a> <a id="4543" href="Bitcoin.Consistency.html#4543" class="Bound">iᵢ</a><a id="4545" class="Symbol">}</a> <a id="4547" class="Symbol">(</a><a id="4548" href="Bitcoin.Consistency.html#4548" class="Bound">∙</a> <a id="4550" href="Bitcoin.Consistency.html#3183" class="InductiveConstructor Operator">⊕</a> <a id="4552" class="DottedPattern Symbol">.</a><a id="4553" href="Bitcoin.Consistency.html#4534" class="DottedPattern Bound">T</a> <a id="4555" href="Bitcoin.Consistency.html#3183" class="InductiveConstructor Operator">∶-</a> <a id="4558" class="Keyword">record</a> <a id="4565" class="Symbol">{</a><a id="4566" href="Bitcoin.Consistency.html#2163" class="Field">inputs∈UTXO</a> <a id="4578" class="Symbol">=</a> <a id="4580" href="Bitcoin.Consistency.html#4580" class="Bound">i∈</a><a id="4582" class="Symbol">})</a> <a id="4585" class="Symbol">_</a> <a id="4587" class="Symbol">=</a> <a id="4589" href="Data.Empty.html#628" class="Function">⊥-elim</a> <a id="4596" href="Function.Base.html#1919" class="Function Operator">$</a> <a id="4598" href="Prelude.Sets.Interface.html#1499" class="Function">∉∅</a> <a id="4601" class="Symbol">_</a> <a id="4603" class="Symbol">(</a><a id="4604" href="Bitcoin.Consistency.html#4580" class="Bound">i∈</a> <a id="4607" href="Bitcoin.Consistency.html#4543" class="Bound">iᵢ</a><a id="4609" class="Symbol">)</a>

<a id="4612" class="Comment">--</a>

<a id="∃Unspent-∷"></a><a id="4616" href="Bitcoin.Consistency.html#4616" class="Function">∃Unspent-∷</a> <a id="4627" class="Symbol">:</a> <a id="4629" class="Symbol">∀</a> <a id="4631" class="Symbol">{</a><a id="4632" href="Bitcoin.Consistency.html#4632" class="Bound">t</a> <a id="4634" href="Bitcoin.Consistency.html#4634" class="Bound">tx</a> <a id="4637" href="Bitcoin.Consistency.html#4637" class="Bound">b</a> <a id="4639" href="Bitcoin.Consistency.html#4639" class="Bound">o</a><a id="4640" class="Symbol">}</a> <a id="4642" class="Symbol">→</a>
  <a id="4646" href="Prelude.InferenceRules.html#56066" class="Function Operator">∙</a> <a id="4648" href="Bitcoin.Consistency.html#2992" class="Datatype">ConsistentBlockchain</a> <a id="4669" class="Symbol">((</a><a id="4671" href="Bitcoin.Consistency.html#4634" class="Bound">tx</a> <a id="4674" class="InductiveConstructor Operator">at</a> <a id="4677" href="Bitcoin.Consistency.html#4632" class="Bound">t</a><a id="4678" class="Symbol">)</a> <a id="4680" class="InductiveConstructor Operator">∷</a> <a id="4682" href="Bitcoin.Consistency.html#4637" class="Bound">b</a><a id="4683" class="Symbol">)</a>
  <a id="4687" class="Symbol">→</a> <a id="4689" class="Symbol">(</a><a id="4690" href="Bitcoin.Consistency.html#4690" class="Bound">wit</a> <a id="4694" class="Symbol">:</a> <a id="4696" href="Bitcoin.Consistency.html#4184" class="Function">∃Unspent</a> <a id="4705" href="Bitcoin.Consistency.html#4637" class="Bound">b</a> <a id="4707" href="Bitcoin.Consistency.html#4639" class="Bound">o</a><a id="4708" class="Symbol">)</a>
  <a id="4712" class="Symbol">→</a> <a id="4714" class="Keyword">let</a> <a id="4718" href="Bitcoin.Consistency.html#4718" class="Bound">i</a> <a id="4720" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4722" href="Bitcoin.Consistency.html#4722" class="Bound">j</a> <a id="4724" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4726" class="Symbol">_</a> <a id="4728" class="Symbol">=</a> <a id="4730" href="Bitcoin.Consistency.html#4690" class="Bound">wit</a><a id="4733" class="Symbol">;</a> <a id="4735" class="Symbol">(_</a> <a id="4738" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4740" class="Symbol">_</a> <a id="4742" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4744" href="Bitcoin.Consistency.html#4744" class="Bound">Tᵢ</a><a id="4746" class="Symbol">)</a> <a id="4748" class="InductiveConstructor Operator">at</a> <a id="4751" class="Symbol">_</a> <a id="4753" class="Symbol">=</a> <a id="4755" href="Bitcoin.Consistency.html#4637" class="Bound">b</a> <a id="4757" href="Prelude.Lists.html#1272" class="Function Operator">‼</a> <a id="4759" href="Bitcoin.Consistency.html#4718" class="Bound">i</a> <a id="4761" class="Keyword">in</a>
  <a id="4766" href="Prelude.InferenceRules.html#56066" class="Function Operator">∙</a> <a id="4768" class="Symbol">(</a><a id="4769" href="Bitcoin.Consistency.html#4744" class="Bound">Tᵢ</a> <a id="4772" href="Bitcoin.Tx.Semantics.html#511" class="Function Operator">atᵒ</a> <a id="4776" href="Bitcoin.Consistency.html#4722" class="Bound">j</a> <a id="4778" href="Data.Vec.Membership.Setoid.html#887" class="Function Operator">V.Mem.∉</a> <a id="4786" href="Bitcoin.Tx.Base.html#1330" class="Function">∃inputs</a> <a id="4794" href="Bitcoin.Consistency.html#4634" class="Bound">tx</a><a id="4796" class="Symbol">)</a>
    <a id="4802" href="Prelude.InferenceRules.html#12443" class="Function Operator">─────────────────────────────────────────────────────────</a>
    <a id="4864" href="Bitcoin.Consistency.html#4184" class="Function">∃Unspent</a> <a id="4873" class="Symbol">((</a><a id="4875" href="Bitcoin.Consistency.html#4634" class="Bound">tx</a> <a id="4878" class="InductiveConstructor Operator">at</a> <a id="4881" href="Bitcoin.Consistency.html#4632" class="Bound">t</a><a id="4882" class="Symbol">)</a> <a id="4884" class="InductiveConstructor Operator">∷</a> <a id="4886" href="Bitcoin.Consistency.html#4637" class="Bound">b</a><a id="4887" class="Symbol">)</a> <a id="4889" href="Bitcoin.Consistency.html#4639" class="Bound">o</a>
<a id="4891" href="Bitcoin.Consistency.html#4616" class="Function">∃Unspent-∷</a> <a id="4902" href="Bitcoin.Consistency.html#4902" class="Bound">vb</a> <a id="4905" class="Symbol">(</a><a id="4906" href="Bitcoin.Consistency.html#4906" class="Bound">i</a> <a id="4908" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4910" href="Bitcoin.Consistency.html#4910" class="Bound">j</a> <a id="4912" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4914" href="Bitcoin.Consistency.html#4914" class="Bound">p</a> <a id="4916" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4918" href="Bitcoin.Consistency.html#4918" class="Bound">o≡</a><a id="4920" class="Symbol">)</a> <a id="4922" href="Bitcoin.Consistency.html#4922" class="Bound">in∉</a> <a id="4926" class="Symbol">=</a> <a id="4928" href="Data.Fin.Base.html#1179" class="InductiveConstructor">fsuc</a> <a id="4933" href="Bitcoin.Consistency.html#4906" class="Bound">i</a> <a id="4935" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4937" href="Bitcoin.Consistency.html#4910" class="Bound">j</a> <a id="4939" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4941" href="Bitcoin.Consistency.html#3721" class="Function">Unspent-∷</a> <a id="4951" href="Bitcoin.Consistency.html#4914" class="Bound">p</a> <a id="4953" href="Bitcoin.Consistency.html#4922" class="Bound">in∉</a> <a id="4957" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4959" href="Bitcoin.Consistency.html#4918" class="Bound">o≡</a>

<a id="4963" class="Comment">-- (2) Alternative set-theoretic/constructive formulation of the UTXO set, similar to the one in EUTXO.</a>
<a id="stxo"></a><a id="5067" href="Bitcoin.Consistency.html#5067" class="Function">stxo</a> <a id="5072" class="Symbol">:</a> <a id="5074" class="Symbol">∀</a> <a id="5076" class="Symbol">{</a><a id="5077" href="Bitcoin.Consistency.html#5077" class="Bound">tx</a> <a id="5080" href="Bitcoin.Consistency.html#5080" class="Bound">b</a> <a id="5082" href="Bitcoin.Consistency.html#5082" class="Bound">t</a><a id="5083" class="Symbol">}</a> <a id="5085" class="Symbol">→</a> <a id="5087" href="Bitcoin.Consistency.html#2992" class="Datatype">ConsistentBlockchain</a> <a id="5108" class="Symbol">((</a><a id="5110" href="Bitcoin.Consistency.html#5077" class="Bound">tx</a> <a id="5113" class="InductiveConstructor Operator">at</a> <a id="5116" href="Bitcoin.Consistency.html#5082" class="Bound">t</a><a id="5117" class="Symbol">)</a> <a id="5119" class="InductiveConstructor Operator">∷</a> <a id="5121" href="Bitcoin.Consistency.html#5080" class="Bound">b</a><a id="5122" class="Symbol">)</a> <a id="5124" class="Symbol">→</a> <a id="5126" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="5131" href="Bitcoin.Tx.Base.html#793" class="Function">∃TxOutput</a>
<a id="5141" href="Bitcoin.Consistency.html#5067" class="Function">stxo</a> <a id="5146" class="Symbol">{</a><a id="5147" class="Argument">tx</a> <a id="5150" class="Symbol">=</a> <a id="5152" href="Bitcoin.Consistency.html#5152" class="Bound">i</a> <a id="5154" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="5156" class="Symbol">_</a> <a id="5158" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="5160" class="DottedPattern Symbol">.</a><a id="5161" href="Bitcoin.Consistency.html#5170" class="DottedPattern Bound">tx</a><a id="5163" class="Symbol">}</a> <a id="5165" class="Symbol">(_</a> <a id="5168" href="Bitcoin.Consistency.html#3183" class="InductiveConstructor Operator">⊕</a> <a id="5170" href="Bitcoin.Consistency.html#5170" class="Bound">tx</a> <a id="5173" href="Bitcoin.Consistency.html#3183" class="InductiveConstructor Operator">∶-</a> <a id="5176" href="Bitcoin.Consistency.html#5176" class="Bound">p</a><a id="5177" class="Symbol">)</a>
  <a id="5181" class="Symbol">=</a> <a id="5183" href="Data.List.Base.html#1544" class="Function">map</a> <a id="5187" href="Bitcoin.Consistency.html#5226" class="Function">f</a> <a id="5189" class="Symbol">(</a><a id="5190" href="Data.List.Base.html#6324" class="Function">allFin</a> <a id="5197" href="Bitcoin.Consistency.html#5152" class="Bound">i</a><a id="5198" class="Symbol">)</a>
  <a id="5202" class="Keyword">module</a> <a id="∣stxo∣"></a><a id="5209" href="Bitcoin.Consistency.html#5209" class="Module">∣stxo∣</a> <a id="5216" class="Keyword">where</a>
    <a id="∣stxo∣.f"></a><a id="5226" href="Bitcoin.Consistency.html#5226" class="Function">f</a> <a id="5228" class="Symbol">:</a> <a id="5230" href="Data.Fin.Base.html#1126" class="Datatype">Fin</a> <a id="5234" href="Bitcoin.Consistency.html#5152" class="Bound">i</a> <a id="5236" class="Symbol">→</a> <a id="5238" href="Bitcoin.Tx.Base.html#793" class="Function">∃TxOutput</a>
    <a id="5252" href="Bitcoin.Consistency.html#5226" class="Function">f</a> <a id="5254" href="Bitcoin.Consistency.html#5254" class="Bound">i</a> <a id="5256" class="Symbol">=</a>
      <a id="5264" class="Keyword">let</a>
        <a id="5276" class="Keyword">record</a> <a id="5283" class="Symbol">{</a><a id="5284" href="Bitcoin.Consistency.html#1798" class="Field">singleMatch</a> <a id="5296" class="Symbol">=</a> <a id="5298" href="Bitcoin.Consistency.html#5298" class="Bound">singleMatch</a><a id="5309" class="Symbol">;</a> <a id="5311" href="Bitcoin.Consistency.html#1928" class="Field">noOutOfBounds</a> <a id="5325" class="Symbol">=</a> <a id="5327" href="Bitcoin.Consistency.html#5327" class="Bound">noOutOfBounds</a><a id="5340" class="Symbol">}</a> <a id="5342" class="Symbol">=</a> <a id="5344" href="Bitcoin.Consistency.html#5176" class="Bound">p</a>
        <a id="5354" class="Symbol">(_</a> <a id="5357" href="Bitcoin.Tx.Base.html#377" class="InductiveConstructor Operator">at</a> <a id="5360" href="Bitcoin.Consistency.html#5360" class="Bound">oᵢ</a><a id="5362" class="Symbol">)</a> <a id="5364" class="Symbol">=</a> <a id="5366" href="Bitcoin.Consistency.html#5170" class="Bound">tx</a> <a id="5369" href="Bitcoin.Tx.Base.html#1945" class="Function Operator">‼ⁱ</a> <a id="5372" href="Bitcoin.Consistency.html#5254" class="Bound">i</a>
        <a id="5382" class="Symbol">(((_</a> <a id="5387" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="5389" href="Bitcoin.Consistency.html#5389" class="Bound">o</a> <a id="5391" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="5393" href="Bitcoin.Consistency.html#5393" class="Bound">Tᵢ</a><a id="5395" class="Symbol">)</a> <a id="5397" href="Bitcoin.Tx.Base.html#2376" class="InductiveConstructor Operator">at</a> <a id="5400" href="Bitcoin.Consistency.html#5400" class="Bound">tᵢ</a><a id="5402" class="Symbol">)</a> <a id="5404" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="5406" class="Symbol">_)</a> <a id="5409" class="Symbol">=</a> <a id="5411" href="Bitcoin.Consistency.html#5298" class="Bound">singleMatch</a> <a id="5423" href="Bitcoin.Consistency.html#5254" class="Bound">i</a>
        <a id="5433" href="Bitcoin.Consistency.html#5433" class="Bound">oᵢ</a> <a id="5436" class="Symbol">=</a> <a id="5438" href="Data.Fin.Base.html#1973" class="Function">F.fromℕ&lt;</a> <a id="5447" class="Symbol">{</a><a id="5448" class="Argument">m</a> <a id="5450" class="Symbol">=</a> <a id="5452" href="Bitcoin.Consistency.html#5360" class="Bound">oᵢ</a><a id="5454" class="Symbol">}</a> <a id="5456" class="Symbol">{</a><a id="5457" class="Argument">n</a> <a id="5459" class="Symbol">=</a> <a id="5461" href="Bitcoin.Consistency.html#5389" class="Bound">o</a><a id="5462" class="Symbol">}</a> <a id="5464" class="Symbol">(</a><a id="5465" href="Bitcoin.Consistency.html#5327" class="Bound">noOutOfBounds</a> <a id="5479" href="Bitcoin.Consistency.html#5254" class="Bound">i</a><a id="5480" class="Symbol">)</a>
      <a id="5488" class="Keyword">in</a>
        <a id="5499" href="Bitcoin.Consistency.html#5393" class="Bound">Tᵢ</a> <a id="5502" href="Bitcoin.Tx.Base.html#2139" class="Function Operator">‼ᵒ</a> <a id="5505" href="Bitcoin.Consistency.html#5433" class="Bound">oᵢ</a>

<a id="utxoₜₓ"></a><a id="5509" href="Bitcoin.Consistency.html#5509" class="Function">utxoₜₓ</a> <a id="5516" class="Symbol">:</a> <a id="5518" href="Bitcoin.Tx.Base.html#1255" class="Function">∃Tx</a> <a id="5522" class="Symbol">→</a> <a id="5524" href="Prelude.Sets.Interface.html#416" class="Function">Set⟨</a> <a id="5529" href="Bitcoin.Tx.Base.html#793" class="Function">∃TxOutput</a> <a id="5539" href="Prelude.Sets.Interface.html#416" class="Function">⟩</a>
<a id="5541" href="Bitcoin.Consistency.html#5509" class="Function">utxoₜₓ</a> <a id="5548" class="Symbol">(_</a> <a id="5551" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="5553" class="Symbol">_</a> <a id="5555" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="5557" href="Bitcoin.Consistency.html#5557" class="Bound">tx</a><a id="5559" class="Symbol">)</a> <a id="5561" class="Symbol">=</a> <a id="5563" href="Prelude.Sets.Interface.html#3982" class="Function">fromList</a> <a id="5572" class="Symbol">(</a><a id="5573" href="Data.Vec.Base.html#7438" class="Function">V.toList</a> <a id="5582" href="Function.Base.html#1919" class="Function Operator">$</a> <a id="5584" href="Bitcoin.Tx.Base.html#1090" class="Field">outputs</a> <a id="5592" href="Bitcoin.Consistency.html#5557" class="Bound">tx</a><a id="5594" class="Symbol">)</a>

<a id="utxo"></a><a id="5597" href="Bitcoin.Consistency.html#5597" class="Function">utxo</a> <a id="5602" class="Symbol">:</a> <a id="5604" class="Symbol">(</a><a id="5605" href="Bitcoin.Consistency.html#5605" class="Bound">b</a> <a id="5607" class="Symbol">:</a> <a id="5609" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a><a id="5619" class="Symbol">)</a> <a id="5621" class="Symbol">→</a> <a id="5623" href="Bitcoin.Consistency.html#2992" class="Datatype">ConsistentBlockchain</a> <a id="5644" href="Bitcoin.Consistency.html#5605" class="Bound">b</a> <a id="5646" class="Symbol">→</a> <a id="5648" href="Prelude.Sets.Interface.html#416" class="Function">Set⟨</a> <a id="5653" href="Bitcoin.Tx.Base.html#793" class="Function">∃TxOutput</a> <a id="5663" href="Prelude.Sets.Interface.html#416" class="Function">⟩</a>
<a id="5665" href="Bitcoin.Consistency.html#5597" class="Function">utxo</a> <a id="5670" class="DottedPattern Symbol">.</a><a id="5671" href="Agda.Builtin.List.html#185" class="DottedPattern InductiveConstructor">[]</a> <a id="5674" href="Bitcoin.Consistency.html#3151" class="InductiveConstructor">∎</a> <a id="5676" class="Symbol">=</a> <a id="5678" href="Prelude.Sets.Interface.html#434" class="Function">∅</a>
<a id="5680" href="Bitcoin.Consistency.html#5597" class="Function">utxo</a> <a id="5685" class="Symbol">(</a><a id="5686" class="DottedPattern Symbol">.((_</a> <a id="5691" href="Agda.Builtin.Sigma.html#236" class="DottedPattern InductiveConstructor Operator">,</a> <a id="5693" class="DottedPattern Symbol">_</a> <a id="5695" href="Agda.Builtin.Sigma.html#236" class="DottedPattern InductiveConstructor Operator">,</a> <a id="5697" href="Bitcoin.Consistency.html#5722" class="DottedPattern Bound">tx</a><a id="5699" class="DottedPattern Symbol">)</a> <a id="5701" href="Bitcoin.Tx.Base.html#2376" class="DottedPattern InductiveConstructor Operator">at</a> <a id="5704" class="DottedPattern Symbol">_)</a> <a id="5707" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="5709" href="Bitcoin.Consistency.html#5709" class="Bound">b</a><a id="5710" class="Symbol">)</a> <a id="5712" href="Bitcoin.Consistency.html#5712" class="Bound">vb₀</a><a id="5715" class="Symbol">@(</a><a id="5717" href="Bitcoin.Consistency.html#5717" class="Bound">vb</a> <a id="5720" href="Bitcoin.Consistency.html#3183" class="InductiveConstructor Operator">⊕</a> <a id="5722" href="Bitcoin.Consistency.html#5722" class="Bound">tx</a> <a id="5725" href="Bitcoin.Consistency.html#3183" class="InductiveConstructor Operator">∶-</a> <a id="5728" class="Symbol">_)</a>
  <a id="5733" class="Symbol">=</a> <a id="5735" href="Bitcoin.Consistency.html#5597" class="Function">utxo</a> <a id="5740" href="Bitcoin.Consistency.html#5709" class="Bound">b</a> <a id="5742" href="Bitcoin.Consistency.html#5717" class="Bound">vb</a> <a id="5745" href="Prelude.Sets.Interface.html#500" class="Function Operator">─</a> <a id="5747" href="Prelude.Sets.Interface.html#3982" class="Function">fromList</a> <a id="5756" class="Symbol">(</a><a id="5757" href="Bitcoin.Consistency.html#5067" class="Function">stxo</a> <a id="5762" href="Bitcoin.Consistency.html#5712" class="Bound">vb₀</a><a id="5765" class="Symbol">)</a>
  <a id="5769" href="Prelude.Sets.Interface.html#504" class="Function Operator">∪</a> <a id="5771" href="Bitcoin.Consistency.html#5509" class="Function">utxoₜₓ</a> <a id="5778" class="Symbol">(</a><a id="5779" href="Data.Product.html#2247" class="Function Operator">-,</a> <a id="5782" href="Data.Product.html#2247" class="Function Operator">-,</a> <a id="5785" href="Bitcoin.Consistency.html#5722" class="Bound">tx</a><a id="5787" class="Symbol">)</a>

<a id="5790" class="Comment">-- T0D0: prove equivalence between (1) and (2)</a>

<a id="5838" class="Comment">-- Unspent : (b : Blockchain) → (i : Index b) → let (_ , o , Tᵢ) at tᵢ = b ‼ i in ∀ (j : Fin o) → Set</a>
<a id="5940" class="Comment">-- utxo : (b : Blockchain) → ConsistentBlockchain b → Set⟨ ∃TxOutput ⟩</a>
<a id="6011" class="Comment">-- UTXO : Blockchain → Set⟨ TxInput ⟩</a>

<a id="6050" class="Comment">{-
Unspent→UTXO : ∀ {b : Blockchain} {i : Index b} → let _ , o , tx = transaction (b ‼ i) in
               ∀ {j : Fin o}
  → Unspent b i j
    ─────────────────────────────────────────────────────────
    ((tx ♯) at toℕ j) ∈ˢ UTXO b
Unspent→UTXO {b} {i} {j} p = {!!}

UTXO→Unspent : ∀ {b : Blockchain} {i : Index b} → let _ , o , tx = transaction (b ‼ i) in
               ∀ {j : Fin o}
  → ((tx ♯) at toℕ j) ∈ˢ UTXO b
    ─────────────────────────────────────────────────────────
    Unspent b i j
UTXO→Unspent {x ∷ b} {i} {j} p = {!!}
-}</a>

<a id="6592" class="Comment">{- WIP
-- record BlockchainTx : Set where
--   field
--     b : Blockchain
--     i : Index b

--   getTTx : TimedTx
--   getTTx = b ‼ i

--   getTx : ∃Tx
--   getTx = transaction (getTTx b)

-- BlockchainTx = Σ[ b ∈ Blockchain ] Index b

-- getTTx : BlockchainTx → TimedTx
-- getTTx (b , i) = b ‼ i

-- getTx : BlockchainTx → ∃Tx
-- getTx = transaction ∘ getTTx

-- Unspent : (btx : BlockchainTx) →  Pred₀ (Fin $ ∃o $ getTx btx)
-- Unspent (b , i) j =
--   let (_ , o , Tᵢ) at tᵢ = b ‼ i in
--   ∀ (i′ : Index b) (leq : i′ F.≤ i) → let (i′ , _ , Tᵢ′) at tᵢ′ = b ‼ i′ in
--   ∀ (j′ : Fin i′) →
--     Tᵢ , j , tᵢ ↛ Tᵢ′ , j′ , tᵢ′
-}</a>
</pre></body></html>