<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Bitcoin.Consistency</title><link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css'/><style>.github-fork-ribbon:before { background-color: #333; }</style><link rel="stylesheet" href="css/Agda.css"></head><body><a class='github-fork-ribbon'href='https://github.com/omelkonian/formal-bitcoin/tree/master/Bitcoin/Consistency.agda'data-ribbon='Source code on Github' title='Source code on Github'>Source code on Github</a><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- Blockchain and consistency.</a>
<a id="105" class="Comment">------------------------------------------------------------------------</a>
<a id="178" class="Keyword">module</a> <a id="185" href="Bitcoin.Consistency.html" class="Module">Bitcoin.Consistency</a> <a id="205" class="Keyword">where</a>

<a id="212" class="Keyword">open</a> <a id="217" class="Keyword">import</a> <a id="224" href="Prelude.Init.html" class="Module">Prelude.Init</a><a id="236" class="Symbol">;</a> <a id="238" class="Keyword">open</a> <a id="243" href="Prelude.Init.html#504" class="Module">SetAsType</a>
<a id="253" class="Keyword">open</a> <a id="258" class="Keyword">import</a> <a id="265" href="Prelude.General.html" class="Module">Prelude.General</a>
<a id="281" class="Keyword">open</a> <a id="286" class="Keyword">import</a> <a id="293" href="Prelude.Lists.html" class="Module">Prelude.Lists</a>
<a id="307" class="Keyword">open</a> <a id="312" class="Keyword">import</a> <a id="319" href="Prelude.DecEq.html" class="Module">Prelude.DecEq</a>
<a id="333" class="Keyword">open</a> <a id="338" class="Keyword">import</a> <a id="345" href="Prelude.Sets.html" class="Module">Prelude.Sets</a>
<a id="358" class="Keyword">open</a> <a id="363" class="Keyword">import</a> <a id="370" href="Prelude.Functor.html" class="Module">Prelude.Functor</a>
<a id="386" class="Keyword">open</a> <a id="391" class="Keyword">import</a> <a id="398" href="Prelude.ToN.html" class="Module">Prelude.ToN</a>
<a id="410" class="Keyword">open</a> <a id="415" class="Keyword">import</a> <a id="422" href="Prelude.Ord.html" class="Module">Prelude.Ord</a>
<a id="434" class="Keyword">open</a> <a id="439" class="Keyword">import</a> <a id="446" href="Prelude.InferenceRules.html" class="Module">Prelude.InferenceRules</a>
<a id="469" class="Keyword">open</a> <a id="474" class="Keyword">import</a> <a id="481" href="Prelude.FromList.html" class="Module">Prelude.FromList</a><a id="497" class="Symbol">;</a> <a id="499" class="Keyword">open</a> <a id="504" class="Keyword">import</a> <a id="511" href="Prelude.ToList.html" class="Module">Prelude.ToList</a>

<a id="527" class="Keyword">open</a> <a id="532" class="Keyword">import</a> <a id="539" href="Bitcoin.Crypto.html" class="Module">Bitcoin.Crypto</a>
<a id="554" class="Keyword">open</a> <a id="559" class="Keyword">import</a> <a id="566" href="Bitcoin.BasicTypes.html" class="Module">Bitcoin.BasicTypes</a>
<a id="585" class="Keyword">open</a> <a id="590" class="Keyword">import</a> <a id="597" href="Bitcoin.Script.html" class="Module">Bitcoin.Script</a>
<a id="612" class="Keyword">open</a> <a id="617" class="Keyword">import</a> <a id="624" href="Bitcoin.Tx.html" class="Module">Bitcoin.Tx</a>

<a id="636" class="Comment">-- Blockchain</a>
<a id="Blockchain"></a><a id="650" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a> <a id="661" class="Symbol">:</a> <a id="663" href="Agda.Primitive.html#320" class="Primitive">Type</a>
<a id="668" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a> <a id="679" class="Symbol">=</a> <a id="681" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="686" href="Bitcoin.Tx.Base.html#2632" class="Record">TimedTx</a> <a id="694" class="Comment">-- in reverse chronological order, in contrast to the paper</a>

<a id="755" class="Keyword">variable</a> <a id="764" href="Bitcoin.Consistency.html#764" class="Generalizable">txs</a> <a id="768" href="Bitcoin.Consistency.html#768" class="Generalizable">txs′</a> <a id="773" class="Symbol">:</a> <a id="775" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a>

<a id="txSet"></a><a id="787" href="Bitcoin.Consistency.html#787" class="Function">txSet</a> <a id="793" class="Symbol">:</a> <a id="795" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a> <a id="806" class="Symbol">→</a> <a id="808" href="Prelude.Sets.AsUniqueLists.Core.html#1017" class="Record">Set⟨</a> <a id="813" href="Bitcoin.Tx.Base.html#2632" class="Record">TimedTx</a> <a id="821" href="Prelude.Sets.AsUniqueLists.Core.html#1017" class="Record">⟩</a>
<a id="823" href="Bitcoin.Consistency.html#787" class="Function">txSet</a> <a id="829" class="Symbol">=</a> <a id="831" href="Prelude.FromList.html#197" class="Field">fromList</a>

<a id="match"></a><a id="841" href="Bitcoin.Consistency.html#841" class="Function">match</a> <a id="847" class="Symbol">:</a> <a id="849" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a> <a id="860" class="Symbol">→</a> <a id="862" href="Bitcoin.BasicTypes.html#244" class="Function">HashId</a> <a id="869" class="Symbol">→</a> <a id="871" href="Prelude.Sets.AsUniqueLists.Core.html#1017" class="Record">Set⟨</a> <a id="876" href="Bitcoin.Tx.Base.html#2632" class="Record">TimedTx</a> <a id="884" href="Prelude.Sets.AsUniqueLists.Core.html#1017" class="Record">⟩</a>
<a id="886" href="Bitcoin.Consistency.html#841" class="Function">match</a> <a id="892" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>                <a id="910" class="Symbol">_</a>   <a id="914" class="Symbol">=</a> <a id="916" href="Prelude.Sets.AsUniqueLists.Core.html#2842" class="InductiveConstructor">∅</a>
<a id="918" href="Bitcoin.Consistency.html#841" class="Function">match</a> <a id="924" class="Symbol">((</a><a id="926" href="Bitcoin.Consistency.html#926" class="Bound">∃tx</a><a id="929" class="Symbol">@(_</a> <a id="933" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="935" class="Symbol">_</a> <a id="937" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="939" href="Bitcoin.Consistency.html#939" class="Bound">tx</a><a id="941" class="Symbol">)</a> <a id="943" href="Bitcoin.Tx.Base.html#2667" class="InductiveConstructor Operator">at</a> <a id="946" href="Bitcoin.Consistency.html#946" class="Bound">t</a><a id="947" class="Symbol">)</a> <a id="949" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="951" href="Bitcoin.Consistency.html#951" class="Bound">txs</a><a id="954" class="Symbol">)</a> <a id="956" href="Bitcoin.Consistency.html#956" class="Bound">tx♯</a> <a id="960" class="Symbol">=</a>
  <a id="964" href="Data.Bool.Base.html#1292" class="Function Operator">if</a> <a id="967" href="Bitcoin.Consistency.html#939" class="Bound">tx</a> <a id="970" href="Bitcoin.Crypto.html#669" class="Postulate Operator">♯</a> <a id="972" href="Prelude.DecEq.Core.html#222" class="Function Operator">==</a> <a id="975" href="Bitcoin.Consistency.html#956" class="Bound">tx♯</a> <a id="979" href="Data.Bool.Base.html#1292" class="Function Operator">then</a>
    <a id="988" href="Prelude.Sets.AsUniqueLists.Core.html#2855" class="Function">singleton</a> <a id="998" class="Symbol">(</a><a id="999" href="Bitcoin.Consistency.html#926" class="Bound">∃tx</a> <a id="1003" href="Bitcoin.Tx.Base.html#2667" class="InductiveConstructor Operator">at</a> <a id="1006" href="Bitcoin.Consistency.html#946" class="Bound">t</a><a id="1007" class="Symbol">)</a> <a id="1009" href="Prelude.Sets.AsUniqueLists.Core.html#3160" class="Function Operator">∪</a> <a id="1011" href="Bitcoin.Consistency.html#841" class="Function">match</a> <a id="1017" href="Bitcoin.Consistency.html#951" class="Bound">txs</a> <a id="1021" href="Bitcoin.Consistency.html#956" class="Bound">tx♯</a>
  <a id="1027" href="Data.Bool.Base.html#1292" class="Function Operator">else</a>
    <a id="1036" href="Bitcoin.Consistency.html#841" class="Function">match</a> <a id="1042" href="Bitcoin.Consistency.html#951" class="Bound">txs</a> <a id="1046" href="Bitcoin.Consistency.html#956" class="Bound">tx♯</a>

<a id="1051" class="Comment">-- UTXO: Unspent transaction outputs.</a>
<a id="1089" class="Comment">-- (0) EUTXO-like set-theoretic definition, based on txInputs instead of outputs for convenience</a>
<a id="UTXOₜₓ"></a><a id="1186" href="Bitcoin.Consistency.html#1186" class="Function">UTXOₜₓ</a> <a id="1193" class="Symbol">:</a> <a id="1195" href="Bitcoin.Tx.Base.html#1467" class="Function">∃Tx</a> <a id="1199" class="Symbol">→</a> <a id="1201" href="Prelude.Sets.AsUniqueLists.Core.html#1017" class="Record">Set⟨</a> <a id="1206" href="Bitcoin.Tx.Base.html#359" class="Record">TxInput</a> <a id="1214" href="Prelude.Sets.AsUniqueLists.Core.html#1017" class="Record">⟩</a>
<a id="1216" href="Bitcoin.Consistency.html#1186" class="Function">UTXOₜₓ</a> <a id="1223" class="Symbol">(_</a> <a id="1226" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1228" href="Bitcoin.Consistency.html#1228" class="Bound">o</a> <a id="1230" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1232" href="Bitcoin.Consistency.html#1232" class="Bound">tx</a><a id="1234" class="Symbol">)</a> <a id="1236" class="Symbol">=</a> <a id="1238" href="Prelude.FromList.html#197" class="Field">fromList</a> <a id="1247" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="1249" class="Symbol">(</a><a id="1250" href="Bitcoin.Consistency.html#1232" class="Bound">tx</a> <a id="1253" href="Bitcoin.Crypto.html#669" class="Postulate Operator">♯</a><a id="1254" class="Symbol">)</a> <a id="1256" href="Bitcoin.Tx.Base.html#394" class="InductiveConstructor Operator">at_</a> <a id="1260" href="Prelude.Functor.html#382" class="Field Operator">&lt;$&gt;</a> <a id="1264" href="Data.List.Base.html#6243" class="Function">upTo</a> <a id="1269" href="Bitcoin.Consistency.html#1228" class="Bound">o</a>

<a id="STXOₜₓ"></a><a id="1272" href="Bitcoin.Consistency.html#1272" class="Function">STXOₜₓ</a> <a id="1279" class="Symbol">:</a> <a id="1281" href="Bitcoin.Tx.Base.html#1467" class="Function">∃Tx</a> <a id="1285" class="Symbol">→</a> <a id="1287" href="Prelude.Sets.AsUniqueLists.Core.html#1017" class="Record">Set⟨</a> <a id="1292" href="Bitcoin.Tx.Base.html#359" class="Record">TxInput</a> <a id="1300" href="Prelude.Sets.AsUniqueLists.Core.html#1017" class="Record">⟩</a>
<a id="1302" href="Bitcoin.Consistency.html#1272" class="Function">STXOₜₓ</a> <a id="1309" class="Symbol">(_</a> <a id="1312" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1314" class="Symbol">_</a> <a id="1316" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1318" href="Bitcoin.Consistency.html#1318" class="Bound">tx</a><a id="1320" class="Symbol">)</a> <a id="1322" class="Symbol">=</a> <a id="1324" href="Bitcoin.Consistency.html#1318" class="Bound">tx</a> <a id="1327" class="Symbol">.</a><a id="1328" href="Bitcoin.Tx.Base.html#1152" class="Field">inputs</a> <a id="1335" href="Prelude.ToList.html#215" class="Function Operator">∙toList</a> <a id="1343" href="Prelude.FromList.html#221" class="Function Operator">∙fromList</a>

<a id="UTXO"></a><a id="1354" href="Bitcoin.Consistency.html#1354" class="Function">UTXO</a> <a id="1359" class="Symbol">:</a> <a id="1361" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a> <a id="1372" class="Symbol">→</a> <a id="1374" href="Prelude.Sets.AsUniqueLists.Core.html#1017" class="Record">Set⟨</a> <a id="1379" href="Bitcoin.Tx.Base.html#359" class="Record">TxInput</a> <a id="1387" href="Prelude.Sets.AsUniqueLists.Core.html#1017" class="Record">⟩</a>
<a id="1389" href="Bitcoin.Consistency.html#1354" class="Function">UTXO</a> <a id="1394" class="Symbol">=</a> <a id="1396" class="Symbol">λ</a> <a id="1398" class="Keyword">where</a>
  <a id="1406" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>              <a id="1422" class="Symbol">→</a> <a id="1424" href="Prelude.Sets.AsUniqueLists.Core.html#2842" class="InductiveConstructor">∅</a>
  <a id="1428" class="Symbol">(</a><a id="1429" href="Bitcoin.Consistency.html#1429" class="Bound">tx</a> <a id="1432" href="Bitcoin.Tx.Base.html#2667" class="InductiveConstructor Operator">at</a> <a id="1435" class="Symbol">_</a> <a id="1437" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="1439" href="Bitcoin.Consistency.html#1439" class="Bound">txs</a><a id="1442" class="Symbol">)</a> <a id="1444" class="Symbol">→</a> <a id="1446" href="Bitcoin.Consistency.html#1354" class="Function">UTXO</a> <a id="1451" href="Bitcoin.Consistency.html#1439" class="Bound">txs</a> <a id="1455" href="Prelude.Sets.AsUniqueLists.Core.html#3168" class="Function Operator">─</a> <a id="1457" href="Bitcoin.Consistency.html#1272" class="Function">STXOₜₓ</a> <a id="1464" href="Bitcoin.Consistency.html#1429" class="Bound">tx</a>
                  <a id="1485" href="Prelude.Sets.AsUniqueLists.Core.html#3160" class="Function Operator">∪</a> <a id="1487" href="Bitcoin.Consistency.html#1186" class="Function">UTXOₜₓ</a> <a id="1494" href="Bitcoin.Consistency.html#1429" class="Bound">tx</a>

<a id="1498" class="Comment">-- Consistent update.</a>
<a id="latestTime"></a><a id="1520" href="Bitcoin.Consistency.html#1520" class="Function">latestTime</a> <a id="1531" class="Symbol">:</a> <a id="1533" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a> <a id="1544" class="Symbol">→</a> <a id="1546" href="Bitcoin.BasicTypes.html#233" class="Function">Time</a>
<a id="1551" href="Bitcoin.Consistency.html#1520" class="Function">latestTime</a> <a id="1562" class="Symbol">=</a> <a id="1564" class="Symbol">λ</a> <a id="1566" class="Keyword">where</a>
  <a id="1574" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>             <a id="1589" class="Symbol">→</a> <a id="1591" class="Number">0</a>
  <a id="1595" class="Symbol">((_</a> <a id="1599" href="Bitcoin.Tx.Base.html#2667" class="InductiveConstructor Operator">at</a> <a id="1602" href="Bitcoin.Consistency.html#1602" class="Bound">t</a><a id="1603" class="Symbol">)</a> <a id="1605" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="1607" class="Symbol">_)</a> <a id="1610" class="Symbol">→</a> <a id="1612" href="Bitcoin.Consistency.html#1602" class="Bound">t</a>

<a id="1615" class="Keyword">record</a> <a id="_▷_,_"></a><a id="1622" href="Bitcoin.Consistency.html#1622" class="Record Operator">_▷_,_</a> <a id="1628" class="Symbol">(</a><a id="1629" href="Bitcoin.Consistency.html#1629" class="Bound">txs</a> <a id="1633" class="Symbol">:</a> <a id="1635" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a><a id="1645" class="Symbol">)</a> <a id="1647" class="Symbol">(</a><a id="1648" href="Bitcoin.Consistency.html#1648" class="Bound">tx</a> <a id="1651" class="Symbol">:</a> <a id="1653" href="Bitcoin.Tx.Base.html#1114" class="Record">Tx</a> <a id="1656" href="Bitcoin.Tx.Base.html#2199" class="Generalizable">i</a> <a id="1658" href="Bitcoin.Tx.Base.html#2204" class="Generalizable">o</a><a id="1659" class="Symbol">)</a> <a id="1661" class="Symbol">(</a><a id="1662" href="Bitcoin.Consistency.html#1662" class="Bound">t</a> <a id="1664" class="Symbol">:</a> <a id="1666" href="Bitcoin.BasicTypes.html#233" class="Function">Time</a><a id="1670" class="Symbol">)</a> <a id="1672" class="Symbol">:</a> <a id="1674" href="Agda.Primitive.html#320" class="Primitive">Type</a> <a id="1679" class="Keyword">where</a>
  <a id="1687" class="Keyword">field</a>
    <a id="1697" class="Comment">-- well-formedness conditions</a>

    <a id="_▷_,_.inputsUnique"></a><a id="1732" href="Bitcoin.Consistency.html#1732" class="Field">inputsUnique</a> <a id="1745" class="Symbol">:</a>
      <a id="1753" href="Data.List.Relation.Unary.Unique.Setoid.html#728" class="Datatype">Unique</a> <a id="1760" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="1762" href="Bitcoin.Consistency.html#1648" class="Bound">tx</a> <a id="1765" class="Symbol">.</a><a id="1766" href="Bitcoin.Tx.Base.html#1152" class="Field">inputs</a> <a id="1773" href="Prelude.ToList.html#215" class="Function Operator">∙toList</a>

    <a id="_▷_,_.singleMatch"></a><a id="1786" href="Bitcoin.Consistency.html#1786" class="Field">singleMatch</a> <a id="1798" class="Symbol">:</a> <a id="1800" class="Symbol">∀</a> <a id="1802" class="Symbol">(</a><a id="1803" href="Bitcoin.Consistency.html#1803" class="Bound">i</a> <a id="1805" class="Symbol">:</a> <a id="1807" href="Data.Fin.Base.html#1135" class="Datatype">Fin</a> <a id="1811" href="Bitcoin.Consistency.html#1656" class="Bound">i</a><a id="1812" class="Symbol">)</a> <a id="1814" class="Symbol">→</a>
      <a id="1822" class="Keyword">let</a>
        <a id="1834" class="Symbol">(</a><a id="1835" href="Bitcoin.Consistency.html#1835" class="Bound">tx♯</a> <a id="1839" href="Bitcoin.Tx.Base.html#394" class="InductiveConstructor Operator">at</a> <a id="1842" class="Symbol">_)</a> <a id="1845" class="Symbol">=</a> <a id="1847" href="Bitcoin.Consistency.html#1648" class="Bound">tx</a> <a id="1850" href="Bitcoin.Tx.Base.html#2230" class="Function Operator">‼ⁱ</a> <a id="1853" href="Bitcoin.Consistency.html#1803" class="Bound">i</a>
      <a id="1861" class="Keyword">in</a>
        <a id="1872" href="Data.Product.html#1815" class="Function">∃[</a> <a id="1875" href="Bitcoin.Consistency.html#1875" class="Bound">tx</a> <a id="1878" href="Data.Product.html#1815" class="Function">]</a> <a id="1880" class="Symbol">(</a><a id="1881" href="Bitcoin.Consistency.html#841" class="Function">match</a> <a id="1887" href="Bitcoin.Consistency.html#1629" class="Bound">txs</a> <a id="1891" href="Bitcoin.Consistency.html#1835" class="Bound">tx♯</a> <a id="1895" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="1897" href="Prelude.Sets.AsUniqueLists.Core.html#2855" class="Function">singleton</a> <a id="1907" href="Bitcoin.Consistency.html#1875" class="Bound">tx</a><a id="1909" class="Symbol">)</a>

    <a id="_▷_,_.noOutOfBounds"></a><a id="1916" href="Bitcoin.Consistency.html#1916" class="Field">noOutOfBounds</a> <a id="1930" class="Symbol">:</a> <a id="1932" class="Symbol">∀</a> <a id="1934" class="Symbol">(</a><a id="1935" href="Bitcoin.Consistency.html#1935" class="Bound">i</a> <a id="1937" class="Symbol">:</a> <a id="1939" href="Data.Fin.Base.html#1135" class="Datatype">Fin</a> <a id="1943" href="Bitcoin.Consistency.html#1656" class="Bound">i</a><a id="1944" class="Symbol">)</a> <a id="1946" class="Symbol">→</a>
      <a id="1954" class="Keyword">let</a>
        <a id="1966" class="Symbol">(_</a> <a id="1969" href="Bitcoin.Tx.Base.html#394" class="InductiveConstructor Operator">at</a> <a id="1972" href="Bitcoin.Consistency.html#1972" class="Bound">oᵢ</a><a id="1974" class="Symbol">)</a>                <a id="1991" class="Symbol">=</a> <a id="1993" href="Bitcoin.Consistency.html#1648" class="Bound">tx</a> <a id="1996" href="Bitcoin.Tx.Base.html#2230" class="Function Operator">‼ⁱ</a> <a id="1999" href="Bitcoin.Consistency.html#1935" class="Bound">i</a>
        <a id="2009" class="Symbol">(((_</a> <a id="2014" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2016" href="Bitcoin.Consistency.html#2016" class="Bound">o</a> <a id="2018" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2020" class="Symbol">_)</a> <a id="2023" href="Bitcoin.Tx.Base.html#2667" class="InductiveConstructor Operator">at</a> <a id="2026" class="Symbol">_)</a> <a id="2029" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2031" class="Symbol">_)</a> <a id="2034" class="Symbol">=</a> <a id="2036" href="Bitcoin.Consistency.html#1786" class="Field">singleMatch</a> <a id="2048" href="Bitcoin.Consistency.html#1935" class="Bound">i</a>
      <a id="2056" class="Keyword">in</a>
        <a id="2067" href="Bitcoin.Consistency.html#1972" class="Bound">oᵢ</a> <a id="2070" href="Prelude.Ord.Core.html#213" class="Field Operator">&lt;</a> <a id="2072" href="Bitcoin.Consistency.html#2016" class="Bound">o</a>

  <a id="2077" class="Keyword">private</a>
    <a id="_▷_,_.getI"></a><a id="2089" href="Bitcoin.Consistency.html#2089" class="Function">getI</a> <a id="2094" class="Symbol">:</a> <a id="2096" class="Symbol">∀</a> <a id="2098" class="Symbol">(</a><a id="2099" href="Bitcoin.Consistency.html#2099" class="Bound">i</a> <a id="2101" class="Symbol">:</a> <a id="2103" href="Data.Fin.Base.html#1135" class="Datatype">Fin</a> <a id="2107" href="Bitcoin.Consistency.html#1656" class="Bound">i</a><a id="2108" class="Symbol">)</a> <a id="2110" class="Symbol">→</a> <a id="2112" class="Keyword">let</a> <a id="2116" href="Bitcoin.Consistency.html#2116" class="Bound">i′</a> <a id="2119" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2121" href="Bitcoin.Consistency.html#2121" class="Bound">o′</a> <a id="2124" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2126" class="Symbol">_</a> <a id="2128" class="Symbol">=</a> <a id="2130" href="Bitcoin.Consistency.html#1786" class="Field">singleMatch</a> <a id="2142" href="Bitcoin.Consistency.html#2099" class="Bound">i</a> <a id="2144" class="Symbol">.</a><a id="2145" href="Agda.Builtin.Sigma.html#234" class="Field">proj₁</a> <a id="2151" class="Symbol">.</a><a id="2152" href="Bitcoin.Tx.Base.html#2680" class="Field">transaction</a> <a id="2164" class="Keyword">in</a>
      <a id="2173" href="Bitcoin.Tx.Base.html#1114" class="Record">Tx</a> <a id="2176" href="Bitcoin.Consistency.html#2116" class="Bound">i′</a> <a id="2179" href="Bitcoin.Consistency.html#2121" class="Bound">o′</a> <a id="2182" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="2184" href="Data.Fin.Base.html#1135" class="Datatype">Fin</a> <a id="2188" href="Bitcoin.Consistency.html#2121" class="Bound">o′</a> <a id="2191" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="2193" href="Bitcoin.BasicTypes.html#233" class="Function">Time</a> <a id="2198" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="2200" href="Bitcoin.BasicTypes.html#222" class="Function">Value</a>
    <a id="2210" href="Bitcoin.Consistency.html#2089" class="Function">getI</a> <a id="2215" href="Bitcoin.Consistency.html#2215" class="Bound">i</a> <a id="2217" class="Symbol">=</a>
      <a id="2225" class="Keyword">let</a>
        <a id="2237" class="Symbol">(_</a> <a id="2240" href="Bitcoin.Tx.Base.html#394" class="InductiveConstructor Operator">at</a> <a id="2243" href="Bitcoin.Consistency.html#2243" class="Bound">oᵢ</a><a id="2245" class="Symbol">)</a> <a id="2247" class="Symbol">=</a> <a id="2249" href="Bitcoin.Consistency.html#1648" class="Bound">tx</a> <a id="2252" href="Bitcoin.Tx.Base.html#2230" class="Function Operator">‼ⁱ</a> <a id="2255" href="Bitcoin.Consistency.html#2215" class="Bound">i</a>
        <a id="2265" class="Symbol">(((_</a> <a id="2270" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2272" href="Bitcoin.Consistency.html#2272" class="Bound">o</a> <a id="2274" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2276" href="Bitcoin.Consistency.html#2276" class="Bound">Tᵢ</a><a id="2278" class="Symbol">)</a> <a id="2280" href="Bitcoin.Tx.Base.html#2667" class="InductiveConstructor Operator">at</a> <a id="2283" href="Bitcoin.Consistency.html#2283" class="Bound">tᵢ</a><a id="2285" class="Symbol">)</a> <a id="2287" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2289" class="Symbol">_)</a> <a id="2292" class="Symbol">=</a> <a id="2294" href="Bitcoin.Consistency.html#1786" class="Field">singleMatch</a> <a id="2306" href="Bitcoin.Consistency.html#2215" class="Bound">i</a>
        <a id="2316" href="Bitcoin.Consistency.html#2316" class="Bound">oᵢ</a> <a id="2319" class="Symbol">=</a> <a id="2321" href="Data.Fin.Base.html#1982" class="Function">F.fromℕ&lt;</a> <a id="2330" class="Symbol">{</a><a id="2331" class="Argument">m</a> <a id="2333" class="Symbol">=</a> <a id="2335" href="Bitcoin.Consistency.html#2243" class="Bound">oᵢ</a><a id="2337" class="Symbol">}</a> <a id="2339" class="Symbol">{</a><a id="2340" class="Argument">n</a> <a id="2342" class="Symbol">=</a> <a id="2344" href="Bitcoin.Consistency.html#2272" class="Bound">o</a><a id="2345" class="Symbol">}</a> <a id="2347" class="Symbol">(</a><a id="2348" href="Bitcoin.Consistency.html#1916" class="Field">noOutOfBounds</a> <a id="2362" href="Bitcoin.Consistency.html#2215" class="Bound">i</a><a id="2363" class="Symbol">)</a>
        <a id="2373" href="Bitcoin.Consistency.html#2373" class="Bound">vᵢ</a> <a id="2376" class="Symbol">=</a> <a id="2378" class="Symbol">(</a><a id="2379" href="Bitcoin.Consistency.html#2276" class="Bound">Tᵢ</a> <a id="2382" href="Bitcoin.Tx.Base.html#2427" class="Function Operator">‼ᵒ</a> <a id="2385" href="Bitcoin.Consistency.html#2316" class="Bound">oᵢ</a><a id="2387" class="Symbol">)</a> <a id="2389" href="Bitcoin.Tx.Base.html#891" class="Function Operator">∙value</a>
      <a id="2402" class="Keyword">in</a>
        <a id="2413" href="Bitcoin.Consistency.html#2276" class="Bound">Tᵢ</a> <a id="2416" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2418" href="Bitcoin.Consistency.html#2316" class="Bound">oᵢ</a> <a id="2421" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2423" href="Bitcoin.Consistency.html#2283" class="Bound">tᵢ</a> <a id="2426" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2428" href="Bitcoin.Consistency.html#2373" class="Bound">vᵢ</a>

  <a id="2434" class="Keyword">field</a>
    <a id="2444" class="Comment">-- (1)</a>
    <a id="_▷_,_.inputs∈UTXO"></a><a id="2455" href="Bitcoin.Consistency.html#2455" class="Field">inputs∈UTXO</a> <a id="2467" class="Symbol">:</a> <a id="2469" class="Symbol">∀</a> <a id="2471" class="Symbol">(</a><a id="2472" href="Bitcoin.Consistency.html#2472" class="Bound">i</a> <a id="2474" class="Symbol">:</a> <a id="2476" href="Data.Fin.Base.html#1135" class="Datatype">Fin</a> <a id="2480" href="Bitcoin.Consistency.html#1656" class="Bound">i</a><a id="2481" class="Symbol">)</a> <a id="2483" class="Symbol">→</a>
      <a id="2491" href="Bitcoin.Consistency.html#1648" class="Bound">tx</a> <a id="2494" href="Bitcoin.Tx.Base.html#2230" class="Function Operator">‼ⁱ</a> <a id="2497" href="Bitcoin.Consistency.html#2472" class="Bound">i</a> <a id="2499" href="Prelude.Sets.AsUniqueLists.Core.html#2169" class="Function Operator">∈ˢ</a> <a id="2502" href="Bitcoin.Consistency.html#1354" class="Function">UTXO</a> <a id="2507" href="Bitcoin.Consistency.html#1629" class="Bound">txs</a>

    <a id="2516" class="Comment">-- (2)</a>
    <a id="_▷_,_.inputsRedeemable"></a><a id="2527" href="Bitcoin.Consistency.html#2527" class="Field">inputsRedeemable</a> <a id="2544" class="Symbol">:</a> <a id="2546" class="Symbol">∀</a> <a id="2548" class="Symbol">(</a><a id="2549" href="Bitcoin.Consistency.html#2549" class="Bound">i</a> <a id="2551" class="Symbol">:</a> <a id="2553" href="Data.Fin.Base.html#1135" class="Datatype">Fin</a> <a id="2557" href="Bitcoin.Consistency.html#1656" class="Bound">i</a><a id="2558" class="Symbol">)</a> <a id="2560" class="Symbol">→</a> <a id="2562" class="Keyword">let</a> <a id="2566" href="Bitcoin.Consistency.html#2566" class="Bound">Tᵢ</a> <a id="2569" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2571" href="Bitcoin.Consistency.html#2571" class="Bound">oᵢ</a> <a id="2574" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2576" href="Bitcoin.Consistency.html#2576" class="Bound">tᵢ</a> <a id="2579" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2581" href="Bitcoin.Consistency.html#2581" class="Bound">vᵢ</a> <a id="2584" class="Symbol">=</a> <a id="2586" href="Bitcoin.Consistency.html#2089" class="Function">getI</a> <a id="2591" href="Bitcoin.Consistency.html#2549" class="Bound">i</a> <a id="2593" class="Keyword">in</a>
        <a id="2604" href="Bitcoin.Consistency.html#2566" class="Bound">Tᵢ</a> <a id="2607" href="Bitcoin.Tx.Semantics.html#542" class="Record Operator">,</a> <a id="2609" href="Bitcoin.Consistency.html#2571" class="Bound">oᵢ</a> <a id="2612" href="Bitcoin.Tx.Semantics.html#542" class="Record Operator">,</a> <a id="2614" href="Bitcoin.Consistency.html#2576" class="Bound">tᵢ</a> <a id="2617" href="Bitcoin.Tx.Semantics.html#542" class="Record Operator">↝[</a> <a id="2620" href="Bitcoin.Consistency.html#2581" class="Bound">vᵢ</a> <a id="2623" href="Bitcoin.Tx.Semantics.html#542" class="Record Operator">]</a> <a id="2625" href="Bitcoin.Consistency.html#1648" class="Bound">tx</a> <a id="2628" href="Bitcoin.Tx.Semantics.html#542" class="Record Operator">,</a> <a id="2630" href="Bitcoin.Consistency.html#2549" class="Bound">i</a> <a id="2632" href="Bitcoin.Tx.Semantics.html#542" class="Record Operator">,</a> <a id="2634" href="Bitcoin.Consistency.html#1662" class="Bound">t</a>

    <a id="2641" class="Comment">-- (3)</a>
    <a id="_▷_,_.valuesPreserved"></a><a id="2652" href="Bitcoin.Consistency.html#2652" class="Field">valuesPreserved</a> <a id="2668" class="Symbol">:</a>
      <a id="2676" class="Keyword">let</a>
        <a id="2688" href="Bitcoin.Consistency.html#2688" class="Bound">ins</a>  <a id="2693" class="Symbol">=</a> <a id="2695" href="Data.Vec.Base.html#5897" class="Function">V.tabulate</a> <a id="2706" class="Symbol">λ</a> <a id="2708" href="Bitcoin.Consistency.html#2708" class="Bound">i</a> <a id="2710" class="Symbol">→</a> <a id="2712" class="Keyword">let</a> <a id="2716" href="Bitcoin.Consistency.html#2716" class="Bound">Tᵢ</a> <a id="2719" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2721" href="Bitcoin.Consistency.html#2721" class="Bound">oᵢ</a> <a id="2724" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2726" class="Symbol">_</a> <a id="2728" class="Symbol">=</a> <a id="2730" href="Bitcoin.Consistency.html#2089" class="Function">getI</a> <a id="2735" href="Bitcoin.Consistency.html#2708" class="Bound">i</a> <a id="2737" class="Keyword">in</a> <a id="2740" class="Symbol">(</a><a id="2741" href="Bitcoin.Consistency.html#2716" class="Bound">Tᵢ</a> <a id="2744" href="Bitcoin.Tx.Base.html#2427" class="Function Operator">‼ᵒ</a> <a id="2747" href="Bitcoin.Consistency.html#2721" class="Bound">oᵢ</a><a id="2749" class="Symbol">)</a> <a id="2751" href="Bitcoin.Tx.Base.html#891" class="Function Operator">∙value</a>
        <a id="2766" href="Bitcoin.Consistency.html#2766" class="Bound">outs</a> <a id="2771" class="Symbol">=</a> <a id="2773" href="Bitcoin.Tx.Base.html#891" class="Function Operator">_∙value</a> <a id="2781" href="Prelude.Functor.html#382" class="Field Operator">&lt;$&gt;</a> <a id="2785" href="Bitcoin.Consistency.html#1648" class="Bound">tx</a> <a id="2788" class="Symbol">.</a><a id="2789" href="Bitcoin.Tx.Base.html#1302" class="Field">outputs</a>
      <a id="2803" class="Keyword">in</a>
        <a id="2814" href="Data.Vec.Base.html#5423" class="Function">V.sum</a> <a id="2820" href="Bitcoin.Consistency.html#2688" class="Bound">ins</a> <a id="2824" href="Prelude.Ord.Core.html#289" class="Function Operator">≥</a> <a id="2826" href="Data.Vec.Base.html#5423" class="Function">V.sum</a> <a id="2832" href="Bitcoin.Consistency.html#2766" class="Bound">outs</a>

    <a id="2842" class="Comment">-- (4)</a>
    <a id="_▷_,_.laterTime"></a><a id="2853" href="Bitcoin.Consistency.html#2853" class="Field">laterTime</a> <a id="2863" class="Symbol">:</a>
      <a id="2871" href="Bitcoin.Consistency.html#1662" class="Bound">t</a> <a id="2873" href="Prelude.Ord.Core.html#289" class="Function Operator">≥</a> <a id="2875" href="Bitcoin.Consistency.html#1520" class="Function">latestTime</a> <a id="2886" href="Bitcoin.Consistency.html#1629" class="Bound">txs</a>

<a id="2891" class="Comment">-- Consistency.</a>
<a id="2907" class="Keyword">data</a> <a id="ConsistentBlockchain"></a><a id="2912" href="Bitcoin.Consistency.html#2912" class="Datatype">ConsistentBlockchain</a> <a id="2933" class="Symbol">:</a> <a id="2935" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a> <a id="2946" class="Symbol">→</a> <a id="2948" href="Agda.Primitive.html#320" class="Primitive">Type</a> <a id="2953" class="Keyword">where</a>
  <a id="2961" class="Comment">-- ∎_∶-_  : (tx : Tx 0 o)</a>
  <a id="2989" class="Comment">--        → Coinbase tx</a>
  <a id="3015" class="Comment">--        → ConsistentBlockchain [ (_ , _ , tx) at 0 ]</a>
  <a id="ConsistentBlockchain.∎"></a><a id="3072" href="Bitcoin.Consistency.html#3072" class="InductiveConstructor">∎</a>  <a id="3075" class="Symbol">:</a> <a id="3077" href="Bitcoin.Consistency.html#2912" class="Datatype">ConsistentBlockchain</a> <a id="3098" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>

  <a id="ConsistentBlockchain._⊕_∶-_"></a><a id="3104" href="Bitcoin.Consistency.html#3104" class="InductiveConstructor Operator">_⊕_∶-_</a> <a id="3111" class="Symbol">:</a> <a id="3113" href="Bitcoin.Consistency.html#2912" class="Datatype">ConsistentBlockchain</a> <a id="3134" href="Bitcoin.Consistency.html#764" class="Generalizable">txs</a>
         <a id="3147" class="Symbol">→</a> <a id="3149" class="Symbol">(</a><a id="3150" href="Bitcoin.Consistency.html#3150" class="Bound">tx</a> <a id="3153" class="Symbol">:</a> <a id="3155" href="Bitcoin.Tx.Base.html#1114" class="Record">Tx</a> <a id="3158" href="Bitcoin.Tx.Base.html#2199" class="Generalizable">i</a> <a id="3160" href="Bitcoin.Tx.Base.html#2204" class="Generalizable">o</a><a id="3161" class="Symbol">)</a>
         <a id="3172" class="Symbol">→</a> <a id="3174" href="Bitcoin.Consistency.html#764" class="Generalizable">txs</a> <a id="3178" href="Bitcoin.Consistency.html#1622" class="Record Operator">▷</a> <a id="3180" href="Bitcoin.Consistency.html#3150" class="Bound">tx</a> <a id="3183" href="Bitcoin.Consistency.html#1622" class="Record Operator">,</a> <a id="3185" href="Bitcoin.BasicTypes.html#300" class="Generalizable">t</a>
         <a id="3196" class="Symbol">→</a> <a id="3198" href="Bitcoin.Consistency.html#2912" class="Datatype">ConsistentBlockchain</a> <a id="3219" class="Symbol">(((</a><a id="3222" href="Data.Product.html#2256" class="Function Operator">-,</a> <a id="3225" href="Data.Product.html#2256" class="Function Operator">-,</a> <a id="3228" href="Bitcoin.Consistency.html#3150" class="Bound">tx</a><a id="3230" class="Symbol">)</a> <a id="3232" href="Bitcoin.Tx.Base.html#2667" class="InductiveConstructor Operator">at</a> <a id="3235" href="Bitcoin.BasicTypes.html#300" class="Generalizable">t</a><a id="3236" class="Symbol">)</a> <a id="3238" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3240" href="Bitcoin.Consistency.html#764" class="Generalizable">txs</a><a id="3243" class="Symbol">)</a>

<a id="3246" class="Comment">-- (1) Non-constructive/indirect formulation of the UTXO set, via describing when an output is unspent.</a>
<a id="Unspent"></a><a id="3350" href="Bitcoin.Consistency.html#3350" class="Function">Unspent</a> <a id="3358" class="Symbol">:</a> <a id="3360" class="Symbol">(</a><a id="3361" href="Bitcoin.Consistency.html#3361" class="Bound">b</a> <a id="3363" class="Symbol">:</a> <a id="3365" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a><a id="3375" class="Symbol">)</a> <a id="3377" class="Symbol">→</a> <a id="3379" class="Symbol">(</a><a id="3380" href="Bitcoin.Consistency.html#3380" class="Bound">i</a> <a id="3382" class="Symbol">:</a> <a id="3384" href="Prelude.Lists.Indexed.html#492" class="Function">Index</a> <a id="3390" href="Bitcoin.Consistency.html#3361" class="Bound">b</a><a id="3391" class="Symbol">)</a> <a id="3393" class="Symbol">→</a> <a id="3395" class="Keyword">let</a> <a id="3399" class="Symbol">(_</a> <a id="3402" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3404" href="Bitcoin.Consistency.html#3404" class="Bound">o</a> <a id="3406" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3408" href="Bitcoin.Consistency.html#3408" class="Bound">Tᵢ</a><a id="3410" class="Symbol">)</a> <a id="3412" class="InductiveConstructor Operator">at</a> <a id="3415" href="Bitcoin.Consistency.html#3415" class="Bound">tᵢ</a> <a id="3418" class="Symbol">=</a> <a id="3420" href="Bitcoin.Consistency.html#3361" class="Bound">b</a> <a id="3422" href="Prelude.Lists.Indexed.html#600" class="Function Operator">‼</a> <a id="3424" href="Bitcoin.Consistency.html#3380" class="Bound">i</a> <a id="3426" class="Keyword">in</a>
        <a id="3437" class="Symbol">∀</a> <a id="3439" class="Symbol">(</a><a id="3440" href="Bitcoin.Consistency.html#3440" class="Bound">j</a> <a id="3442" class="Symbol">:</a> <a id="3444" href="Data.Fin.Base.html#1135" class="Datatype">Fin</a> <a id="3448" href="Bitcoin.Consistency.html#3404" class="Bound">o</a><a id="3449" class="Symbol">)</a> <a id="3451" class="Symbol">→</a> <a id="3453" href="Agda.Primitive.html#320" class="Primitive">Type</a>
<a id="3458" href="Bitcoin.Consistency.html#3350" class="Function">Unspent</a> <a id="3466" href="Bitcoin.Consistency.html#3466" class="Bound">b</a> <a id="3468" href="Bitcoin.Consistency.html#3468" class="Bound">i</a> <a id="3470" href="Bitcoin.Consistency.html#3470" class="Bound">j</a> <a id="3472" class="Symbol">=</a>
  <a id="3476" class="Keyword">let</a> <a id="3480" class="Symbol">(_</a> <a id="3483" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3485" href="Bitcoin.Consistency.html#3485" class="Bound">o</a> <a id="3487" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3489" href="Bitcoin.Consistency.html#3489" class="Bound">Tᵢ</a><a id="3491" class="Symbol">)</a> <a id="3493" href="Bitcoin.Tx.Base.html#2667" class="InductiveConstructor Operator">at</a> <a id="3496" href="Bitcoin.Consistency.html#3496" class="Bound">tᵢ</a> <a id="3499" class="Symbol">=</a> <a id="3501" href="Bitcoin.Consistency.html#3466" class="Bound">b</a> <a id="3503" href="Prelude.Lists.Indexed.html#600" class="Function Operator">‼</a> <a id="3505" href="Bitcoin.Consistency.html#3468" class="Bound">i</a> <a id="3507" class="Keyword">in</a>
  <a id="3512" class="Symbol">∀</a> <a id="3514" class="Symbol">(</a><a id="3515" href="Bitcoin.Consistency.html#3515" class="Bound">i′</a> <a id="3518" class="Symbol">:</a> <a id="3520" href="Prelude.Lists.Indexed.html#492" class="Function">Index</a> <a id="3526" href="Bitcoin.Consistency.html#3466" class="Bound">b</a><a id="3527" class="Symbol">)</a> <a id="3529" class="Symbol">(</a><a id="3530" href="Bitcoin.Consistency.html#3530" class="Bound">leq</a> <a id="3534" class="Symbol">:</a> <a id="3536" href="Bitcoin.Consistency.html#3515" class="Bound">i′</a> <a id="3539" href="Data.Fin.Base.html#7193" class="Function Operator">F.≤</a> <a id="3543" href="Bitcoin.Consistency.html#3468" class="Bound">i</a><a id="3544" class="Symbol">)</a>  <a id="3547" class="Symbol">→</a> <a id="3549" class="Keyword">let</a> <a id="3553" class="Symbol">(</a><a id="3554" href="Bitcoin.Consistency.html#3554" class="Bound">i′</a> <a id="3557" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3559" class="Symbol">_</a> <a id="3561" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3563" href="Bitcoin.Consistency.html#3563" class="Bound">Tᵢ′</a><a id="3566" class="Symbol">)</a> <a id="3568" href="Bitcoin.Tx.Base.html#2667" class="InductiveConstructor Operator">at</a> <a id="3571" href="Bitcoin.Consistency.html#3571" class="Bound">tᵢ′</a> <a id="3575" class="Symbol">=</a> <a id="3577" href="Bitcoin.Consistency.html#3466" class="Bound">b</a> <a id="3579" href="Prelude.Lists.Indexed.html#600" class="Function Operator">‼</a> <a id="3581" href="Bitcoin.Consistency.html#3515" class="Bound">i′</a> <a id="3584" class="Keyword">in</a>
  <a id="3589" class="Symbol">∀</a> <a id="3591" class="Symbol">(</a><a id="3592" href="Bitcoin.Consistency.html#3592" class="Bound">j′</a> <a id="3595" class="Symbol">:</a> <a id="3597" href="Data.Fin.Base.html#1135" class="Datatype">Fin</a> <a id="3601" href="Bitcoin.Consistency.html#3554" class="Bound">i′</a><a id="3603" class="Symbol">)</a> <a id="3605" class="Symbol">→</a>
    <a id="3611" href="Bitcoin.Consistency.html#3489" class="Bound">Tᵢ</a> <a id="3614" href="Bitcoin.Tx.Semantics.html#1147" class="Function Operator">,</a> <a id="3616" href="Bitcoin.Consistency.html#3470" class="Bound">j</a> <a id="3618" href="Bitcoin.Tx.Semantics.html#1147" class="Function Operator">,</a> <a id="3620" href="Bitcoin.Consistency.html#3496" class="Bound">tᵢ</a> <a id="3623" href="Bitcoin.Tx.Semantics.html#1147" class="Function Operator">↛</a> <a id="3625" href="Bitcoin.Consistency.html#3563" class="Bound">Tᵢ′</a> <a id="3629" href="Bitcoin.Tx.Semantics.html#1147" class="Function Operator">,</a> <a id="3631" href="Bitcoin.Consistency.html#3592" class="Bound">j′</a> <a id="3634" href="Bitcoin.Tx.Semantics.html#1147" class="Function Operator">,</a> <a id="3636" href="Bitcoin.Consistency.html#3571" class="Bound">tᵢ′</a>

<a id="Unspent-∷"></a><a id="3641" href="Bitcoin.Consistency.html#3641" class="Function">Unspent-∷</a> <a id="3651" class="Symbol">:</a> <a id="3653" class="Symbol">∀</a> <a id="3655" class="Symbol">{</a><a id="3656" href="Bitcoin.Consistency.html#3656" class="Bound">tx</a> <a id="3659" href="Bitcoin.Consistency.html#3659" class="Bound">t</a><a id="3660" class="Symbol">}</a> <a id="3662" class="Symbol">{</a><a id="3663" href="Bitcoin.Consistency.html#3663" class="Bound">b</a> <a id="3665" class="Symbol">:</a> <a id="3667" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a><a id="3677" class="Symbol">}</a> <a id="3679" class="Symbol">{</a><a id="3680" href="Bitcoin.Consistency.html#3680" class="Bound">i</a> <a id="3682" class="Symbol">:</a> <a id="3684" href="Prelude.Lists.Indexed.html#492" class="Function">Index</a> <a id="3690" href="Bitcoin.Consistency.html#3663" class="Bound">b</a><a id="3691" class="Symbol">}</a> <a id="3693" class="Symbol">→</a> <a id="3695" class="Keyword">let</a> <a id="3699" class="Symbol">(_</a> <a id="3702" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3704" href="Bitcoin.Consistency.html#3704" class="Bound">o</a> <a id="3706" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3708" href="Bitcoin.Consistency.html#3708" class="Bound">Tᵢ</a><a id="3710" class="Symbol">)</a> <a id="3712" class="InductiveConstructor Operator">at</a> <a id="3715" href="Bitcoin.Consistency.html#3715" class="Bound">tᵢ</a> <a id="3718" class="Symbol">=</a> <a id="3720" href="Bitcoin.Consistency.html#3663" class="Bound">b</a> <a id="3722" href="Prelude.Lists.Indexed.html#600" class="Function Operator">‼</a> <a id="3724" href="Bitcoin.Consistency.html#3680" class="Bound">i</a> <a id="3726" class="Keyword">in</a> <a id="3729" class="Symbol">∀</a> <a id="3731" class="Symbol">{</a><a id="3732" href="Bitcoin.Consistency.html#3732" class="Bound">j</a> <a id="3734" class="Symbol">:</a> <a id="3736" href="Data.Fin.Base.html#1135" class="Datatype">Fin</a> <a id="3740" href="Bitcoin.Consistency.html#3704" class="Bound">o</a><a id="3741" class="Symbol">}</a> <a id="3743" class="Symbol">→</a>
  <a id="3747" href="Prelude.InferenceRules.html#56141" class="Function Operator">∙</a> <a id="3749" href="Bitcoin.Consistency.html#3350" class="Function">Unspent</a> <a id="3757" href="Bitcoin.Consistency.html#3663" class="Bound">b</a> <a id="3759" href="Bitcoin.Consistency.html#3680" class="Bound">i</a> <a id="3761" href="Bitcoin.Consistency.html#3732" class="Bound">j</a>
  <a id="3765" href="Prelude.InferenceRules.html#56072" class="Function Operator">∙</a> <a id="3767" class="Symbol">(((</a><a id="3770" href="Bitcoin.Consistency.html#3708" class="Bound">Tᵢ</a> <a id="3773" href="Bitcoin.Tx.Crypto.html#1510" class="Function Operator">♯at</a> <a id="3777" href="Bitcoin.Consistency.html#3732" class="Bound">j</a><a id="3778" class="Symbol">)</a> <a id="3780" href="Data.Vec.Membership.Setoid.html#896" class="Function Operator">V.Mem.∉</a> <a id="3788" href="Bitcoin.Tx.Base.html#1542" class="Function">∃inputs</a> <a id="3796" href="Bitcoin.Consistency.html#3656" class="Bound">tx</a><a id="3798" class="Symbol">)</a>
    <a id="3804" href="Prelude.InferenceRules.html#12510" class="Function Operator">─────────────────────────────────────────────────────────</a>
    <a id="3866" href="Bitcoin.Consistency.html#3350" class="Function">Unspent</a> <a id="3874" class="Symbol">((</a><a id="3876" href="Bitcoin.Consistency.html#3656" class="Bound">tx</a> <a id="3879" class="InductiveConstructor Operator">at</a> <a id="3882" href="Bitcoin.Consistency.html#3659" class="Bound">t</a><a id="3883" class="Symbol">)</a> <a id="3885" class="InductiveConstructor Operator">∷</a> <a id="3887" href="Bitcoin.Consistency.html#3663" class="Bound">b</a><a id="3888" class="Symbol">)</a> <a id="3890" class="Symbol">(</a><a id="3891" href="Data.Fin.Base.html#1188" class="InductiveConstructor">fsuc</a> <a id="3896" href="Bitcoin.Consistency.html#3680" class="Bound">i</a><a id="3897" class="Symbol">)</a> <a id="3899" href="Bitcoin.Consistency.html#3732" class="Bound">j</a><a id="3900" class="Symbol">)</a>
<a id="3902" href="Bitcoin.Consistency.html#3641" class="Function">Unspent-∷</a> <a id="3912" class="Symbol">{</a><a id="3913" class="Argument">tx</a> <a id="3916" class="Symbol">=</a> <a id="3918" href="Bitcoin.Consistency.html#3918" class="Bound">tx</a><a id="3920" class="Symbol">}</a> <a id="3922" href="Bitcoin.Consistency.html#3922" class="Bound">unsp</a> <a id="3927" href="Bitcoin.Consistency.html#3927" class="Bound">in∉</a> <a id="3931" href="Data.Fin.Patterns.html#399" class="InductiveConstructor">0F</a> <a id="3934" href="Bitcoin.Consistency.html#3934" class="Bound">0≤</a> <a id="3937" href="Bitcoin.Consistency.html#3937" class="Bound">j′</a> <a id="3940" class="Symbol">(</a><a id="3941" href="Bitcoin.Consistency.html#3941" class="Bound">v</a> <a id="3943" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3945" class="Keyword">record</a> <a id="3952" class="Symbol">{</a><a id="3953" href="Bitcoin.Tx.Semantics.html#859" class="Field">input~output</a> <a id="3966" class="Symbol">=</a> <a id="3968" href="Bitcoin.Consistency.html#3968" class="Bound">io</a><a id="3970" class="Symbol">})</a>
  <a id="3975" class="Symbol">=</a> <a id="3977" href="Bitcoin.Consistency.html#3927" class="Bound">in∉</a> <a id="3981" class="Symbol">(</a><a id="3982" href="Relation.Binary.PropositionalEquality.Core.html#1789" class="Function">subst</a> <a id="3988" class="Symbol">(</a><a id="3989" href="Data.Vec.Membership.Setoid.html#838" class="Function Operator">V.Mem._∈</a> <a id="3998" href="Bitcoin.Tx.Base.html#1542" class="Function">∃inputs</a> <a id="4006" href="Bitcoin.Consistency.html#3918" class="Bound">tx</a><a id="4008" class="Symbol">)</a> <a id="4010" href="Bitcoin.Consistency.html#3968" class="Bound">io</a> <a id="4013" class="Symbol">(</a><a id="4014" href="Data.Vec.Membership.Propositional.Properties.html#1207" class="Function">V.Mem.∈-lookup</a> <a id="4029" href="Bitcoin.Consistency.html#3937" class="Bound">j′</a> <a id="4032" class="Symbol">_))</a>
<a id="4036" href="Bitcoin.Consistency.html#3641" class="Function">Unspent-∷</a> <a id="4046" href="Bitcoin.Consistency.html#4046" class="Bound">unsp</a> <a id="4051" class="Symbol">_</a> <a id="4053" class="Symbol">(</a><a id="4054" href="Data.Fin.Base.html#1188" class="InductiveConstructor">fsuc</a> <a id="4059" href="Bitcoin.Consistency.html#4059" class="Bound">i′</a><a id="4061" class="Symbol">)</a> <a id="4063" class="Symbol">(</a><a id="4064" href="Data.Nat.Base.html#1609" class="InductiveConstructor">s≤s</a> <a id="4068" href="Bitcoin.Consistency.html#4068" class="Bound">leq</a><a id="4071" class="Symbol">)</a> <a id="4073" href="Bitcoin.Consistency.html#4073" class="Bound">j′</a> <a id="4076" href="Bitcoin.Consistency.html#4076" class="Bound">p</a>
  <a id="4080" class="Symbol">=</a> <a id="4082" href="Bitcoin.Consistency.html#4046" class="Bound">unsp</a> <a id="4087" href="Bitcoin.Consistency.html#4059" class="Bound">i′</a> <a id="4090" href="Bitcoin.Consistency.html#4068" class="Bound">leq</a> <a id="4094" href="Bitcoin.Consistency.html#4073" class="Bound">j′</a> <a id="4097" href="Bitcoin.Consistency.html#4076" class="Bound">p</a>

<a id="4100" class="Comment">--</a>

<a id="∃Unspent"></a><a id="4104" href="Bitcoin.Consistency.html#4104" class="Function">∃Unspent</a> <a id="4113" class="Symbol">:</a> <a id="4115" class="Symbol">(</a><a id="4116" href="Bitcoin.Consistency.html#4116" class="Bound">b</a> <a id="4118" class="Symbol">:</a> <a id="4120" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a><a id="4130" class="Symbol">)</a> <a id="4132" class="Symbol">→</a> <a id="4134" href="Bitcoin.Tx.Base.html#857" class="Function">∃TxOutput</a> <a id="4144" class="Symbol">→</a> <a id="4146" href="Agda.Primitive.html#320" class="Primitive">Type</a>
<a id="4151" href="Bitcoin.Consistency.html#4104" class="Function">∃Unspent</a> <a id="4160" href="Bitcoin.Consistency.html#4160" class="Bound">b</a> <a id="4162" href="Bitcoin.Consistency.html#4162" class="Bound">txo</a> <a id="4166" class="Symbol">=</a>
  <a id="4170" href="Agda.Builtin.Sigma.html#148" class="Record">Σ</a> <a id="4172" class="Symbol">(</a><a id="4173" href="Prelude.Lists.Indexed.html#492" class="Function">Index</a> <a id="4179" href="Bitcoin.Consistency.html#4160" class="Bound">b</a><a id="4180" class="Symbol">)</a> <a id="4182" class="Symbol">λ</a> <a id="4184" href="Bitcoin.Consistency.html#4184" class="Bound">i</a> <a id="4186" class="Symbol">→</a>
    <a id="4192" class="Keyword">let</a> <a id="4196" class="Symbol">(_</a> <a id="4199" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4201" href="Bitcoin.Consistency.html#4201" class="Bound">o</a> <a id="4203" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4205" href="Bitcoin.Consistency.html#4205" class="Bound">Tᵢ</a><a id="4207" class="Symbol">)</a> <a id="4209" href="Bitcoin.Tx.Base.html#2667" class="InductiveConstructor Operator">at</a> <a id="4212" class="Symbol">_</a> <a id="4214" class="Symbol">=</a> <a id="4216" href="Bitcoin.Consistency.html#4160" class="Bound">b</a> <a id="4218" href="Prelude.Lists.Indexed.html#600" class="Function Operator">‼</a> <a id="4220" href="Bitcoin.Consistency.html#4184" class="Bound">i</a> <a id="4222" class="Keyword">in</a>
    <a id="4229" href="Agda.Builtin.Sigma.html#148" class="Record">Σ</a> <a id="4231" class="Symbol">(</a><a id="4232" href="Data.Fin.Base.html#1135" class="Datatype">Fin</a> <a id="4236" href="Bitcoin.Consistency.html#4201" class="Bound">o</a><a id="4237" class="Symbol">)</a> <a id="4239" class="Symbol">λ</a> <a id="4241" href="Bitcoin.Consistency.html#4241" class="Bound">j</a> <a id="4243" class="Symbol">→</a>
      <a id="4251" href="Bitcoin.Consistency.html#3350" class="Function">Unspent</a> <a id="4259" href="Bitcoin.Consistency.html#4160" class="Bound">b</a> <a id="4261" href="Bitcoin.Consistency.html#4184" class="Bound">i</a> <a id="4263" href="Bitcoin.Consistency.html#4241" class="Bound">j</a> <a id="4265" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="4267" class="Symbol">(</a><a id="4268" href="Bitcoin.Consistency.html#4205" class="Bound">Tᵢ</a> <a id="4271" href="Bitcoin.Tx.Base.html#2427" class="Function Operator">‼ᵒ</a> <a id="4274" href="Bitcoin.Consistency.html#4241" class="Bound">j</a> <a id="4276" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="4278" href="Bitcoin.Consistency.html#4162" class="Bound">txo</a><a id="4281" class="Symbol">)</a>

<a id="↝-irreflexive"></a><a id="4284" href="Bitcoin.Consistency.html#4284" class="Function">↝-irreflexive</a> <a id="4298" class="Symbol">:</a> <a id="4300" class="Symbol">∀</a> <a id="4302" class="Symbol">{</a><a id="4303" href="Bitcoin.Consistency.html#4303" class="Bound">T</a> <a id="4305" class="Symbol">:</a> <a id="4307" href="Bitcoin.Tx.Base.html#1114" class="Record">Tx</a> <a id="4310" href="Bitcoin.Tx.Base.html#2199" class="Generalizable">i</a> <a id="4312" href="Bitcoin.Tx.Base.html#2204" class="Generalizable">o</a><a id="4313" class="Symbol">}</a> <a id="4315" class="Symbol">{</a><a id="4316" href="Bitcoin.Consistency.html#4316" class="Bound">oᵢ</a> <a id="4319" class="Symbol">:</a> <a id="4321" href="Data.Fin.Base.html#1135" class="Datatype">Fin</a> <a id="4325" href="Bitcoin.Tx.Base.html#2204" class="Generalizable">o</a><a id="4326" class="Symbol">}</a> <a id="4328" class="Symbol">{</a><a id="4329" href="Bitcoin.Consistency.html#4329" class="Bound">iᵢ</a> <a id="4332" class="Symbol">:</a> <a id="4334" href="Data.Fin.Base.html#1135" class="Datatype">Fin</a> <a id="4338" href="Bitcoin.Tx.Base.html#2199" class="Generalizable">i</a><a id="4339" class="Symbol">}</a> <a id="4341" class="Symbol">{</a><a id="4342" href="Bitcoin.Consistency.html#4342" class="Bound">t₀</a> <a id="4345" href="Bitcoin.Consistency.html#4345" class="Bound">t</a> <a id="4347" href="Bitcoin.Consistency.html#4347" class="Bound">v</a> <a id="4349" href="Bitcoin.Consistency.html#4349" class="Bound">t′</a><a id="4351" class="Symbol">}</a>
  <a id="4355" class="Symbol">→</a> <a id="4357" href="Bitcoin.Consistency.html#2912" class="Datatype">ConsistentBlockchain</a> <a id="4378" href="Data.List.Base.html#5034" class="Function Operator">[</a> <a id="4380" class="Symbol">(</a><a id="4381" href="Data.Product.html#2256" class="Function Operator">-,</a> <a id="4384" href="Data.Product.html#2256" class="Function Operator">-,</a> <a id="4387" href="Bitcoin.Consistency.html#4303" class="Bound">T</a><a id="4388" class="Symbol">)</a> <a id="4390" class="InductiveConstructor Operator">at</a> <a id="4393" href="Bitcoin.Consistency.html#4342" class="Bound">t₀</a> <a id="4396" href="Data.List.Base.html#5034" class="Function Operator">]</a>
  <a id="4400" class="Symbol">→</a> <a id="4402" href="Relation.Nullary.html#665" class="Function Operator">¬</a> <a id="4404" class="Symbol">(</a><a id="4405" href="Bitcoin.Consistency.html#4303" class="Bound">T</a> <a id="4407" href="Bitcoin.Tx.Semantics.html#542" class="Record Operator">,</a> <a id="4409" href="Bitcoin.Consistency.html#4316" class="Bound">oᵢ</a> <a id="4412" href="Bitcoin.Tx.Semantics.html#542" class="Record Operator">,</a> <a id="4414" href="Bitcoin.Consistency.html#4345" class="Bound">t</a> <a id="4416" href="Bitcoin.Tx.Semantics.html#542" class="Record Operator">↝[</a> <a id="4419" href="Bitcoin.Consistency.html#4347" class="Bound">v</a> <a id="4421" href="Bitcoin.Tx.Semantics.html#542" class="Record Operator">]</a> <a id="4423" href="Bitcoin.Consistency.html#4303" class="Bound">T</a> <a id="4425" href="Bitcoin.Tx.Semantics.html#542" class="Record Operator">,</a> <a id="4427" href="Bitcoin.Consistency.html#4329" class="Bound">iᵢ</a> <a id="4430" href="Bitcoin.Tx.Semantics.html#542" class="Record Operator">,</a> <a id="4432" href="Bitcoin.Consistency.html#4349" class="Bound">t′</a><a id="4434" class="Symbol">)</a>
<a id="4436" href="Bitcoin.Consistency.html#4284" class="Function">↝-irreflexive</a> <a id="4450" class="Symbol">{</a><a id="4451" class="Argument">T</a> <a id="4453" class="Symbol">=</a> <a id="4455" href="Bitcoin.Consistency.html#4455" class="Bound">T</a><a id="4456" class="Symbol">}</a> <a id="4458" class="Symbol">{</a><a id="4459" class="Argument">iᵢ</a> <a id="4462" class="Symbol">=</a> <a id="4464" href="Bitcoin.Consistency.html#4464" class="Bound">iᵢ</a><a id="4466" class="Symbol">}</a> <a id="4468" class="Symbol">(</a><a id="4469" href="Bitcoin.Consistency.html#4469" class="Bound">∙</a> <a id="4471" href="Bitcoin.Consistency.html#3104" class="InductiveConstructor Operator">⊕</a> <a id="4473" class="DottedPattern Symbol">.</a><a id="4474" href="Bitcoin.Consistency.html#4455" class="DottedPattern Bound">T</a> <a id="4476" href="Bitcoin.Consistency.html#3104" class="InductiveConstructor Operator">∶-</a> <a id="4479" class="Keyword">record</a> <a id="4486" class="Symbol">{</a><a id="4487" href="Bitcoin.Consistency.html#2455" class="Field">inputs∈UTXO</a> <a id="4499" class="Symbol">=</a> <a id="4501" href="Bitcoin.Consistency.html#4501" class="Bound">i∈</a><a id="4503" class="Symbol">})</a> <a id="4506" class="Symbol">_</a> <a id="4508" class="Symbol">=</a> <a id="4510" href="Data.Empty.html#637" class="Function">⊥-elim</a> <a id="4517" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="4519" href="Prelude.Sets.AsUniqueLists.Core.html#3581" class="Function">∉∅</a> <a id="4522" class="Symbol">_</a> <a id="4524" class="Symbol">(</a><a id="4525" href="Bitcoin.Consistency.html#4501" class="Bound">i∈</a> <a id="4528" href="Bitcoin.Consistency.html#4464" class="Bound">iᵢ</a><a id="4530" class="Symbol">)</a>

<a id="4533" class="Comment">--</a>

<a id="∃Unspent-∷"></a><a id="4537" href="Bitcoin.Consistency.html#4537" class="Function">∃Unspent-∷</a> <a id="4548" class="Symbol">:</a> <a id="4550" class="Symbol">∀</a> <a id="4552" class="Symbol">{</a><a id="4553" href="Bitcoin.Consistency.html#4553" class="Bound">t</a> <a id="4555" href="Bitcoin.Consistency.html#4555" class="Bound">tx</a> <a id="4558" href="Bitcoin.Consistency.html#4558" class="Bound">b</a> <a id="4560" href="Bitcoin.Consistency.html#4560" class="Bound">o</a><a id="4561" class="Symbol">}</a> <a id="4563" class="Symbol">→</a>
  <a id="4567" href="Prelude.InferenceRules.html#56141" class="Function Operator">∙</a> <a id="4569" href="Bitcoin.Consistency.html#2912" class="Datatype">ConsistentBlockchain</a> <a id="4590" class="Symbol">((</a><a id="4592" href="Bitcoin.Consistency.html#4555" class="Bound">tx</a> <a id="4595" class="InductiveConstructor Operator">at</a> <a id="4598" href="Bitcoin.Consistency.html#4553" class="Bound">t</a><a id="4599" class="Symbol">)</a> <a id="4601" class="InductiveConstructor Operator">∷</a> <a id="4603" href="Bitcoin.Consistency.html#4558" class="Bound">b</a><a id="4604" class="Symbol">)</a>
  <a id="4608" class="Symbol">→</a> <a id="4610" class="Symbol">(</a><a id="4611" href="Bitcoin.Consistency.html#4611" class="Bound">wit</a> <a id="4615" class="Symbol">:</a> <a id="4617" href="Bitcoin.Consistency.html#4104" class="Function">∃Unspent</a> <a id="4626" href="Bitcoin.Consistency.html#4558" class="Bound">b</a> <a id="4628" href="Bitcoin.Consistency.html#4560" class="Bound">o</a><a id="4629" class="Symbol">)</a>
  <a id="4633" class="Symbol">→</a> <a id="4635" class="Keyword">let</a> <a id="4639" href="Bitcoin.Consistency.html#4639" class="Bound">i</a> <a id="4641" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4643" href="Bitcoin.Consistency.html#4643" class="Bound">j</a> <a id="4645" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4647" class="Symbol">_</a> <a id="4649" class="Symbol">=</a> <a id="4651" href="Bitcoin.Consistency.html#4611" class="Bound">wit</a><a id="4654" class="Symbol">;</a> <a id="4656" class="Symbol">(_</a> <a id="4659" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4661" class="Symbol">_</a> <a id="4663" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4665" href="Bitcoin.Consistency.html#4665" class="Bound">Tᵢ</a><a id="4667" class="Symbol">)</a> <a id="4669" class="InductiveConstructor Operator">at</a> <a id="4672" class="Symbol">_</a> <a id="4674" class="Symbol">=</a> <a id="4676" href="Bitcoin.Consistency.html#4558" class="Bound">b</a> <a id="4678" href="Prelude.Lists.Indexed.html#600" class="Function Operator">‼</a> <a id="4680" href="Bitcoin.Consistency.html#4639" class="Bound">i</a> <a id="4682" class="Keyword">in</a>
  <a id="4687" href="Prelude.InferenceRules.html#56141" class="Function Operator">∙</a> <a id="4689" class="Symbol">(</a><a id="4690" href="Bitcoin.Consistency.html#4665" class="Bound">Tᵢ</a> <a id="4693" href="Bitcoin.Tx.Crypto.html#1510" class="Function Operator">♯at</a> <a id="4697" href="Bitcoin.Consistency.html#4643" class="Bound">j</a> <a id="4699" href="Data.Vec.Membership.Setoid.html#896" class="Function Operator">V.Mem.∉</a> <a id="4707" href="Bitcoin.Tx.Base.html#1542" class="Function">∃inputs</a> <a id="4715" href="Bitcoin.Consistency.html#4555" class="Bound">tx</a><a id="4717" class="Symbol">)</a>
    <a id="4723" href="Prelude.InferenceRules.html#12510" class="Function Operator">─────────────────────────────────────────────────────────</a>
    <a id="4785" href="Bitcoin.Consistency.html#4104" class="Function">∃Unspent</a> <a id="4794" class="Symbol">((</a><a id="4796" href="Bitcoin.Consistency.html#4555" class="Bound">tx</a> <a id="4799" class="InductiveConstructor Operator">at</a> <a id="4802" href="Bitcoin.Consistency.html#4553" class="Bound">t</a><a id="4803" class="Symbol">)</a> <a id="4805" class="InductiveConstructor Operator">∷</a> <a id="4807" href="Bitcoin.Consistency.html#4558" class="Bound">b</a><a id="4808" class="Symbol">)</a> <a id="4810" href="Bitcoin.Consistency.html#4560" class="Bound">o</a>
<a id="4812" href="Bitcoin.Consistency.html#4537" class="Function">∃Unspent-∷</a> <a id="4823" href="Bitcoin.Consistency.html#4823" class="Bound">vb</a> <a id="4826" class="Symbol">(</a><a id="4827" href="Bitcoin.Consistency.html#4827" class="Bound">i</a> <a id="4829" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4831" href="Bitcoin.Consistency.html#4831" class="Bound">j</a> <a id="4833" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4835" href="Bitcoin.Consistency.html#4835" class="Bound">p</a> <a id="4837" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4839" href="Bitcoin.Consistency.html#4839" class="Bound">o≡</a><a id="4841" class="Symbol">)</a> <a id="4843" href="Bitcoin.Consistency.html#4843" class="Bound">in∉</a> <a id="4847" class="Symbol">=</a> <a id="4849" href="Data.Fin.Base.html#1188" class="InductiveConstructor">fsuc</a> <a id="4854" href="Bitcoin.Consistency.html#4827" class="Bound">i</a> <a id="4856" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4858" href="Bitcoin.Consistency.html#4831" class="Bound">j</a> <a id="4860" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4862" href="Bitcoin.Consistency.html#3641" class="Function">Unspent-∷</a> <a id="4872" href="Bitcoin.Consistency.html#4835" class="Bound">p</a> <a id="4874" href="Bitcoin.Consistency.html#4843" class="Bound">in∉</a> <a id="4878" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4880" href="Bitcoin.Consistency.html#4839" class="Bound">o≡</a>

<a id="4884" class="Comment">-- (2) Alternative set-theoretic/constructive formulation of the UTXO set, similar to the one in EUTXO.</a>
<a id="stxo"></a><a id="4988" href="Bitcoin.Consistency.html#4988" class="Function">stxo</a> <a id="4993" class="Symbol">:</a> <a id="4995" class="Symbol">∀</a> <a id="4997" class="Symbol">{</a><a id="4998" href="Bitcoin.Consistency.html#4998" class="Bound">tx</a> <a id="5001" href="Bitcoin.Consistency.html#5001" class="Bound">b</a> <a id="5003" href="Bitcoin.Consistency.html#5003" class="Bound">t</a><a id="5004" class="Symbol">}</a> <a id="5006" class="Symbol">→</a> <a id="5008" href="Bitcoin.Consistency.html#2912" class="Datatype">ConsistentBlockchain</a> <a id="5029" class="Symbol">((</a><a id="5031" href="Bitcoin.Consistency.html#4998" class="Bound">tx</a> <a id="5034" class="InductiveConstructor Operator">at</a> <a id="5037" href="Bitcoin.Consistency.html#5003" class="Bound">t</a><a id="5038" class="Symbol">)</a> <a id="5040" class="InductiveConstructor Operator">∷</a> <a id="5042" href="Bitcoin.Consistency.html#5001" class="Bound">b</a><a id="5043" class="Symbol">)</a> <a id="5045" class="Symbol">→</a> <a id="5047" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="5052" href="Bitcoin.Tx.Base.html#857" class="Function">∃TxOutput</a>
<a id="5062" href="Bitcoin.Consistency.html#4988" class="Function">stxo</a> <a id="5067" class="Symbol">{</a><a id="5068" class="Argument">tx</a> <a id="5071" class="Symbol">=</a> <a id="5073" href="Bitcoin.Consistency.html#5073" class="Bound">i</a> <a id="5075" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5077" class="Symbol">_</a> <a id="5079" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5081" class="Symbol">_}</a> <a id="5084" class="Symbol">(_</a> <a id="5087" href="Bitcoin.Consistency.html#3104" class="InductiveConstructor Operator">⊕</a> <a id="5089" href="Bitcoin.Consistency.html#5089" class="Bound">tx</a> <a id="5092" href="Bitcoin.Consistency.html#3104" class="InductiveConstructor Operator">∶-</a> <a id="5095" href="Bitcoin.Consistency.html#5095" class="Bound">p</a><a id="5096" class="Symbol">)</a>
  <a id="5100" class="Symbol">=</a> <a id="5102" href="Data.List.Base.html#1553" class="Function">map</a> <a id="5106" href="Bitcoin.Consistency.html#5145" class="Function">f</a> <a id="5108" class="Symbol">(</a><a id="5109" href="Data.List.Base.html#6333" class="Function">allFin</a> <a id="5116" href="Bitcoin.Consistency.html#5073" class="Bound">i</a><a id="5117" class="Symbol">)</a>
  <a id="5121" class="Keyword">module</a> <a id="∣stxo∣"></a><a id="5128" href="Bitcoin.Consistency.html#5128" class="Module">∣stxo∣</a> <a id="5135" class="Keyword">where</a>
    <a id="∣stxo∣.f"></a><a id="5145" href="Bitcoin.Consistency.html#5145" class="Function">f</a> <a id="5147" class="Symbol">:</a> <a id="5149" href="Data.Fin.Base.html#1135" class="Datatype">Fin</a> <a id="5153" href="Bitcoin.Consistency.html#5073" class="Bound">i</a> <a id="5155" class="Symbol">→</a> <a id="5157" href="Bitcoin.Tx.Base.html#857" class="Function">∃TxOutput</a>
    <a id="5171" href="Bitcoin.Consistency.html#5145" class="Function">f</a> <a id="5173" href="Bitcoin.Consistency.html#5173" class="Bound">i</a> <a id="5175" class="Symbol">=</a>
      <a id="5183" class="Keyword">let</a>
        <a id="5195" class="Keyword">record</a> <a id="5202" class="Symbol">{</a><a id="5203" href="Bitcoin.Consistency.html#1786" class="Field">singleMatch</a> <a id="5215" class="Symbol">=</a> <a id="5217" href="Bitcoin.Consistency.html#5217" class="Bound">singleMatch</a><a id="5228" class="Symbol">;</a> <a id="5230" href="Bitcoin.Consistency.html#1916" class="Field">noOutOfBounds</a> <a id="5244" class="Symbol">=</a> <a id="5246" href="Bitcoin.Consistency.html#5246" class="Bound">noOutOfBounds</a><a id="5259" class="Symbol">}</a> <a id="5261" class="Symbol">=</a> <a id="5263" href="Bitcoin.Consistency.html#5095" class="Bound">p</a>
        <a id="5273" class="Symbol">(_</a> <a id="5276" href="Bitcoin.Tx.Base.html#394" class="InductiveConstructor Operator">at</a> <a id="5279" href="Bitcoin.Consistency.html#5279" class="Bound">oᵢ</a><a id="5281" class="Symbol">)</a> <a id="5283" class="Symbol">=</a> <a id="5285" href="Bitcoin.Consistency.html#5089" class="Bound">tx</a> <a id="5288" href="Bitcoin.Tx.Base.html#2230" class="Function Operator">‼ⁱ</a> <a id="5291" href="Bitcoin.Consistency.html#5173" class="Bound">i</a>
        <a id="5301" class="Symbol">(((_</a> <a id="5306" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5308" href="Bitcoin.Consistency.html#5308" class="Bound">o</a> <a id="5310" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5312" href="Bitcoin.Consistency.html#5312" class="Bound">Tᵢ</a><a id="5314" class="Symbol">)</a> <a id="5316" href="Bitcoin.Tx.Base.html#2667" class="InductiveConstructor Operator">at</a> <a id="5319" href="Bitcoin.Consistency.html#5319" class="Bound">tᵢ</a><a id="5321" class="Symbol">)</a> <a id="5323" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5325" class="Symbol">_)</a> <a id="5328" class="Symbol">=</a> <a id="5330" href="Bitcoin.Consistency.html#5217" class="Bound">singleMatch</a> <a id="5342" href="Bitcoin.Consistency.html#5173" class="Bound">i</a>
        <a id="5352" href="Bitcoin.Consistency.html#5352" class="Bound">oᵢ</a> <a id="5355" class="Symbol">=</a> <a id="5357" href="Data.Fin.Base.html#1982" class="Function">F.fromℕ&lt;</a> <a id="5366" class="Symbol">{</a><a id="5367" class="Argument">m</a> <a id="5369" class="Symbol">=</a> <a id="5371" href="Bitcoin.Consistency.html#5279" class="Bound">oᵢ</a><a id="5373" class="Symbol">}</a> <a id="5375" class="Symbol">{</a><a id="5376" class="Argument">n</a> <a id="5378" class="Symbol">=</a> <a id="5380" href="Bitcoin.Consistency.html#5308" class="Bound">o</a><a id="5381" class="Symbol">}</a> <a id="5383" class="Symbol">(</a><a id="5384" href="Bitcoin.Consistency.html#5246" class="Bound">noOutOfBounds</a> <a id="5398" href="Bitcoin.Consistency.html#5173" class="Bound">i</a><a id="5399" class="Symbol">)</a>
      <a id="5407" class="Keyword">in</a>
        <a id="5418" href="Bitcoin.Consistency.html#5312" class="Bound">Tᵢ</a> <a id="5421" href="Bitcoin.Tx.Base.html#2427" class="Function Operator">‼ᵒ</a> <a id="5424" href="Bitcoin.Consistency.html#5352" class="Bound">oᵢ</a>

<a id="utxoₜₓ"></a><a id="5428" href="Bitcoin.Consistency.html#5428" class="Function">utxoₜₓ</a> <a id="5435" class="Symbol">:</a> <a id="5437" href="Bitcoin.Tx.Base.html#1467" class="Function">∃Tx</a> <a id="5441" class="Symbol">→</a> <a id="5443" href="Prelude.Sets.AsUniqueLists.Core.html#1017" class="Record">Set⟨</a> <a id="5448" href="Bitcoin.Tx.Base.html#857" class="Function">∃TxOutput</a> <a id="5458" href="Prelude.Sets.AsUniqueLists.Core.html#1017" class="Record">⟩</a>
<a id="5460" href="Bitcoin.Consistency.html#5428" class="Function">utxoₜₓ</a> <a id="5467" class="Symbol">(_</a> <a id="5470" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5472" class="Symbol">_</a> <a id="5474" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5476" href="Bitcoin.Consistency.html#5476" class="Bound">tx</a><a id="5478" class="Symbol">)</a> <a id="5480" class="Symbol">=</a> <a id="5482" href="Bitcoin.Consistency.html#5476" class="Bound">tx</a> <a id="5485" class="Symbol">.</a><a id="5486" href="Bitcoin.Tx.Base.html#1302" class="Field">outputs</a> <a id="5494" href="Prelude.ToList.html#215" class="Function Operator">∙toList</a> <a id="5502" href="Prelude.FromList.html#221" class="Function Operator">∙fromList</a>

<a id="utxo"></a><a id="5513" href="Bitcoin.Consistency.html#5513" class="Function">utxo</a> <a id="5518" class="Symbol">:</a> <a id="5520" class="Symbol">(</a><a id="5521" href="Bitcoin.Consistency.html#5521" class="Bound">b</a> <a id="5523" class="Symbol">:</a> <a id="5525" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a><a id="5535" class="Symbol">)</a> <a id="5537" class="Symbol">→</a> <a id="5539" href="Bitcoin.Consistency.html#2912" class="Datatype">ConsistentBlockchain</a> <a id="5560" href="Bitcoin.Consistency.html#5521" class="Bound">b</a> <a id="5562" class="Symbol">→</a> <a id="5564" href="Prelude.Sets.AsUniqueLists.Core.html#1017" class="Record">Set⟨</a> <a id="5569" href="Bitcoin.Tx.Base.html#857" class="Function">∃TxOutput</a> <a id="5579" href="Prelude.Sets.AsUniqueLists.Core.html#1017" class="Record">⟩</a>
<a id="5581" href="Bitcoin.Consistency.html#5513" class="Function">utxo</a> <a id="5586" class="DottedPattern Symbol">.</a><a id="5587" href="Agda.Builtin.List.html#167" class="DottedPattern InductiveConstructor">[]</a> <a id="5590" href="Bitcoin.Consistency.html#3072" class="InductiveConstructor">∎</a> <a id="5592" class="Symbol">=</a> <a id="5594" href="Prelude.Sets.AsUniqueLists.Core.html#2842" class="InductiveConstructor">∅</a>
<a id="5596" href="Bitcoin.Consistency.html#5513" class="Function">utxo</a> <a id="5601" class="Symbol">(</a><a id="5602" class="DottedPattern Symbol">.((_</a> <a id="5607" href="Agda.Builtin.Sigma.html#218" class="DottedPattern InductiveConstructor Operator">,</a> <a id="5609" class="DottedPattern Symbol">_</a> <a id="5611" href="Agda.Builtin.Sigma.html#218" class="DottedPattern InductiveConstructor Operator">,</a> <a id="5613" href="Bitcoin.Consistency.html#5638" class="DottedPattern Bound">tx</a><a id="5615" class="DottedPattern Symbol">)</a> <a id="5617" href="Bitcoin.Tx.Base.html#2667" class="DottedPattern InductiveConstructor Operator">at</a> <a id="5620" class="DottedPattern Symbol">_)</a> <a id="5623" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5625" href="Bitcoin.Consistency.html#5625" class="Bound">b</a><a id="5626" class="Symbol">)</a> <a id="5628" href="Bitcoin.Consistency.html#5628" class="Bound">vb₀</a><a id="5631" class="Symbol">@(</a><a id="5633" href="Bitcoin.Consistency.html#5633" class="Bound">vb</a> <a id="5636" href="Bitcoin.Consistency.html#3104" class="InductiveConstructor Operator">⊕</a> <a id="5638" href="Bitcoin.Consistency.html#5638" class="Bound">tx</a> <a id="5641" href="Bitcoin.Consistency.html#3104" class="InductiveConstructor Operator">∶-</a> <a id="5644" class="Symbol">_)</a>
  <a id="5649" class="Symbol">=</a> <a id="5651" href="Bitcoin.Consistency.html#5513" class="Function">utxo</a> <a id="5656" href="Bitcoin.Consistency.html#5625" class="Bound">b</a> <a id="5658" href="Bitcoin.Consistency.html#5633" class="Bound">vb</a> <a id="5661" href="Prelude.Sets.AsUniqueLists.Core.html#3168" class="Function Operator">─</a> <a id="5663" href="Prelude.FromList.html#197" class="Field">fromList</a> <a id="5672" class="Symbol">(</a><a id="5673" href="Bitcoin.Consistency.html#4988" class="Function">stxo</a> <a id="5678" href="Bitcoin.Consistency.html#5628" class="Bound">vb₀</a><a id="5681" class="Symbol">)</a>
  <a id="5685" href="Prelude.Sets.AsUniqueLists.Core.html#3160" class="Function Operator">∪</a> <a id="5687" href="Bitcoin.Consistency.html#5428" class="Function">utxoₜₓ</a> <a id="5694" class="Symbol">(</a><a id="5695" href="Data.Product.html#2256" class="Function Operator">-,</a> <a id="5698" href="Data.Product.html#2256" class="Function Operator">-,</a> <a id="5701" href="Bitcoin.Consistency.html#5638" class="Bound">tx</a><a id="5703" class="Symbol">)</a>

<a id="5706" class="Comment">-- T0D0: prove equivalence between (1) and (2)</a>

<a id="5754" class="Comment">-- Unspent : (b : Blockchain) → (i : Index b) → let (_ , o , Tᵢ) at tᵢ = b ‼ i in ∀ (j : Fin o) → Type</a>
<a id="5857" class="Comment">-- utxo : (b : Blockchain) → ConsistentBlockchain b → Set⟨ ∃TxOutput ⟩</a>
<a id="5928" class="Comment">-- UTXO : Blockchain → Set⟨ TxInput ⟩</a>

<a id="5967" class="Comment">{-
Unspent→UTXO : ∀ {b : Blockchain} {i : Index b} → let _ , o , tx = transaction (b ‼ i) in
               ∀ {j : Fin o}
  → Unspent b i j
    ─────────────────────────────────────────────────────────
    ((tx ♯) at toℕ j) ∈ˢ UTXO b
Unspent→UTXO {b} {i} {j} p = {!!}

UTXO→Unspent : ∀ {b : Blockchain} {i : Index b} → let _ , o , tx = transaction (b ‼ i) in
               ∀ {j : Fin o}
  → ((tx ♯) at toℕ j) ∈ˢ UTXO b
    ─────────────────────────────────────────────────────────
    Unspent b i j
UTXO→Unspent {x ∷ b} {i} {j} p = {!!}
-}</a>

<a id="6509" class="Comment">{- WIP
-- record BlockchainTx : Type where
--   field
--     b : Blockchain
--     i : Index b

--   getTTx : TimedTx
--   getTTx = b ‼ i

--   getTx : ∃Tx
--   getTx = transaction (getTTx b)

-- BlockchainTx = Σ[ b ∈ Blockchain ] Index b

-- getTTx : BlockchainTx → TimedTx
-- getTTx (b , i) = b ‼ i

-- getTx : BlockchainTx → ∃Tx
-- getTx = transaction ∘ getTTx

-- Unspent : (btx : BlockchainTx) →  Pred₀ (Fin $ ∃o $ getTx btx)
-- Unspent (b , i) j =
--   let (_ , o , Tᵢ) at tᵢ = b ‼ i in
--   ∀ (i′ : Index b) (leq : i′ F.≤ i) → let (i′ , _ , Tᵢ′) at tᵢ′ = b ‼ i′ in
--   ∀ (j′ : Fin i′) →
--     Tᵢ , j , tᵢ ↛ Tᵢ′ , j′ , tᵢ′
-}</a>
</pre></body></html>