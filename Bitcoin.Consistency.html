<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Bitcoin.Consistency</title><link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.3/gh-fork-ribbon.min.css'/><style>.github-fork-ribbon:before { background-color: #333; }</style><link rel="stylesheet" href="css/Agda.css"></head><body><a class='github-fork-ribbon'href='https://github.com/omelkonian/formal-bitcoin/tree/master/Bitcoin/Consistency.agda'data-ribbon='Source code on Github' title='Source code on Github'>Source code on Github</a><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- Blockchain and consistency.</a>
<a id="105" class="Comment">------------------------------------------------------------------------</a>
<a id="178" class="Keyword">module</a> <a id="185" href="Bitcoin.Consistency.html" class="Module">Bitcoin.Consistency</a> <a id="205" class="Keyword">where</a>

<a id="212" class="Keyword">open</a> <a id="217" class="Keyword">import</a> <a id="224" href="Prelude.Init.html" class="Module">Prelude.Init</a><a id="236" class="Symbol">;</a> <a id="238" class="Keyword">open</a> <a id="243" href="Prelude.Init.html#504" class="Module">SetAsType</a>
<a id="253" class="Keyword">open</a> <a id="258" class="Keyword">import</a> <a id="265" href="Prelude.General.html" class="Module">Prelude.General</a>
<a id="281" class="Keyword">open</a> <a id="286" class="Keyword">import</a> <a id="293" href="Prelude.Lists.html" class="Module">Prelude.Lists</a>
<a id="307" class="Keyword">open</a> <a id="312" class="Keyword">import</a> <a id="319" href="Prelude.DecEq.html" class="Module">Prelude.DecEq</a>
<a id="333" class="Keyword">open</a> <a id="338" class="Keyword">import</a> <a id="345" href="Prelude.Sets.html" class="Module">Prelude.Sets</a>
<a id="358" class="Keyword">open</a> <a id="363" class="Keyword">import</a> <a id="370" href="Prelude.Functor.html" class="Module">Prelude.Functor</a>
<a id="386" class="Keyword">open</a> <a id="391" class="Keyword">import</a> <a id="398" href="Prelude.ToN.html" class="Module">Prelude.ToN</a>
<a id="410" class="Keyword">open</a> <a id="415" class="Keyword">import</a> <a id="422" href="Prelude.Ord.html" class="Module">Prelude.Ord</a>
<a id="434" class="Keyword">open</a> <a id="439" class="Keyword">import</a> <a id="446" href="Prelude.InferenceRules.html" class="Module">Prelude.InferenceRules</a>
<a id="469" class="Keyword">open</a> <a id="474" class="Keyword">import</a> <a id="481" href="Prelude.FromList.html" class="Module">Prelude.FromList</a><a id="497" class="Symbol">;</a> <a id="499" class="Keyword">open</a> <a id="504" class="Keyword">import</a> <a id="511" href="Prelude.ToList.html" class="Module">Prelude.ToList</a>

<a id="527" class="Keyword">open</a> <a id="532" class="Keyword">import</a> <a id="539" href="Bitcoin.Crypto.html" class="Module">Bitcoin.Crypto</a>
<a id="554" class="Keyword">open</a> <a id="559" class="Keyword">import</a> <a id="566" href="Bitcoin.BasicTypes.html" class="Module">Bitcoin.BasicTypes</a>
<a id="585" class="Keyword">open</a> <a id="590" class="Keyword">import</a> <a id="597" href="Bitcoin.Script.html" class="Module">Bitcoin.Script</a>
<a id="612" class="Keyword">open</a> <a id="617" class="Keyword">import</a> <a id="624" href="Bitcoin.Tx.html" class="Module">Bitcoin.Tx</a>

<a id="636" class="Comment">-- Blockchain</a>
<a id="Blockchain"></a><a id="650" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a> <a id="661" class="Symbol">:</a> <a id="663" href="Agda.Primitive.html#320" class="Primitive">Type</a>
<a id="668" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a> <a id="679" class="Symbol">=</a> <a id="681" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="686" href="Bitcoin.Tx.Base.html#2632" class="Record">TimedTx</a> <a id="694" class="Comment">-- in reverse chronological order, in contrast to the paper</a>

<a id="755" class="Keyword">variable</a> <a id="764" href="Bitcoin.Consistency.html#764" class="Generalizable">txs</a> <a id="768" href="Bitcoin.Consistency.html#768" class="Generalizable">txs′</a> <a id="773" class="Symbol">:</a> <a id="775" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a>

<a id="txSet"></a><a id="787" href="Bitcoin.Consistency.html#787" class="Function">txSet</a> <a id="793" class="Symbol">:</a> <a id="795" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a> <a id="806" class="Symbol">→</a> <a id="808" href="Prelude.Sets.AsUniqueLists.Core.html#1017" class="Record">Set⟨</a> <a id="813" href="Bitcoin.Tx.Base.html#2632" class="Record">TimedTx</a> <a id="821" href="Prelude.Sets.AsUniqueLists.Core.html#1017" class="Record">⟩</a>
<a id="823" href="Bitcoin.Consistency.html#787" class="Function">txSet</a> <a id="829" class="Symbol">=</a> <a id="831" href="Prelude.FromList.html#197" class="Field">fromList</a>

<a id="match"></a><a id="841" href="Bitcoin.Consistency.html#841" class="Function">match</a> <a id="847" class="Symbol">:</a> <a id="849" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a> <a id="860" class="Symbol">→</a> <a id="862" href="Bitcoin.BasicTypes.html#244" class="Function">HashId</a> <a id="869" class="Symbol">→</a> <a id="871" href="Prelude.Sets.AsUniqueLists.Core.html#1017" class="Record">Set⟨</a> <a id="876" href="Bitcoin.Tx.Base.html#2632" class="Record">TimedTx</a> <a id="884" href="Prelude.Sets.AsUniqueLists.Core.html#1017" class="Record">⟩</a>
<a id="886" href="Bitcoin.Consistency.html#841" class="Function">match</a> <a id="892" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>                              <a id="924" class="Symbol">_</a>   <a id="928" class="Symbol">=</a> <a id="930" href="Prelude.Sets.AsUniqueLists.Core.html#2842" class="InductiveConstructor">∅</a>
<a id="932" href="Bitcoin.Consistency.html#841" class="Function">match</a> <a id="938" class="Symbol">((</a><a id="940" href="Bitcoin.Consistency.html#940" class="Bound">∃tx</a><a id="943" class="Symbol">@(_</a> <a id="947" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="949" class="Symbol">_</a> <a id="951" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="953" href="Bitcoin.Consistency.html#953" class="Bound">tx</a><a id="955" class="Symbol">)</a> <a id="957" href="Bitcoin.Tx.Base.html#2667" class="InductiveConstructor Operator">at</a> <a id="960" href="Bitcoin.Consistency.html#960" class="Bound">t</a><a id="961" class="Symbol">)</a> <a id="963" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="965" href="Bitcoin.Consistency.html#965" class="Bound">txs</a><a id="968" class="Symbol">)</a> <a id="970" href="Bitcoin.Consistency.html#970" class="Bound">tx♯</a> <a id="974" class="Symbol">=</a>
  <a id="978" href="Data.Bool.Base.html#1292" class="Function Operator">if</a> <a id="981" href="Bitcoin.Consistency.html#953" class="Bound">tx</a> <a id="984" href="Bitcoin.Crypto.html#669" class="Postulate Operator">♯</a> <a id="986" href="Prelude.DecEq.Core.html#222" class="Function Operator">==</a> <a id="989" href="Bitcoin.Consistency.html#970" class="Bound">tx♯</a> <a id="993" href="Data.Bool.Base.html#1292" class="Function Operator">then</a>
    <a id="1002" href="Prelude.Sets.AsUniqueLists.Core.html#2855" class="Function">singleton</a> <a id="1012" class="Symbol">(</a><a id="1013" href="Bitcoin.Consistency.html#940" class="Bound">∃tx</a> <a id="1017" href="Bitcoin.Tx.Base.html#2667" class="InductiveConstructor Operator">at</a> <a id="1020" href="Bitcoin.Consistency.html#960" class="Bound">t</a><a id="1021" class="Symbol">)</a> <a id="1023" href="Prelude.Sets.AsUniqueLists.Core.html#3160" class="Function Operator">∪</a> <a id="1025" href="Bitcoin.Consistency.html#841" class="Function">match</a> <a id="1031" href="Bitcoin.Consistency.html#965" class="Bound">txs</a> <a id="1035" href="Bitcoin.Consistency.html#970" class="Bound">tx♯</a>
  <a id="1041" href="Data.Bool.Base.html#1292" class="Function Operator">else</a>
    <a id="1050" href="Bitcoin.Consistency.html#841" class="Function">match</a> <a id="1056" href="Bitcoin.Consistency.html#965" class="Bound">txs</a> <a id="1060" href="Bitcoin.Consistency.html#970" class="Bound">tx♯</a>

<a id="1065" class="Comment">-- UTXO: Unspent transaction outputs.</a>
<a id="1103" class="Comment">-- (0) EUTXO-like set-theoretic definition, based on txInputs instead of outputs for convenience</a>
<a id="UTXOₜₓ"></a><a id="1200" href="Bitcoin.Consistency.html#1200" class="Function">UTXOₜₓ</a> <a id="1207" class="Symbol">:</a> <a id="1209" href="Bitcoin.Tx.Base.html#1467" class="Function">∃Tx</a> <a id="1213" class="Symbol">→</a> <a id="1215" href="Prelude.Sets.AsUniqueLists.Core.html#1017" class="Record">Set⟨</a> <a id="1220" href="Bitcoin.Tx.Base.html#359" class="Record">TxInput</a> <a id="1228" href="Prelude.Sets.AsUniqueLists.Core.html#1017" class="Record">⟩</a>
<a id="1230" href="Bitcoin.Consistency.html#1200" class="Function">UTXOₜₓ</a> <a id="1237" class="Symbol">(_</a> <a id="1240" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1242" href="Bitcoin.Consistency.html#1242" class="Bound">o</a> <a id="1244" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1246" href="Bitcoin.Consistency.html#1246" class="Bound">tx</a><a id="1248" class="Symbol">)</a> <a id="1250" class="Symbol">=</a> <a id="1252" href="Prelude.FromList.html#197" class="Field">fromList</a> <a id="1261" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="1263" class="Symbol">(</a><a id="1264" href="Bitcoin.Consistency.html#1246" class="Bound">tx</a> <a id="1267" href="Bitcoin.Crypto.html#669" class="Postulate Operator">♯</a><a id="1268" class="Symbol">)</a> <a id="1270" href="Bitcoin.Tx.Base.html#394" class="InductiveConstructor Operator">at_</a> <a id="1274" href="Prelude.Functor.html#382" class="Field Operator">&lt;$&gt;</a> <a id="1278" href="Data.List.Base.html#6243" class="Function">upTo</a> <a id="1283" href="Bitcoin.Consistency.html#1242" class="Bound">o</a>

<a id="STXOₜₓ"></a><a id="1286" href="Bitcoin.Consistency.html#1286" class="Function">STXOₜₓ</a> <a id="1293" class="Symbol">:</a> <a id="1295" href="Bitcoin.Tx.Base.html#1467" class="Function">∃Tx</a> <a id="1299" class="Symbol">→</a> <a id="1301" href="Prelude.Sets.AsUniqueLists.Core.html#1017" class="Record">Set⟨</a> <a id="1306" href="Bitcoin.Tx.Base.html#359" class="Record">TxInput</a> <a id="1314" href="Prelude.Sets.AsUniqueLists.Core.html#1017" class="Record">⟩</a>
<a id="1316" href="Bitcoin.Consistency.html#1286" class="Function">STXOₜₓ</a> <a id="1323" class="Symbol">(_</a> <a id="1326" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1328" class="Symbol">_</a> <a id="1330" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="1332" href="Bitcoin.Consistency.html#1332" class="Bound">tx</a><a id="1334" class="Symbol">)</a> <a id="1336" class="Symbol">=</a> <a id="1338" href="Bitcoin.Consistency.html#1332" class="Bound">tx</a> <a id="1341" class="Symbol">.</a><a id="1342" href="Bitcoin.Tx.Base.html#1152" class="Field">inputs</a> <a id="1349" href="Prelude.ToList.html#215" class="Function Operator">∙toList</a> <a id="1357" href="Prelude.FromList.html#221" class="Function Operator">∙fromList</a>

<a id="UTXO"></a><a id="1368" href="Bitcoin.Consistency.html#1368" class="Function">UTXO</a> <a id="1373" class="Symbol">:</a> <a id="1375" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a> <a id="1386" class="Symbol">→</a> <a id="1388" href="Prelude.Sets.AsUniqueLists.Core.html#1017" class="Record">Set⟨</a> <a id="1393" href="Bitcoin.Tx.Base.html#359" class="Record">TxInput</a> <a id="1401" href="Prelude.Sets.AsUniqueLists.Core.html#1017" class="Record">⟩</a>
<a id="1403" href="Bitcoin.Consistency.html#1368" class="Function">UTXO</a> <a id="1408" class="Symbol">=</a> <a id="1410" class="Symbol">λ</a> <a id="1412" class="Keyword">where</a>
  <a id="1420" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>              <a id="1436" class="Symbol">→</a> <a id="1438" href="Prelude.Sets.AsUniqueLists.Core.html#2842" class="InductiveConstructor">∅</a>
  <a id="1442" class="Symbol">(</a><a id="1443" href="Bitcoin.Consistency.html#1443" class="Bound">tx</a> <a id="1446" href="Bitcoin.Tx.Base.html#2667" class="InductiveConstructor Operator">at</a> <a id="1449" class="Symbol">_</a> <a id="1451" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="1453" href="Bitcoin.Consistency.html#1453" class="Bound">txs</a><a id="1456" class="Symbol">)</a> <a id="1458" class="Symbol">→</a> <a id="1460" href="Bitcoin.Consistency.html#1368" class="Function">UTXO</a> <a id="1465" href="Bitcoin.Consistency.html#1453" class="Bound">txs</a> <a id="1469" href="Prelude.Sets.AsUniqueLists.Core.html#3168" class="Function Operator">─</a> <a id="1471" href="Bitcoin.Consistency.html#1286" class="Function">STXOₜₓ</a> <a id="1478" href="Bitcoin.Consistency.html#1443" class="Bound">tx</a>
                  <a id="1499" href="Prelude.Sets.AsUniqueLists.Core.html#3160" class="Function Operator">∪</a> <a id="1501" href="Bitcoin.Consistency.html#1200" class="Function">UTXOₜₓ</a> <a id="1508" href="Bitcoin.Consistency.html#1443" class="Bound">tx</a>

<a id="1512" class="Comment">-- Consistent update.</a>
<a id="latestTime"></a><a id="1534" href="Bitcoin.Consistency.html#1534" class="Function">latestTime</a> <a id="1545" class="Symbol">:</a> <a id="1547" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a> <a id="1558" class="Symbol">→</a> <a id="1560" href="Bitcoin.BasicTypes.html#233" class="Function">Time</a>
<a id="1565" href="Bitcoin.Consistency.html#1534" class="Function">latestTime</a> <a id="1576" class="Symbol">=</a> <a id="1578" class="Symbol">λ</a> <a id="1580" class="Keyword">where</a>
  <a id="1588" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>             <a id="1603" class="Symbol">→</a> <a id="1605" class="Number">0</a>
  <a id="1609" class="Symbol">((_</a> <a id="1613" href="Bitcoin.Tx.Base.html#2667" class="InductiveConstructor Operator">at</a> <a id="1616" href="Bitcoin.Consistency.html#1616" class="Bound">t</a><a id="1617" class="Symbol">)</a> <a id="1619" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="1621" class="Symbol">_)</a> <a id="1624" class="Symbol">→</a> <a id="1626" href="Bitcoin.Consistency.html#1616" class="Bound">t</a>

<a id="1629" class="Keyword">record</a> <a id="_▷_,_"></a><a id="1636" href="Bitcoin.Consistency.html#1636" class="Record Operator">_▷_,_</a> <a id="1642" class="Symbol">(</a><a id="1643" href="Bitcoin.Consistency.html#1643" class="Bound">txs</a> <a id="1647" class="Symbol">:</a> <a id="1649" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a><a id="1659" class="Symbol">)</a> <a id="1661" class="Symbol">(</a><a id="1662" href="Bitcoin.Consistency.html#1662" class="Bound">tx</a> <a id="1665" class="Symbol">:</a> <a id="1667" href="Bitcoin.Tx.Base.html#1114" class="Record">Tx</a> <a id="1670" href="Bitcoin.Tx.Base.html#2199" class="Generalizable">i</a> <a id="1672" href="Bitcoin.Tx.Base.html#2204" class="Generalizable">o</a><a id="1673" class="Symbol">)</a> <a id="1675" class="Symbol">(</a><a id="1676" href="Bitcoin.Consistency.html#1676" class="Bound">t</a> <a id="1678" class="Symbol">:</a> <a id="1680" href="Bitcoin.BasicTypes.html#233" class="Function">Time</a><a id="1684" class="Symbol">)</a> <a id="1686" class="Symbol">:</a> <a id="1688" href="Agda.Primitive.html#320" class="Primitive">Type</a> <a id="1693" class="Keyword">where</a>
  <a id="1701" class="Keyword">field</a>
    <a id="1711" class="Comment">-- well-formedness conditions</a>

    <a id="_▷_,_.inputsUnique"></a><a id="1746" href="Bitcoin.Consistency.html#1746" class="Field">inputsUnique</a> <a id="1759" class="Symbol">:</a>
      <a id="1767" href="Data.List.Relation.Unary.Unique.Setoid.html#728" class="Datatype">Unique</a> <a id="1774" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="1776" href="Bitcoin.Consistency.html#1662" class="Bound">tx</a> <a id="1779" class="Symbol">.</a><a id="1780" href="Bitcoin.Tx.Base.html#1152" class="Field">inputs</a> <a id="1787" href="Prelude.ToList.html#215" class="Function Operator">∙toList</a>

    <a id="_▷_,_.singleMatch"></a><a id="1800" href="Bitcoin.Consistency.html#1800" class="Field">singleMatch</a> <a id="1812" class="Symbol">:</a> <a id="1814" class="Symbol">∀</a> <a id="1816" class="Symbol">(</a><a id="1817" href="Bitcoin.Consistency.html#1817" class="Bound">i</a> <a id="1819" class="Symbol">:</a> <a id="1821" href="Data.Fin.Base.html#1135" class="Datatype">Fin</a> <a id="1825" href="Bitcoin.Consistency.html#1670" class="Bound">i</a><a id="1826" class="Symbol">)</a> <a id="1828" class="Symbol">→</a>
      <a id="1836" class="Keyword">let</a>
        <a id="1848" class="Symbol">(</a><a id="1849" href="Bitcoin.Consistency.html#1849" class="Bound">tx♯</a> <a id="1853" href="Bitcoin.Tx.Base.html#394" class="InductiveConstructor Operator">at</a> <a id="1856" class="Symbol">_)</a> <a id="1859" class="Symbol">=</a> <a id="1861" href="Bitcoin.Consistency.html#1662" class="Bound">tx</a> <a id="1864" href="Bitcoin.Tx.Base.html#2230" class="Function Operator">‼ⁱ</a> <a id="1867" href="Bitcoin.Consistency.html#1817" class="Bound">i</a>
      <a id="1875" class="Keyword">in</a>
        <a id="1886" href="Data.Product.html#1815" class="Function">∃[</a> <a id="1889" href="Bitcoin.Consistency.html#1889" class="Bound">tx</a> <a id="1892" href="Data.Product.html#1815" class="Function">]</a> <a id="1894" class="Symbol">(</a><a id="1895" href="Bitcoin.Consistency.html#841" class="Function">match</a> <a id="1901" href="Bitcoin.Consistency.html#1643" class="Bound">txs</a> <a id="1905" href="Bitcoin.Consistency.html#1849" class="Bound">tx♯</a> <a id="1909" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="1911" href="Prelude.Sets.AsUniqueLists.Core.html#2855" class="Function">singleton</a> <a id="1921" href="Bitcoin.Consistency.html#1889" class="Bound">tx</a><a id="1923" class="Symbol">)</a>

    <a id="_▷_,_.noOutOfBounds"></a><a id="1930" href="Bitcoin.Consistency.html#1930" class="Field">noOutOfBounds</a> <a id="1944" class="Symbol">:</a> <a id="1946" class="Symbol">∀</a> <a id="1948" class="Symbol">(</a><a id="1949" href="Bitcoin.Consistency.html#1949" class="Bound">i</a> <a id="1951" class="Symbol">:</a> <a id="1953" href="Data.Fin.Base.html#1135" class="Datatype">Fin</a> <a id="1957" href="Bitcoin.Consistency.html#1670" class="Bound">i</a><a id="1958" class="Symbol">)</a> <a id="1960" class="Symbol">→</a>
      <a id="1968" class="Keyword">let</a>
        <a id="1980" class="Symbol">(_</a> <a id="1983" href="Bitcoin.Tx.Base.html#394" class="InductiveConstructor Operator">at</a> <a id="1986" href="Bitcoin.Consistency.html#1986" class="Bound">oᵢ</a><a id="1988" class="Symbol">)</a>                <a id="2005" class="Symbol">=</a> <a id="2007" href="Bitcoin.Consistency.html#1662" class="Bound">tx</a> <a id="2010" href="Bitcoin.Tx.Base.html#2230" class="Function Operator">‼ⁱ</a> <a id="2013" href="Bitcoin.Consistency.html#1949" class="Bound">i</a>
        <a id="2023" class="Symbol">(((_</a> <a id="2028" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2030" href="Bitcoin.Consistency.html#2030" class="Bound">o</a> <a id="2032" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2034" class="Symbol">_)</a> <a id="2037" href="Bitcoin.Tx.Base.html#2667" class="InductiveConstructor Operator">at</a> <a id="2040" class="Symbol">_)</a> <a id="2043" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2045" class="Symbol">_)</a> <a id="2048" class="Symbol">=</a> <a id="2050" href="Bitcoin.Consistency.html#1800" class="Field">singleMatch</a> <a id="2062" href="Bitcoin.Consistency.html#1949" class="Bound">i</a>
      <a id="2070" class="Keyword">in</a>
        <a id="2081" href="Bitcoin.Consistency.html#1986" class="Bound">oᵢ</a> <a id="2084" href="Prelude.Ord.Core.html#213" class="Field Operator">&lt;</a> <a id="2086" href="Bitcoin.Consistency.html#2030" class="Bound">o</a>

  <a id="2091" class="Keyword">private</a>
    <a id="_▷_,_.getI"></a><a id="2103" href="Bitcoin.Consistency.html#2103" class="Function">getI</a> <a id="2108" class="Symbol">:</a> <a id="2110" class="Symbol">∀</a> <a id="2112" class="Symbol">(</a><a id="2113" href="Bitcoin.Consistency.html#2113" class="Bound">i</a> <a id="2115" class="Symbol">:</a> <a id="2117" href="Data.Fin.Base.html#1135" class="Datatype">Fin</a> <a id="2121" href="Bitcoin.Consistency.html#1670" class="Bound">i</a><a id="2122" class="Symbol">)</a> <a id="2124" class="Symbol">→</a> <a id="2126" class="Keyword">let</a> <a id="2130" href="Bitcoin.Consistency.html#2130" class="Bound">i′</a> <a id="2133" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2135" href="Bitcoin.Consistency.html#2135" class="Bound">o′</a> <a id="2138" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2140" class="Symbol">_</a> <a id="2142" class="Symbol">=</a> <a id="2144" href="Bitcoin.Consistency.html#1800" class="Field">singleMatch</a> <a id="2156" href="Bitcoin.Consistency.html#2113" class="Bound">i</a> <a id="2158" class="Symbol">.</a><a id="2159" href="Agda.Builtin.Sigma.html#234" class="Field">proj₁</a> <a id="2165" class="Symbol">.</a><a id="2166" href="Bitcoin.Tx.Base.html#2680" class="Field">transaction</a> <a id="2178" class="Keyword">in</a>
      <a id="2187" href="Bitcoin.Tx.Base.html#1114" class="Record">Tx</a> <a id="2190" href="Bitcoin.Consistency.html#2130" class="Bound">i′</a> <a id="2193" href="Bitcoin.Consistency.html#2135" class="Bound">o′</a> <a id="2196" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="2198" href="Data.Fin.Base.html#1135" class="Datatype">Fin</a> <a id="2202" href="Bitcoin.Consistency.html#2135" class="Bound">o′</a> <a id="2205" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="2207" href="Bitcoin.BasicTypes.html#233" class="Function">Time</a> <a id="2212" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="2214" href="Bitcoin.BasicTypes.html#222" class="Function">Value</a>
    <a id="2224" href="Bitcoin.Consistency.html#2103" class="Function">getI</a> <a id="2229" href="Bitcoin.Consistency.html#2229" class="Bound">i</a> <a id="2231" class="Symbol">=</a>
      <a id="2239" class="Keyword">let</a>
        <a id="2251" class="Symbol">(_</a> <a id="2254" href="Bitcoin.Tx.Base.html#394" class="InductiveConstructor Operator">at</a> <a id="2257" href="Bitcoin.Consistency.html#2257" class="Bound">oᵢ</a><a id="2259" class="Symbol">)</a> <a id="2261" class="Symbol">=</a> <a id="2263" href="Bitcoin.Consistency.html#1662" class="Bound">tx</a> <a id="2266" href="Bitcoin.Tx.Base.html#2230" class="Function Operator">‼ⁱ</a> <a id="2269" href="Bitcoin.Consistency.html#2229" class="Bound">i</a>
        <a id="2279" class="Symbol">(((_</a> <a id="2284" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2286" href="Bitcoin.Consistency.html#2286" class="Bound">o</a> <a id="2288" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2290" href="Bitcoin.Consistency.html#2290" class="Bound">Tᵢ</a><a id="2292" class="Symbol">)</a> <a id="2294" href="Bitcoin.Tx.Base.html#2667" class="InductiveConstructor Operator">at</a> <a id="2297" href="Bitcoin.Consistency.html#2297" class="Bound">tᵢ</a><a id="2299" class="Symbol">)</a> <a id="2301" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2303" class="Symbol">_)</a> <a id="2306" class="Symbol">=</a> <a id="2308" href="Bitcoin.Consistency.html#1800" class="Field">singleMatch</a> <a id="2320" href="Bitcoin.Consistency.html#2229" class="Bound">i</a>
        <a id="2330" href="Bitcoin.Consistency.html#2330" class="Bound">oᵢ</a> <a id="2333" class="Symbol">=</a> <a id="2335" href="Data.Fin.Base.html#1982" class="Function">F.fromℕ&lt;</a> <a id="2344" class="Symbol">{</a><a id="2345" class="Argument">m</a> <a id="2347" class="Symbol">=</a> <a id="2349" href="Bitcoin.Consistency.html#2257" class="Bound">oᵢ</a><a id="2351" class="Symbol">}</a> <a id="2353" class="Symbol">{</a><a id="2354" class="Argument">n</a> <a id="2356" class="Symbol">=</a> <a id="2358" href="Bitcoin.Consistency.html#2286" class="Bound">o</a><a id="2359" class="Symbol">}</a> <a id="2361" class="Symbol">(</a><a id="2362" href="Bitcoin.Consistency.html#1930" class="Field">noOutOfBounds</a> <a id="2376" href="Bitcoin.Consistency.html#2229" class="Bound">i</a><a id="2377" class="Symbol">)</a>
        <a id="2387" href="Bitcoin.Consistency.html#2387" class="Bound">vᵢ</a> <a id="2390" class="Symbol">=</a> <a id="2392" class="Symbol">(</a><a id="2393" href="Bitcoin.Consistency.html#2290" class="Bound">Tᵢ</a> <a id="2396" href="Bitcoin.Tx.Base.html#2427" class="Function Operator">‼ᵒ</a> <a id="2399" href="Bitcoin.Consistency.html#2330" class="Bound">oᵢ</a><a id="2401" class="Symbol">)</a> <a id="2403" href="Bitcoin.Tx.Base.html#891" class="Function Operator">∙value</a>
      <a id="2416" class="Keyword">in</a>
        <a id="2427" href="Bitcoin.Consistency.html#2290" class="Bound">Tᵢ</a> <a id="2430" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2432" href="Bitcoin.Consistency.html#2330" class="Bound">oᵢ</a> <a id="2435" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2437" href="Bitcoin.Consistency.html#2297" class="Bound">tᵢ</a> <a id="2440" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2442" href="Bitcoin.Consistency.html#2387" class="Bound">vᵢ</a>

  <a id="2448" class="Keyword">field</a>
    <a id="2458" class="Comment">-- (1)</a>
    <a id="_▷_,_.inputs∈UTXO"></a><a id="2469" href="Bitcoin.Consistency.html#2469" class="Field">inputs∈UTXO</a> <a id="2481" class="Symbol">:</a> <a id="2483" class="Symbol">∀</a> <a id="2485" class="Symbol">(</a><a id="2486" href="Bitcoin.Consistency.html#2486" class="Bound">i</a> <a id="2488" class="Symbol">:</a> <a id="2490" href="Data.Fin.Base.html#1135" class="Datatype">Fin</a> <a id="2494" href="Bitcoin.Consistency.html#1670" class="Bound">i</a><a id="2495" class="Symbol">)</a> <a id="2497" class="Symbol">→</a>
      <a id="2505" href="Bitcoin.Consistency.html#1662" class="Bound">tx</a> <a id="2508" href="Bitcoin.Tx.Base.html#2230" class="Function Operator">‼ⁱ</a> <a id="2511" href="Bitcoin.Consistency.html#2486" class="Bound">i</a> <a id="2513" href="Prelude.Sets.AsUniqueLists.Core.html#2169" class="Function Operator">∈ˢ</a> <a id="2516" href="Bitcoin.Consistency.html#1368" class="Function">UTXO</a> <a id="2521" href="Bitcoin.Consistency.html#1643" class="Bound">txs</a>

    <a id="2530" class="Comment">-- (2)</a>
    <a id="_▷_,_.inputsRedeemable"></a><a id="2541" href="Bitcoin.Consistency.html#2541" class="Field">inputsRedeemable</a> <a id="2558" class="Symbol">:</a> <a id="2560" class="Symbol">∀</a> <a id="2562" class="Symbol">(</a><a id="2563" href="Bitcoin.Consistency.html#2563" class="Bound">i</a> <a id="2565" class="Symbol">:</a> <a id="2567" href="Data.Fin.Base.html#1135" class="Datatype">Fin</a> <a id="2571" href="Bitcoin.Consistency.html#1670" class="Bound">i</a><a id="2572" class="Symbol">)</a> <a id="2574" class="Symbol">→</a> <a id="2576" class="Keyword">let</a> <a id="2580" href="Bitcoin.Consistency.html#2580" class="Bound">Tᵢ</a> <a id="2583" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2585" href="Bitcoin.Consistency.html#2585" class="Bound">oᵢ</a> <a id="2588" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2590" href="Bitcoin.Consistency.html#2590" class="Bound">tᵢ</a> <a id="2593" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2595" href="Bitcoin.Consistency.html#2595" class="Bound">vᵢ</a> <a id="2598" class="Symbol">=</a> <a id="2600" href="Bitcoin.Consistency.html#2103" class="Function">getI</a> <a id="2605" href="Bitcoin.Consistency.html#2563" class="Bound">i</a> <a id="2607" class="Keyword">in</a>
        <a id="2618" href="Bitcoin.Consistency.html#2580" class="Bound">Tᵢ</a> <a id="2621" href="Bitcoin.Tx.Semantics.html#542" class="Record Operator">,</a> <a id="2623" href="Bitcoin.Consistency.html#2585" class="Bound">oᵢ</a> <a id="2626" href="Bitcoin.Tx.Semantics.html#542" class="Record Operator">,</a> <a id="2628" href="Bitcoin.Consistency.html#2590" class="Bound">tᵢ</a> <a id="2631" href="Bitcoin.Tx.Semantics.html#542" class="Record Operator">↝[</a> <a id="2634" href="Bitcoin.Consistency.html#2595" class="Bound">vᵢ</a> <a id="2637" href="Bitcoin.Tx.Semantics.html#542" class="Record Operator">]</a> <a id="2639" href="Bitcoin.Consistency.html#1662" class="Bound">tx</a> <a id="2642" href="Bitcoin.Tx.Semantics.html#542" class="Record Operator">,</a> <a id="2644" href="Bitcoin.Consistency.html#2563" class="Bound">i</a> <a id="2646" href="Bitcoin.Tx.Semantics.html#542" class="Record Operator">,</a> <a id="2648" href="Bitcoin.Consistency.html#1676" class="Bound">t</a>

    <a id="2655" class="Comment">-- (3)</a>
    <a id="_▷_,_.valuesPreserved"></a><a id="2666" href="Bitcoin.Consistency.html#2666" class="Field">valuesPreserved</a> <a id="2682" class="Symbol">:</a>
      <a id="2690" class="Keyword">let</a>
        <a id="2702" href="Bitcoin.Consistency.html#2702" class="Bound">ins</a>  <a id="2707" class="Symbol">=</a> <a id="2709" href="Data.Vec.Base.html#5897" class="Function">V.tabulate</a> <a id="2720" class="Symbol">λ</a> <a id="2722" href="Bitcoin.Consistency.html#2722" class="Bound">i</a> <a id="2724" class="Symbol">→</a> <a id="2726" class="Keyword">let</a> <a id="2730" href="Bitcoin.Consistency.html#2730" class="Bound">Tᵢ</a> <a id="2733" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2735" href="Bitcoin.Consistency.html#2735" class="Bound">oᵢ</a> <a id="2738" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="2740" class="Symbol">_</a> <a id="2742" class="Symbol">=</a> <a id="2744" href="Bitcoin.Consistency.html#2103" class="Function">getI</a> <a id="2749" href="Bitcoin.Consistency.html#2722" class="Bound">i</a> <a id="2751" class="Keyword">in</a> <a id="2754" class="Symbol">(</a><a id="2755" href="Bitcoin.Consistency.html#2730" class="Bound">Tᵢ</a> <a id="2758" href="Bitcoin.Tx.Base.html#2427" class="Function Operator">‼ᵒ</a> <a id="2761" href="Bitcoin.Consistency.html#2735" class="Bound">oᵢ</a><a id="2763" class="Symbol">)</a> <a id="2765" href="Bitcoin.Tx.Base.html#891" class="Function Operator">∙value</a>
        <a id="2780" href="Bitcoin.Consistency.html#2780" class="Bound">outs</a> <a id="2785" class="Symbol">=</a> <a id="2787" href="Bitcoin.Tx.Base.html#891" class="Function Operator">_∙value</a> <a id="2795" href="Prelude.Functor.html#382" class="Field Operator">&lt;$&gt;</a> <a id="2799" href="Bitcoin.Consistency.html#1662" class="Bound">tx</a> <a id="2802" class="Symbol">.</a><a id="2803" href="Bitcoin.Tx.Base.html#1302" class="Field">outputs</a>
      <a id="2817" class="Keyword">in</a>
        <a id="2828" href="Data.Vec.Base.html#5423" class="Function">V.sum</a> <a id="2834" href="Bitcoin.Consistency.html#2702" class="Bound">ins</a> <a id="2838" href="Prelude.Ord.Core.html#289" class="Function Operator">≥</a> <a id="2840" href="Data.Vec.Base.html#5423" class="Function">V.sum</a> <a id="2846" href="Bitcoin.Consistency.html#2780" class="Bound">outs</a>

    <a id="2856" class="Comment">-- (4)</a>
    <a id="_▷_,_.laterTime"></a><a id="2867" href="Bitcoin.Consistency.html#2867" class="Field">laterTime</a> <a id="2877" class="Symbol">:</a>
      <a id="2885" href="Bitcoin.Consistency.html#1676" class="Bound">t</a> <a id="2887" href="Prelude.Ord.Core.html#289" class="Function Operator">≥</a> <a id="2889" href="Bitcoin.Consistency.html#1534" class="Function">latestTime</a> <a id="2900" href="Bitcoin.Consistency.html#1643" class="Bound">txs</a>

<a id="2905" class="Comment">-- Consistency.</a>
<a id="2921" class="Keyword">data</a> <a id="ConsistentBlockchain"></a><a id="2926" href="Bitcoin.Consistency.html#2926" class="Datatype">ConsistentBlockchain</a> <a id="2947" class="Symbol">:</a> <a id="2949" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a> <a id="2960" class="Symbol">→</a> <a id="2962" href="Agda.Primitive.html#320" class="Primitive">Type</a> <a id="2967" class="Keyword">where</a>
  <a id="2975" class="Comment">-- ∎_∶-_  : (tx : Tx 0 o)</a>
  <a id="3003" class="Comment">--        → Coinbase tx</a>
  <a id="3029" class="Comment">--        → ConsistentBlockchain [ (_ , _ , tx) at 0 ]</a>
  <a id="ConsistentBlockchain.∎"></a><a id="3086" href="Bitcoin.Consistency.html#3086" class="InductiveConstructor">∎</a>  <a id="3089" class="Symbol">:</a> <a id="3091" href="Bitcoin.Consistency.html#2926" class="Datatype">ConsistentBlockchain</a> <a id="3112" href="Agda.Builtin.List.html#167" class="InductiveConstructor">[]</a>

  <a id="ConsistentBlockchain._⊕_∶-_"></a><a id="3118" href="Bitcoin.Consistency.html#3118" class="InductiveConstructor Operator">_⊕_∶-_</a> <a id="3125" class="Symbol">:</a> <a id="3127" href="Bitcoin.Consistency.html#2926" class="Datatype">ConsistentBlockchain</a> <a id="3148" href="Bitcoin.Consistency.html#764" class="Generalizable">txs</a>
         <a id="3161" class="Symbol">→</a> <a id="3163" class="Symbol">(</a><a id="3164" href="Bitcoin.Consistency.html#3164" class="Bound">tx</a> <a id="3167" class="Symbol">:</a> <a id="3169" href="Bitcoin.Tx.Base.html#1114" class="Record">Tx</a> <a id="3172" href="Bitcoin.Tx.Base.html#2199" class="Generalizable">i</a> <a id="3174" href="Bitcoin.Tx.Base.html#2204" class="Generalizable">o</a><a id="3175" class="Symbol">)</a>
         <a id="3186" class="Symbol">→</a> <a id="3188" href="Bitcoin.Consistency.html#764" class="Generalizable">txs</a> <a id="3192" href="Bitcoin.Consistency.html#1636" class="Record Operator">▷</a> <a id="3194" href="Bitcoin.Consistency.html#3164" class="Bound">tx</a> <a id="3197" href="Bitcoin.Consistency.html#1636" class="Record Operator">,</a> <a id="3199" href="Bitcoin.BasicTypes.html#300" class="Generalizable">t</a>
         <a id="3210" class="Symbol">→</a> <a id="3212" href="Bitcoin.Consistency.html#2926" class="Datatype">ConsistentBlockchain</a> <a id="3233" class="Symbol">(((</a><a id="3236" href="Data.Product.html#2256" class="Function Operator">-,</a> <a id="3239" href="Data.Product.html#2256" class="Function Operator">-,</a> <a id="3242" href="Bitcoin.Consistency.html#3164" class="Bound">tx</a><a id="3244" class="Symbol">)</a> <a id="3246" href="Bitcoin.Tx.Base.html#2667" class="InductiveConstructor Operator">at</a> <a id="3249" href="Bitcoin.BasicTypes.html#300" class="Generalizable">t</a><a id="3250" class="Symbol">)</a> <a id="3252" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="3254" href="Bitcoin.Consistency.html#764" class="Generalizable">txs</a><a id="3257" class="Symbol">)</a>

<a id="3260" class="Comment">-- (1) Non-constructive/indirect formulation of the UTXO set, via describing when an output is unspent.</a>
<a id="Unspent"></a><a id="3364" href="Bitcoin.Consistency.html#3364" class="Function">Unspent</a> <a id="3372" class="Symbol">:</a> <a id="3374" class="Symbol">(</a><a id="3375" href="Bitcoin.Consistency.html#3375" class="Bound">b</a> <a id="3377" class="Symbol">:</a> <a id="3379" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a><a id="3389" class="Symbol">)</a> <a id="3391" class="Symbol">→</a> <a id="3393" class="Symbol">(</a><a id="3394" href="Bitcoin.Consistency.html#3394" class="Bound">i</a> <a id="3396" class="Symbol">:</a> <a id="3398" href="Prelude.Lists.Indexed.html#492" class="Function">Index</a> <a id="3404" href="Bitcoin.Consistency.html#3375" class="Bound">b</a><a id="3405" class="Symbol">)</a> <a id="3407" class="Symbol">→</a> <a id="3409" class="Keyword">let</a> <a id="3413" class="Symbol">(_</a> <a id="3416" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3418" href="Bitcoin.Consistency.html#3418" class="Bound">o</a> <a id="3420" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3422" href="Bitcoin.Consistency.html#3422" class="Bound">Tᵢ</a><a id="3424" class="Symbol">)</a> <a id="3426" class="InductiveConstructor Operator">at</a> <a id="3429" href="Bitcoin.Consistency.html#3429" class="Bound">tᵢ</a> <a id="3432" class="Symbol">=</a> <a id="3434" href="Bitcoin.Consistency.html#3375" class="Bound">b</a> <a id="3436" href="Prelude.Lists.Indexed.html#600" class="Function Operator">‼</a> <a id="3438" href="Bitcoin.Consistency.html#3394" class="Bound">i</a> <a id="3440" class="Keyword">in</a>
        <a id="3451" class="Symbol">∀</a> <a id="3453" class="Symbol">(</a><a id="3454" href="Bitcoin.Consistency.html#3454" class="Bound">j</a> <a id="3456" class="Symbol">:</a> <a id="3458" href="Data.Fin.Base.html#1135" class="Datatype">Fin</a> <a id="3462" href="Bitcoin.Consistency.html#3418" class="Bound">o</a><a id="3463" class="Symbol">)</a> <a id="3465" class="Symbol">→</a> <a id="3467" href="Agda.Primitive.html#320" class="Primitive">Type</a>
<a id="3472" href="Bitcoin.Consistency.html#3364" class="Function">Unspent</a> <a id="3480" href="Bitcoin.Consistency.html#3480" class="Bound">b</a> <a id="3482" href="Bitcoin.Consistency.html#3482" class="Bound">i</a> <a id="3484" href="Bitcoin.Consistency.html#3484" class="Bound">j</a> <a id="3486" class="Symbol">=</a>
  <a id="3490" class="Keyword">let</a> <a id="3494" class="Symbol">(_</a> <a id="3497" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3499" href="Bitcoin.Consistency.html#3499" class="Bound">o</a> <a id="3501" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3503" href="Bitcoin.Consistency.html#3503" class="Bound">Tᵢ</a><a id="3505" class="Symbol">)</a> <a id="3507" href="Bitcoin.Tx.Base.html#2667" class="InductiveConstructor Operator">at</a> <a id="3510" href="Bitcoin.Consistency.html#3510" class="Bound">tᵢ</a> <a id="3513" class="Symbol">=</a> <a id="3515" href="Bitcoin.Consistency.html#3480" class="Bound">b</a> <a id="3517" href="Prelude.Lists.Indexed.html#600" class="Function Operator">‼</a> <a id="3519" href="Bitcoin.Consistency.html#3482" class="Bound">i</a> <a id="3521" class="Keyword">in</a>
  <a id="3526" class="Symbol">∀</a> <a id="3528" class="Symbol">(</a><a id="3529" href="Bitcoin.Consistency.html#3529" class="Bound">i′</a> <a id="3532" class="Symbol">:</a> <a id="3534" href="Prelude.Lists.Indexed.html#492" class="Function">Index</a> <a id="3540" href="Bitcoin.Consistency.html#3480" class="Bound">b</a><a id="3541" class="Symbol">)</a> <a id="3543" class="Symbol">(</a><a id="3544" href="Bitcoin.Consistency.html#3544" class="Bound">leq</a> <a id="3548" class="Symbol">:</a> <a id="3550" href="Bitcoin.Consistency.html#3529" class="Bound">i′</a> <a id="3553" href="Data.Fin.Base.html#7193" class="Function Operator">F.≤</a> <a id="3557" href="Bitcoin.Consistency.html#3482" class="Bound">i</a><a id="3558" class="Symbol">)</a>  <a id="3561" class="Symbol">→</a> <a id="3563" class="Keyword">let</a> <a id="3567" class="Symbol">(</a><a id="3568" href="Bitcoin.Consistency.html#3568" class="Bound">i′</a> <a id="3571" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3573" class="Symbol">_</a> <a id="3575" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3577" href="Bitcoin.Consistency.html#3577" class="Bound">Tᵢ′</a><a id="3580" class="Symbol">)</a> <a id="3582" href="Bitcoin.Tx.Base.html#2667" class="InductiveConstructor Operator">at</a> <a id="3585" href="Bitcoin.Consistency.html#3585" class="Bound">tᵢ′</a> <a id="3589" class="Symbol">=</a> <a id="3591" href="Bitcoin.Consistency.html#3480" class="Bound">b</a> <a id="3593" href="Prelude.Lists.Indexed.html#600" class="Function Operator">‼</a> <a id="3595" href="Bitcoin.Consistency.html#3529" class="Bound">i′</a> <a id="3598" class="Keyword">in</a>
  <a id="3603" class="Symbol">∀</a> <a id="3605" class="Symbol">(</a><a id="3606" href="Bitcoin.Consistency.html#3606" class="Bound">j′</a> <a id="3609" class="Symbol">:</a> <a id="3611" href="Data.Fin.Base.html#1135" class="Datatype">Fin</a> <a id="3615" href="Bitcoin.Consistency.html#3568" class="Bound">i′</a><a id="3617" class="Symbol">)</a> <a id="3619" class="Symbol">→</a>
    <a id="3625" href="Bitcoin.Consistency.html#3503" class="Bound">Tᵢ</a> <a id="3628" href="Bitcoin.Tx.Semantics.html#1147" class="Function Operator">,</a> <a id="3630" href="Bitcoin.Consistency.html#3484" class="Bound">j</a> <a id="3632" href="Bitcoin.Tx.Semantics.html#1147" class="Function Operator">,</a> <a id="3634" href="Bitcoin.Consistency.html#3510" class="Bound">tᵢ</a> <a id="3637" href="Bitcoin.Tx.Semantics.html#1147" class="Function Operator">↛</a> <a id="3639" href="Bitcoin.Consistency.html#3577" class="Bound">Tᵢ′</a> <a id="3643" href="Bitcoin.Tx.Semantics.html#1147" class="Function Operator">,</a> <a id="3645" href="Bitcoin.Consistency.html#3606" class="Bound">j′</a> <a id="3648" href="Bitcoin.Tx.Semantics.html#1147" class="Function Operator">,</a> <a id="3650" href="Bitcoin.Consistency.html#3585" class="Bound">tᵢ′</a>

<a id="Unspent-∷"></a><a id="3655" href="Bitcoin.Consistency.html#3655" class="Function">Unspent-∷</a> <a id="3665" class="Symbol">:</a> <a id="3667" class="Symbol">∀</a> <a id="3669" class="Symbol">{</a><a id="3670" href="Bitcoin.Consistency.html#3670" class="Bound">tx</a> <a id="3673" href="Bitcoin.Consistency.html#3673" class="Bound">t</a><a id="3674" class="Symbol">}</a> <a id="3676" class="Symbol">{</a><a id="3677" href="Bitcoin.Consistency.html#3677" class="Bound">b</a> <a id="3679" class="Symbol">:</a> <a id="3681" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a><a id="3691" class="Symbol">}</a> <a id="3693" class="Symbol">{</a><a id="3694" href="Bitcoin.Consistency.html#3694" class="Bound">i</a> <a id="3696" class="Symbol">:</a> <a id="3698" href="Prelude.Lists.Indexed.html#492" class="Function">Index</a> <a id="3704" href="Bitcoin.Consistency.html#3677" class="Bound">b</a><a id="3705" class="Symbol">}</a> <a id="3707" class="Symbol">→</a> <a id="3709" class="Keyword">let</a> <a id="3713" class="Symbol">(_</a> <a id="3716" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3718" href="Bitcoin.Consistency.html#3718" class="Bound">o</a> <a id="3720" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3722" href="Bitcoin.Consistency.html#3722" class="Bound">Tᵢ</a><a id="3724" class="Symbol">)</a> <a id="3726" class="InductiveConstructor Operator">at</a> <a id="3729" href="Bitcoin.Consistency.html#3729" class="Bound">tᵢ</a> <a id="3732" class="Symbol">=</a> <a id="3734" href="Bitcoin.Consistency.html#3677" class="Bound">b</a> <a id="3736" href="Prelude.Lists.Indexed.html#600" class="Function Operator">‼</a> <a id="3738" href="Bitcoin.Consistency.html#3694" class="Bound">i</a> <a id="3740" class="Keyword">in</a> <a id="3743" class="Symbol">∀</a> <a id="3745" class="Symbol">{</a><a id="3746" href="Bitcoin.Consistency.html#3746" class="Bound">j</a> <a id="3748" class="Symbol">:</a> <a id="3750" href="Data.Fin.Base.html#1135" class="Datatype">Fin</a> <a id="3754" href="Bitcoin.Consistency.html#3718" class="Bound">o</a><a id="3755" class="Symbol">}</a> <a id="3757" class="Symbol">→</a>
  <a id="3761" href="Prelude.InferenceRules.html#56141" class="Function Operator">∙</a> <a id="3763" href="Bitcoin.Consistency.html#3364" class="Function">Unspent</a> <a id="3771" href="Bitcoin.Consistency.html#3677" class="Bound">b</a> <a id="3773" href="Bitcoin.Consistency.html#3694" class="Bound">i</a> <a id="3775" href="Bitcoin.Consistency.html#3746" class="Bound">j</a>
  <a id="3779" href="Prelude.InferenceRules.html#56072" class="Function Operator">∙</a> <a id="3781" class="Symbol">(((</a><a id="3784" href="Bitcoin.Consistency.html#3722" class="Bound">Tᵢ</a> <a id="3787" href="Bitcoin.Tx.Crypto.html#530" class="Function Operator">♯at</a> <a id="3791" href="Bitcoin.Consistency.html#3746" class="Bound">j</a><a id="3792" class="Symbol">)</a> <a id="3794" href="Data.Vec.Membership.Setoid.html#896" class="Function Operator">V.Mem.∉</a> <a id="3802" href="Bitcoin.Tx.Base.html#1542" class="Function">∃inputs</a> <a id="3810" href="Bitcoin.Consistency.html#3670" class="Bound">tx</a><a id="3812" class="Symbol">)</a>
    <a id="3818" href="Prelude.InferenceRules.html#12510" class="Function Operator">─────────────────────────────────────────────────────────</a>
    <a id="3880" href="Bitcoin.Consistency.html#3364" class="Function">Unspent</a> <a id="3888" class="Symbol">((</a><a id="3890" href="Bitcoin.Consistency.html#3670" class="Bound">tx</a> <a id="3893" class="InductiveConstructor Operator">at</a> <a id="3896" href="Bitcoin.Consistency.html#3673" class="Bound">t</a><a id="3897" class="Symbol">)</a> <a id="3899" class="InductiveConstructor Operator">∷</a> <a id="3901" href="Bitcoin.Consistency.html#3677" class="Bound">b</a><a id="3902" class="Symbol">)</a> <a id="3904" class="Symbol">(</a><a id="3905" href="Data.Fin.Base.html#1188" class="InductiveConstructor">fsuc</a> <a id="3910" href="Bitcoin.Consistency.html#3694" class="Bound">i</a><a id="3911" class="Symbol">)</a> <a id="3913" href="Bitcoin.Consistency.html#3746" class="Bound">j</a><a id="3914" class="Symbol">)</a>
<a id="3916" href="Bitcoin.Consistency.html#3655" class="Function">Unspent-∷</a> <a id="3926" class="Symbol">{</a><a id="3927" class="Argument">tx</a> <a id="3930" class="Symbol">=</a> <a id="3932" href="Bitcoin.Consistency.html#3932" class="Bound">tx</a><a id="3934" class="Symbol">}</a> <a id="3936" href="Bitcoin.Consistency.html#3936" class="Bound">unsp</a> <a id="3941" href="Bitcoin.Consistency.html#3941" class="Bound">in∉</a> <a id="3945" href="Data.Fin.Patterns.html#399" class="InductiveConstructor">0F</a> <a id="3948" href="Bitcoin.Consistency.html#3948" class="Bound">0≤</a> <a id="3951" href="Bitcoin.Consistency.html#3951" class="Bound">j′</a> <a id="3954" class="Symbol">(</a><a id="3955" href="Bitcoin.Consistency.html#3955" class="Bound">v</a> <a id="3957" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="3959" class="Keyword">record</a> <a id="3966" class="Symbol">{</a><a id="3967" href="Bitcoin.Tx.Semantics.html#859" class="Field">input~output</a> <a id="3980" class="Symbol">=</a> <a id="3982" href="Bitcoin.Consistency.html#3982" class="Bound">io</a><a id="3984" class="Symbol">})</a>
  <a id="3989" class="Symbol">=</a> <a id="3991" href="Bitcoin.Consistency.html#3941" class="Bound">in∉</a> <a id="3995" class="Symbol">(</a><a id="3996" href="Relation.Binary.PropositionalEquality.Core.html#1789" class="Function">subst</a> <a id="4002" class="Symbol">(</a><a id="4003" href="Data.Vec.Membership.Setoid.html#838" class="Function Operator">V.Mem._∈</a> <a id="4012" href="Bitcoin.Tx.Base.html#1542" class="Function">∃inputs</a> <a id="4020" href="Bitcoin.Consistency.html#3932" class="Bound">tx</a><a id="4022" class="Symbol">)</a> <a id="4024" href="Bitcoin.Consistency.html#3982" class="Bound">io</a> <a id="4027" class="Symbol">(</a><a id="4028" href="Data.Vec.Membership.Propositional.Properties.html#1207" class="Function">V.Mem.∈-lookup</a> <a id="4043" href="Bitcoin.Consistency.html#3951" class="Bound">j′</a> <a id="4046" class="Symbol">_))</a>
<a id="4050" href="Bitcoin.Consistency.html#3655" class="Function">Unspent-∷</a> <a id="4060" href="Bitcoin.Consistency.html#4060" class="Bound">unsp</a> <a id="4065" class="Symbol">_</a> <a id="4067" class="Symbol">(</a><a id="4068" href="Data.Fin.Base.html#1188" class="InductiveConstructor">fsuc</a> <a id="4073" href="Bitcoin.Consistency.html#4073" class="Bound">i′</a><a id="4075" class="Symbol">)</a> <a id="4077" class="Symbol">(</a><a id="4078" href="Data.Nat.Base.html#1609" class="InductiveConstructor">s≤s</a> <a id="4082" href="Bitcoin.Consistency.html#4082" class="Bound">leq</a><a id="4085" class="Symbol">)</a> <a id="4087" href="Bitcoin.Consistency.html#4087" class="Bound">j′</a> <a id="4090" href="Bitcoin.Consistency.html#4090" class="Bound">p</a>
  <a id="4094" class="Symbol">=</a> <a id="4096" href="Bitcoin.Consistency.html#4060" class="Bound">unsp</a> <a id="4101" href="Bitcoin.Consistency.html#4073" class="Bound">i′</a> <a id="4104" href="Bitcoin.Consistency.html#4082" class="Bound">leq</a> <a id="4108" href="Bitcoin.Consistency.html#4087" class="Bound">j′</a> <a id="4111" href="Bitcoin.Consistency.html#4090" class="Bound">p</a>

<a id="4114" class="Comment">--</a>

<a id="∃Unspent"></a><a id="4118" href="Bitcoin.Consistency.html#4118" class="Function">∃Unspent</a> <a id="4127" class="Symbol">:</a> <a id="4129" class="Symbol">(</a><a id="4130" href="Bitcoin.Consistency.html#4130" class="Bound">b</a> <a id="4132" class="Symbol">:</a> <a id="4134" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a><a id="4144" class="Symbol">)</a> <a id="4146" class="Symbol">→</a> <a id="4148" href="Bitcoin.Tx.Base.html#857" class="Function">∃TxOutput</a> <a id="4158" class="Symbol">→</a> <a id="4160" href="Agda.Primitive.html#320" class="Primitive">Type</a>
<a id="4165" href="Bitcoin.Consistency.html#4118" class="Function">∃Unspent</a> <a id="4174" href="Bitcoin.Consistency.html#4174" class="Bound">b</a> <a id="4176" href="Bitcoin.Consistency.html#4176" class="Bound">txo</a> <a id="4180" class="Symbol">=</a>
  <a id="4184" href="Agda.Builtin.Sigma.html#148" class="Record">Σ</a> <a id="4186" class="Symbol">(</a><a id="4187" href="Prelude.Lists.Indexed.html#492" class="Function">Index</a> <a id="4193" href="Bitcoin.Consistency.html#4174" class="Bound">b</a><a id="4194" class="Symbol">)</a> <a id="4196" class="Symbol">λ</a> <a id="4198" href="Bitcoin.Consistency.html#4198" class="Bound">i</a> <a id="4200" class="Symbol">→</a>
    <a id="4206" class="Keyword">let</a> <a id="4210" class="Symbol">(_</a> <a id="4213" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4215" href="Bitcoin.Consistency.html#4215" class="Bound">o</a> <a id="4217" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4219" href="Bitcoin.Consistency.html#4219" class="Bound">Tᵢ</a><a id="4221" class="Symbol">)</a> <a id="4223" href="Bitcoin.Tx.Base.html#2667" class="InductiveConstructor Operator">at</a> <a id="4226" class="Symbol">_</a> <a id="4228" class="Symbol">=</a> <a id="4230" href="Bitcoin.Consistency.html#4174" class="Bound">b</a> <a id="4232" href="Prelude.Lists.Indexed.html#600" class="Function Operator">‼</a> <a id="4234" href="Bitcoin.Consistency.html#4198" class="Bound">i</a> <a id="4236" class="Keyword">in</a>
    <a id="4243" href="Agda.Builtin.Sigma.html#148" class="Record">Σ</a> <a id="4245" class="Symbol">(</a><a id="4246" href="Data.Fin.Base.html#1135" class="Datatype">Fin</a> <a id="4250" href="Bitcoin.Consistency.html#4215" class="Bound">o</a><a id="4251" class="Symbol">)</a> <a id="4253" class="Symbol">λ</a> <a id="4255" href="Bitcoin.Consistency.html#4255" class="Bound">j</a> <a id="4257" class="Symbol">→</a>
      <a id="4265" href="Bitcoin.Consistency.html#3364" class="Function">Unspent</a> <a id="4273" href="Bitcoin.Consistency.html#4174" class="Bound">b</a> <a id="4275" href="Bitcoin.Consistency.html#4198" class="Bound">i</a> <a id="4277" href="Bitcoin.Consistency.html#4255" class="Bound">j</a> <a id="4279" href="Data.Product.html#1176" class="Function Operator">×</a> <a id="4281" class="Symbol">(</a><a id="4282" href="Bitcoin.Consistency.html#4219" class="Bound">Tᵢ</a> <a id="4285" href="Bitcoin.Tx.Base.html#2427" class="Function Operator">‼ᵒ</a> <a id="4288" href="Bitcoin.Consistency.html#4255" class="Bound">j</a> <a id="4290" href="Agda.Builtin.Equality.html#133" class="Datatype Operator">≡</a> <a id="4292" href="Bitcoin.Consistency.html#4176" class="Bound">txo</a><a id="4295" class="Symbol">)</a>

<a id="↝-irreflexive"></a><a id="4298" href="Bitcoin.Consistency.html#4298" class="Function">↝-irreflexive</a> <a id="4312" class="Symbol">:</a> <a id="4314" class="Symbol">∀</a> <a id="4316" class="Symbol">{</a><a id="4317" href="Bitcoin.Consistency.html#4317" class="Bound">T</a> <a id="4319" class="Symbol">:</a> <a id="4321" href="Bitcoin.Tx.Base.html#1114" class="Record">Tx</a> <a id="4324" href="Bitcoin.Tx.Base.html#2199" class="Generalizable">i</a> <a id="4326" href="Bitcoin.Tx.Base.html#2204" class="Generalizable">o</a><a id="4327" class="Symbol">}</a> <a id="4329" class="Symbol">{</a><a id="4330" href="Bitcoin.Consistency.html#4330" class="Bound">oᵢ</a> <a id="4333" class="Symbol">:</a> <a id="4335" href="Data.Fin.Base.html#1135" class="Datatype">Fin</a> <a id="4339" href="Bitcoin.Tx.Base.html#2204" class="Generalizable">o</a><a id="4340" class="Symbol">}</a> <a id="4342" class="Symbol">{</a><a id="4343" href="Bitcoin.Consistency.html#4343" class="Bound">iᵢ</a> <a id="4346" class="Symbol">:</a> <a id="4348" href="Data.Fin.Base.html#1135" class="Datatype">Fin</a> <a id="4352" href="Bitcoin.Tx.Base.html#2199" class="Generalizable">i</a><a id="4353" class="Symbol">}</a> <a id="4355" class="Symbol">{</a><a id="4356" href="Bitcoin.Consistency.html#4356" class="Bound">t₀</a> <a id="4359" href="Bitcoin.Consistency.html#4359" class="Bound">t</a> <a id="4361" href="Bitcoin.Consistency.html#4361" class="Bound">v</a> <a id="4363" href="Bitcoin.Consistency.html#4363" class="Bound">t′</a><a id="4365" class="Symbol">}</a>
  <a id="4369" class="Symbol">→</a> <a id="4371" href="Bitcoin.Consistency.html#2926" class="Datatype">ConsistentBlockchain</a> <a id="4392" href="Data.List.Base.html#5034" class="Function Operator">[</a> <a id="4394" class="Symbol">(</a><a id="4395" href="Data.Product.html#2256" class="Function Operator">-,</a> <a id="4398" href="Data.Product.html#2256" class="Function Operator">-,</a> <a id="4401" href="Bitcoin.Consistency.html#4317" class="Bound">T</a><a id="4402" class="Symbol">)</a> <a id="4404" class="InductiveConstructor Operator">at</a> <a id="4407" href="Bitcoin.Consistency.html#4356" class="Bound">t₀</a> <a id="4410" href="Data.List.Base.html#5034" class="Function Operator">]</a>
  <a id="4414" class="Symbol">→</a> <a id="4416" href="Relation.Nullary.html#665" class="Function Operator">¬</a> <a id="4418" class="Symbol">(</a><a id="4419" href="Bitcoin.Consistency.html#4317" class="Bound">T</a> <a id="4421" href="Bitcoin.Tx.Semantics.html#542" class="Record Operator">,</a> <a id="4423" href="Bitcoin.Consistency.html#4330" class="Bound">oᵢ</a> <a id="4426" href="Bitcoin.Tx.Semantics.html#542" class="Record Operator">,</a> <a id="4428" href="Bitcoin.Consistency.html#4359" class="Bound">t</a> <a id="4430" href="Bitcoin.Tx.Semantics.html#542" class="Record Operator">↝[</a> <a id="4433" href="Bitcoin.Consistency.html#4361" class="Bound">v</a> <a id="4435" href="Bitcoin.Tx.Semantics.html#542" class="Record Operator">]</a> <a id="4437" href="Bitcoin.Consistency.html#4317" class="Bound">T</a> <a id="4439" href="Bitcoin.Tx.Semantics.html#542" class="Record Operator">,</a> <a id="4441" href="Bitcoin.Consistency.html#4343" class="Bound">iᵢ</a> <a id="4444" href="Bitcoin.Tx.Semantics.html#542" class="Record Operator">,</a> <a id="4446" href="Bitcoin.Consistency.html#4363" class="Bound">t′</a><a id="4448" class="Symbol">)</a>
<a id="4450" href="Bitcoin.Consistency.html#4298" class="Function">↝-irreflexive</a> <a id="4464" class="Symbol">{</a><a id="4465" class="Argument">T</a> <a id="4467" class="Symbol">=</a> <a id="4469" href="Bitcoin.Consistency.html#4469" class="Bound">T</a><a id="4470" class="Symbol">}</a> <a id="4472" class="Symbol">{</a><a id="4473" class="Argument">iᵢ</a> <a id="4476" class="Symbol">=</a> <a id="4478" href="Bitcoin.Consistency.html#4478" class="Bound">iᵢ</a><a id="4480" class="Symbol">}</a> <a id="4482" class="Symbol">(</a><a id="4483" href="Bitcoin.Consistency.html#4483" class="Bound">∙</a> <a id="4485" href="Bitcoin.Consistency.html#3118" class="InductiveConstructor Operator">⊕</a> <a id="4487" class="DottedPattern Symbol">.</a><a id="4488" href="Bitcoin.Consistency.html#4469" class="DottedPattern Bound">T</a> <a id="4490" href="Bitcoin.Consistency.html#3118" class="InductiveConstructor Operator">∶-</a> <a id="4493" class="Keyword">record</a> <a id="4500" class="Symbol">{</a><a id="4501" href="Bitcoin.Consistency.html#2469" class="Field">inputs∈UTXO</a> <a id="4513" class="Symbol">=</a> <a id="4515" href="Bitcoin.Consistency.html#4515" class="Bound">i∈</a><a id="4517" class="Symbol">})</a> <a id="4520" class="Symbol">_</a> <a id="4522" class="Symbol">=</a> <a id="4524" href="Data.Empty.html#637" class="Function">⊥-elim</a> <a id="4531" href="Function.Base.html#1928" class="Function Operator">$</a> <a id="4533" href="Prelude.Sets.AsUniqueLists.Core.html#3581" class="Function">∉∅</a> <a id="4536" class="Symbol">_</a> <a id="4538" class="Symbol">(</a><a id="4539" href="Bitcoin.Consistency.html#4515" class="Bound">i∈</a> <a id="4542" href="Bitcoin.Consistency.html#4478" class="Bound">iᵢ</a><a id="4544" class="Symbol">)</a>

<a id="4547" class="Comment">--</a>

<a id="∃Unspent-∷"></a><a id="4551" href="Bitcoin.Consistency.html#4551" class="Function">∃Unspent-∷</a> <a id="4562" class="Symbol">:</a> <a id="4564" class="Symbol">∀</a> <a id="4566" class="Symbol">{</a><a id="4567" href="Bitcoin.Consistency.html#4567" class="Bound">t</a> <a id="4569" href="Bitcoin.Consistency.html#4569" class="Bound">tx</a> <a id="4572" href="Bitcoin.Consistency.html#4572" class="Bound">b</a> <a id="4574" href="Bitcoin.Consistency.html#4574" class="Bound">o</a><a id="4575" class="Symbol">}</a> <a id="4577" class="Symbol">→</a>
  <a id="4581" href="Prelude.InferenceRules.html#56141" class="Function Operator">∙</a> <a id="4583" href="Bitcoin.Consistency.html#2926" class="Datatype">ConsistentBlockchain</a> <a id="4604" class="Symbol">((</a><a id="4606" href="Bitcoin.Consistency.html#4569" class="Bound">tx</a> <a id="4609" class="InductiveConstructor Operator">at</a> <a id="4612" href="Bitcoin.Consistency.html#4567" class="Bound">t</a><a id="4613" class="Symbol">)</a> <a id="4615" class="InductiveConstructor Operator">∷</a> <a id="4617" href="Bitcoin.Consistency.html#4572" class="Bound">b</a><a id="4618" class="Symbol">)</a>
  <a id="4622" class="Symbol">→</a> <a id="4624" class="Symbol">(</a><a id="4625" href="Bitcoin.Consistency.html#4625" class="Bound">wit</a> <a id="4629" class="Symbol">:</a> <a id="4631" href="Bitcoin.Consistency.html#4118" class="Function">∃Unspent</a> <a id="4640" href="Bitcoin.Consistency.html#4572" class="Bound">b</a> <a id="4642" href="Bitcoin.Consistency.html#4574" class="Bound">o</a><a id="4643" class="Symbol">)</a>
  <a id="4647" class="Symbol">→</a> <a id="4649" class="Keyword">let</a> <a id="4653" href="Bitcoin.Consistency.html#4653" class="Bound">i</a> <a id="4655" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4657" href="Bitcoin.Consistency.html#4657" class="Bound">j</a> <a id="4659" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4661" class="Symbol">_</a> <a id="4663" class="Symbol">=</a> <a id="4665" href="Bitcoin.Consistency.html#4625" class="Bound">wit</a><a id="4668" class="Symbol">;</a> <a id="4670" class="Symbol">(_</a> <a id="4673" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4675" class="Symbol">_</a> <a id="4677" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4679" href="Bitcoin.Consistency.html#4679" class="Bound">Tᵢ</a><a id="4681" class="Symbol">)</a> <a id="4683" class="InductiveConstructor Operator">at</a> <a id="4686" class="Symbol">_</a> <a id="4688" class="Symbol">=</a> <a id="4690" href="Bitcoin.Consistency.html#4572" class="Bound">b</a> <a id="4692" href="Prelude.Lists.Indexed.html#600" class="Function Operator">‼</a> <a id="4694" href="Bitcoin.Consistency.html#4653" class="Bound">i</a> <a id="4696" class="Keyword">in</a>
  <a id="4701" href="Prelude.InferenceRules.html#56141" class="Function Operator">∙</a> <a id="4703" class="Symbol">(</a><a id="4704" href="Bitcoin.Consistency.html#4679" class="Bound">Tᵢ</a> <a id="4707" href="Bitcoin.Tx.Crypto.html#530" class="Function Operator">♯at</a> <a id="4711" href="Bitcoin.Consistency.html#4657" class="Bound">j</a> <a id="4713" href="Data.Vec.Membership.Setoid.html#896" class="Function Operator">V.Mem.∉</a> <a id="4721" href="Bitcoin.Tx.Base.html#1542" class="Function">∃inputs</a> <a id="4729" href="Bitcoin.Consistency.html#4569" class="Bound">tx</a><a id="4731" class="Symbol">)</a>
    <a id="4737" href="Prelude.InferenceRules.html#12510" class="Function Operator">─────────────────────────────────────────────────────────</a>
    <a id="4799" href="Bitcoin.Consistency.html#4118" class="Function">∃Unspent</a> <a id="4808" class="Symbol">((</a><a id="4810" href="Bitcoin.Consistency.html#4569" class="Bound">tx</a> <a id="4813" class="InductiveConstructor Operator">at</a> <a id="4816" href="Bitcoin.Consistency.html#4567" class="Bound">t</a><a id="4817" class="Symbol">)</a> <a id="4819" class="InductiveConstructor Operator">∷</a> <a id="4821" href="Bitcoin.Consistency.html#4572" class="Bound">b</a><a id="4822" class="Symbol">)</a> <a id="4824" href="Bitcoin.Consistency.html#4574" class="Bound">o</a>
<a id="4826" href="Bitcoin.Consistency.html#4551" class="Function">∃Unspent-∷</a> <a id="4837" href="Bitcoin.Consistency.html#4837" class="Bound">vb</a> <a id="4840" class="Symbol">(</a><a id="4841" href="Bitcoin.Consistency.html#4841" class="Bound">i</a> <a id="4843" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4845" href="Bitcoin.Consistency.html#4845" class="Bound">j</a> <a id="4847" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4849" href="Bitcoin.Consistency.html#4849" class="Bound">p</a> <a id="4851" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4853" href="Bitcoin.Consistency.html#4853" class="Bound">o≡</a><a id="4855" class="Symbol">)</a> <a id="4857" href="Bitcoin.Consistency.html#4857" class="Bound">in∉</a> <a id="4861" class="Symbol">=</a> <a id="4863" href="Data.Fin.Base.html#1188" class="InductiveConstructor">fsuc</a> <a id="4868" href="Bitcoin.Consistency.html#4841" class="Bound">i</a> <a id="4870" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4872" href="Bitcoin.Consistency.html#4845" class="Bound">j</a> <a id="4874" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4876" href="Bitcoin.Consistency.html#3655" class="Function">Unspent-∷</a> <a id="4886" href="Bitcoin.Consistency.html#4849" class="Bound">p</a> <a id="4888" href="Bitcoin.Consistency.html#4857" class="Bound">in∉</a> <a id="4892" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="4894" href="Bitcoin.Consistency.html#4853" class="Bound">o≡</a>

<a id="4898" class="Comment">-- (2) Alternative set-theoretic/constructive formulation of the UTXO set, similar to the one in EUTXO.</a>
<a id="stxo"></a><a id="5002" href="Bitcoin.Consistency.html#5002" class="Function">stxo</a> <a id="5007" class="Symbol">:</a> <a id="5009" class="Symbol">∀</a> <a id="5011" class="Symbol">{</a><a id="5012" href="Bitcoin.Consistency.html#5012" class="Bound">tx</a> <a id="5015" href="Bitcoin.Consistency.html#5015" class="Bound">b</a> <a id="5017" href="Bitcoin.Consistency.html#5017" class="Bound">t</a><a id="5018" class="Symbol">}</a> <a id="5020" class="Symbol">→</a> <a id="5022" href="Bitcoin.Consistency.html#2926" class="Datatype">ConsistentBlockchain</a> <a id="5043" class="Symbol">((</a><a id="5045" href="Bitcoin.Consistency.html#5012" class="Bound">tx</a> <a id="5048" class="InductiveConstructor Operator">at</a> <a id="5051" href="Bitcoin.Consistency.html#5017" class="Bound">t</a><a id="5052" class="Symbol">)</a> <a id="5054" class="InductiveConstructor Operator">∷</a> <a id="5056" href="Bitcoin.Consistency.html#5015" class="Bound">b</a><a id="5057" class="Symbol">)</a> <a id="5059" class="Symbol">→</a> <a id="5061" href="Agda.Builtin.List.html#130" class="Datatype">List</a> <a id="5066" href="Bitcoin.Tx.Base.html#857" class="Function">∃TxOutput</a>
<a id="5076" href="Bitcoin.Consistency.html#5002" class="Function">stxo</a> <a id="5081" class="Symbol">{</a><a id="5082" class="Argument">tx</a> <a id="5085" class="Symbol">=</a> <a id="5087" href="Bitcoin.Consistency.html#5087" class="Bound">i</a> <a id="5089" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5091" class="Symbol">_</a> <a id="5093" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5095" class="Symbol">_}</a> <a id="5098" class="Symbol">(_</a> <a id="5101" href="Bitcoin.Consistency.html#3118" class="InductiveConstructor Operator">⊕</a> <a id="5103" href="Bitcoin.Consistency.html#5103" class="Bound">tx</a> <a id="5106" href="Bitcoin.Consistency.html#3118" class="InductiveConstructor Operator">∶-</a> <a id="5109" href="Bitcoin.Consistency.html#5109" class="Bound">p</a><a id="5110" class="Symbol">)</a>
  <a id="5114" class="Symbol">=</a> <a id="5116" href="Data.List.Base.html#1553" class="Function">map</a> <a id="5120" href="Bitcoin.Consistency.html#5159" class="Function">f</a> <a id="5122" class="Symbol">(</a><a id="5123" href="Data.List.Base.html#6333" class="Function">allFin</a> <a id="5130" href="Bitcoin.Consistency.html#5087" class="Bound">i</a><a id="5131" class="Symbol">)</a>
  <a id="5135" class="Keyword">module</a> <a id="∣stxo∣"></a><a id="5142" href="Bitcoin.Consistency.html#5142" class="Module">∣stxo∣</a> <a id="5149" class="Keyword">where</a>
    <a id="∣stxo∣.f"></a><a id="5159" href="Bitcoin.Consistency.html#5159" class="Function">f</a> <a id="5161" class="Symbol">:</a> <a id="5163" href="Data.Fin.Base.html#1135" class="Datatype">Fin</a> <a id="5167" href="Bitcoin.Consistency.html#5087" class="Bound">i</a> <a id="5169" class="Symbol">→</a> <a id="5171" href="Bitcoin.Tx.Base.html#857" class="Function">∃TxOutput</a>
    <a id="5185" href="Bitcoin.Consistency.html#5159" class="Function">f</a> <a id="5187" href="Bitcoin.Consistency.html#5187" class="Bound">i</a> <a id="5189" class="Symbol">=</a>
      <a id="5197" class="Keyword">let</a>
        <a id="5209" class="Keyword">record</a> <a id="5216" class="Symbol">{</a><a id="5217" href="Bitcoin.Consistency.html#1800" class="Field">singleMatch</a> <a id="5229" class="Symbol">=</a> <a id="5231" href="Bitcoin.Consistency.html#5231" class="Bound">singleMatch</a><a id="5242" class="Symbol">;</a> <a id="5244" href="Bitcoin.Consistency.html#1930" class="Field">noOutOfBounds</a> <a id="5258" class="Symbol">=</a> <a id="5260" href="Bitcoin.Consistency.html#5260" class="Bound">noOutOfBounds</a><a id="5273" class="Symbol">}</a> <a id="5275" class="Symbol">=</a> <a id="5277" href="Bitcoin.Consistency.html#5109" class="Bound">p</a>
        <a id="5287" class="Symbol">(_</a> <a id="5290" href="Bitcoin.Tx.Base.html#394" class="InductiveConstructor Operator">at</a> <a id="5293" href="Bitcoin.Consistency.html#5293" class="Bound">oᵢ</a><a id="5295" class="Symbol">)</a> <a id="5297" class="Symbol">=</a> <a id="5299" href="Bitcoin.Consistency.html#5103" class="Bound">tx</a> <a id="5302" href="Bitcoin.Tx.Base.html#2230" class="Function Operator">‼ⁱ</a> <a id="5305" href="Bitcoin.Consistency.html#5187" class="Bound">i</a>
        <a id="5315" class="Symbol">(((_</a> <a id="5320" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5322" href="Bitcoin.Consistency.html#5322" class="Bound">o</a> <a id="5324" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5326" href="Bitcoin.Consistency.html#5326" class="Bound">Tᵢ</a><a id="5328" class="Symbol">)</a> <a id="5330" href="Bitcoin.Tx.Base.html#2667" class="InductiveConstructor Operator">at</a> <a id="5333" href="Bitcoin.Consistency.html#5333" class="Bound">tᵢ</a><a id="5335" class="Symbol">)</a> <a id="5337" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5339" class="Symbol">_)</a> <a id="5342" class="Symbol">=</a> <a id="5344" href="Bitcoin.Consistency.html#5231" class="Bound">singleMatch</a> <a id="5356" href="Bitcoin.Consistency.html#5187" class="Bound">i</a>
        <a id="5366" href="Bitcoin.Consistency.html#5366" class="Bound">oᵢ</a> <a id="5369" class="Symbol">=</a> <a id="5371" href="Data.Fin.Base.html#1982" class="Function">F.fromℕ&lt;</a> <a id="5380" class="Symbol">{</a><a id="5381" class="Argument">m</a> <a id="5383" class="Symbol">=</a> <a id="5385" href="Bitcoin.Consistency.html#5293" class="Bound">oᵢ</a><a id="5387" class="Symbol">}</a> <a id="5389" class="Symbol">{</a><a id="5390" class="Argument">n</a> <a id="5392" class="Symbol">=</a> <a id="5394" href="Bitcoin.Consistency.html#5322" class="Bound">o</a><a id="5395" class="Symbol">}</a> <a id="5397" class="Symbol">(</a><a id="5398" href="Bitcoin.Consistency.html#5260" class="Bound">noOutOfBounds</a> <a id="5412" href="Bitcoin.Consistency.html#5187" class="Bound">i</a><a id="5413" class="Symbol">)</a>
      <a id="5421" class="Keyword">in</a>
        <a id="5432" href="Bitcoin.Consistency.html#5326" class="Bound">Tᵢ</a> <a id="5435" href="Bitcoin.Tx.Base.html#2427" class="Function Operator">‼ᵒ</a> <a id="5438" href="Bitcoin.Consistency.html#5366" class="Bound">oᵢ</a>

<a id="utxoₜₓ"></a><a id="5442" href="Bitcoin.Consistency.html#5442" class="Function">utxoₜₓ</a> <a id="5449" class="Symbol">:</a> <a id="5451" href="Bitcoin.Tx.Base.html#1467" class="Function">∃Tx</a> <a id="5455" class="Symbol">→</a> <a id="5457" href="Prelude.Sets.AsUniqueLists.Core.html#1017" class="Record">Set⟨</a> <a id="5462" href="Bitcoin.Tx.Base.html#857" class="Function">∃TxOutput</a> <a id="5472" href="Prelude.Sets.AsUniqueLists.Core.html#1017" class="Record">⟩</a>
<a id="5474" href="Bitcoin.Consistency.html#5442" class="Function">utxoₜₓ</a> <a id="5481" class="Symbol">(_</a> <a id="5484" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5486" class="Symbol">_</a> <a id="5488" href="Agda.Builtin.Sigma.html#218" class="InductiveConstructor Operator">,</a> <a id="5490" href="Bitcoin.Consistency.html#5490" class="Bound">tx</a><a id="5492" class="Symbol">)</a> <a id="5494" class="Symbol">=</a> <a id="5496" href="Bitcoin.Consistency.html#5490" class="Bound">tx</a> <a id="5499" class="Symbol">.</a><a id="5500" href="Bitcoin.Tx.Base.html#1302" class="Field">outputs</a> <a id="5508" href="Prelude.ToList.html#215" class="Function Operator">∙toList</a> <a id="5516" href="Prelude.FromList.html#221" class="Function Operator">∙fromList</a>

<a id="utxo"></a><a id="5527" href="Bitcoin.Consistency.html#5527" class="Function">utxo</a> <a id="5532" class="Symbol">:</a> <a id="5534" class="Symbol">(</a><a id="5535" href="Bitcoin.Consistency.html#5535" class="Bound">b</a> <a id="5537" class="Symbol">:</a> <a id="5539" href="Bitcoin.Consistency.html#650" class="Function">Blockchain</a><a id="5549" class="Symbol">)</a> <a id="5551" class="Symbol">→</a> <a id="5553" href="Bitcoin.Consistency.html#2926" class="Datatype">ConsistentBlockchain</a> <a id="5574" href="Bitcoin.Consistency.html#5535" class="Bound">b</a> <a id="5576" class="Symbol">→</a> <a id="5578" href="Prelude.Sets.AsUniqueLists.Core.html#1017" class="Record">Set⟨</a> <a id="5583" href="Bitcoin.Tx.Base.html#857" class="Function">∃TxOutput</a> <a id="5593" href="Prelude.Sets.AsUniqueLists.Core.html#1017" class="Record">⟩</a>
<a id="5595" href="Bitcoin.Consistency.html#5527" class="Function">utxo</a> <a id="5600" class="DottedPattern Symbol">.</a><a id="5601" href="Agda.Builtin.List.html#167" class="DottedPattern InductiveConstructor">[]</a> <a id="5604" href="Bitcoin.Consistency.html#3086" class="InductiveConstructor">∎</a> <a id="5606" class="Symbol">=</a> <a id="5608" href="Prelude.Sets.AsUniqueLists.Core.html#2842" class="InductiveConstructor">∅</a>
<a id="5610" href="Bitcoin.Consistency.html#5527" class="Function">utxo</a> <a id="5615" class="Symbol">(</a><a id="5616" class="DottedPattern Symbol">.((_</a> <a id="5621" href="Agda.Builtin.Sigma.html#218" class="DottedPattern InductiveConstructor Operator">,</a> <a id="5623" class="DottedPattern Symbol">_</a> <a id="5625" href="Agda.Builtin.Sigma.html#218" class="DottedPattern InductiveConstructor Operator">,</a> <a id="5627" href="Bitcoin.Consistency.html#5652" class="DottedPattern Bound">tx</a><a id="5629" class="DottedPattern Symbol">)</a> <a id="5631" href="Bitcoin.Tx.Base.html#2667" class="DottedPattern InductiveConstructor Operator">at</a> <a id="5634" class="DottedPattern Symbol">_)</a> <a id="5637" href="Agda.Builtin.List.html#182" class="InductiveConstructor Operator">∷</a> <a id="5639" href="Bitcoin.Consistency.html#5639" class="Bound">b</a><a id="5640" class="Symbol">)</a> <a id="5642" href="Bitcoin.Consistency.html#5642" class="Bound">vb₀</a><a id="5645" class="Symbol">@(</a><a id="5647" href="Bitcoin.Consistency.html#5647" class="Bound">vb</a> <a id="5650" href="Bitcoin.Consistency.html#3118" class="InductiveConstructor Operator">⊕</a> <a id="5652" href="Bitcoin.Consistency.html#5652" class="Bound">tx</a> <a id="5655" href="Bitcoin.Consistency.html#3118" class="InductiveConstructor Operator">∶-</a> <a id="5658" class="Symbol">_)</a>
  <a id="5663" class="Symbol">=</a> <a id="5665" href="Bitcoin.Consistency.html#5527" class="Function">utxo</a> <a id="5670" href="Bitcoin.Consistency.html#5639" class="Bound">b</a> <a id="5672" href="Bitcoin.Consistency.html#5647" class="Bound">vb</a> <a id="5675" href="Prelude.Sets.AsUniqueLists.Core.html#3168" class="Function Operator">─</a> <a id="5677" href="Prelude.FromList.html#197" class="Field">fromList</a> <a id="5686" class="Symbol">(</a><a id="5687" href="Bitcoin.Consistency.html#5002" class="Function">stxo</a> <a id="5692" href="Bitcoin.Consistency.html#5642" class="Bound">vb₀</a><a id="5695" class="Symbol">)</a>
  <a id="5699" href="Prelude.Sets.AsUniqueLists.Core.html#3160" class="Function Operator">∪</a> <a id="5701" href="Bitcoin.Consistency.html#5442" class="Function">utxoₜₓ</a> <a id="5708" class="Symbol">(</a><a id="5709" href="Data.Product.html#2256" class="Function Operator">-,</a> <a id="5712" href="Data.Product.html#2256" class="Function Operator">-,</a> <a id="5715" href="Bitcoin.Consistency.html#5652" class="Bound">tx</a><a id="5717" class="Symbol">)</a>

<a id="5720" class="Comment">-- T0D0: prove equivalence between (1) and (2)</a>

<a id="5768" class="Comment">-- Unspent : (b : Blockchain) → (i : Index b) → let (_ , o , Tᵢ) at tᵢ = b ‼ i in ∀ (j : Fin o) → Type</a>
<a id="5871" class="Comment">-- utxo : (b : Blockchain) → ConsistentBlockchain b → Set⟨ ∃TxOutput ⟩</a>
<a id="5942" class="Comment">-- UTXO : Blockchain → Set⟨ TxInput ⟩</a>

<a id="5981" class="Comment">{-
Unspent→UTXO : ∀ {b : Blockchain} {i : Index b} → let _ , o , tx = transaction (b ‼ i) in
               ∀ {j : Fin o}
  → Unspent b i j
    ─────────────────────────────────────────────────────────
    ((tx ♯) at toℕ j) ∈ˢ UTXO b
Unspent→UTXO {b} {i} {j} p = {!!}

UTXO→Unspent : ∀ {b : Blockchain} {i : Index b} → let _ , o , tx = transaction (b ‼ i) in
               ∀ {j : Fin o}
  → ((tx ♯) at toℕ j) ∈ˢ UTXO b
    ─────────────────────────────────────────────────────────
    Unspent b i j
UTXO→Unspent {x ∷ b} {i} {j} p = {!!}
-}</a>

<a id="6523" class="Comment">{- WIP
-- record BlockchainTx : Type where
--   field
--     b : Blockchain
--     i : Index b

--   getTTx : TimedTx
--   getTTx = b ‼ i

--   getTx : ∃Tx
--   getTx = transaction (getTTx b)

-- BlockchainTx = Σ[ b ∈ Blockchain ] Index b

-- getTTx : BlockchainTx → TimedTx
-- getTTx (b , i) = b ‼ i

-- getTx : BlockchainTx → ∃Tx
-- getTx = transaction ∘ getTTx

-- Unspent : (btx : BlockchainTx) →  Pred₀ (Fin $ ∃o $ getTx btx)
-- Unspent (b , i) j =
--   let (_ , o , Tᵢ) at tᵢ = b ‼ i in
--   ∀ (i′ : Index b) (leq : i′ F.≤ i) → let (i′ , _ , Tᵢ′) at tᵢ′ = b ‼ i′ in
--   ∀ (j′ : Fin i′) →
--     Tᵢ , j , tᵢ ↛ Tᵢ′ , j′ , tᵢ′
-}</a>
</pre></body></html>