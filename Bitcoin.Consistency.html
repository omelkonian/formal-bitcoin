<!DOCTYPE HTML>
<html><head><meta charset="utf-8"><title>Bitcoin.Consistency</title><link rel="stylesheet" href="css/Agda.css"></head><body><pre class="Agda"><a id="1" class="Comment">------------------------------------------------------------------------</a>
<a id="74" class="Comment">-- Blockchain and consistency.</a>
<a id="105" class="Comment">------------------------------------------------------------------------</a>
<a id="178" class="Keyword">module</a> <a id="185" href="Bitcoin.Consistency.html" class="Module">Bitcoin.Consistency</a> <a id="205" class="Keyword">where</a>

<a id="212" class="Keyword">open</a> <a id="217" class="Keyword">import</a> <a id="224" href="Prelude.Init.html" class="Module">Prelude.Init</a>
<a id="237" class="Keyword">open</a> <a id="242" class="Keyword">import</a> <a id="249" href="Prelude.General.html" class="Module">Prelude.General</a>
<a id="265" class="Keyword">open</a> <a id="270" class="Keyword">import</a> <a id="277" href="Prelude.Lists.html" class="Module">Prelude.Lists</a>
<a id="291" class="Keyword">open</a> <a id="296" class="Keyword">import</a> <a id="303" href="Prelude.DecEq.html" class="Module">Prelude.DecEq</a>
<a id="317" class="Keyword">open</a> <a id="322" class="Keyword">import</a> <a id="329" href="Prelude.Sets.html" class="Module">Prelude.Sets</a>
<a id="342" class="Keyword">open</a> <a id="347" class="Keyword">import</a> <a id="354" href="Prelude.Functor.html" class="Module">Prelude.Functor</a>
<a id="370" class="Keyword">open</a> <a id="375" class="Keyword">import</a> <a id="382" href="Prelude.ToN.html" class="Module">Prelude.ToN</a>

<a id="395" class="Keyword">open</a> <a id="400" class="Keyword">import</a> <a id="407" href="Bitcoin.Crypto.html" class="Module">Bitcoin.Crypto</a>
<a id="422" class="Keyword">open</a> <a id="427" class="Keyword">import</a> <a id="434" href="Bitcoin.BasicTypes.html" class="Module">Bitcoin.BasicTypes</a>
<a id="453" class="Keyword">open</a> <a id="458" class="Keyword">import</a> <a id="465" href="Bitcoin.Script.Base.html" class="Module">Bitcoin.Script.Base</a>
<a id="485" class="Keyword">open</a> <a id="490" class="Keyword">import</a> <a id="497" href="Bitcoin.Tx.Base.html" class="Module">Bitcoin.Tx.Base</a>
<a id="513" class="Keyword">open</a> <a id="518" class="Keyword">import</a> <a id="525" href="Bitcoin.Tx.Crypto.html" class="Module">Bitcoin.Tx.Crypto</a>
<a id="543" class="Keyword">open</a> <a id="548" class="Keyword">import</a> <a id="555" href="Bitcoin.Tx.Semantics.html" class="Module">Bitcoin.Tx.Semantics</a>

<a id="577" class="Comment">-- Blockchain</a>
<a id="Blockchain"></a><a id="591" href="Bitcoin.Consistency.html#591" class="Function">Blockchain</a> <a id="602" class="Symbol">:</a> <a id="604" class="PrimitiveType">Set</a>
<a id="608" href="Bitcoin.Consistency.html#591" class="Function">Blockchain</a> <a id="619" class="Symbol">=</a> <a id="621" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="626" href="Bitcoin.Tx.Base.html#2342" class="Record">TimedTx</a> <a id="634" class="Comment">-- in reverse chronological order, in contrast to the paper</a>

<a id="695" class="Keyword">variable</a> <a id="704" href="Bitcoin.Consistency.html#704" class="Generalizable">txs</a> <a id="708" href="Bitcoin.Consistency.html#708" class="Generalizable">txs′</a> <a id="713" class="Symbol">:</a> <a id="715" href="Bitcoin.Consistency.html#591" class="Function">Blockchain</a>

<a id="txSet"></a><a id="727" href="Bitcoin.Consistency.html#727" class="Function">txSet</a> <a id="733" class="Symbol">:</a> <a id="735" href="Bitcoin.Consistency.html#591" class="Function">Blockchain</a> <a id="746" class="Symbol">→</a> <a id="748" href="Prelude.Sets.Interface.html#416" class="Function">Set⟨</a> <a id="753" href="Bitcoin.Tx.Base.html#2342" class="Record">TimedTx</a> <a id="761" href="Prelude.Sets.Interface.html#416" class="Function">⟩</a>
<a id="763" href="Bitcoin.Consistency.html#727" class="Function">txSet</a> <a id="769" class="Symbol">=</a> <a id="771" href="Prelude.Sets.Interface.html#3982" class="Function">fromList</a>

<a id="match"></a><a id="781" href="Bitcoin.Consistency.html#781" class="Function">match</a> <a id="787" class="Symbol">:</a> <a id="789" href="Bitcoin.Consistency.html#591" class="Function">Blockchain</a> <a id="800" class="Symbol">→</a> <a id="802" href="Bitcoin.BasicTypes.html#266" class="Function">HashId</a> <a id="809" class="Symbol">→</a> <a id="811" href="Prelude.Sets.Interface.html#416" class="Function">Set⟨</a> <a id="816" href="Bitcoin.Tx.Base.html#2342" class="Record">TimedTx</a> <a id="824" href="Prelude.Sets.Interface.html#416" class="Function">⟩</a>
<a id="826" href="Bitcoin.Consistency.html#781" class="Function">match</a> <a id="832" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>                <a id="850" class="Symbol">_</a>   <a id="854" class="Symbol">=</a> <a id="856" href="Prelude.Sets.Interface.html#434" class="Function">∅</a>
<a id="858" href="Bitcoin.Consistency.html#781" class="Function">match</a> <a id="864" class="Symbol">((</a><a id="866" href="Bitcoin.Consistency.html#866" class="Bound">tx</a> <a id="869" href="Bitcoin.Tx.Base.html#2376" class="InductiveConstructor Operator">at</a> <a id="872" href="Bitcoin.Consistency.html#872" class="Bound">t</a><a id="873" class="Symbol">)</a> <a id="875" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="877" href="Bitcoin.Consistency.html#877" class="Bound">txs</a><a id="880" class="Symbol">)</a> <a id="882" href="Bitcoin.Consistency.html#882" class="Bound">tx♯</a> <a id="886" class="Keyword">with</a> <a id="891" href="Bitcoin.Consistency.html#866" class="Bound">tx</a> <a id="894" href="Bitcoin.Crypto.html#826" class="Field Operator">♯</a> <a id="896" href="Prelude.DecEq.Core.html#147" class="Field Operator">≟</a> <a id="898" href="Bitcoin.Consistency.html#882" class="Bound">tx♯</a>
<a id="902" class="Symbol">...</a> <a id="906" class="Symbol">|</a> <a id="908" href="Relation.Nullary.html#1685" class="InductiveConstructor">no</a> <a id="911" class="Symbol">_</a>  <a id="914" class="Symbol">=</a> <a id="916" href="Bitcoin.Consistency.html#781" class="Function">match</a> <a id="922" class="Bound">txs</a> <a id="926" class="Bound">tx♯</a>
<a id="930" class="Symbol">...</a> <a id="934" class="Symbol">|</a> <a id="936" href="Relation.Nullary.html#1648" class="InductiveConstructor">yes</a> <a id="940" class="Symbol">_</a> <a id="942" class="Symbol">=</a> <a id="944" href="Prelude.Sets.Interface.html#447" class="Function">singleton</a> <a id="954" class="Symbol">(</a><a id="955" class="Bound">tx</a> <a id="958" href="Bitcoin.Tx.Base.html#2376" class="InductiveConstructor Operator">at</a> <a id="961" class="Bound">t</a><a id="962" class="Symbol">)</a>
            <a id="976" href="Prelude.Sets.Interface.html#504" class="Function Operator">∪</a> <a id="978" href="Bitcoin.Consistency.html#781" class="Function">match</a> <a id="984" class="Bound">txs</a> <a id="988" class="Bound">tx♯</a>

<a id="993" class="Comment">-- UTXO: Unspent transaction outputs.</a>
<a id="1031" class="Comment">-- (0) EUTXO-like set-theoretic definition, based on txInputs instead of outputs for convenience</a>
<a id="UTXOₜₓ"></a><a id="1128" href="Bitcoin.Consistency.html#1128" class="Function">UTXOₜₓ</a> <a id="1135" class="Symbol">:</a> <a id="1137" href="Bitcoin.Tx.Base.html#1255" class="Function">∃Tx</a> <a id="1141" class="Symbol">→</a> <a id="1143" href="Prelude.Sets.Interface.html#416" class="Function">Set⟨</a> <a id="1148" href="Bitcoin.Tx.Base.html#343" class="Record">TxInput</a> <a id="1156" href="Prelude.Sets.Interface.html#416" class="Function">⟩</a>
<a id="1158" href="Bitcoin.Consistency.html#1128" class="Function">UTXOₜₓ</a> <a id="1165" href="Bitcoin.Consistency.html#1165" class="Bound">∃tx</a><a id="1168" class="Symbol">@(_</a> <a id="1172" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1174" href="Bitcoin.Consistency.html#1174" class="Bound">o</a> <a id="1176" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1178" href="Bitcoin.Consistency.html#1178" class="Bound">tx</a><a id="1180" class="Symbol">)</a> <a id="1182" class="Symbol">=</a> <a id="1184" href="Prelude.Sets.Interface.html#3982" class="Function">fromList</a> <a id="1193" href="Function.Base.html#1919" class="Function Operator">$</a> <a id="1195" href="Data.List.Base.html#1544" class="Function">map</a> <a id="1199" class="Symbol">(λ</a> <a id="1202" href="Bitcoin.Consistency.html#1202" class="Bound">i</a> <a id="1204" class="Symbol">→</a> <a id="1206" class="Symbol">(</a><a id="1207" href="Bitcoin.Consistency.html#1165" class="Bound">∃tx</a> <a id="1211" href="Bitcoin.Crypto.html#826" class="Field Operator">♯</a><a id="1212" class="Symbol">)</a> <a id="1214" href="Bitcoin.Tx.Base.html#377" class="InductiveConstructor Operator">at</a> <a id="1217" href="Bitcoin.Consistency.html#1202" class="Bound">i</a><a id="1218" class="Symbol">)</a> <a id="1220" class="Symbol">(</a><a id="1221" href="Data.List.Base.html#6234" class="Function">upTo</a> <a id="1226" href="Bitcoin.Consistency.html#1174" class="Bound">o</a><a id="1227" class="Symbol">)</a>

<a id="STXOₜₓ"></a><a id="1230" href="Bitcoin.Consistency.html#1230" class="Function">STXOₜₓ</a> <a id="1237" class="Symbol">:</a> <a id="1239" href="Bitcoin.Tx.Base.html#1255" class="Function">∃Tx</a> <a id="1243" class="Symbol">→</a> <a id="1245" href="Prelude.Sets.Interface.html#416" class="Function">Set⟨</a> <a id="1250" href="Bitcoin.Tx.Base.html#343" class="Record">TxInput</a> <a id="1258" href="Prelude.Sets.Interface.html#416" class="Function">⟩</a>
<a id="1260" href="Bitcoin.Consistency.html#1230" class="Function">STXOₜₓ</a> <a id="1267" class="Symbol">(_</a> <a id="1270" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1272" class="Symbol">_</a> <a id="1274" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1276" href="Bitcoin.Consistency.html#1276" class="Bound">tx</a><a id="1278" class="Symbol">)</a> <a id="1280" class="Symbol">=</a> <a id="1282" href="Prelude.Sets.Interface.html#3982" class="Function">fromList</a> <a id="1291" class="Symbol">(</a><a id="1292" href="Data.Vec.Base.html#7438" class="Function">V.toList</a> <a id="1301" href="Function.Base.html#1919" class="Function Operator">$</a> <a id="1303" href="Bitcoin.Tx.Base.html#940" class="Field">inputs</a> <a id="1310" href="Bitcoin.Consistency.html#1276" class="Bound">tx</a><a id="1312" class="Symbol">)</a>

<a id="UTXO"></a><a id="1315" href="Bitcoin.Consistency.html#1315" class="Function">UTXO</a> <a id="1320" class="Symbol">:</a> <a id="1322" href="Bitcoin.Consistency.html#591" class="Function">Blockchain</a> <a id="1333" class="Symbol">→</a> <a id="1335" href="Prelude.Sets.Interface.html#416" class="Function">Set⟨</a> <a id="1340" href="Bitcoin.Tx.Base.html#343" class="Record">TxInput</a> <a id="1348" href="Prelude.Sets.Interface.html#416" class="Function">⟩</a>
<a id="1350" href="Bitcoin.Consistency.html#1315" class="Function">UTXO</a> <a id="1355" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>              <a id="1371" class="Symbol">=</a> <a id="1373" href="Prelude.Sets.Interface.html#434" class="Function">∅</a>
<a id="1375" href="Bitcoin.Consistency.html#1315" class="Function">UTXO</a> <a id="1380" class="Symbol">(</a><a id="1381" href="Bitcoin.Consistency.html#1381" class="Bound">tx</a> <a id="1384" href="Bitcoin.Tx.Base.html#2376" class="InductiveConstructor Operator">at</a> <a id="1387" class="Symbol">_</a> <a id="1389" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="1391" href="Bitcoin.Consistency.html#1391" class="Bound">txs</a><a id="1394" class="Symbol">)</a> <a id="1396" class="Symbol">=</a> <a id="1398" href="Bitcoin.Consistency.html#1315" class="Function">UTXO</a> <a id="1403" href="Bitcoin.Consistency.html#1391" class="Bound">txs</a> <a id="1407" href="Prelude.Sets.Interface.html#500" class="Function Operator">─</a> <a id="1409" href="Bitcoin.Consistency.html#1230" class="Function">STXOₜₓ</a> <a id="1416" href="Bitcoin.Consistency.html#1381" class="Bound">tx</a>
                     <a id="1440" href="Prelude.Sets.Interface.html#504" class="Function Operator">∪</a> <a id="1442" href="Bitcoin.Consistency.html#1128" class="Function">UTXOₜₓ</a> <a id="1449" href="Bitcoin.Consistency.html#1381" class="Bound">tx</a>

<a id="1453" class="Comment">-- Consistent update.</a>
<a id="latestTime"></a><a id="1475" href="Bitcoin.Consistency.html#1475" class="Function">latestTime</a> <a id="1486" class="Symbol">:</a> <a id="1488" href="Bitcoin.Consistency.html#591" class="Function">Blockchain</a> <a id="1499" class="Symbol">→</a> <a id="1501" href="Bitcoin.BasicTypes.html#245" class="Function">Time</a>
<a id="1506" href="Bitcoin.Consistency.html#1475" class="Function">latestTime</a> <a id="1517" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>             <a id="1532" class="Symbol">=</a> <a id="1534" class="Number">0</a>
<a id="1536" href="Bitcoin.Consistency.html#1475" class="Function">latestTime</a> <a id="1547" class="Symbol">((_</a> <a id="1551" href="Bitcoin.Tx.Base.html#2376" class="InductiveConstructor Operator">at</a> <a id="1554" href="Bitcoin.Consistency.html#1554" class="Bound">t</a><a id="1555" class="Symbol">)</a> <a id="1557" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="1559" class="Symbol">_)</a> <a id="1562" class="Symbol">=</a> <a id="1564" href="Bitcoin.Consistency.html#1554" class="Bound">t</a>

<a id="1567" class="Keyword">record</a> <a id="_▷_,_"></a><a id="1574" href="Bitcoin.Consistency.html#1574" class="Record Operator">_▷_,_</a> <a id="1580" class="Symbol">(</a><a id="1581" href="Bitcoin.Consistency.html#1581" class="Bound">txs</a> <a id="1585" class="Symbol">:</a> <a id="1587" href="Bitcoin.Consistency.html#591" class="Function">Blockchain</a><a id="1597" class="Symbol">)</a> <a id="1599" class="Symbol">(</a><a id="1600" href="Bitcoin.Consistency.html#1600" class="Bound">tx</a> <a id="1603" class="Symbol">:</a> <a id="1605" href="Bitcoin.Tx.Base.html#903" class="Record">Tx</a> <a id="1608" href="Bitcoin.Tx.Base.html#1914" class="Generalizable">i</a> <a id="1610" href="Bitcoin.Tx.Base.html#1919" class="Generalizable">o</a><a id="1611" class="Symbol">)</a> <a id="1613" class="Symbol">(</a><a id="1614" href="Bitcoin.Consistency.html#1614" class="Bound">t</a> <a id="1616" class="Symbol">:</a> <a id="1618" href="Bitcoin.BasicTypes.html#245" class="Function">Time</a><a id="1622" class="Symbol">)</a> <a id="1624" class="Symbol">:</a> <a id="1626" class="PrimitiveType">Set</a> <a id="1630" class="Keyword">where</a>
  <a id="1638" class="Keyword">field</a>
    <a id="1648" class="Comment">-- well-formedness conditions</a>

    <a id="_▷_,_.inputsUnique"></a><a id="1683" href="Bitcoin.Consistency.html#1683" class="Field">inputsUnique</a> <a id="1696" class="Symbol">:</a>
      <a id="1704" href="Data.List.Relation.Unary.Unique.Setoid.html#719" class="Datatype">Unique</a> <a id="1711" class="Symbol">(</a><a id="1712" href="Data.Vec.Base.html#7438" class="Function">V.toList</a> <a id="1721" class="Symbol">(</a><a id="1722" href="Bitcoin.Tx.Base.html#940" class="Field">inputs</a> <a id="1729" href="Bitcoin.Consistency.html#1600" class="Bound">tx</a><a id="1731" class="Symbol">))</a>

    <a id="_▷_,_.singleMatch"></a><a id="1739" href="Bitcoin.Consistency.html#1739" class="Field">singleMatch</a> <a id="1751" class="Symbol">:</a> <a id="1753" class="Symbol">∀</a> <a id="1755" class="Symbol">(</a><a id="1756" href="Bitcoin.Consistency.html#1756" class="Bound">i</a> <a id="1758" class="Symbol">:</a> <a id="1760" href="Data.Fin.Base.html#1146" class="Datatype">Fin</a> <a id="1764" href="Bitcoin.Consistency.html#1608" class="Bound">i</a><a id="1765" class="Symbol">)</a> <a id="1767" class="Symbol">→</a>
      <a id="1775" class="Keyword">let</a>
        <a id="1787" class="Symbol">(</a><a id="1788" href="Bitcoin.Consistency.html#1788" class="Bound">tx♯</a> <a id="1792" href="Bitcoin.Tx.Base.html#377" class="InductiveConstructor Operator">at</a> <a id="1795" class="Symbol">_)</a> <a id="1798" class="Symbol">=</a> <a id="1800" href="Bitcoin.Consistency.html#1600" class="Bound">tx</a> <a id="1803" href="Bitcoin.Tx.Base.html#1945" class="Function Operator">‼ⁱ</a> <a id="1806" href="Bitcoin.Consistency.html#1756" class="Bound">i</a>
      <a id="1814" class="Keyword">in</a>
        <a id="1825" href="Data.Product.html#1806" class="Function">∃[</a> <a id="1828" href="Bitcoin.Consistency.html#1828" class="Bound">tx</a> <a id="1831" href="Data.Product.html#1806" class="Function">]</a> <a id="1833" class="Symbol">(</a><a id="1834" href="Bitcoin.Consistency.html#781" class="Function">match</a> <a id="1840" href="Bitcoin.Consistency.html#1581" class="Bound">txs</a> <a id="1844" href="Bitcoin.Consistency.html#1788" class="Bound">tx♯</a> <a id="1848" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="1850" href="Prelude.Sets.Interface.html#447" class="Function">singleton</a> <a id="1860" href="Bitcoin.Consistency.html#1828" class="Bound">tx</a><a id="1862" class="Symbol">)</a>

    <a id="_▷_,_.noOutOfBounds"></a><a id="1869" href="Bitcoin.Consistency.html#1869" class="Field">noOutOfBounds</a> <a id="1883" class="Symbol">:</a> <a id="1885" class="Symbol">∀</a> <a id="1887" class="Symbol">(</a><a id="1888" href="Bitcoin.Consistency.html#1888" class="Bound">i</a> <a id="1890" class="Symbol">:</a> <a id="1892" href="Data.Fin.Base.html#1146" class="Datatype">Fin</a> <a id="1896" href="Bitcoin.Consistency.html#1608" class="Bound">i</a><a id="1897" class="Symbol">)</a> <a id="1899" class="Symbol">→</a>
      <a id="1907" class="Keyword">let</a>
        <a id="1919" class="Symbol">(</a><a id="1920" href="Bitcoin.Consistency.html#1920" class="Bound">Tᵢ♯</a> <a id="1924" href="Bitcoin.Tx.Base.html#377" class="InductiveConstructor Operator">at</a> <a id="1927" href="Bitcoin.Consistency.html#1927" class="Bound">oᵢ</a><a id="1929" class="Symbol">)</a>              <a id="1944" class="Symbol">=</a> <a id="1946" href="Bitcoin.Consistency.html#1600" class="Bound">tx</a> <a id="1949" href="Bitcoin.Tx.Base.html#1945" class="Function Operator">‼ⁱ</a> <a id="1952" href="Bitcoin.Consistency.html#1888" class="Bound">i</a>
        <a id="1962" class="Symbol">(((_</a> <a id="1967" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1969" href="Bitcoin.Consistency.html#1969" class="Bound">o</a> <a id="1971" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1973" class="Symbol">_)</a> <a id="1976" href="Bitcoin.Tx.Base.html#2376" class="InductiveConstructor Operator">at</a> <a id="1979" class="Symbol">_)</a> <a id="1982" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="1984" class="Symbol">_)</a> <a id="1987" class="Symbol">=</a> <a id="1989" href="Bitcoin.Consistency.html#1739" class="Field">singleMatch</a> <a id="2001" href="Bitcoin.Consistency.html#1888" class="Bound">i</a>
      <a id="2009" class="Keyword">in</a>
        <a id="2020" href="Bitcoin.Consistency.html#1927" class="Bound">oᵢ</a> <a id="2023" href="Data.Nat.Base.html#1645" class="Function Operator">&lt;</a> <a id="2025" href="Bitcoin.Consistency.html#1969" class="Bound">o</a>

    <a id="2032" class="Comment">-------------------------------------------------------</a>

    <a id="2093" class="Comment">-- (1)</a>
    <a id="_▷_,_.inputs∈UTXO"></a><a id="2104" href="Bitcoin.Consistency.html#2104" class="Field">inputs∈UTXO</a> <a id="2116" class="Symbol">:</a> <a id="2118" class="Symbol">∀</a> <a id="2120" class="Symbol">(</a><a id="2121" href="Bitcoin.Consistency.html#2121" class="Bound">i</a> <a id="2123" class="Symbol">:</a> <a id="2125" href="Data.Fin.Base.html#1146" class="Datatype">Fin</a> <a id="2129" href="Bitcoin.Consistency.html#1608" class="Bound">i</a><a id="2130" class="Symbol">)</a> <a id="2132" class="Symbol">→</a>
      <a id="2140" href="Bitcoin.Consistency.html#1600" class="Bound">tx</a> <a id="2143" href="Bitcoin.Tx.Base.html#1945" class="Function Operator">‼ⁱ</a> <a id="2146" href="Bitcoin.Consistency.html#2121" class="Bound">i</a> <a id="2148" href="Prelude.Sets.Interface.html#473" class="Function Operator">∈ˢ</a> <a id="2151" href="Bitcoin.Consistency.html#1315" class="Function">UTXO</a> <a id="2156" href="Bitcoin.Consistency.html#1581" class="Bound">txs</a>

    <a id="2165" class="Comment">-- (2)</a>
    <a id="_▷_,_.inputsRedeemable"></a><a id="2176" href="Bitcoin.Consistency.html#2176" class="Field">inputsRedeemable</a> <a id="2193" class="Symbol">:</a> <a id="2195" class="Symbol">∀</a> <a id="2197" class="Symbol">(</a><a id="2198" href="Bitcoin.Consistency.html#2198" class="Bound">i</a> <a id="2200" class="Symbol">:</a> <a id="2202" href="Data.Fin.Base.html#1146" class="Datatype">Fin</a> <a id="2206" href="Bitcoin.Consistency.html#1608" class="Bound">i</a><a id="2207" class="Symbol">)</a> <a id="2209" class="Symbol">→</a>
      <a id="2217" class="Keyword">let</a>
        <a id="2229" class="Symbol">(_</a> <a id="2232" href="Bitcoin.Tx.Base.html#377" class="InductiveConstructor Operator">at</a> <a id="2235" href="Bitcoin.Consistency.html#2235" class="Bound">oᵢ</a><a id="2237" class="Symbol">)</a> <a id="2239" class="Symbol">=</a> <a id="2241" href="Bitcoin.Consistency.html#1600" class="Bound">tx</a> <a id="2244" href="Bitcoin.Tx.Base.html#1945" class="Function Operator">‼ⁱ</a> <a id="2247" href="Bitcoin.Consistency.html#2198" class="Bound">i</a>
        <a id="2257" class="Symbol">(((_</a> <a id="2262" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2264" href="Bitcoin.Consistency.html#2264" class="Bound">o</a> <a id="2266" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2268" href="Bitcoin.Consistency.html#2268" class="Bound">Tᵢ</a><a id="2270" class="Symbol">)</a> <a id="2272" href="Bitcoin.Tx.Base.html#2376" class="InductiveConstructor Operator">at</a> <a id="2275" href="Bitcoin.Consistency.html#2275" class="Bound">tᵢ</a><a id="2277" class="Symbol">)</a> <a id="2279" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2281" class="Symbol">_)</a> <a id="2284" class="Symbol">=</a> <a id="2286" href="Bitcoin.Consistency.html#1739" class="Field">singleMatch</a> <a id="2298" href="Bitcoin.Consistency.html#2198" class="Bound">i</a>
        <a id="2308" href="Bitcoin.Consistency.html#2308" class="Bound">oᵢ</a> <a id="2311" class="Symbol">=</a> <a id="2313" href="Data.Fin.Base.html#1993" class="Function">F.fromℕ&lt;</a> <a id="2322" class="Symbol">{</a><a id="2323" class="Argument">m</a> <a id="2325" class="Symbol">=</a> <a id="2327" href="Bitcoin.Consistency.html#2235" class="Bound">oᵢ</a><a id="2329" class="Symbol">}</a> <a id="2331" class="Symbol">{</a><a id="2332" class="Argument">n</a> <a id="2334" class="Symbol">=</a> <a id="2336" href="Bitcoin.Consistency.html#2264" class="Bound">o</a><a id="2337" class="Symbol">}</a> <a id="2339" class="Symbol">(</a><a id="2340" href="Bitcoin.Consistency.html#1869" class="Field">noOutOfBounds</a> <a id="2354" href="Bitcoin.Consistency.html#2198" class="Bound">i</a><a id="2355" class="Symbol">)</a>
        <a id="2365" href="Bitcoin.Consistency.html#2365" class="Bound">vᵢ</a> <a id="2368" class="Symbol">=</a> <a id="2370" href="Bitcoin.Tx.Base.html#658" class="Field">value</a> <a id="2376" class="Symbol">(</a><a id="2377" href="Agda.Builtin.Sigma.html#264" class="Field">proj₂</a> <a id="2383" class="Symbol">(</a><a id="2384" href="Bitcoin.Consistency.html#2268" class="Bound">Tᵢ</a> <a id="2387" href="Bitcoin.Tx.Base.html#2139" class="Function Operator">‼ᵒ</a> <a id="2390" href="Bitcoin.Consistency.html#2308" class="Bound">oᵢ</a><a id="2392" class="Symbol">))</a>
      <a id="2401" class="Keyword">in</a>
        <a id="2412" href="Bitcoin.Consistency.html#2268" class="Bound">Tᵢ</a> <a id="2415" href="Bitcoin.Tx.Semantics.html#576" class="Record Operator">,</a> <a id="2417" href="Bitcoin.Consistency.html#2308" class="Bound">oᵢ</a> <a id="2420" href="Bitcoin.Tx.Semantics.html#576" class="Record Operator">,</a> <a id="2422" href="Bitcoin.Consistency.html#2275" class="Bound">tᵢ</a> <a id="2425" href="Bitcoin.Tx.Semantics.html#576" class="Record Operator">↝[</a> <a id="2428" href="Bitcoin.Consistency.html#2365" class="Bound">vᵢ</a> <a id="2431" href="Bitcoin.Tx.Semantics.html#576" class="Record Operator">]</a> <a id="2433" href="Bitcoin.Consistency.html#1600" class="Bound">tx</a> <a id="2436" href="Bitcoin.Tx.Semantics.html#576" class="Record Operator">,</a> <a id="2438" href="Bitcoin.Consistency.html#2198" class="Bound">i</a> <a id="2440" href="Bitcoin.Tx.Semantics.html#576" class="Record Operator">,</a> <a id="2442" href="Bitcoin.Consistency.html#1614" class="Bound">t</a>

    <a id="2449" class="Comment">-- (3)</a>
    <a id="_▷_,_.valuesPreserved"></a><a id="2460" href="Bitcoin.Consistency.html#2460" class="Field">valuesPreserved</a> <a id="2476" class="Symbol">:</a>
      <a id="2484" class="Keyword">let</a>
        <a id="2496" href="Bitcoin.Consistency.html#2496" class="Bound">ins</a>  <a id="2501" class="Symbol">=</a> <a id="2503" href="Data.Vec.Base.html#5888" class="Function">V.tabulate</a> <a id="2514" class="Symbol">λ</a> <a id="2516" href="Bitcoin.Consistency.html#2516" class="Bound">i</a> <a id="2518" class="Symbol">→</a> <a id="2520" class="Keyword">let</a> <a id="2524" class="Symbol">(_</a> <a id="2527" href="Bitcoin.Tx.Base.html#377" class="InductiveConstructor Operator">at</a> <a id="2530" href="Bitcoin.Consistency.html#2530" class="Bound">oᵢ</a><a id="2532" class="Symbol">)</a> <a id="2534" class="Symbol">=</a> <a id="2536" href="Bitcoin.Consistency.html#1600" class="Bound">tx</a> <a id="2539" href="Bitcoin.Tx.Base.html#1945" class="Function Operator">‼ⁱ</a> <a id="2542" href="Bitcoin.Consistency.html#2516" class="Bound">i</a>
                                    <a id="2580" class="Symbol">(((_</a> <a id="2585" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2587" href="Bitcoin.Consistency.html#2587" class="Bound">o</a> <a id="2589" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2591" href="Bitcoin.Consistency.html#2591" class="Bound">Tᵢ</a><a id="2593" class="Symbol">)</a> <a id="2595" href="Bitcoin.Tx.Base.html#2376" class="InductiveConstructor Operator">at</a> <a id="2598" href="Bitcoin.Consistency.html#2598" class="Bound">tᵢ</a><a id="2600" class="Symbol">)</a> <a id="2602" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="2604" class="Symbol">_)</a> <a id="2607" class="Symbol">=</a> <a id="2609" href="Bitcoin.Consistency.html#1739" class="Field">singleMatch</a> <a id="2621" href="Bitcoin.Consistency.html#2516" class="Bound">i</a>
                                    <a id="2659" href="Bitcoin.Consistency.html#2659" class="Bound">oᵢ</a> <a id="2662" class="Symbol">=</a> <a id="2664" href="Data.Fin.Base.html#1993" class="Function">F.fromℕ&lt;</a> <a id="2673" class="Symbol">{</a><a id="2674" class="Argument">m</a> <a id="2676" class="Symbol">=</a> <a id="2678" href="Bitcoin.Consistency.html#2530" class="Bound">oᵢ</a><a id="2680" class="Symbol">}</a> <a id="2682" class="Symbol">{</a><a id="2683" class="Argument">n</a> <a id="2685" class="Symbol">=</a> <a id="2687" href="Bitcoin.Consistency.html#2587" class="Bound">o</a><a id="2688" class="Symbol">}</a> <a id="2690" class="Symbol">(</a><a id="2691" href="Bitcoin.Consistency.html#1869" class="Field">noOutOfBounds</a> <a id="2705" href="Bitcoin.Consistency.html#2516" class="Bound">i</a><a id="2706" class="Symbol">)</a>
                                <a id="2740" class="Keyword">in</a> <a id="2743" href="Bitcoin.Tx.Base.html#658" class="Field">value</a> <a id="2749" class="Symbol">(</a><a id="2750" href="Agda.Builtin.Sigma.html#264" class="Field">proj₂</a> <a id="2756" class="Symbol">(</a><a id="2757" href="Bitcoin.Consistency.html#2591" class="Bound">Tᵢ</a> <a id="2760" href="Bitcoin.Tx.Base.html#2139" class="Function Operator">‼ᵒ</a> <a id="2763" href="Bitcoin.Consistency.html#2659" class="Bound">oᵢ</a><a id="2765" class="Symbol">))</a>
        <a id="2776" href="Bitcoin.Consistency.html#2776" class="Bound">outs</a> <a id="2781" class="Symbol">=</a> <a id="2783" href="Data.Vec.Base.html#2580" class="Function">V.map</a> <a id="2789" class="Symbol">(</a><a id="2790" href="Bitcoin.Tx.Base.html#658" class="Field">value</a> <a id="2796" href="Function.Base.html#1031" class="Function Operator">∘</a> <a id="2798" href="Agda.Builtin.Sigma.html#264" class="Field">proj₂</a><a id="2803" class="Symbol">)</a> <a id="2805" class="Symbol">(</a><a id="2806" href="Bitcoin.Tx.Base.html#1090" class="Field">outputs</a> <a id="2814" href="Bitcoin.Consistency.html#1600" class="Bound">tx</a><a id="2816" class="Symbol">)</a>
      <a id="2824" class="Keyword">in</a>
        <a id="2835" href="Data.Vec.Base.html#5414" class="Function">V.sum</a> <a id="2841" href="Bitcoin.Consistency.html#2496" class="Bound">ins</a> <a id="2845" href="Data.Nat.Base.html#1679" class="Function Operator">≥</a> <a id="2847" href="Data.Vec.Base.html#5414" class="Function">V.sum</a> <a id="2853" href="Bitcoin.Consistency.html#2776" class="Bound">outs</a>

    <a id="2863" class="Comment">-- (4)</a>
    <a id="_▷_,_.laterTime"></a><a id="2874" href="Bitcoin.Consistency.html#2874" class="Field">laterTime</a> <a id="2884" class="Symbol">:</a>
      <a id="2892" href="Bitcoin.Consistency.html#1614" class="Bound">t</a> <a id="2894" href="Data.Nat.Base.html#1679" class="Function Operator">≥</a> <a id="2896" href="Bitcoin.Consistency.html#1475" class="Function">latestTime</a> <a id="2907" href="Bitcoin.Consistency.html#1581" class="Bound">txs</a>

<a id="2912" class="Comment">-- Consistency.</a>
<a id="2928" class="Keyword">data</a> <a id="ConsistentBlockchain"></a><a id="2933" href="Bitcoin.Consistency.html#2933" class="Datatype">ConsistentBlockchain</a> <a id="2954" class="Symbol">:</a> <a id="2956" href="Bitcoin.Consistency.html#591" class="Function">Blockchain</a> <a id="2967" class="Symbol">→</a> <a id="2969" class="PrimitiveType">Set</a> <a id="2973" class="Keyword">where</a>
  <a id="2981" class="Comment">-- ∙_∶-_  : (tx : Tx 0 o)</a>
  <a id="3009" class="Comment">--        → Coinbase tx</a>
  <a id="3035" class="Comment">--        → ConsistentBlockchain [ (_ , _ , tx) at 0 ]</a>
  <a id="ConsistentBlockchain.∙"></a><a id="3092" href="Bitcoin.Consistency.html#3092" class="InductiveConstructor">∙</a>  <a id="3095" class="Symbol">:</a> <a id="3097" href="Bitcoin.Consistency.html#2933" class="Datatype">ConsistentBlockchain</a> <a id="3118" href="Agda.Builtin.List.html#185" class="InductiveConstructor">[]</a>

  <a id="ConsistentBlockchain._⊕_∶-_"></a><a id="3124" href="Bitcoin.Consistency.html#3124" class="InductiveConstructor Operator">_⊕_∶-_</a> <a id="3131" class="Symbol">:</a> <a id="3133" href="Bitcoin.Consistency.html#2933" class="Datatype">ConsistentBlockchain</a> <a id="3154" href="Bitcoin.Consistency.html#704" class="Generalizable">txs</a>
         <a id="3167" class="Symbol">→</a> <a id="3169" class="Symbol">(</a><a id="3170" href="Bitcoin.Consistency.html#3170" class="Bound">tx</a> <a id="3173" class="Symbol">:</a> <a id="3175" href="Bitcoin.Tx.Base.html#903" class="Record">Tx</a> <a id="3178" href="Bitcoin.Tx.Base.html#1914" class="Generalizable">i</a> <a id="3180" href="Bitcoin.Tx.Base.html#1919" class="Generalizable">o</a><a id="3181" class="Symbol">)</a>
         <a id="3192" class="Symbol">→</a> <a id="3194" href="Bitcoin.Consistency.html#704" class="Generalizable">txs</a> <a id="3198" href="Bitcoin.Consistency.html#1574" class="Record Operator">▷</a> <a id="3200" href="Bitcoin.Consistency.html#3170" class="Bound">tx</a> <a id="3203" href="Bitcoin.Consistency.html#1574" class="Record Operator">,</a> <a id="3205" href="Bitcoin.BasicTypes.html#313" class="Generalizable">t</a>
         <a id="3216" class="Symbol">→</a> <a id="3218" href="Bitcoin.Consistency.html#2933" class="Datatype">ConsistentBlockchain</a> <a id="3239" class="Symbol">(((_</a> <a id="3244" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3246" class="Symbol">_</a> <a id="3248" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3250" href="Bitcoin.Consistency.html#3170" class="Bound">tx</a><a id="3252" class="Symbol">)</a> <a id="3254" href="Bitcoin.Tx.Base.html#2376" class="InductiveConstructor Operator">at</a> <a id="3257" href="Bitcoin.BasicTypes.html#313" class="Generalizable">t</a><a id="3258" class="Symbol">)</a> <a id="3260" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3262" href="Bitcoin.Consistency.html#704" class="Generalizable">txs</a><a id="3265" class="Symbol">)</a>

<a id="3268" class="Comment">-- (1) Non-constructive/indirect formulation of the UTXO set, via describing when an output is unspent.</a>
<a id="Unspent"></a><a id="3372" href="Bitcoin.Consistency.html#3372" class="Function">Unspent</a> <a id="3380" class="Symbol">:</a> <a id="3382" class="Symbol">(</a><a id="3383" href="Bitcoin.Consistency.html#3383" class="Bound">b</a> <a id="3385" class="Symbol">:</a> <a id="3387" href="Bitcoin.Consistency.html#591" class="Function">Blockchain</a><a id="3397" class="Symbol">)</a> <a id="3399" class="Symbol">→</a> <a id="3401" class="Symbol">(</a><a id="3402" href="Bitcoin.Consistency.html#3402" class="Bound">i</a> <a id="3404" class="Symbol">:</a> <a id="3406" href="Prelude.Lists.html#1140" class="Function">Index</a> <a id="3412" href="Bitcoin.Consistency.html#3383" class="Bound">b</a><a id="3413" class="Symbol">)</a> <a id="3415" class="Symbol">→</a> <a id="3417" class="Keyword">let</a> <a id="3421" class="Symbol">(_</a> <a id="3424" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3426" href="Bitcoin.Consistency.html#3426" class="Bound">o</a> <a id="3428" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3430" href="Bitcoin.Consistency.html#3430" class="Bound">Tᵢ</a><a id="3432" class="Symbol">)</a> <a id="3434" href="Bitcoin.Tx.Base.html#2376" class="InductiveConstructor Operator">at</a> <a id="3437" href="Bitcoin.Consistency.html#3437" class="Bound">tᵢ</a> <a id="3440" class="Symbol">=</a> <a id="3442" href="Bitcoin.Consistency.html#3383" class="Bound">b</a> <a id="3444" href="Prelude.Lists.html#1246" class="Function Operator">‼</a> <a id="3446" href="Bitcoin.Consistency.html#3402" class="Bound">i</a> <a id="3448" class="Keyword">in</a>
        <a id="3459" class="Symbol">∀</a> <a id="3461" class="Symbol">(</a><a id="3462" href="Bitcoin.Consistency.html#3462" class="Bound">j</a> <a id="3464" class="Symbol">:</a> <a id="3466" href="Data.Fin.Base.html#1146" class="Datatype">Fin</a> <a id="3470" href="Bitcoin.Consistency.html#3426" class="Bound">o</a><a id="3471" class="Symbol">)</a> <a id="3473" class="Symbol">→</a> <a id="3475" class="PrimitiveType">Set</a>
<a id="3479" href="Bitcoin.Consistency.html#3372" class="Function">Unspent</a> <a id="3487" href="Bitcoin.Consistency.html#3487" class="Bound">b</a> <a id="3489" href="Bitcoin.Consistency.html#3489" class="Bound">i</a> <a id="3491" href="Bitcoin.Consistency.html#3491" class="Bound">j</a> <a id="3493" class="Symbol">=</a>
  <a id="3497" class="Keyword">let</a> <a id="3501" class="Symbol">(_</a> <a id="3504" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3506" href="Bitcoin.Consistency.html#3506" class="Bound">o</a> <a id="3508" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3510" href="Bitcoin.Consistency.html#3510" class="Bound">Tᵢ</a><a id="3512" class="Symbol">)</a> <a id="3514" href="Bitcoin.Tx.Base.html#2376" class="InductiveConstructor Operator">at</a> <a id="3517" href="Bitcoin.Consistency.html#3517" class="Bound">tᵢ</a> <a id="3520" class="Symbol">=</a> <a id="3522" href="Bitcoin.Consistency.html#3487" class="Bound">b</a> <a id="3524" href="Prelude.Lists.html#1246" class="Function Operator">‼</a> <a id="3526" href="Bitcoin.Consistency.html#3489" class="Bound">i</a> <a id="3528" class="Keyword">in</a>
  <a id="3533" class="Symbol">∀</a> <a id="3535" class="Symbol">(</a><a id="3536" href="Bitcoin.Consistency.html#3536" class="Bound">i′</a> <a id="3539" class="Symbol">:</a> <a id="3541" href="Prelude.Lists.html#1140" class="Function">Index</a> <a id="3547" href="Bitcoin.Consistency.html#3487" class="Bound">b</a><a id="3548" class="Symbol">)</a> <a id="3550" class="Symbol">(</a><a id="3551" href="Bitcoin.Consistency.html#3551" class="Bound">leq</a> <a id="3555" class="Symbol">:</a> <a id="3557" href="Bitcoin.Consistency.html#3536" class="Bound">i′</a> <a id="3560" href="Data.Fin.Base.html#6966" class="Function Operator">F.≤</a> <a id="3564" href="Bitcoin.Consistency.html#3489" class="Bound">i</a><a id="3565" class="Symbol">)</a>  <a id="3568" class="Symbol">→</a> <a id="3570" class="Keyword">let</a> <a id="3574" class="Symbol">(</a><a id="3575" href="Bitcoin.Consistency.html#3575" class="Bound">i′</a> <a id="3578" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3580" class="Symbol">_</a> <a id="3582" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3584" href="Bitcoin.Consistency.html#3584" class="Bound">Tᵢ′</a><a id="3587" class="Symbol">)</a> <a id="3589" href="Bitcoin.Tx.Base.html#2376" class="InductiveConstructor Operator">at</a> <a id="3592" href="Bitcoin.Consistency.html#3592" class="Bound">tᵢ′</a> <a id="3596" class="Symbol">=</a> <a id="3598" href="Bitcoin.Consistency.html#3487" class="Bound">b</a> <a id="3600" href="Prelude.Lists.html#1246" class="Function Operator">‼</a> <a id="3602" href="Bitcoin.Consistency.html#3536" class="Bound">i′</a> <a id="3605" class="Keyword">in</a>
  <a id="3610" class="Symbol">∀</a> <a id="3612" class="Symbol">(</a><a id="3613" href="Bitcoin.Consistency.html#3613" class="Bound">j′</a> <a id="3616" class="Symbol">:</a> <a id="3618" href="Data.Fin.Base.html#1146" class="Datatype">Fin</a> <a id="3622" href="Bitcoin.Consistency.html#3575" class="Bound">i′</a><a id="3624" class="Symbol">)</a> <a id="3626" class="Symbol">→</a>
    <a id="3632" href="Bitcoin.Consistency.html#3510" class="Bound">Tᵢ</a> <a id="3635" href="Bitcoin.Tx.Semantics.html#1215" class="Function Operator">,</a> <a id="3637" href="Bitcoin.Consistency.html#3491" class="Bound">j</a> <a id="3639" href="Bitcoin.Tx.Semantics.html#1215" class="Function Operator">,</a> <a id="3641" href="Bitcoin.Consistency.html#3517" class="Bound">tᵢ</a> <a id="3644" href="Bitcoin.Tx.Semantics.html#1215" class="Function Operator">↛</a> <a id="3646" href="Bitcoin.Consistency.html#3584" class="Bound">Tᵢ′</a> <a id="3650" href="Bitcoin.Tx.Semantics.html#1215" class="Function Operator">,</a> <a id="3652" href="Bitcoin.Consistency.html#3613" class="Bound">j′</a> <a id="3655" href="Bitcoin.Tx.Semantics.html#1215" class="Function Operator">,</a> <a id="3657" href="Bitcoin.Consistency.html#3592" class="Bound">tᵢ′</a>

<a id="Unspent-∷"></a><a id="3662" href="Bitcoin.Consistency.html#3662" class="Function">Unspent-∷</a> <a id="3672" class="Symbol">:</a> <a id="3674" class="Symbol">∀</a> <a id="3676" class="Symbol">{</a><a id="3677" href="Bitcoin.Consistency.html#3677" class="Bound">tx</a> <a id="3680" href="Bitcoin.Consistency.html#3680" class="Bound">t</a><a id="3681" class="Symbol">}</a> <a id="3683" class="Symbol">{</a><a id="3684" href="Bitcoin.Consistency.html#3684" class="Bound">b</a> <a id="3686" class="Symbol">:</a> <a id="3688" href="Bitcoin.Consistency.html#591" class="Function">Blockchain</a><a id="3698" class="Symbol">}</a> <a id="3700" class="Symbol">{</a><a id="3701" href="Bitcoin.Consistency.html#3701" class="Bound">i</a> <a id="3703" class="Symbol">:</a> <a id="3705" href="Prelude.Lists.html#1140" class="Function">Index</a> <a id="3711" href="Bitcoin.Consistency.html#3684" class="Bound">b</a><a id="3712" class="Symbol">}</a> <a id="3714" class="Symbol">→</a> <a id="3716" class="Keyword">let</a> <a id="3720" class="Symbol">(_</a> <a id="3723" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3725" href="Bitcoin.Consistency.html#3725" class="Bound">o</a> <a id="3727" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3729" href="Bitcoin.Consistency.html#3729" class="Bound">Tᵢ</a><a id="3731" class="Symbol">)</a> <a id="3733" href="Bitcoin.Tx.Base.html#2376" class="InductiveConstructor Operator">at</a> <a id="3736" href="Bitcoin.Consistency.html#3736" class="Bound">tᵢ</a> <a id="3739" class="Symbol">=</a> <a id="3741" href="Bitcoin.Consistency.html#3684" class="Bound">b</a> <a id="3743" href="Prelude.Lists.html#1246" class="Function Operator">‼</a> <a id="3745" href="Bitcoin.Consistency.html#3701" class="Bound">i</a> <a id="3747" class="Keyword">in</a> <a id="3750" class="Symbol">∀</a> <a id="3752" class="Symbol">{</a><a id="3753" href="Bitcoin.Consistency.html#3753" class="Bound">j</a> <a id="3755" class="Symbol">:</a> <a id="3757" href="Data.Fin.Base.html#1146" class="Datatype">Fin</a> <a id="3761" href="Bitcoin.Consistency.html#3725" class="Bound">o</a><a id="3762" class="Symbol">}</a>
  <a id="3766" class="Symbol">→</a> <a id="3768" href="Bitcoin.Consistency.html#3372" class="Function">Unspent</a> <a id="3776" href="Bitcoin.Consistency.html#3684" class="Bound">b</a> <a id="3778" href="Bitcoin.Consistency.html#3701" class="Bound">i</a> <a id="3780" href="Bitcoin.Consistency.html#3753" class="Bound">j</a>
  <a id="3784" class="Symbol">→</a> <a id="3786" class="Symbol">((</a><a id="3788" href="Bitcoin.Consistency.html#3729" class="Bound">Tᵢ</a> <a id="3791" href="Bitcoin.Tx.Semantics.html#487" class="Function Operator">atᵒ</a> <a id="3795" href="Bitcoin.Consistency.html#3753" class="Bound">j</a><a id="3796" class="Symbol">)</a> <a id="3798" href="Data.Vec.Membership.Setoid.html#887" class="Function Operator">V.Mem.∉</a> <a id="3806" href="Bitcoin.Tx.Base.html#1330" class="Function">∃inputs</a> <a id="3814" href="Bitcoin.Consistency.html#3677" class="Bound">tx</a><a id="3816" class="Symbol">)</a>
    <a id="3822" class="Comment">----------------------------------</a>
  <a id="3859" class="Symbol">→</a> <a id="3861" href="Bitcoin.Consistency.html#3372" class="Function">Unspent</a> <a id="3869" class="Symbol">((</a><a id="3871" href="Bitcoin.Consistency.html#3677" class="Bound">tx</a> <a id="3874" href="Bitcoin.Tx.Base.html#2376" class="InductiveConstructor Operator">at</a> <a id="3877" href="Bitcoin.Consistency.html#3680" class="Bound">t</a><a id="3878" class="Symbol">)</a> <a id="3880" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="3882" href="Bitcoin.Consistency.html#3684" class="Bound">b</a><a id="3883" class="Symbol">)</a> <a id="3885" class="Symbol">(</a><a id="3886" href="Data.Fin.Base.html#1199" class="InductiveConstructor">fsuc</a> <a id="3891" href="Bitcoin.Consistency.html#3701" class="Bound">i</a><a id="3892" class="Symbol">)</a> <a id="3894" href="Bitcoin.Consistency.html#3753" class="Bound">j</a>
<a id="3896" href="Bitcoin.Consistency.html#3662" class="Function">Unspent-∷</a> <a id="3906" class="Symbol">{</a><a id="3907" class="Argument">tx</a> <a id="3910" class="Symbol">=</a> <a id="3912" href="Bitcoin.Consistency.html#3912" class="Bound">tx</a><a id="3914" class="Symbol">}</a> <a id="3916" href="Bitcoin.Consistency.html#3916" class="Bound">unsp</a> <a id="3921" href="Bitcoin.Consistency.html#3921" class="Bound">in∉</a> <a id="3925" href="Data.Fin.Patterns.html#390" class="InductiveConstructor">0F</a> <a id="3928" href="Bitcoin.Consistency.html#3928" class="Bound">0≤</a> <a id="3931" href="Bitcoin.Consistency.html#3931" class="Bound">j′</a> <a id="3934" class="Symbol">(</a><a id="3935" href="Bitcoin.Consistency.html#3935" class="Bound">v</a> <a id="3937" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="3939" class="Keyword">record</a> <a id="3946" class="Symbol">{</a><a id="3947" href="Bitcoin.Tx.Semantics.html#914" class="Field">input~output</a> <a id="3960" class="Symbol">=</a> <a id="3962" href="Bitcoin.Consistency.html#3962" class="Bound">io</a><a id="3964" class="Symbol">})</a>
  <a id="3969" class="Symbol">=</a> <a id="3971" href="Bitcoin.Consistency.html#3921" class="Bound">in∉</a> <a id="3975" class="Symbol">(</a><a id="3976" href="Relation.Binary.PropositionalEquality.Core.html#1780" class="Function">subst</a> <a id="3982" class="Symbol">(</a><a id="3983" href="Data.Vec.Membership.Setoid.html#829" class="Function Operator">V.Mem._∈</a> <a id="3992" href="Bitcoin.Tx.Base.html#1330" class="Function">∃inputs</a> <a id="4000" href="Bitcoin.Consistency.html#3912" class="Bound">tx</a><a id="4002" class="Symbol">)</a> <a id="4004" href="Bitcoin.Consistency.html#3962" class="Bound">io</a> <a id="4007" class="Symbol">(</a><a id="4008" href="Data.Vec.Membership.Propositional.Properties.html#1198" class="Function">V.Mem.∈-lookup</a> <a id="4023" href="Bitcoin.Consistency.html#3931" class="Bound">j′</a> <a id="4026" class="Symbol">_))</a>
<a id="4030" href="Bitcoin.Consistency.html#3662" class="Function">Unspent-∷</a> <a id="4040" href="Bitcoin.Consistency.html#4040" class="Bound">unsp</a> <a id="4045" class="Symbol">_</a> <a id="4047" class="Symbol">(</a><a id="4048" href="Data.Fin.Base.html#1199" class="InductiveConstructor">fsuc</a> <a id="4053" href="Bitcoin.Consistency.html#4053" class="Bound">i′</a><a id="4055" class="Symbol">)</a> <a id="4057" class="Symbol">(</a><a id="4058" href="Data.Nat.Base.html#1600" class="InductiveConstructor">s≤s</a> <a id="4062" href="Bitcoin.Consistency.html#4062" class="Bound">leq</a><a id="4065" class="Symbol">)</a> <a id="4067" href="Bitcoin.Consistency.html#4067" class="Bound">j′</a> <a id="4070" href="Bitcoin.Consistency.html#4070" class="Bound">p</a>
  <a id="4074" class="Symbol">=</a> <a id="4076" href="Bitcoin.Consistency.html#4040" class="Bound">unsp</a> <a id="4081" href="Bitcoin.Consistency.html#4053" class="Bound">i′</a> <a id="4084" href="Bitcoin.Consistency.html#4062" class="Bound">leq</a> <a id="4088" href="Bitcoin.Consistency.html#4067" class="Bound">j′</a> <a id="4091" href="Bitcoin.Consistency.html#4070" class="Bound">p</a>

<a id="4094" class="Comment">--</a>

<a id="∃Unspent"></a><a id="4098" href="Bitcoin.Consistency.html#4098" class="Function">∃Unspent</a> <a id="4107" class="Symbol">:</a> <a id="4109" class="Symbol">(</a><a id="4110" href="Bitcoin.Consistency.html#4110" class="Bound">b</a> <a id="4112" class="Symbol">:</a> <a id="4114" href="Bitcoin.Consistency.html#591" class="Function">Blockchain</a><a id="4124" class="Symbol">)</a> <a id="4126" class="Symbol">→</a> <a id="4128" href="Bitcoin.Tx.Base.html#793" class="Function">∃TxOutput</a> <a id="4138" class="Symbol">→</a> <a id="4140" class="PrimitiveType">Set</a>
<a id="4144" href="Bitcoin.Consistency.html#4098" class="Function">∃Unspent</a> <a id="4153" href="Bitcoin.Consistency.html#4153" class="Bound">b</a> <a id="4155" href="Bitcoin.Consistency.html#4155" class="Bound">txo</a> <a id="4159" class="Symbol">=</a>
  <a id="4163" href="Agda.Builtin.Sigma.html#166" class="Record">Σ</a> <a id="4165" class="Symbol">(</a><a id="4166" href="Prelude.Lists.html#1140" class="Function">Index</a> <a id="4172" href="Bitcoin.Consistency.html#4153" class="Bound">b</a><a id="4173" class="Symbol">)</a> <a id="4175" class="Symbol">λ</a> <a id="4177" href="Bitcoin.Consistency.html#4177" class="Bound">i</a> <a id="4179" class="Symbol">→</a>
    <a id="4185" class="Keyword">let</a> <a id="4189" class="Symbol">(_</a> <a id="4192" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4194" href="Bitcoin.Consistency.html#4194" class="Bound">o</a> <a id="4196" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4198" href="Bitcoin.Consistency.html#4198" class="Bound">Tᵢ</a><a id="4200" class="Symbol">)</a> <a id="4202" href="Bitcoin.Tx.Base.html#2376" class="InductiveConstructor Operator">at</a> <a id="4205" class="Symbol">_</a> <a id="4207" class="Symbol">=</a> <a id="4209" href="Bitcoin.Consistency.html#4153" class="Bound">b</a> <a id="4211" href="Prelude.Lists.html#1246" class="Function Operator">‼</a> <a id="4213" href="Bitcoin.Consistency.html#4177" class="Bound">i</a> <a id="4215" class="Keyword">in</a>
    <a id="4222" href="Agda.Builtin.Sigma.html#166" class="Record">Σ</a> <a id="4224" class="Symbol">(</a><a id="4225" href="Data.Fin.Base.html#1146" class="Datatype">Fin</a> <a id="4229" href="Bitcoin.Consistency.html#4194" class="Bound">o</a><a id="4230" class="Symbol">)</a> <a id="4232" class="Symbol">λ</a> <a id="4234" href="Bitcoin.Consistency.html#4234" class="Bound">j</a> <a id="4236" class="Symbol">→</a>
      <a id="4244" href="Bitcoin.Consistency.html#3372" class="Function">Unspent</a> <a id="4252" href="Bitcoin.Consistency.html#4153" class="Bound">b</a> <a id="4254" href="Bitcoin.Consistency.html#4177" class="Bound">i</a> <a id="4256" href="Bitcoin.Consistency.html#4234" class="Bound">j</a> <a id="4258" href="Data.Product.html#1167" class="Function Operator">×</a> <a id="4260" class="Symbol">(</a><a id="4261" href="Bitcoin.Consistency.html#4198" class="Bound">Tᵢ</a> <a id="4264" href="Bitcoin.Tx.Base.html#2139" class="Function Operator">‼ᵒ</a> <a id="4267" href="Bitcoin.Consistency.html#4234" class="Bound">j</a> <a id="4269" href="Agda.Builtin.Equality.html#151" class="Datatype Operator">≡</a> <a id="4271" href="Bitcoin.Consistency.html#4155" class="Bound">txo</a><a id="4274" class="Symbol">)</a>



<a id="↝-irreflexive"></a><a id="4279" href="Bitcoin.Consistency.html#4279" class="Function">↝-irreflexive</a> <a id="4293" class="Symbol">:</a> <a id="4295" class="Symbol">∀</a> <a id="4297" class="Symbol">{</a><a id="4298" href="Bitcoin.Consistency.html#4298" class="Bound">T</a> <a id="4300" class="Symbol">:</a> <a id="4302" href="Bitcoin.Tx.Base.html#903" class="Record">Tx</a> <a id="4305" href="Bitcoin.Tx.Base.html#1914" class="Generalizable">i</a> <a id="4307" href="Bitcoin.Tx.Base.html#1919" class="Generalizable">o</a><a id="4308" class="Symbol">}</a> <a id="4310" class="Symbol">{</a><a id="4311" href="Bitcoin.Consistency.html#4311" class="Bound">oᵢ</a> <a id="4314" class="Symbol">:</a> <a id="4316" href="Data.Fin.Base.html#1146" class="Datatype">Fin</a> <a id="4320" href="Bitcoin.Tx.Base.html#1919" class="Generalizable">o</a><a id="4321" class="Symbol">}</a> <a id="4323" class="Symbol">{</a><a id="4324" href="Bitcoin.Consistency.html#4324" class="Bound">iᵢ</a> <a id="4327" class="Symbol">:</a> <a id="4329" href="Data.Fin.Base.html#1146" class="Datatype">Fin</a> <a id="4333" href="Bitcoin.Tx.Base.html#1914" class="Generalizable">i</a><a id="4334" class="Symbol">}</a> <a id="4336" class="Symbol">{</a><a id="4337" href="Bitcoin.Consistency.html#4337" class="Bound">t₀</a> <a id="4340" href="Bitcoin.Consistency.html#4340" class="Bound">t</a> <a id="4342" href="Bitcoin.Consistency.html#4342" class="Bound">v</a> <a id="4344" href="Bitcoin.Consistency.html#4344" class="Bound">t′</a><a id="4346" class="Symbol">}</a>
  <a id="4350" class="Symbol">→</a> <a id="4352" href="Bitcoin.Consistency.html#2933" class="Datatype">ConsistentBlockchain</a> <a id="4373" href="Data.List.Base.html#5025" class="Function Operator">[</a> <a id="4375" class="Symbol">(</a><a id="4376" href="Data.Product.html#2247" class="Function Operator">-,</a> <a id="4379" href="Data.Product.html#2247" class="Function Operator">-,</a> <a id="4382" href="Bitcoin.Consistency.html#4298" class="Bound">T</a><a id="4383" class="Symbol">)</a> <a id="4385" href="Bitcoin.Tx.Base.html#2376" class="InductiveConstructor Operator">at</a> <a id="4388" href="Bitcoin.Consistency.html#4337" class="Bound">t₀</a> <a id="4391" href="Data.List.Base.html#5025" class="Function Operator">]</a>
  <a id="4395" class="Symbol">→</a> <a id="4397" href="Relation.Nullary.html#656" class="Function Operator">¬</a> <a id="4399" class="Symbol">(</a><a id="4400" href="Bitcoin.Consistency.html#4298" class="Bound">T</a> <a id="4402" href="Bitcoin.Tx.Semantics.html#576" class="Record Operator">,</a> <a id="4404" href="Bitcoin.Consistency.html#4311" class="Bound">oᵢ</a> <a id="4407" href="Bitcoin.Tx.Semantics.html#576" class="Record Operator">,</a> <a id="4409" href="Bitcoin.Consistency.html#4340" class="Bound">t</a> <a id="4411" href="Bitcoin.Tx.Semantics.html#576" class="Record Operator">↝[</a> <a id="4414" href="Bitcoin.Consistency.html#4342" class="Bound">v</a> <a id="4416" href="Bitcoin.Tx.Semantics.html#576" class="Record Operator">]</a> <a id="4418" href="Bitcoin.Consistency.html#4298" class="Bound">T</a> <a id="4420" href="Bitcoin.Tx.Semantics.html#576" class="Record Operator">,</a> <a id="4422" href="Bitcoin.Consistency.html#4324" class="Bound">iᵢ</a> <a id="4425" href="Bitcoin.Tx.Semantics.html#576" class="Record Operator">,</a> <a id="4427" href="Bitcoin.Consistency.html#4344" class="Bound">t′</a><a id="4429" class="Symbol">)</a>
<a id="4431" href="Bitcoin.Consistency.html#4279" class="Function">↝-irreflexive</a> <a id="4445" class="Symbol">{</a><a id="4446" class="Argument">T</a> <a id="4448" class="Symbol">=</a> <a id="4450" href="Bitcoin.Consistency.html#4450" class="Bound">T</a><a id="4451" class="Symbol">}</a> <a id="4453" class="Symbol">{</a><a id="4454" class="Argument">iᵢ</a> <a id="4457" class="Symbol">=</a> <a id="4459" href="Bitcoin.Consistency.html#4459" class="Bound">iᵢ</a><a id="4461" class="Symbol">}</a> <a id="4463" class="Symbol">(</a><a id="4464" href="Bitcoin.Consistency.html#3092" class="InductiveConstructor">∙</a> <a id="4466" href="Bitcoin.Consistency.html#3124" class="InductiveConstructor Operator">⊕</a> <a id="4468" class="DottedPattern Symbol">.</a><a id="4469" href="Bitcoin.Consistency.html#4450" class="DottedPattern Bound">T</a> <a id="4471" href="Bitcoin.Consistency.html#3124" class="InductiveConstructor Operator">∶-</a> <a id="4474" class="Keyword">record</a> <a id="4481" class="Symbol">{</a><a id="4482" href="Bitcoin.Consistency.html#2104" class="Field">inputs∈UTXO</a> <a id="4494" class="Symbol">=</a> <a id="4496" href="Bitcoin.Consistency.html#4496" class="Bound">i∈</a><a id="4498" class="Symbol">})</a> <a id="4501" class="Symbol">_</a> <a id="4503" class="Symbol">=</a> <a id="4505" href="Data.Empty.html#628" class="Function">⊥-elim</a> <a id="4512" href="Function.Base.html#1919" class="Function Operator">$</a> <a id="4514" href="Prelude.Sets.Interface.html#1499" class="Function">∉∅</a> <a id="4517" class="Symbol">_</a> <a id="4519" class="Symbol">(</a><a id="4520" href="Bitcoin.Consistency.html#4496" class="Bound">i∈</a> <a id="4523" href="Bitcoin.Consistency.html#4459" class="Bound">iᵢ</a><a id="4525" class="Symbol">)</a>

<a id="4528" class="Comment">--</a>

<a id="∃Unspent-∷"></a><a id="4532" href="Bitcoin.Consistency.html#4532" class="Function">∃Unspent-∷</a> <a id="4543" class="Symbol">:</a> <a id="4545" class="Symbol">∀</a> <a id="4547" class="Symbol">{</a><a id="4548" href="Bitcoin.Consistency.html#4548" class="Bound">t</a> <a id="4550" href="Bitcoin.Consistency.html#4550" class="Bound">tx</a> <a id="4553" href="Bitcoin.Consistency.html#4553" class="Bound">b</a> <a id="4555" href="Bitcoin.Consistency.html#4555" class="Bound">o</a><a id="4556" class="Symbol">}</a>
  <a id="4560" class="Symbol">→</a> <a id="4562" class="Symbol">(</a><a id="4563" href="Bitcoin.Consistency.html#4563" class="Bound">vb</a> <a id="4566" class="Symbol">:</a> <a id="4568" href="Bitcoin.Consistency.html#2933" class="Datatype">ConsistentBlockchain</a> <a id="4589" href="Function.Base.html#1919" class="Function Operator">$</a> <a id="4591" class="Symbol">(</a><a id="4592" href="Bitcoin.Consistency.html#4550" class="Bound">tx</a> <a id="4595" href="Bitcoin.Tx.Base.html#2376" class="InductiveConstructor Operator">at</a> <a id="4598" href="Bitcoin.Consistency.html#4548" class="Bound">t</a><a id="4599" class="Symbol">)</a> <a id="4601" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="4603" href="Bitcoin.Consistency.html#4553" class="Bound">b</a><a id="4604" class="Symbol">)</a>
  <a id="4608" class="Symbol">→</a> <a id="4610" class="Symbol">(</a><a id="4611" href="Bitcoin.Consistency.html#4611" class="Bound">wit</a> <a id="4615" class="Symbol">:</a> <a id="4617" href="Bitcoin.Consistency.html#4098" class="Function">∃Unspent</a> <a id="4626" href="Bitcoin.Consistency.html#4553" class="Bound">b</a> <a id="4628" href="Bitcoin.Consistency.html#4555" class="Bound">o</a><a id="4629" class="Symbol">)</a> <a id="4631" class="Symbol">→</a> <a id="4633" class="Keyword">let</a> <a id="4637" href="Bitcoin.Consistency.html#4637" class="Bound">i</a> <a id="4639" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4641" href="Bitcoin.Consistency.html#4641" class="Bound">j</a> <a id="4643" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4645" class="Symbol">_</a> <a id="4647" class="Symbol">=</a> <a id="4649" href="Bitcoin.Consistency.html#4611" class="Bound">wit</a><a id="4652" class="Symbol">;</a> <a id="4654" class="Symbol">(_</a> <a id="4657" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4659" class="Symbol">_</a> <a id="4661" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4663" href="Bitcoin.Consistency.html#4663" class="Bound">Tᵢ</a><a id="4665" class="Symbol">)</a> <a id="4667" href="Bitcoin.Tx.Base.html#2376" class="InductiveConstructor Operator">at</a> <a id="4670" class="Symbol">_</a> <a id="4672" class="Symbol">=</a> <a id="4674" href="Bitcoin.Consistency.html#4553" class="Bound">b</a> <a id="4676" href="Prelude.Lists.html#1246" class="Function Operator">‼</a> <a id="4678" href="Bitcoin.Consistency.html#4637" class="Bound">i</a> <a id="4680" class="Keyword">in</a>
    <a id="4687" class="Symbol">(</a><a id="4688" href="Bitcoin.Consistency.html#4663" class="Bound">Tᵢ</a> <a id="4691" href="Bitcoin.Tx.Semantics.html#487" class="Function Operator">atᵒ</a> <a id="4695" href="Bitcoin.Consistency.html#4641" class="Bound">j</a> <a id="4697" href="Data.Vec.Membership.Setoid.html#887" class="Function Operator">V.Mem.∉</a> <a id="4705" href="Bitcoin.Tx.Base.html#1330" class="Function">∃inputs</a> <a id="4713" href="Bitcoin.Consistency.html#4550" class="Bound">tx</a><a id="4715" class="Symbol">)</a>
    <a id="4721" class="Comment">--------------------------</a>
  <a id="4750" class="Symbol">→</a> <a id="4752" href="Bitcoin.Consistency.html#4098" class="Function">∃Unspent</a> <a id="4761" class="Symbol">((</a><a id="4763" href="Bitcoin.Consistency.html#4550" class="Bound">tx</a> <a id="4766" href="Bitcoin.Tx.Base.html#2376" class="InductiveConstructor Operator">at</a> <a id="4769" href="Bitcoin.Consistency.html#4548" class="Bound">t</a><a id="4770" class="Symbol">)</a> <a id="4772" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="4774" href="Bitcoin.Consistency.html#4553" class="Bound">b</a><a id="4775" class="Symbol">)</a> <a id="4777" href="Bitcoin.Consistency.html#4555" class="Bound">o</a>
<a id="4779" href="Bitcoin.Consistency.html#4532" class="Function">∃Unspent-∷</a> <a id="4790" href="Bitcoin.Consistency.html#4790" class="Bound">vb</a> <a id="4793" class="Symbol">(</a><a id="4794" href="Bitcoin.Consistency.html#4794" class="Bound">i</a> <a id="4796" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4798" href="Bitcoin.Consistency.html#4798" class="Bound">j</a> <a id="4800" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4802" href="Bitcoin.Consistency.html#4802" class="Bound">p</a> <a id="4804" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4806" href="Bitcoin.Consistency.html#4806" class="Bound">o≡</a><a id="4808" class="Symbol">)</a> <a id="4810" href="Bitcoin.Consistency.html#4810" class="Bound">in∉</a> <a id="4814" class="Symbol">=</a> <a id="4816" href="Data.Fin.Base.html#1199" class="InductiveConstructor">fsuc</a> <a id="4821" href="Bitcoin.Consistency.html#4794" class="Bound">i</a> <a id="4823" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4825" href="Bitcoin.Consistency.html#4798" class="Bound">j</a> <a id="4827" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4829" href="Bitcoin.Consistency.html#3662" class="Function">Unspent-∷</a> <a id="4839" href="Bitcoin.Consistency.html#4802" class="Bound">p</a> <a id="4841" href="Bitcoin.Consistency.html#4810" class="Bound">in∉</a> <a id="4845" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="4847" href="Bitcoin.Consistency.html#4806" class="Bound">o≡</a>

<a id="4851" class="Comment">-- (2) Alternative set-theoretic/constructive formulation of the UTXO set, similar to the one in EUTXO.</a>
<a id="stxo"></a><a id="4955" href="Bitcoin.Consistency.html#4955" class="Function">stxo</a> <a id="4960" class="Symbol">:</a> <a id="4962" class="Symbol">∀</a> <a id="4964" class="Symbol">{</a><a id="4965" href="Bitcoin.Consistency.html#4965" class="Bound">tx</a> <a id="4968" href="Bitcoin.Consistency.html#4968" class="Bound">b</a> <a id="4970" href="Bitcoin.Consistency.html#4970" class="Bound">t</a><a id="4971" class="Symbol">}</a> <a id="4973" class="Symbol">→</a> <a id="4975" href="Bitcoin.Consistency.html#2933" class="Datatype">ConsistentBlockchain</a> <a id="4996" class="Symbol">((</a><a id="4998" href="Bitcoin.Consistency.html#4965" class="Bound">tx</a> <a id="5001" href="Bitcoin.Tx.Base.html#2376" class="InductiveConstructor Operator">at</a> <a id="5004" href="Bitcoin.Consistency.html#4970" class="Bound">t</a><a id="5005" class="Symbol">)</a> <a id="5007" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="5009" href="Bitcoin.Consistency.html#4968" class="Bound">b</a><a id="5010" class="Symbol">)</a> <a id="5012" class="Symbol">→</a> <a id="5014" href="Agda.Builtin.List.html#148" class="Datatype">List</a> <a id="5019" href="Bitcoin.Tx.Base.html#793" class="Function">∃TxOutput</a>
<a id="5029" href="Bitcoin.Consistency.html#4955" class="Function">stxo</a> <a id="5034" class="Symbol">{</a><a id="5035" class="Argument">tx</a> <a id="5038" class="Symbol">=</a> <a id="5040" href="Bitcoin.Consistency.html#5040" class="Bound">i</a> <a id="5042" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="5044" class="Symbol">_</a> <a id="5046" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="5048" class="DottedPattern Symbol">.</a><a id="5049" href="Bitcoin.Consistency.html#5058" class="DottedPattern Bound">tx</a><a id="5051" class="Symbol">}</a> <a id="5053" class="Symbol">(_</a> <a id="5056" href="Bitcoin.Consistency.html#3124" class="InductiveConstructor Operator">⊕</a> <a id="5058" href="Bitcoin.Consistency.html#5058" class="Bound">tx</a> <a id="5061" href="Bitcoin.Consistency.html#3124" class="InductiveConstructor Operator">∶-</a> <a id="5064" href="Bitcoin.Consistency.html#5064" class="Bound">p</a><a id="5065" class="Symbol">)</a>
  <a id="5069" class="Symbol">=</a> <a id="5071" href="Data.List.Base.html#1544" class="Function">map</a> <a id="5075" href="Bitcoin.Consistency.html#5114" class="Function">f</a> <a id="5077" class="Symbol">(</a><a id="5078" href="Data.List.Base.html#6324" class="Function">allFin</a> <a id="5085" href="Bitcoin.Consistency.html#5040" class="Bound">i</a><a id="5086" class="Symbol">)</a>
  <a id="5090" class="Keyword">module</a> <a id="∣stxo∣"></a><a id="5097" href="Bitcoin.Consistency.html#5097" class="Module">∣stxo∣</a> <a id="5104" class="Keyword">where</a>
    <a id="∣stxo∣.f"></a><a id="5114" href="Bitcoin.Consistency.html#5114" class="Function">f</a> <a id="5116" class="Symbol">:</a> <a id="5118" href="Data.Fin.Base.html#1146" class="Datatype">Fin</a> <a id="5122" href="Bitcoin.Consistency.html#5040" class="Bound">i</a> <a id="5124" class="Symbol">→</a> <a id="5126" href="Bitcoin.Tx.Base.html#793" class="Function">∃TxOutput</a>
    <a id="5140" href="Bitcoin.Consistency.html#5114" class="Function">f</a> <a id="5142" href="Bitcoin.Consistency.html#5142" class="Bound">i</a> <a id="5144" class="Symbol">=</a>
      <a id="5152" class="Keyword">let</a>
        <a id="5164" class="Keyword">record</a> <a id="5171" class="Symbol">{</a><a id="5172" href="Bitcoin.Consistency.html#1739" class="Field">singleMatch</a> <a id="5184" class="Symbol">=</a> <a id="5186" href="Bitcoin.Consistency.html#5186" class="Bound">singleMatch</a><a id="5197" class="Symbol">;</a> <a id="5199" href="Bitcoin.Consistency.html#1869" class="Field">noOutOfBounds</a> <a id="5213" class="Symbol">=</a> <a id="5215" href="Bitcoin.Consistency.html#5215" class="Bound">noOutOfBounds</a><a id="5228" class="Symbol">}</a> <a id="5230" class="Symbol">=</a> <a id="5232" href="Bitcoin.Consistency.html#5064" class="Bound">p</a>
        <a id="5242" class="Symbol">(_</a> <a id="5245" href="Bitcoin.Tx.Base.html#377" class="InductiveConstructor Operator">at</a> <a id="5248" href="Bitcoin.Consistency.html#5248" class="Bound">oᵢ</a><a id="5250" class="Symbol">)</a> <a id="5252" class="Symbol">=</a> <a id="5254" href="Bitcoin.Consistency.html#5058" class="Bound">tx</a> <a id="5257" href="Bitcoin.Tx.Base.html#1945" class="Function Operator">‼ⁱ</a> <a id="5260" href="Bitcoin.Consistency.html#5142" class="Bound">i</a>
        <a id="5270" class="Symbol">(((_</a> <a id="5275" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="5277" href="Bitcoin.Consistency.html#5277" class="Bound">o</a> <a id="5279" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="5281" href="Bitcoin.Consistency.html#5281" class="Bound">Tᵢ</a><a id="5283" class="Symbol">)</a> <a id="5285" href="Bitcoin.Tx.Base.html#2376" class="InductiveConstructor Operator">at</a> <a id="5288" href="Bitcoin.Consistency.html#5288" class="Bound">tᵢ</a><a id="5290" class="Symbol">)</a> <a id="5292" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="5294" class="Symbol">_)</a> <a id="5297" class="Symbol">=</a> <a id="5299" href="Bitcoin.Consistency.html#5186" class="Bound">singleMatch</a> <a id="5311" href="Bitcoin.Consistency.html#5142" class="Bound">i</a>
        <a id="5321" href="Bitcoin.Consistency.html#5321" class="Bound">oᵢ</a> <a id="5324" class="Symbol">=</a> <a id="5326" href="Data.Fin.Base.html#1993" class="Function">F.fromℕ&lt;</a> <a id="5335" class="Symbol">{</a><a id="5336" class="Argument">m</a> <a id="5338" class="Symbol">=</a> <a id="5340" href="Bitcoin.Consistency.html#5248" class="Bound">oᵢ</a><a id="5342" class="Symbol">}</a> <a id="5344" class="Symbol">{</a><a id="5345" class="Argument">n</a> <a id="5347" class="Symbol">=</a> <a id="5349" href="Bitcoin.Consistency.html#5277" class="Bound">o</a><a id="5350" class="Symbol">}</a> <a id="5352" class="Symbol">(</a><a id="5353" href="Bitcoin.Consistency.html#5215" class="Bound">noOutOfBounds</a> <a id="5367" href="Bitcoin.Consistency.html#5142" class="Bound">i</a><a id="5368" class="Symbol">)</a>
      <a id="5376" class="Keyword">in</a>
        <a id="5387" href="Bitcoin.Consistency.html#5281" class="Bound">Tᵢ</a> <a id="5390" href="Bitcoin.Tx.Base.html#2139" class="Function Operator">‼ᵒ</a> <a id="5393" href="Bitcoin.Consistency.html#5321" class="Bound">oᵢ</a>

<a id="utxoₜₓ"></a><a id="5397" href="Bitcoin.Consistency.html#5397" class="Function">utxoₜₓ</a> <a id="5404" class="Symbol">:</a> <a id="5406" href="Bitcoin.Tx.Base.html#1255" class="Function">∃Tx</a> <a id="5410" class="Symbol">→</a> <a id="5412" href="Prelude.Sets.Interface.html#416" class="Function">Set⟨</a> <a id="5417" href="Bitcoin.Tx.Base.html#793" class="Function">∃TxOutput</a> <a id="5427" href="Prelude.Sets.Interface.html#416" class="Function">⟩</a>
<a id="5429" href="Bitcoin.Consistency.html#5397" class="Function">utxoₜₓ</a> <a id="5436" class="Symbol">(_</a> <a id="5439" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="5441" class="Symbol">_</a> <a id="5443" href="Agda.Builtin.Sigma.html#236" class="InductiveConstructor Operator">,</a> <a id="5445" href="Bitcoin.Consistency.html#5445" class="Bound">tx</a><a id="5447" class="Symbol">)</a> <a id="5449" class="Symbol">=</a> <a id="5451" href="Prelude.Sets.Interface.html#3982" class="Function">fromList</a> <a id="5460" class="Symbol">(</a><a id="5461" href="Data.Vec.Base.html#7438" class="Function">V.toList</a> <a id="5470" href="Function.Base.html#1919" class="Function Operator">$</a> <a id="5472" href="Bitcoin.Tx.Base.html#1090" class="Field">outputs</a> <a id="5480" href="Bitcoin.Consistency.html#5445" class="Bound">tx</a><a id="5482" class="Symbol">)</a>

<a id="utxo"></a><a id="5485" href="Bitcoin.Consistency.html#5485" class="Function">utxo</a> <a id="5490" class="Symbol">:</a> <a id="5492" class="Symbol">(</a><a id="5493" href="Bitcoin.Consistency.html#5493" class="Bound">b</a> <a id="5495" class="Symbol">:</a> <a id="5497" href="Bitcoin.Consistency.html#591" class="Function">Blockchain</a><a id="5507" class="Symbol">)</a> <a id="5509" class="Symbol">→</a> <a id="5511" href="Bitcoin.Consistency.html#2933" class="Datatype">ConsistentBlockchain</a> <a id="5532" href="Bitcoin.Consistency.html#5493" class="Bound">b</a> <a id="5534" class="Symbol">→</a> <a id="5536" href="Prelude.Sets.Interface.html#416" class="Function">Set⟨</a> <a id="5541" href="Bitcoin.Tx.Base.html#793" class="Function">∃TxOutput</a> <a id="5551" href="Prelude.Sets.Interface.html#416" class="Function">⟩</a>
<a id="5553" href="Bitcoin.Consistency.html#5485" class="Function">utxo</a> <a id="5558" class="DottedPattern Symbol">.</a><a id="5559" href="Agda.Builtin.List.html#185" class="DottedPattern InductiveConstructor">[]</a> <a id="5562" href="Bitcoin.Consistency.html#3092" class="InductiveConstructor">∙</a> <a id="5564" class="Symbol">=</a> <a id="5566" href="Prelude.Sets.Interface.html#434" class="Function">∅</a>
<a id="5568" href="Bitcoin.Consistency.html#5485" class="Function">utxo</a> <a id="5573" class="Symbol">(</a><a id="5574" class="DottedPattern Symbol">.((_</a> <a id="5579" href="Agda.Builtin.Sigma.html#236" class="DottedPattern InductiveConstructor Operator">,</a> <a id="5581" class="DottedPattern Symbol">_</a> <a id="5583" href="Agda.Builtin.Sigma.html#236" class="DottedPattern InductiveConstructor Operator">,</a> <a id="5585" href="Bitcoin.Consistency.html#5610" class="DottedPattern Bound">tx</a><a id="5587" class="DottedPattern Symbol">)</a> <a id="5589" href="Bitcoin.Tx.Base.html#2376" class="DottedPattern InductiveConstructor Operator">at</a> <a id="5592" class="DottedPattern Symbol">_)</a> <a id="5595" href="Agda.Builtin.List.html#200" class="InductiveConstructor Operator">∷</a> <a id="5597" href="Bitcoin.Consistency.html#5597" class="Bound">b</a><a id="5598" class="Symbol">)</a> <a id="5600" href="Bitcoin.Consistency.html#5600" class="Bound">vb₀</a><a id="5603" class="Symbol">@(</a><a id="5605" href="Bitcoin.Consistency.html#5605" class="Bound">vb</a> <a id="5608" href="Bitcoin.Consistency.html#3124" class="InductiveConstructor Operator">⊕</a> <a id="5610" href="Bitcoin.Consistency.html#5610" class="Bound">tx</a> <a id="5613" href="Bitcoin.Consistency.html#3124" class="InductiveConstructor Operator">∶-</a> <a id="5616" class="Symbol">_)</a>
  <a id="5621" class="Symbol">=</a> <a id="5623" href="Bitcoin.Consistency.html#5485" class="Function">utxo</a> <a id="5628" href="Bitcoin.Consistency.html#5597" class="Bound">b</a> <a id="5630" href="Bitcoin.Consistency.html#5605" class="Bound">vb</a> <a id="5633" href="Prelude.Sets.Interface.html#500" class="Function Operator">─</a> <a id="5635" href="Prelude.Sets.Interface.html#3982" class="Function">fromList</a> <a id="5644" class="Symbol">(</a><a id="5645" href="Bitcoin.Consistency.html#4955" class="Function">stxo</a> <a id="5650" href="Bitcoin.Consistency.html#5600" class="Bound">vb₀</a><a id="5653" class="Symbol">)</a>
  <a id="5657" href="Prelude.Sets.Interface.html#504" class="Function Operator">∪</a> <a id="5659" href="Bitcoin.Consistency.html#5397" class="Function">utxoₜₓ</a> <a id="5666" class="Symbol">(</a><a id="5667" href="Data.Product.html#2247" class="Function Operator">-,</a> <a id="5670" href="Data.Product.html#2247" class="Function Operator">-,</a> <a id="5673" href="Bitcoin.Consistency.html#5610" class="Bound">tx</a><a id="5675" class="Symbol">)</a>

<a id="5678" class="Comment">-- T0D0: prove equivalence between (1) and (2)</a>

<a id="5726" class="Comment">-- Unspent : (b : Blockchain) → (i : Index b) → let (_ , o , Tᵢ) at tᵢ = b ‼ i in ∀ (j : Fin o) → Set</a>
<a id="5828" class="Comment">-- utxo : (b : Blockchain) → ConsistentBlockchain b → Set⟨ ∃TxOutput ⟩</a>
<a id="5899" class="Comment">-- UTXO : Blockchain → Set⟨ TxInput ⟩</a>

<a id="5938" class="Comment">{-
Unspent→UTXO : ∀ {b : Blockchain} {i : Index b} → let _ , o , tx = transaction (b ‼ i) in
               ∀ {j : Fin o}
  → Unspent b i j
    --————————————————————————
  → ((tx ♯) at toℕ j) ∈ˢ UTXO b
Unspent→UTXO {b} {i} {j} p = {!!}

UTXO→Unspent : ∀ {b : Blockchain} {i : Index b} → let _ , o , tx = transaction (b ‼ i) in
               ∀ {j : Fin o}
  → ((tx ♯) at toℕ j) ∈ˢ UTXO b
    --————————————————————————
  → Unspent b i j
UTXO→Unspent {x ∷ b} {i} {j} p = {!!}
-}</a>

<a id="6418" class="Comment">{- WIP
-- record BlockchainTx : Set where
--   field
--     b : Blockchain
--     i : Index b

--   getTTx : TimedTx
--   getTTx = b ‼ i

--   getTx : ∃Tx
--   getTx = transaction (getTTx b)

-- BlockchainTx = Σ[ b ∈ Blockchain ] Index b

-- getTTx : BlockchainTx → TimedTx
-- getTTx (b , i) = b ‼ i

-- getTx : BlockchainTx → ∃Tx
-- getTx = transaction ∘ getTTx

-- Unspent : (btx : BlockchainTx) →  Pred₀ (Fin $ ∃o $ getTx btx)
-- Unspent (b , i) j =
--   let (_ , o , Tᵢ) at tᵢ = b ‼ i in
--   ∀ (i′ : Index b) (leq : i′ F.≤ i) → let (i′ , _ , Tᵢ′) at tᵢ′ = b ‼ i′ in
--   ∀ (j′ : Fin i′) →
--     Tᵢ , j , tᵢ ↛ Tᵢ′ , j′ , tᵢ′
-}</a>
</pre></body></html>